import{r as l,j as e,b as c}from"./index-CosGzjM2.js";const o="twofaStatus";function J(){const[E,m]=l.useState(!0),[u,i]=l.useState(!1),[x,h]=l.useState(""),[b,f]=l.useState(""),[d,g]=l.useState(""),[p,r]=l.useState(null),[v,n]=l.useState(null),[y,j]=l.useState(!1),[S,N]=l.useState(!1),[w,k]=l.useState(!1),C=async()=>{var s;m(!0),n(null);try{const t=await c.get("/auth/2fa/status"),a=!!((s=t==null?void 0:t.data)!=null&&s.enabled);i(a),localStorage.setItem(o,JSON.stringify({enabled:a}))}catch{try{const t=localStorage.getItem(o),a=t?JSON.parse(t).enabled:!1;i(!!a)}catch{i(!1)}}finally{m(!1)}};l.useEffect(()=>{C()},[]);const I=async()=>{var s,t;j(!0),n(null),r(null),g("");try{const a=await c.post("/auth/2fa/setup"),F=((s=a==null?void 0:a.data)==null?void 0:s.secret)||"",A=((t=a==null?void 0:a.data)==null?void 0:t.otpauth_url)||"";h(F),f(A),!F&&!A&&n("Server 2FA setup endpoint is not available. Please enable it on the backend.")}catch{n("Failed to start setup. Please try again.")}finally{j(!1)}},D=async s=>{var t;if(s.preventDefault(),!!d.trim()){N(!0),n(null),r(null);try{const a=await c.post("/auth/2fa/enable",{code:d.trim()});(t=a==null?void 0:a.data)!=null&&t.enabled?(i(!0),h(""),f(""),localStorage.setItem(o,JSON.stringify({enabled:!0})),r("Two-factor authentication enabled.")):n("Invalid code. Please try again.")}catch{n("Verification failed. Make sure the backend 2FA endpoints are available.")}finally{N(!1)}}},O=async()=>{var s;k(!0),n(null),r(null);try{const t=await c.post("/auth/2fa/disable");((s=t==null?void 0:t.data)==null?void 0:s.disabled)??!0?(i(!1),localStorage.setItem(o,JSON.stringify({enabled:!1})),r("Two-factor authentication disabled.")):n("Could not disable 2FA. Please try again.")}catch{n("Disable failed. Make sure the backend 2FA endpoints are available.")}finally{k(!1)}};return e.jsxs("div",{className:"max-w-3xl",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Two-Factor Authentication"}),p&&e.jsx("div",{className:"mb-3 rounded-lg border border-emerald-200 bg-emerald-50 p-3 text-emerald-800",children:p}),v&&e.jsx("div",{className:"mb-3 rounded-lg border border-rose-200 bg-rose-50 p-3 text-rose-800",children:v}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:E?e.jsx("div",{className:"text-sm text-slate-500",children:"Checking 2FA status…"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Status"}),e.jsx("div",{className:"text-sm text-slate-500",children:u?"Enabled":"Disabled"})]}),u?e.jsx("button",{onClick:O,disabled:w,className:"inline-flex items-center gap-2 h-9 px-4 rounded bg-rose-600 text-white hover:bg-rose-700 disabled:opacity-50",children:w?"Disabling…":"Disable 2FA"}):e.jsx("button",{onClick:I,disabled:y,className:"inline-flex items-center gap-2 h-9 px-4 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:y?"Preparing…":"Set up 2FA"})]}),!u&&(x||b)&&e.jsxs("div",{className:"mt-6 grid md:grid-cols-[200px_1fr] gap-6 items-start",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[b?e.jsx("img",{alt:"Scan in Google Authenticator",className:"rounded-lg border",src:`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(b)}`}):e.jsx("div",{className:"text-xs text-slate-500",children:"QR not available"}),e.jsx("div",{className:"text-[11px] text-slate-500 mt-2 text-center",children:"Scan in your authenticator app"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Secret"}),e.jsx("div",{className:"font-mono text-sm mt-1 bg-slate-50 dark:bg-slate-800 rounded px-2 py-1 inline-block",children:x||"(provided by server)"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"If the QR doesn’t load, add an account manually using this secret."})]}),e.jsxs("form",{onSubmit:D,className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Enter 6-digit code to verify"}),e.jsx("input",{value:d,onChange:s=>g(s.target.value),inputMode:"numeric",pattern:"[0-9]*",maxLength:6,className:"w-full md:w-64 rounded-md border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm bg-white dark:bg-slate-800",placeholder:"123456"}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:S||!d.trim(),className:"inline-flex items-center gap-2 h-9 px-4 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:S?"Verifying…":"Enable 2FA"})})]})]})]})]})})]})}export{J as default};
