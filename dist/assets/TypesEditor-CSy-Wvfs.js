import{r as c,j as e}from"./index-CMgmpHUd.js";import{A as p}from"./admin-P6SYWxkw.js";function A({title:b,category:x}){const[i,d]=c.useState([]),[u,g]=c.useState(""),[v,y]=c.useState(!0),[h,o]=c.useState(!1),[j,N]=c.useState(""),f=async()=>{var s,l;try{y(!0);const t=await p.listTypes(x,{q:u});d(t||[]),N("")}catch(t){N(((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.error)||t.message)}finally{y(!1)}};c.useEffect(()=>{f()},[x]);const S=()=>d([{id:null,name:"",code:"",meta:{}},...i]),C=async s=>{var l,t;try{o(!0);const a={category:x,name:s.name,code:s.code,meta:s.meta||{}},n=s.id?await p.updateType(s.id,a):await p.createType(a);d(r=>r.map(m=>m===s?n:m))}catch(a){alert(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.error)||a.message)}finally{o(!1)}},w=async s=>{var l,t;if(!s.id){d(i.filter(a=>a!==s));return}if(window.confirm("Delete this item?"))try{o(!0),await p.deleteType(s.id),d(i.filter(a=>a.id!==s.id))}catch(a){alert(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.error)||a.message)}finally{o(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:b}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:u,onChange:s=>g(s.target.value),placeholder:"Search…",className:"text-sm border rounded px-2 py-1"}),e.jsx("button",{className:"text-sm px-3 py-1 rounded border",onClick:f,children:"Search"}),e.jsx("button",{className:"text-sm px-3 py-1 rounded bg-blue-600 text-white",onClick:S,children:"Add"})]})]}),j&&e.jsx("div",{className:"text-sm text-rose-600",children:j}),v?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-600",children:[e.jsx("th",{className:"py-2 pr-4",children:"Name"}),e.jsx("th",{className:"py-2 pr-4",children:"Code"}),e.jsx("th",{className:"py-2 pr-4",children:"Meta (JSON)"}),e.jsx("th",{className:"py-2 pr-4 w-40",children:"Actions"})]})}),e.jsxs("tbody",{children:[i.map((s,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.name||"",onChange:t=>d(a=>a.map((n,r)=>r===l?{...n,name:t.target.value}:n)),className:"w-full border rounded px-2 py-1"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.code||"",onChange:t=>d(a=>a.map((n,r)=>r===l?{...n,code:t.target.value}:n)),className:"w-full border rounded px-2 py-1"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.meta?JSON.stringify(s.meta):"",onChange:t=>{let a={};try{a=JSON.parse(t.target.value||"{}")}catch{}d(n=>n.map((r,m)=>m===l?{...r,meta:a}:r))},className:"w-full border rounded px-2 py-1 font-mono",placeholder:"{}"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-sm rounded border",disabled:h,onClick:()=>C(s),children:h?"Saving…":"Save"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",disabled:h,onClick:()=>w(s),children:"Delete"})]})})]},s.id??`new-${l}`)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-6 text-center text-slate-500",children:"No items."})})]})]})})]})}export{A as T};
