import{r,j as e}from"./index-CM-KCFgk.js";import{S as d}from"./settings-BLT9uKql.js";import"./index-Cjud5Sml.js";const g=[{value:"inapp",label:"In-app"},{value:"email",label:"Email"},{value:"sms",label:"SMS"}],y=[{value:"notice",label:"Notice"},{value:"maintenance",label:"Maintenance"},{value:"policy",label:"Policy"}],w=[{value:"low",label:"Low"},{value:"normal",label:"Normal"},{value:"high",label:"High"},{value:"critical",label:"Critical"}];function S(){const[m,h]=r.useState([]),[x,n]=r.useState(""),[p,u]=r.useState(!1),[a,c]=r.useState({title:"",text:"",channel:"inapp",type:"notice",priority:"normal",isActive:!0,showInTicker:!0,showOnDashboard:!1,startAt:"",endAt:""});async function o(){var t,s,i;n("");try{const l=await d.listComms(),N=Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l)?l:[];h(N)}catch(l){console.warn("Failed to list communications, treating as empty.",(t=l==null?void 0:l.response)==null?void 0:t.status,(s=l==null?void 0:l.response)==null?void 0:s.data),h([]),((i=l==null?void 0:l.response)==null?void 0:i.status)===401&&n("You are not authorized. Please sign in again.")}}r.useEffect(()=>{o()},[]);const v=t=>t?new Date(t).toISOString():null;async function b(){var t,s;if(n(""),!a.title.trim()||!a.text.trim()){n("title and text are required");return}u(!0);try{await d.createComm({title:a.title.trim(),text:a.text.trim(),channel:a.channel,type:a.type,priority:a.priority,isActive:!!a.isActive,showInTicker:!!a.showInTicker,showOnDashboard:!!a.showOnDashboard,startAt:v(a.startAt),endAt:v(a.endAt)}),c(i=>({...i,title:"",text:""})),await o()}catch(i){n(((s=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:s.error)||i.message||"Failed to create communication")}finally{u(!1)}}async function j(t){var s,i;if(confirm("Delete this communication?")){n("");try{await d.deleteComm(t),await o()}catch(l){n(((i=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:i.error)||l.message||"Delete failed")}}}return e.jsxs("div",{className:"app-theme-bold card p-4 space-y-3",children:[e.jsx("div",{className:"page-head",children:e.jsx("h1",{className:"text-xl font-extrabold",children:"Communications"})}),x&&e.jsx("div",{className:"text-sm text-rose-600",children:x}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Title"}),e.jsx("input",{className:"input text-sm",value:a.title,onChange:t=>c(s=>({...s,title:t.target.value})),placeholder:"Important Notice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Channel"}),e.jsx("select",{className:"input text-sm ms-select",value:a.channel,onChange:t=>c(s=>({...s,channel:t.target.value})),children:g.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Type"}),e.jsx("select",{className:"input text-sm ms-select",value:a.type,onChange:t=>c(s=>({...s,type:t.target.value})),children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Priority"}),e.jsx("select",{className:"input text-sm ms-select",value:a.priority,onChange:t=>c(s=>({...s,priority:t.target.value})),children:w.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Body"}),e.jsx("textarea",{className:"input text-sm min-h-[120px]",value:a.text,onChange:t=>c(s=>({...s,text:t.target.value})),placeholder:"REMINDER: Submit weekly PAR review by Friday 4:00 PM."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 md:col-span-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"isActive",type:"checkbox",className:"ms-checkbox cursor-pointer",checked:a.isActive,onChange:t=>c(s=>({...s,isActive:t.target.checked}))}),e.jsx("label",{htmlFor:"isActive",className:"text-xs cursor-pointer",children:"Active"})]}),e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"showTicker",type:"checkbox",className:"ms-checkbox cursor-pointer",checked:a.showInTicker,onChange:t=>c(s=>({...s,showInTicker:t.target.checked}))}),e.jsx("label",{htmlFor:"showTicker",className:"text-xs cursor-pointer",children:"Show in ticker (bottom line)"})]}),e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"showDash",type:"checkbox",className:"ms-checkbox cursor-pointer",checked:a.showOnDashboard,onChange:t=>c(s=>({...s,showOnDashboard:t.target.checked}))}),e.jsx("label",{htmlFor:"showDash",className:"text-xs cursor-pointer",children:"Show on dashboard (curated card)"})]})]}),e.jsxs("div",{className:"ms-inline-add md:col-span-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"Start at"}),e.jsx("input",{type:"datetime-local",className:"input text-sm",value:a.startAt,onChange:t=>c(s=>({...s,startAt:t.target.value}))})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs mb-1 muted",children:"End at"}),e.jsx("input",{type:"datetime-local",className:"input text-sm",value:a.endAt,onChange:t=>c(s=>({...s,endAt:t.target.value}))})]}),e.jsx("button",{onClick:b,disabled:p,className:"btn px-3 py-2 bg-white disabled:opacity-60",children:p?"Saving…":"Add"})]})]}),e.jsx("div",{className:"table-frame",children:e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"sticky-head",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Title"}),e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Channel"}),e.jsx("th",{className:"p-2 text-left",children:"Preview"}),e.jsx("th",{className:"p-2"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 muted",colSpan:6,children:"No communications"})}):m.map(t=>e.jsxs("tr",{className:"align-top",children:[e.jsx("td",{className:"p-2",children:t.title}),e.jsx("td",{className:"p-2",children:t.type||"notice"}),e.jsx("td",{className:"p-2",children:t.priority||"normal"}),e.jsx("td",{className:"p-2",children:t.channel||"inapp"}),e.jsxs("td",{className:"p-2 max-w-[520px]",children:[e.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap",children:t.text||t.body||""}),e.jsxs("div",{className:"text-[11px] muted mt-1",children:[t.isActive?"Active":"Inactive"," · ",t.showInTicker?"Ticker":"—"," ",t.showOnDashboard?"· Dashboard":"",t.startAt?` · from ${new Date(t.startAt).toLocaleString()}`:"",t.endAt?` · until ${new Date(t.endAt).toLocaleString()}`:""]})]}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 text-xs btn",onClick:()=>j(t.id||t._id),children:"Delete"})})]},t.id||t._id||t.title))})]})})})]})}export{S as default};
