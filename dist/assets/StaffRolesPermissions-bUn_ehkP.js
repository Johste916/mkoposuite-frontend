import{r as l,j as e}from"./index-D3cCxaCf.js";import{A as o}from"./acl-t4PheKlz.js";import"./index-cuhIMYo8.js";function w(){const[c,p]=l.useState([]),[i,h]=l.useState([]),[u,n]=l.useState(""),[d,m]=l.useState({name:"",description:""});l.useEffect(()=>{(async()=>{var s,t;try{n("");const[a,r]=await Promise.all([o.listRoles(),o.listPermissions()]);p(a||[]),h(r||[])}catch(a){n(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to load roles or permissions")}})()},[]);const j=async()=>{var s,t;try{const a=await o.createRole(d);p([a,...c]),m({name:"",description:""})}catch(a){n(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to create role")}},g=(s,t)=>{h(a=>a.map(r=>{if(r.action!==s)return r;const x=(r.roles||[]).includes(t);return{...r,roles:x?r.roles.filter(f=>f!==t):[...r.roles,t]}}))},b=async s=>{var t,a;try{const r=i.find(x=>x.action===s);await o.updatePermission(s,r.roles||[])}catch(r){n(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||`Failed to update "${s}"`)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Staff Roles & Permissions"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add roles and control which roles can perform each action."})]}),u&&e.jsx("div",{className:"text-sm text-rose-600",children:u}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Role name (e.g., manager)",value:d.name,onChange:s=>m(t=>({...t,name:s.target.value}))}),e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Description",value:d.description,onChange:s=>m(t=>({...t,description:s.target.value}))}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",onClick:j,children:"Create Role"})})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 overflow-x-auto",children:i.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No permissions defined."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4",children:"Action"}),c.map(s=>e.jsx("th",{className:"py-2 pr-4",children:s.name},s.id)),e.jsx("th",{className:"py-2 pr-4",children:"Save"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4",children:s.action}),c.map(t=>{const a=(s.roles||[]).includes(t.name);return e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{type:"checkbox",checked:a,onChange:()=>g(s.action,t.name)})},t.id)}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>b(s.action),children:"Save"})})]},s.action))})]})})]})}export{w as default};
