import{r as l,j as e,b as j}from"./index-Bd6BEfec.js";import{E as T}from"./jspdf.es.min-DGmldSiV.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{C as A}from"./index-D2tfzN6P.js";const M=()=>{const[p,v]=l.useState([]),[m,w]=l.useState({}),[f,N]=l.useState(0),[t,y]=l.useState({borrowerId:"",type:""}),[k,x]=l.useState(!1),[d,n]=l.useState({borrowerId:"",type:"deposit",amount:"",date:"",notes:""}),[h,c]=l.useState(""),u=JSON.parse(localStorage.getItem("user")||"{}"),b=((u==null?void 0:u.role)||"").toLowerCase()==="admin",g=async()=>{var s,r;c("");try{if(!t.borrowerId){v([]),N(0),w({});return}const a=new URLSearchParams;t.type&&a.set("type",t.type);const o=await j._get(`/savings/borrower/${t.borrowerId}?${a.toString()}`);v(o.data.transactions||[]),N(o.data.balance||0),w(o.data.totals||{})}catch(a){c(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.error)||(a==null?void 0:a.normalizedMessage)||"Failed to load savings.")}};l.useEffect(()=>{g()},[t.borrowerId,t.type]);const C=async()=>{var s,r;c("");try{const a={...d};if(!a.borrowerId||!a.type||!a.amount||!a.date){c("Borrower, type, amount and date are required.");return}await j._post("/savings",a),x(!1),n({borrowerId:"",type:"deposit",amount:"",date:"",notes:""}),g()}catch(a){c(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.error)||(a==null?void 0:a.normalizedMessage)||"Failed to save.")}},I=async s=>{var r,a;if(window.confirm("Reverse this transaction?"))try{await j._patch(`/savings/transactions/${s}/reverse`),g()}catch(o){c(((a=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:a.error)||(o==null?void 0:o.normalizedMessage)||"Failed to reverse.")}},S=()=>{const s=new T;s.text("Savings Transactions",14,16),s.autoTable({startY:20,head:[["Date","Type","Amount","Notes","Reversed"]],body:p.map(r=>[r.date,r.type,r.amount,r.notes||"-",r.reversed?"Yes":"No"])}),s.save("savings.pdf")},D=[["Date","Type","Amount","Notes","Reversed"],...p.map(s=>[s.date,s.type,s.amount,s.notes||"",s.reversed?"Yes":"No"])],i="bg-white dark:bg-slate-800 rounded-xl shadow p-4";return e.jsxs("div",{className:"p-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Savings"}),e.jsx("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"+ Add Transaction"})]}),e.jsxs("div",{className:`${i} mb-4`,children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Borrower ID"}),e.jsx("input",{type:"number",placeholder:"Borrower ID",value:t.borrowerId,onChange:s=>y({...t,borrowerId:s.target.value}),className:"border px-3 py-2 rounded w-48 dark:bg-slate-700 dark:border-slate-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"Type"}),e.jsxs("select",{value:t.type,onChange:s=>y({...t,type:s.target.value}),className:"border px-3 py-2 rounded w-48 dark:bg-slate-700 dark:border-slate-600",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"charge",children:"Charge"}),e.jsx("option",{value:"interest",children:"Interest"})]})]})]}),h&&e.jsxs("div",{className:"text-sm text-rose-600 mt-3",children:["Error: ",h]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:i,children:["Balance: ",e.jsx("strong",{children:f})]}),e.jsxs("div",{className:i,children:["Deposits: ",e.jsx("strong",{children:m.deposits||0})]}),e.jsxs("div",{className:i,children:["Withdrawals: ",e.jsx("strong",{children:m.withdrawals||0})]}),e.jsxs("div",{className:i,children:["Charges: ",e.jsx("strong",{children:m.charges||0})]})]}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx(A,{data:D,filename:"savings.csv",className:"bg-green-600 text-white px-4 py-2 rounded",children:"Export CSV"}),e.jsx("button",{onClick:S,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Export PDF"})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-slate-800 border rounded shadow",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Date"}),e.jsx("th",{className:"p-2 border",children:"Type"}),e.jsx("th",{className:"p-2 border",children:"Amount"}),e.jsx("th",{className:"p-2 border",children:"Notes"}),e.jsx("th",{className:"p-2 border",children:"Reversed"}),b&&e.jsx("th",{className:"p-2 border",children:"Action"})]})}),e.jsxs("tbody",{children:[p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:s.date}),e.jsx("td",{className:"border p-2",children:s.type}),e.jsx("td",{className:"border p-2",children:s.amount}),e.jsx("td",{className:"border p-2",children:s.notes||"-"}),e.jsx("td",{className:"border p-2",children:s.reversed?"Yes":"No"}),b&&e.jsx("td",{className:"border p-2",children:!s.reversed&&e.jsx("button",{onClick:()=>I(s.id),className:"text-red-500 text-sm",children:"Reverse"})})]},s.id)),!p.length&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-sm text-slate-500",colSpan:b?6:5,children:t.borrowerId?"No transactions found.":"Enter a Borrower ID to view transactions."})})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded shadow-md w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Add Transaction"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"number",placeholder:"Borrower ID",value:d.borrowerId,onChange:s=>n({...d,borrowerId:s.target.value}),className:"border px-3 py-2 w-full rounded dark:bg-slate-800 dark:border-slate-700"}),e.jsxs("select",{value:d.type,onChange:s=>n({...d,type:s.target.value}),className:"border px-3 py-2 w-full rounded dark:bg-slate-800 dark:border-slate-700",children:[e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"charge",children:"Charge"}),e.jsx("option",{value:"interest",children:"Interest"})]}),e.jsx("input",{type:"number",placeholder:"Amount",value:d.amount,onChange:s=>n({...d,amount:s.target.value}),className:"border px-3 py-2 w-full rounded dark:bg-slate-800 dark:border-slate-700"}),e.jsx("input",{type:"date",value:d.date,onChange:s=>n({...d,date:s.target.value}),className:"border px-3 py-2 w-full rounded dark:bg-slate-800 dark:border-slate-700"}),e.jsx("input",{type:"text",placeholder:"Notes",value:d.notes,onChange:s=>n({...d,notes:s.target.value}),className:"border px-3 py-2 w-full rounded dark:bg-slate-800 dark:border-slate-700"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-300 rounded",children:"Cancel"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Save"})]}),h&&e.jsxs("div",{className:"text-sm text-rose-600",children:["Error: ",h]})]})]})})]})};export{M as default};
