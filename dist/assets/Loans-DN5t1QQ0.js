import{r as n,j as e,a as o}from"./index-DBq0ewuQ.js";import{E as Y}from"./jspdf.es.min-Bv6J8J_k.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{C as z}from"./index-BDx4LDiF.js";const Q=()=>{var N,y;const[w,f]=n.useState([]),[S,D]=n.useState([]),[C,$]=n.useState([]),[u,E]=n.useState("all"),[m,I]=n.useState(""),[x,b]=n.useState(null),[c,j]=n.useState(null),[B,g]=n.useState(!1),[R,M]=n.useState([]),[G,v]=n.useState(!1),[s,l]=n.useState({amount:"",interestRate:"",termMonths:"",interestMethod:"flat",borrowerId:"",branchId:"",startDate:"",endDate:""}),d="https://mkoposuite-backend-42w2.onrender.com/api",i=async()=>{try{v(!0);const t=await o.get(`${d}/loans`);f(t.data||[])}catch(t){console.error("Error fetching loans:",t)}finally{v(!1)}},k=async()=>{try{const t=await o.get(`${d}/borrowers`);D(t.data||[])}catch(t){console.error("Error fetching borrowers:",t)}},L=async()=>{try{const t=await o.get(`${d}/branches`);$(t.data||[])}catch(t){console.error("Error fetching branches:",t)}};n.useEffect(()=>{i(),k(),L()},[]);const A=async t=>{t.preventDefault();try{x?await o.put(`${d}/loans/${x}`,s):await o.post(`${d}/loans`,s),P(),i()}catch(r){console.error("Error saving loan:",r)}},F=t=>{var r,a;l({amount:t.amount,interestRate:t.interestRate,termMonths:t.termMonths,interestMethod:t.interestMethod||"flat",borrowerId:t.borrowerId,branchId:t.branchId,startDate:((r=t.startDate)==null?void 0:r.slice(0,10))||"",endDate:((a=t.endDate)==null?void 0:a.slice(0,10))||""}),b(t.id)},q=async t=>{if(confirm("Are you sure you want to delete this loan?"))try{await o.delete(`${d}/loans/${t}`),i()}catch(r){console.error("Error deleting loan:",r)}},P=()=>{l({amount:"",interestRate:"",termMonths:"",interestMethod:"flat",borrowerId:"",branchId:"",startDate:"",endDate:""}),b(null)},p=async(t,r)=>{try{await o.patch(`${d}/loans/${t}/${r}`),i()}catch(a){console.error(`Error updating loan (${r}):`,a)}},T=async t=>{try{const r=await o.get(`${d}/loans/${t}/schedule`);M(r.data.schedule||[]),g(!0)}catch(r){console.error("Error fetching schedule:",r)}},V=()=>{const t=new Y;t.text("Loan Report",14,16),t.autoTable({startY:20,head:[["Amount","Rate","Term","Borrower","Status"]],body:h.map(r=>{var a;return[r.amount,r.interestRate,r.termMonths,((a=r.Borrower)==null?void 0:a.name)||"N/A",r.status]})}),t.save("loans.pdf")},h=w.filter(t=>{var r,a;return(u==="all"||t.status===u)&&(((a=(r=t.Borrower)==null?void 0:r.name)==null?void 0:a.toLowerCase())||"").includes(m.toLowerCase())}),U=t=>{const r="px-2 py-1 rounded text-xs font-semibold";switch(t){case"pending":return`${r} bg-yellow-100 text-yellow-700`;case"approved":return`${r} bg-green-100 text-green-700`;case"rejected":return`${r} bg-red-100 text-red-700`;case"disbursed":case"active":return`${r} bg-blue-100 text-blue-700`;case"closed":return`${r} bg-gray-100 text-gray-700`;default:return`${r} bg-gray-200 text-gray-600`}};return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Loan Management"}),e.jsxs("form",{onSubmit:A,className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded shadow",children:[e.jsx("input",{type:"number",placeholder:"Amount",value:s.amount,onChange:t=>l({...s,amount:t.target.value}),required:!0,className:"border px-4 py-2 rounded"}),e.jsx("input",{type:"number",placeholder:"Interest Rate (%)",value:s.interestRate,onChange:t=>l({...s,interestRate:t.target.value}),required:!0,className:"border px-4 py-2 rounded"}),e.jsx("input",{type:"number",placeholder:"Term (Months)",value:s.termMonths,onChange:t=>l({...s,termMonths:t.target.value}),required:!0,className:"border px-4 py-2 rounded"}),e.jsxs("select",{value:s.interestMethod,onChange:t=>l({...s,interestMethod:t.target.value}),className:"border px-4 py-2 rounded",children:[e.jsx("option",{value:"flat",children:"Flat"}),e.jsx("option",{value:"reducing",children:"Reducing Balance"})]}),e.jsxs("select",{value:s.borrowerId,onChange:t=>l({...s,borrowerId:t.target.value}),required:!0,className:"border px-4 py-2 rounded",children:[e.jsx("option",{value:"",children:"Select Borrower"}),S.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:s.branchId,onChange:t=>l({...s,branchId:t.target.value}),className:"border px-4 py-2 rounded",children:[e.jsx("option",{value:"",children:"Select Branch"}),C.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("input",{type:"date",value:s.startDate,onChange:t=>l({...s,startDate:t.target.value}),required:!0,className:"border px-4 py-2 rounded"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>l({...s,endDate:t.target.value}),className:"border px-4 py-2 rounded"}),e.jsx("button",{type:"submit",className:"col-span-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:x?"Update Loan":"Create Loan"})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search borrower...",value:m,onChange:t=>I(t.target.value),className:"border px-4 py-2 rounded"}),e.jsxs("select",{value:u,onChange:t=>E(t.target.value),className:"border px-4 py-2 rounded",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"disbursed",children:"Disbursed"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"closed",children:"Closed"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{data:h,filename:"loans.csv",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Export CSV"}),e.jsx("button",{onClick:V,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Export PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded shadow border",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Amount"}),e.jsx("th",{className:"p-2 border",children:"Rate (%)"}),e.jsx("th",{className:"p-2 border",children:"Term"}),e.jsx("th",{className:"p-2 border",children:"Borrower"}),e.jsx("th",{className:"p-2 border",children:"Branch"}),e.jsx("th",{className:"p-2 border",children:"Status"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsxs("tbody",{children:[h.map(t=>{var r,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2",children:t.amount}),e.jsx("td",{className:"border px-2",children:t.interestRate}),e.jsx("td",{className:"border px-2",children:t.termMonths}),e.jsx("td",{className:"border px-2",children:(r=t.Borrower)==null?void 0:r.name}),e.jsx("td",{className:"border px-2",children:(a=t.branch)==null?void 0:a.name}),e.jsx("td",{className:"border px-2",children:e.jsx("span",{className:U(t.status),children:t.status})}),e.jsxs("td",{className:"border px-2 text-center space-x-2",children:[e.jsx("button",{onClick:()=>j(t),className:"text-indigo-600 hover:underline",children:"View"}),e.jsx("button",{onClick:()=>F(t),className:"text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>q(t.id),className:"text-red-600 hover:underline",children:"Delete"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(t.id,"approve"),className:"text-green-600 hover:underline",children:"Approve"}),e.jsx("button",{onClick:()=>p(t.id,"reject"),className:"text-yellow-600 hover:underline",children:"Reject"})]}),t.status==="approved"&&e.jsx("button",{onClick:()=>p(t.id,"disburse"),className:"text-indigo-600 hover:underline",children:"Disburse"}),e.jsx("button",{onClick:()=>T(t.id),className:"text-purple-600 hover:underline",children:"Schedule"})]})]},t.id)}),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center p-4",children:"No loans found."})})]})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Loan Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",c.amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Borrower:"})," ",(N=c.Borrower)==null?void 0:N.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Branch:"})," ",(y=c.branch)==null?void 0:y.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",c.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start Date:"})," ",c.startDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"End Date:"})," ",c.endDate]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>j(null),className:"bg-gray-500 text-white px-4 py-2 rounded",children:"Close"})})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-3xl w-full shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Repayment Schedule"}),e.jsxs("table",{className:"min-w-full border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border px-2",children:"Installment"}),e.jsx("th",{className:"border px-2",children:"Due Date"}),e.jsx("th",{className:"border px-2",children:"Principal"}),e.jsx("th",{className:"border px-2",children:"Interest"}),e.jsx("th",{className:"border px-2",children:"Total"})]})}),e.jsx("tbody",{children:R.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2",children:t.installment}),e.jsx("td",{className:"border px-2",children:t.dueDate}),e.jsx("td",{className:"border px-2",children:t.principal}),e.jsx("td",{className:"border px-2",children:t.interest}),e.jsx("td",{className:"border px-2",children:t.total})]},r))})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>g(!1),className:"bg-gray-500 text-white px-4 py-2 rounded",children:"Close"})})]})})]})};export{Q as default};
