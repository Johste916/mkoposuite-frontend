import{r as o,j as t,L as D}from"./index-CZryhDWz.js";import{a as d}from"./index-Dq7h7Pqt.js";import{E as $}from"./jspdf.es.min-C7MKLJ3x.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{C as E}from"./index-DrG25GLf.js";const k=()=>{const[m,b]=o.useState([]),[s,a]=o.useState({amount:"",interestRate:"",termMonths:"",borrowerId:"",startDate:""}),[u,x]=o.useState(null),[g,j]=o.useState([]),[h,v]=o.useState("all"),n="https://mkoposuite-backend-42w2.onrender.com/api",l=async()=>{try{const e=await d.get(`${n}/loans`);b(e.data)}catch(e){console.error("Error fetching loans:",e)}},N=async()=>{try{const e=await d.get(`${n}/borrowers`);j(e.data)}catch(e){console.error("Error fetching borrowers:",e)}},w=async e=>{e.preventDefault();try{u?await d.put(`${n}/loans/${u}`,s):await d.post(`${n}/loans`,s),a({amount:"",interestRate:"",termMonths:"",borrowerId:"",startDate:""}),x(null),l()}catch(r){console.error("Error saving loan:",r)}},y=e=>{a({amount:e.amount,interestRate:e.interestRate,termMonths:e.termMonths,borrowerId:e.borrowerId,startDate:e.startDate?e.startDate.slice(0,10):""}),x(e.id)},f=async e=>{if(confirm("Are you sure you want to delete this loan?"))try{await d.delete(`${n}/loans/${e}`),l()}catch(r){console.error("Error deleting loan:",r)}},p=async(e,r)=>{try{await d.patch(`${n}/loans/${e}/status`,{status:r}),l()}catch(i){console.error(`Error updating loan status to ${r}:`,i)}},S=e=>{const r="px-2 py-1 rounded text-xs font-semibold";switch(e){case"pending":return`${r} bg-yellow-100 text-yellow-700`;case"approved":return`${r} bg-green-100 text-green-700`;case"rejected":return`${r} bg-red-100 text-red-700`;case"active":return`${r} bg-blue-100 text-blue-700`;case"closed":return`${r} bg-gray-100 text-gray-700`;default:return`${r} bg-gray-200 text-gray-600`}},C=()=>{const e=new $;e.text("Loan Report",14,16),e.autoTable({startY:20,head:[["Amount","Interest","Term","Start Date","Borrower","Status"]],body:c.map(r=>{var i;return[r.amount,r.interestRate,r.termMonths,r.startDate,((i=r.Borrower)==null?void 0:i.name)||"N/A",r.status]})}),e.save("loans.pdf")},c=m.filter(e=>h==="all"||e.status===h);return o.useEffect(()=>{l(),N()},[]),t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Loan Management"}),t.jsxs("form",{onSubmit:w,className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded shadow",children:[t.jsx("input",{type:"number",placeholder:"Amount",value:s.amount,onChange:e=>a({...s,amount:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsx("input",{type:"number",placeholder:"Interest Rate (%)",value:s.interestRate,onChange:e=>a({...s,interestRate:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsx("input",{type:"number",placeholder:"Term (Months)",value:s.termMonths,onChange:e=>a({...s,termMonths:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsxs("select",{value:s.borrowerId,onChange:e=>a({...s,borrowerId:e.target.value}),required:!0,className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"",children:"Select Borrower"}),g.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx("input",{type:"date",value:s.startDate,onChange:e=>a({...s,startDate:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsx("button",{type:"submit",className:"col-span-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:u?"Update Loan":"Create Loan"})]}),t.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[t.jsxs("select",{value:h,onChange:e=>v(e.target.value),className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"all",children:"All Statuses"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"approved",children:"Approved"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"rejected",children:"Rejected"}),t.jsx("option",{value:"closed",children:"Closed"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(E,{data:c,filename:"loans.csv",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Export CSV"}),t.jsx("button",{onClick:C,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Export PDF"})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white rounded shadow table-auto border",children:[t.jsx("thead",{className:"bg-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 border",children:"Amount"}),t.jsx("th",{className:"p-2 border",children:"Interest Rate (%)"}),t.jsx("th",{className:"p-2 border",children:"Term (Months)"}),t.jsx("th",{className:"p-2 border",children:"Start Date"}),t.jsx("th",{className:"p-2 border",children:"Borrower"}),t.jsx("th",{className:"p-2 border",children:"Status"}),t.jsx("th",{className:"p-2 border",children:"Actions"})]})}),t.jsxs("tbody",{children:[c.map(e=>{var r;return t.jsxs("tr",{children:[t.jsx("td",{className:"border px-2",children:e.amount}),t.jsx("td",{className:"border px-2",children:e.interestRate}),t.jsx("td",{className:"border px-2",children:e.termMonths}),t.jsx("td",{className:"border px-2",children:e.startDate}),t.jsx("td",{className:"border px-2",children:((r=e.Borrower)==null?void 0:r.name)||"N/A"}),t.jsx("td",{className:"border px-2",children:t.jsx("span",{className:S(e.status),children:e.status})}),t.jsxs("td",{className:"border px-2 text-center space-x-2",children:[t.jsx(D,{to:`/loans/${e.id}`,className:"text-indigo-600 hover:underline",children:"View"}),t.jsx("button",{onClick:()=>y(e),className:"text-blue-600 hover:underline",children:"Edit"}),t.jsx("button",{onClick:()=>f(e.id),className:"text-red-600 hover:underline",children:"Delete"}),e.status==="pending"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>p(e.id,"approved"),className:"text-green-600 hover:underline",children:"Approve"}),t.jsx("button",{onClick:()=>p(e.id,"rejected"),className:"text-yellow-600 hover:underline",children:"Reject"})]}),e.status==="approved"&&t.jsx("button",{onClick:()=>p(e.id,"active"),className:"text-indigo-600 hover:underline",children:"Disburse"})]})]},e.id)}),c.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:"7",className:"text-center p-4",children:"No loans found."})})]})]})})]})};export{k as default};
