import{r as d,g as j,j as e}from"./index-sMnl2-1N.js";const n=()=>({accountId:"",debit:"",credit:"",description:""});function A(){const[u,N]=d.useState(()=>new Date().toISOString().slice(0,10)),[m,b]=d.useState(""),[l,i]=d.useState([n(),n()]),[f,v]=d.useState([]),[h,y]=d.useState(!1),[p,c]=d.useState({type:"",text:""});d.useEffect(()=>{(async()=>{var s,r;try{const{data:t}=await j.get("/accounting/chart-of-accounts");v(Array.isArray(t)?t:[])}catch(t){c({type:"error",text:((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.error)||t.message})}})()},[]);const o=d.useMemo(()=>l.reduce((s,r)=>(s.debit+=Number(r.debit||0),s.credit+=Number(r.credit||0),s),{debit:0,credit:0}),[l]),g=Number(o.debit.toFixed(2))===Number(o.credit.toFixed(2)),x=(s,r)=>{i(t=>t.map((a,C)=>C===s?{...a,...r}:a))},w=()=>i(s=>[...s,n()]),k=s=>i(r=>r.filter((t,a)=>a!==s)),S=async()=>{var r,t;if(c({type:"",text:""}),!g){c({type:"error",text:"Debits must equal credits."});return}const s={date:u,memo:m,lines:l.filter(a=>a.accountId&&(Number(a.debit||0)>0||Number(a.credit||0)>0)).map(a=>({accountId:a.accountId,debit:Number(a.debit||0),credit:Number(a.credit||0),description:a.description||void 0}))};if(!s.lines.length){c({type:"error",text:"Add at least one non-zero line."});return}try{y(!0);const{data:a}=await j.post("/accounting/manual-journal",s);c({type:"ok",text:`Journal posted (ID ${a==null?void 0:a.journalId}).`}),i([n(),n()]),b("")}catch(a){c({type:"error",text:((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.error)||a.message})}finally{y(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4 space-y-3",children:[e.jsx("div",{className:"flex items-end justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Manual Journal"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Post balanced debits and credits"})]})}),p.text&&e.jsx("div",{className:`text-sm px-3 py-2 rounded ${p.type==="ok"?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-600"}`,children:p.text}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("label",{className:"block text-xs opacity-70",children:"Date"}),e.jsx("input",{type:"date",value:u,onChange:s=>N(s.target.value),className:"border rounded px-2 py-1 dark:bg-gray-700"})]}),e.jsxs("div",{className:"flex-1 text-sm min-w-[280px]",children:[e.jsx("label",{className:"block text-xs opacity-70",children:"Memo"}),e.jsx("input",{value:m,onChange:s=>b(s.target.value),placeholder:"e.g. Adjusting entry",className:"w-full border rounded px-2 py-1 dark:bg-gray-700"})]})]}),e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"px-3 py-2 w-64",children:"Account"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Debit"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Credit"}),e.jsx("th",{className:"px-3 py-2",children:"Description"}),e.jsx("th",{className:"px-3 py-2 w-10"})]})}),e.jsx("tbody",{children:l.map((s,r)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{value:s.accountId,onChange:t=>x(r,{accountId:t.target.value}),className:"w-full border rounded px-2 py-1 dark:bg-gray-700",children:[e.jsx("option",{value:"",children:"Select account…"}),f.map(t=>e.jsxs("option",{value:t.id,children:[(t.code||t.accountCode||t.number)??"—"," — ",(t.name||t.accountName||t.title)??"—"]},t.id))]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.debit,onChange:t=>x(r,{debit:t.target.value,credit:""}),className:"w-full border rounded px-2 py-1 text-right dark:bg-gray-700"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.credit,onChange:t=>x(r,{credit:t.target.value,debit:""}),className:"w-full border rounded px-2 py-1 text-right dark:bg-gray-700"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{value:s.description,onChange:t=>x(r,{description:t.target.value}),className:"w-full border rounded px-2 py-1 dark:bg-gray-700"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>k(r),className:"px-2 py-1 rounded border",children:"×"})})]},r))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"font-semibold border-t",children:[e.jsx("td",{className:"px-3 py-2 text-right",children:"Totals"}),e.jsx("td",{className:"px-3 py-2 text-right",children:o.debit.toLocaleString()}),e.jsx("td",{className:"px-3 py-2 text-right",children:o.credit.toLocaleString()}),e.jsx("td",{className:"px-3 py-2",colSpan:2,children:g?e.jsx("span",{className:"text-emerald-600",children:"Balanced"}):e.jsx("span",{className:"text-red-600",children:"Not balanced"})})]})})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:w,className:"px-3 py-2 rounded border",children:"Add line"}),e.jsx("button",{disabled:h,onClick:S,className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-60",children:h?"Posting…":"Post Journal"})]})]})}export{A as default};
