const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-jApFZpkQ.js","assets/index-L976ZryY.js","assets/index-Bo2NLxGI.css"])))=>i.map(i=>d[i]);
import{_ as $e,r as b,j as e,i as Qe,u as et,L as re,h as w}from"./index-L976ZryY.js";const c=(t,d="TZS")=>`‎${d} ${Number(t||0).toLocaleString()}`,G=t=>t?new Date(t).toLocaleDateString():"—",tt=t=>t?new Date(t).toLocaleString():"",q=t=>{if(!t)return"";const d=new Date(t);return Number.isNaN(d.getTime())?String(t).slice(0,10):d.toISOString().slice(0,10)};function st(t){return t?Array.isArray(t)?t:Array.isArray(t.schedule)?t.schedule:Array.isArray(t.rows)?t.rows:Array.isArray(t.data)?t.data:null:null}function at(t=[],d=0){let s=Number(d||0),l=0,i=0,N=0,g=0;for(const u of t){const p=Number(u.fee??u.fees??0),v=Number(u.penalty??0),o=Number(u.interest??0),k=Number(u.principal??0);if(s<=0)break;const P=Math.min(s,p);if(g+=P,s-=P,s<=0)break;const D=Math.min(s,v);if(N+=D,s-=D,s<=0)break;const $=Math.min(s,o);if(i+=$,s-=$,s<=0)break;const j=Math.min(s,k);l+=j,s-=j}return{paidPrincipal:l,paidInterest:i,paidPenalty:N,paidFees:g}}const Le=t=>{const d=Number((t==null?void 0:t.principal)||0),s=Number((t==null?void 0:t.interest)||0),l=Number((t==null?void 0:t.penalty)||0),i=Number((t==null?void 0:t.fee)??(t==null?void 0:t.fees)??0),N=(t==null?void 0:t.total)!=null?Number(t.total):d+s+l+i;if((t==null?void 0:t.balance)!=null&&!Number.isNaN(Number(t.balance)))return Number(t.balance);if((t==null?void 0:t.paidPrincipal)!=null||(t==null?void 0:t.paidInterest)!=null||(t==null?void 0:t.paidPenalty)!=null||(t==null?void 0:t.paidFees)!=null||(t==null?void 0:t.paidFee)!=null){const u=Number(t.paidPrincipal||0),p=Number(t.paidInterest||0),v=Number(t.paidPenalty||0),o=Number(t.paidFees||0)+Number(t.paidFee||0);return Math.max(N-(u+p+v+o),0)}return N},Re=["#","Due Date","Principal","Interest","Total P&I","Penalty","Fees","Paid Principal","Paid Interest","Outstanding","Status"];function le(t=[]){const d=[];for(let l=0;l<t.length;l++){const i=t[l],N=Number(i.principal||0),g=Number(i.interest||0),u=Number(i.penalty||0),p=Number(i.fee??i.fees??0),v=i.paidPrincipal!=null?Number(i.paidPrincipal):null,o=i.paidInterest!=null?Number(i.paidInterest):null,k=Le(i),P=k<=1e-6?"Settled":"Pending";d.push({idx:i.installment??i.period??l+1,dueDateISO:q(i.dueDate??i.date??""),principal:N,interest:g,penalty:u,fees:p,pi:N+g,paidP:v,paidI:o,outstanding:k,status:P})}return d}function pe(t=[],d=[]){const s=Array.isArray(t)?t:[],l=L=>s.reduce((m,y)=>m+Number((y==null?void 0:y[L])||0),0),i=l("principal"),N=l("interest"),g=l("penalty"),u=l("fee")+l("fees"),p=l("total")||i+N+g+u,v=(Array.isArray(d)?d:[]).reduce((L,m)=>L+Number(m.amount||0),0),o=l("paidPrincipal")||0,k=l("paidInterest")||0,P=l("paidPenalty")||0,D=l("paidFees")+l("paidFee")||0,j=o+k+P+D>0?{paidPrincipal:o,paidInterest:k,paidPenalty:P,paidFees:D}:at(s,v),f=Math.max(p-v,0),I=s.find(L=>Le(L)>0)||null,z=I?{idx:I.installment??I.period??s.indexOf(I)+1,date:I.dueDate||I.date||null,amount:Number(I.total??0)}:null;return{scheduledPrincipal:i,scheduledInterest:N,scheduledPenalty:g,scheduledFees:u,scheduledTotal:p,totalPaid:v,outstanding:f,outstandingTotal:f,nextDue:z,...j}}function it({loan:t,schedule:d=[],currency:s="TZS",method:l="",company:i={}}){var j;if(!d.length)return;const N=[["Company",i.name||""],["Address",i.address||""],["Phone",i.phone||""],["Email",i.email||""],["Website",i.website||""],[],["Loan ID",(t==null?void 0:t.id)??""],["Borrower",((j=t==null?void 0:t.Borrower)==null?void 0:j.name)||(t==null?void 0:t.borrowerName)||""],["Status",(t==null?void 0:t.status)||""],["Currency",s],["Interest Method",l||(t==null?void 0:t.interestMethod)||""],["Disbursed",q((t==null?void 0:t.releaseDate)||(t==null?void 0:t.startDate)||"")],["Generated At",new Date().toLocaleString()],[]],g=Re.slice(0,-1).concat("Settled"),u=le(d).map(f=>[f.idx,f.dueDateISO,f.principal,f.interest,f.pi,f.penalty,f.fees,f.paidP??"",f.paidI??"",f.outstanding,f.outstanding<=1e-6?"YES":"NO"]),p=pe(d,[]),v=[[],["Totals","",p.scheduledPrincipal,p.scheduledInterest,p.scheduledPrincipal+p.scheduledInterest,p.scheduledPenalty,p.scheduledFees,p.paidPrincipal,p.paidInterest,p.outstanding,""],["Total Paid","","","","","","","","",p.totalPaid,""]],k=[...N,g,...u,...v].map(f=>f.map(I=>`"${String(I??"").replace(/"/g,'""')}"`).join(",")).join(`
`),P=new Blob([k],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(P),$=document.createElement("a");$.href=D,$.download=`loan_${(t==null?void 0:t.id)??"schedule"}.csv`,$.click(),URL.revokeObjectURL(D)}async function nt({loan:t,schedule:d=[],currency:s="TZS",method:l="",company:i={}}){var z,L;if(!d.length)return;let N,g;try{N=(await $e(async()=>{const{default:m}=await import("./jspdf.es.min-jApFZpkQ.js").then(y=>y.j);return{default:m}},__vite__mapDeps([0,1,2]))).default,g=(await $e(async()=>{const{default:m}=await import("./jspdf.plugin.autotable-CfO62xhj.js");return{default:m}},[])).default}catch{return rt({loan:t,schedule:d,currency:s,method:l,company:i})}const u=new N({unit:"pt",format:"a4"}),p=u.internal.pageSize.getWidth(),v=40;let o=40;if(i.logoUrl)try{const m=await fetch(i.logoUrl).then(F=>F.blob()),y=new FileReader,S=new Promise(F=>{y.onload=()=>F(y.result)});y.readAsDataURL(m);const T=await S;u.addImage(T,"PNG",v,o,120,40)}catch{}u.setFontSize(14),u.text(i.name||"Company",v,o+65),u.setFontSize(10),[i.address,[i.phone,i.email].filter(Boolean).join("  •  "),i.website].filter(Boolean).forEach((m,y)=>u.text(String(m),v,o+80+y*14)),u.setFontSize(16),u.text("Loan Repayment Schedule",p-40,50,{align:"right"}),u.setFontSize(10),[`Loan ID: ${(t==null?void 0:t.id)??""}`,`Borrower: ${((z=t==null?void 0:t.Borrower)==null?void 0:z.name)||(t==null?void 0:t.borrowerName)||""}`,`Status: ${(t==null?void 0:t.status)||""}`,`Currency: ${s}`,`Interest Method: ${l||(t==null?void 0:t.interestMethod)||""}`,`Disbursed: ${q((t==null?void 0:t.releaseDate)||(t==null?void 0:t.startDate)||"")}`,`Generated: ${new Date().toLocaleString()}`].forEach((m,y)=>u.text(m,p-40,68+y*14,{align:"right"}));const P=[{header:"#",dataKey:"idx"},{header:"Due Date",dataKey:"dueDate"},{header:"Principal",dataKey:"principal"},{header:"Interest",dataKey:"interest"},{header:"Total P&I",dataKey:"pi"},{header:"Penalty",dataKey:"penalty"},{header:"Fees",dataKey:"fees"},{header:"Paid Principal",dataKey:"paidP"},{header:"Paid Interest",dataKey:"paidI"},{header:"Outstanding",dataKey:"outstanding"},{header:"Settled",dataKey:"settled"}],D=1e-6,$=le(d).map(m=>({idx:m.idx,dueDate:m.dueDateISO,principal:c(m.principal,s),interest:c(m.interest,s),pi:c(m.pi,s),penalty:c(m.penalty,s),fees:c(m.fees,s),paidP:m.paidP==null?"—":c(m.paidP,s),paidI:m.paidI==null?"—":c(m.paidI,s),outstanding:c(m.outstanding,s),settled:m.outstanding<=D?"YES":"NO"}));g(u,{head:[P.map(m=>m.header)],body:$.map(m=>P.map(y=>m[y.dataKey])),startY:140,styles:{fontSize:9},headStyles:{fillColor:[243,244,246],textColor:20},alternateRowStyles:{fillColor:[250,250,250]},margin:{left:40,right:40},didDrawPage:()=>{const m=`Page ${u.internal.getNumberOfPages()}`;u.setFontSize(9),u.text(m,p-40,u.internal.pageSize.getHeight()-20,{align:"right"})}});const j=pe(d,[]);let f=((L=u.lastAutoTable)==null?void 0:L.finalY)||140;f+=16,u.setFontSize(11),u.text("Summary",40,f),f+=8,u.setFontSize(10),[["Principal (Sched.)",c(j.scheduledPrincipal,s)],["Interest (Sched.)",c(j.scheduledInterest,s)],["Total P&I (Sched.)",c(j.scheduledPrincipal+j.scheduledInterest,s)],["Penalty (Sched.)",c(j.scheduledPenalty,s)],["Fees (Sched.)",c(j.scheduledFees,s)],["Total Payable",c(j.scheduledTotal,s)],["Paid Principal",c(j.paidPrincipal,s)],["Paid Interest",c(j.paidInterest,s)],["Total Paid",c(j.totalPaid,s)],["Outstanding",c(j.outstanding,s)]].forEach((m,y)=>{u.text(m[0],40,f+16+y*14),u.text(m[1],p-40,f+16+y*14,{align:"right"})}),u.save(`loan_${(t==null?void 0:t.id)??"schedule"}.pdf`)}function rt({loan:t,schedule:d=[],currency:s,method:l,company:i}){var v;const N=le(d).map(o=>`
      <tr>
        <td>${o.idx}</td>
        <td>${o.dueDateISO}</td>
        <td>${c(o.principal,s)}</td>
        <td>${c(o.interest,s)}</td>
        <td>${c(o.pi,s)}</td>
        <td>${c(o.penalty,s)}</td>
        <td>${c(o.fees,s)}</td>
        <td>${o.paidP==null?"—":c(o.paidP,s)}</td>
        <td>${o.paidI==null?"—":c(o.paidI,s)}</td>
        <td>${c(o.outstanding,s)}</td>
        <td>${o.outstanding<=1e-6?"YES":"NO"}</td>
      </tr>`).join(""),g=i!=null&&i.logoUrl?`<img src="${i.logoUrl}" style="height:48px;object-fit:contain;margin-right:12px;" />`:"",u=`
    <html>
      <head>
        <meta charset="utf-8" />
        <title>Loan ${(t==null?void 0:t.id)??""} Schedule</title>
        <style>
          body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial; color:#111827; }
          .container { max-width: 1024px; margin: 24px auto; }
          .header { display:flex; align-items:center; justify-content:space-between; }
          .company { display:flex; align-items:center; }
          .company h1 { margin:0; font-size:18px; }
          .muted { color:#6B7280; font-size:12px; }
          table { width:100%; border-collapse: collapse; margin-top: 16px; }
          th, td { border: 1px solid #E5E7EB; padding: 6px 8px; font-size: 12px; }
          thead { background:#F3F4F6; }
          .summary { margin-top:16px; display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:8px; }
          .card { border:1px solid #E5E7EB; padding:8px 10px; border-radius:8px; }
          @media print { .no-print { display:none; } }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <div class="company">
              ${g}
              <div>
                <h1>${(i==null?void 0:i.name)||""}</h1>
                <div class="muted">
                  ${[i==null?void 0:i.address,i==null?void 0:i.phone,i==null?void 0:i.email,i==null?void 0:i.website].filter(Boolean).join(" • ")}
                </div>
              </div>
            </div>
            <div>
              <div style="font-weight:600;">Loan Repayment Schedule</div>
              <div class="muted">Generated: ${new Date().toLocaleString()}</div>
            </div>
          </div>

          <div style="margin-top:12px;font-size:12px;">
            <div><b>Loan ID:</b> ${(t==null?void 0:t.id)??""}</div>
            <div><b>Borrower:</b> ${((v=t==null?void 0:t.Borrower)==null?void 0:v.name)||(t==null?void 0:t.borrowerName)||""}</div>
            <div><b>Status:</b> ${(t==null?void 0:t.status)||""}</div>
            <div><b>Currency:</b> ${(t==null?void 0:t.currency)||s} &nbsp; • &nbsp; <b>Interest Method:</b> ${l||(t==null?void 0:t.interestMethod)||""}</div>
            <div><b>Disbursed:</b> ${q((t==null?void 0:t.releaseDate)||(t==null?void 0:t.startDate)||"")}</div>
          </div>

          <table>
            <thead>
              <tr>${Re.map(o=>`<th>${o}</th>`).join("")}<th>Settled</th></tr>
            </thead>
            <tbody>${N}</tbody>
          </table>

          <div class="no-print" style="margin-top:16px;">
            <button onclick="window.print()" style="padding:8px 12px;border:1px solid #E5E7EB;border-radius:8px;background:white;cursor:pointer;">Print / Save as PDF</button>
          </div>
        </div>
      </body>
    </html>
  `,p=window.open("","_blank","noopener,noreferrer,width=1024,height=768");p&&(p.document.open(),p.document.write(u),p.document.close())}function dt({schedule:t=[],currency:d="TZS"}){const s=b.useMemo(()=>le(t||[]),[t,d]);return s.length?e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-slate-900",children:e.jsxs("table",{className:"min-w-full text-base",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 sticky top-0 z-10",children:e.jsxs("tr",{className:"text-left dark:text-slate-200",children:[e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"#"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"Due Date"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Principal"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Interest"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Total P&I"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Penalty"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Fees"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Paid Principal"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Paid Interest"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Outstanding"}),e.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:s.map((l,i)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800 dark:text-slate-100",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:l.idx}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:l.dueDateISO}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.principal,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.interest,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.pi,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.penalty,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.fees,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:l.paidP==null?"—":c(l.paidP,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:l.paidI==null?"—":c(l.paidI,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:c(l.outstanding,d)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:l.status==="Settled"?e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:ring-emerald-900",children:"Settled"}):e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:ring-amber-900",children:"Pending"})})]},i))})]})}):e.jsx("div",{className:"text-sm text-gray-600 dark:text-slate-300",children:"No schedule available."})}const n={page:"w-full px-4 md:px-6 py-6 space-y-6 bg-[var(--bg)] text-[var(--fg)]",h1:"text-4xl font-extrabold tracking-tight",sub:"text-sm text-[var(--muted)]",card:"card rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",cardHead:"px-6 py-4 border-b-2 border-[var(--border)] bg-[var(--table-head-bg)] flex items-center justify-between rounded-t-2xl",cardBody:"px-6 py-6",cardBodyDense:"px-6 py-4",label:"text-[12px] uppercase tracking-wide text-[var(--muted)] font-semibold",actionLink:"inline-flex items-center gap-1 font-extrabold text-[var(--primary)] underline underline-offset-4 decoration-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",chip:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-[11px] font-extrabold uppercase ring-2 ring-[var(--border)] bg-[var(--badge-bg)] text-[var(--badge-fg)]",btn:"inline-flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg font-semibold border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)] hover:bg-[var(--chip-soft)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]",primary:"inline-flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg font-semibold bg-[var(--primary)] text-[var(--primary-contrast)] hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)] disabled:opacity-60",input:"w-full rounded-lg border-2 px-3 py-2 outline-none bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)] placeholder:text-[var(--input-placeholder)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]",tableWrap:"overflow-x-auto rounded-xl border-2 border-[var(--border-strong)] bg-[var(--card)]",th:"bg-[var(--table-head-bg)] text-left text-[12px] uppercase tracking-wide font-semibold px-3 py-2 border border-[var(--border)] text-[var(--fg)]/90",td:"px-3 py-2 border border-[var(--border)] text-sm text-[var(--fg)]"},de=({title:t,subtitle:d,right:s,children:l,dense:i=!1})=>e.jsxs("div",{className:n.card,children:[(t||d||s)&&e.jsxs("div",{className:n.cardHead,children:[e.jsxs("div",{className:"min-w-0",children:[t&&e.jsx("h3",{className:"text-xl md:text-2xl font-extrabold tracking-tight",children:t}),d&&e.jsx("p",{className:n.sub,children:d})]}),s]}),e.jsx("div",{className:i?n.cardBodyDense:n.cardBody,children:l})]}),O=({children:t})=>e.jsx("div",{className:n.label,children:t}),lt=()=>{try{return(JSON.parse(localStorage.getItem("user")||"{}").role||"").toLowerCase()}catch{return""}},H=t=>t==="admin"||t==="director"||t==="superadmin",ct=t=>["branch_manager","manager","bm"].includes(t)||H(t),ot=t=>["compliance","compliance_officer","legal"].includes(t)||H(t),ut=t=>["accountant","finance"].includes(t)||H(t),mt=t=>["loan_officer","officer"].includes(t)&&!H(t);function ht(t){if(!t)return"";const d=String(t).toLowerCase();return d==="pending"?"submitted":d==="approved"?"accounting":""}function xt(){var Ce,De;const{id:t}=Qe(),d=et(),[s,l]=b.useState(null),[i,N]=b.useState(null),[g,u]=b.useState([]),[p,v]=b.useState([]),[o,k]=b.useState(null),[P,D]=b.useState(!0),[$,j]=b.useState(!0),[f,I]=b.useState(!0),[z,L]=b.useState(!1),[m,y]=b.useState(null),[S,T]=b.useState(""),[F,xe]=b.useState(""),[A,J]=b.useState(!1),[ce,oe]=b.useState(""),[Fe,X]=b.useState(!1),[be,ge]=b.useState(!1),[U,Y]=b.useState({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),[Ae,ue]=b.useState(!1),[Ee,Q]=b.useState(!1),[R,V]=b.useState({amount:"",interestRate:"",termMonths:"",startDate:""}),[fe,ve]=b.useState(!1),[Me,ee]=b.useState(!1),[M,te]=b.useState({termMonths:"",startDate:"",previewOnly:!1}),[je,Ne]=b.useState(!1),C=(s==null?void 0:s.currency)||"TZS",_e=n.chip,K=lt(),me=ct(K),ye=ot(K),Oe=ut(K),Te=mt(K),Be=H(K)||me||ye,ze=H(K)||me,W=(s==null?void 0:s.workflowStage)||ht(s==null?void 0:s.status),we=Te&&["changes_requested","bm_changes_requested","compliance_changes_requested","returned_to_officer","request_changes"].includes(W),se=me&&["submitted","bm_review","changes_resubmitted"].includes(W),Se=ye&&["compliance","compliance_review"].includes(W),ke=Oe&&((s==null?void 0:s.status)==="approved"||W==="accounting"),Pe=b.useRef(null),E=async()=>{D(!0),y(null);try{const{data:a}=await w.get(`/loans/${t}`);l(a),xe(String((a==null?void 0:a.amount)??""));const r=[w.get(`/repayments/loan/${t}`).then(x=>u(x.data||[])).catch(()=>u([])).finally(()=>j(!1)),w.get(`/comments/loan/${t}`).then(x=>v(Array.isArray(x.data)?x.data:[])).catch(()=>v([])).finally(()=>I(!1))];a!=null&&a.productId&&r.push(w.get(`/loan-products/${a.productId}`).then(x=>N(x.data)).catch(()=>N(null))),L(!0),r.push(w.get(`/loans/${t}/schedule`).then(x=>k(st(x.data))).catch(()=>k(null)).finally(()=>L(!1))),await Promise.all(r)}catch(a){console.error(a),y("Failed to fetch loan.")}finally{D(!1)}};b.useEffect(()=>{Pe.current!==t&&(Pe.current=t,k(null),T(""),oe(""),j(!0),I(!0),E())},[t]),b.useEffect(()=>{const a=()=>E();return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)},[]),b.useEffect(()=>{const a=r=>{var x;String((x=r==null?void 0:r.detail)==null?void 0:x.id)===String(t)&&E()};return window.addEventListener("loan:updated",a),()=>window.removeEventListener("loan:updated",a)},[t]);async function Z(a){try{await w.post("/comments",{loanId:t,content:a});const r=await w.get(`/comments/loan/${t}`);v(Array.isArray(r.data)?r.data:[])}catch{}}async function ae(a,r={}){J(!0);try{await w.post(`/loans/${t}/workflow`,{action:a,comment:(S==null?void 0:S.trim())||void 0,suggestedAmount:r.suggestedAmount!=null&&r.suggestedAmount!==""?Number(r.suggestedAmount):void 0}),await E(),T(""),alert("Action applied.")}catch{try{a==="bm_approve"||a==="compliance_approve"?(await w.patch(`/loans/${t}/status`,{status:"approved"}),S.trim()&&await Z(S.trim())):a==="reject"?(await w.patch(`/loans/${t}/status`,{status:"rejected"}),S.trim()&&await Z(S.trim())):a==="request_changes"?S.trim()&&await Z(`Changes requested: ${S.trim()}`):a==="resubmit"&&(await w.patch(`/loans/${t}/status`,{status:"pending"}),S.trim()&&await Z(`Resubmitted: ${S.trim()}`)),await E(),T(""),alert("Action applied (fallback).")}catch(h){console.error(h),alert("Failed to apply action.")}}finally{J(!1)}}async function Ue(){if(!F||Number(F)<=0){alert("Enter a valid amount.");return}J(!0);try{await w.patch(`/loans/${t}`,{amount:Number(F)}),S.trim()&&await Z(`Suggested amount: ${c(F,C)} — ${S.trim()}`),await E(),alert("Suggestion saved.")}catch(a){console.error(a),alert("Failed to save suggestion.")}finally{J(!1)}}const Ke=async()=>{const a=Number(ie||0);if(!(a>0&&!window.confirm("Outstanding > 0. Close anyway?")))try{await w.patch(`/loans/${t}/status`,{status:"closed",override:a>0}),await E(),alert("Loan closed.")}catch(r){console.error(r),alert("Failed to close loan.")}},We=async()=>{if(ce.trim())try{const a=await w.post("/comments",{loanId:t,content:ce});v(r=>[a.data,...r]),oe("")}catch(a){console.error(a),alert("Failed to add comment.")}},qe=async()=>{const a=Number(U.amount);if(!a||a<=0)return alert("Enter a valid amount.");ge(!0);try{if(await w.post("/repayments",{loanId:t,...U,amount:a}),s!=null&&s.status&&!["active","closed"].includes(String(s.status).toLowerCase()))try{await w.patch(`/loans/${t}/status`,{status:"active"})}catch{}await E(),X(!1),Y({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),window.dispatchEvent(new CustomEvent("loan:updated",{detail:{id:t}})),alert("Repayment posted.")}catch(r){console.error(r),alert("Failed to post repayment.")}finally{ge(!1)}},He=()=>{V({amount:(s==null?void 0:s.amount)??"",interestRate:(s==null?void 0:s.interestRate)??"",termMonths:(s==null?void 0:s.termMonths)??(s==null?void 0:s.durationMonths)??"",startDate:q((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate))}),Q(!0)},Ye=async()=>{var r,x;const a={amount:R.amount===""?void 0:Number(R.amount),interestRate:R.interestRate===""?void 0:Number(R.interestRate),termMonths:R.termMonths===""?void 0:Number(R.termMonths),startDate:R.startDate||void 0};if(Number.isFinite(a.amount)&&a.amount<=0)return alert("Amount must be > 0");if(Number.isFinite(a.termMonths)&&a.termMonths<=0)return alert("Term must be > 0");ve(!0);try{await w.patch(`/loans/${t}`,a),Q(!1),await E(),alert("Loan updated.")}catch(h){console.error(h),alert(((x=(r=h==null?void 0:h.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to update loan.")}finally{ve(!1)}},Ve=async()=>{var a,r;if(window.confirm("This will permanently delete this loan. Continue?"))try{await w.delete(`/loans/${t}`),alert("Loan deleted."),d("/loans")}catch(x){console.error(x),alert(((r=(a=x==null?void 0:x.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to delete loan.")}},Ze=()=>{te({termMonths:(s==null?void 0:s.termMonths)??"",startDate:q((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate)),previewOnly:!1}),ee(!0)},Ge=async()=>{var r,x;const a={termMonths:M.termMonths===""?void 0:Number(M.termMonths),startDate:M.startDate||void 0,previewOnly:!!M.previewOnly};if(Number.isFinite(a.termMonths)&&a.termMonths<=0)return alert("Term must be > 0");Ne(!0);try{const{data:h}=await w.post(`/loans/${t}/reschedule`,a);Array.isArray(h==null?void 0:h.schedule)&&k(h.schedule),ee(!1),await E(),alert((h==null?void 0:h.message)||"Schedule updated.")}catch(h){console.error(h),alert(((x=(r=h==null?void 0:h.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to reschedule.")}finally{Ne(!1)}},Je=async()=>{var a,r,x;if(window.confirm("Reissue creates a new pending loan cloned from this one. Continue?"))try{const{data:h}=await w.post(`/loans/${t}/reissue`),Ie=((a=h==null?void 0:h.loan)==null?void 0:a.id)||(h==null?void 0:h.id);alert("New loan created."),Ie&&d(`/loans/${Ie}`)}catch(h){console.error(h),alert(((x=(r=h==null?void 0:h.response)==null?void 0:r.data)==null?void 0:x.error)||"Failed to reissue loan.")}},_=b.useMemo(()=>pe(o||[],g||[]),[o,g]),he=Array.isArray(o)&&o.length>0,ie=(s==null?void 0:s.status)==="closed"?0:he?_.outstanding:(s==null?void 0:s.outstanding)??null,B=he?_.nextDue:null,ne=b.useMemo(()=>{const a=g.length||0,r=g.reduce((x,h)=>x+Number(h.amount||0),0);return{count:a,sum:r}},[g]),Xe=(s==null?void 0:s.status)!=="closed"&&Number(ie||0)>0;return P?e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:"Loading loan…"}):m?e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:m}):s?e.jsxs("div",{className:n.page,children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:n.h1,children:"Loan Details"}),e.jsx("span",{className:_e,children:s.status}),W&&e.jsxs("span",{className:n.chip,children:["Stage: ",W.replaceAll("_"," ")]})]}),e.jsx("button",{onClick:()=>d(-1),className:n.actionLink,children:"← Back"})]}),e.jsxs(de,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-2 min-w-0",children:[e.jsx(O,{children:"Borrower"}),e.jsxs(re,{className:`${n.actionLink} text-lg md:text-xl truncate`,to:`/borrowers/${s.borrowerId}`,title:((Ce=s.Borrower)==null?void 0:Ce.name)||s.borrowerName||"N/A",children:[((De=s.Borrower)==null?void 0:De.name)||s.borrowerName||"N/A"," ",e.jsx("span",{children:"›"})]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Amount"}),e.jsx("div",{className:"text-2xl font-extrabold",children:c(s.amount,C)})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Interest"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-bold",children:[s.interestRate,"%"]})," ",e.jsxs("span",{children:["· ",s.interestMethod||"—"]})]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Term"}),e.jsxs("div",{className:"text-base font-semibold",children:[s.termMonths||s.durationMonths," months"]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Start / Release"}),e.jsx("div",{className:"text-base font-semibold",children:G(s.startDate||s.releaseDate)})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Outstanding"}),e.jsx("div",{className:"text-2xl font-extrabold",children:ie==null?"—":c(ie,C)})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Next Due"}),e.jsx("div",{className:"text-base font-semibold",children:B?e.jsxs(e.Fragment,{children:[G(B.date)," ·"," ",e.jsx("span",{className:"font-extrabold",children:c(B.amount,C)})]}):"—"})]}),i&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3 xl:col-span-4",children:[e.jsx(O,{children:"Product"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-extrabold",children:[i.name,i.code?` (${i.code})`:""]}),e.jsxs("div",{className:"text-sm mt-0.5",children:["Defaults: ",i.interestMethod," @"," ",i.interestRate??i.defaultInterestRate,"% · Limits:"," ",c(i.minPrincipal,C)," –"," ",c(i.maxPrincipal,C),", ",i.minTermMonths,"-",i.maxTermMonths," months"]})]})]})]}),e.jsx("div",{className:"mt-6 grid sm:grid-cols-3 lg:grid-cols-6 gap-4 text-sm",children:[["Paid Principal",_.paidPrincipal],["Paid Interest",_.paidInterest],["Paid Penalties",_.paidPenalty],["Paid Fees",_.paidFees],["Total Paid",_.totalPaid],["Total Scheduled",_.scheduledTotal]].map(([a,r])=>e.jsxs("div",{className:"rounded-xl border-2 border-[var(--border-strong)] p-3 bg-[var(--card)] shadow-sm",children:[e.jsx("div",{className:n.label,children:a}),e.jsx("div",{className:"font-bold text-lg",children:he?c(r,C):"—"})]},a))})]}),(we||se||Se||ke)&&e.jsxs(de,{dense:!0,children:[we&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-extrabold",children:"Changes Requested"}),e.jsxs("p",{className:"text-sm",children:["Update the application and attach missing documents, then"," ",e.jsx("strong",{children:"Resubmit"}),". Add a short note if helpful."]}),e.jsx("label",{className:"block text-xs font-semibold",children:"Comment (optional)"}),e.jsx("textarea",{value:S,onChange:a=>T(a.target.value),className:`${n.input} min-h-[44px]`,placeholder:"What did you fix / add?"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>ae("resubmit"),disabled:A,className:n.primary,title:"Send for review again",children:A?"Submitting…":"Resubmit for Review"}),e.jsx(re,{to:"/loans/applications",className:n.btn,title:"Open applications to edit details/attachments",children:"Edit Application"})]})]}),(se||Se)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-extrabold",children:se?"Branch Manager Review":"Compliance Review"})}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold",children:"Suggested Principal"}),e.jsx("input",{type:"number",className:n.input,value:F,onChange:a=>xe(a.target.value),min:"0",step:"0.01"}),e.jsx("p",{className:"text-[11px] text-[var(--muted)] mt-1",children:"Save a suggestion or approve with a different amount."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold",children:"Comment"}),e.jsx("textarea",{className:`${n.input} min-h-[44px]`,placeholder:"Why approving / changes / rejection?",value:S,onChange:a=>T(a.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>ae(se?"bm_approve":"compliance_approve",{suggestedAmount:F}),disabled:A,className:n.primary,children:A?"Working…":"Approve"}),e.jsx("button",{onClick:()=>ae("request_changes"),disabled:A,className:n.btn,title:"Send back to Loan Officer with requested changes",children:A?"Working…":"Request Changes"}),e.jsx("button",{onClick:()=>ae("reject"),disabled:A,className:n.btn,children:A?"Working…":"Reject"}),e.jsx("button",{onClick:Ue,disabled:A,className:n.btn,children:A?"Saving…":"Save Suggestion"})]})]}),ke&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",children:"This loan is approved. Proceed to disbursement to finalize payout."}),e.jsx(re,{to:`/loans/${t}/disburse`,className:n.primary,children:"Disburse"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(re,{to:"/loans",className:n.btn,children:"Back to Loans"}),e.jsx("button",{onClick:()=>ue(!0),className:n.btn,children:"View Schedule"}),e.jsx("button",{onClick:()=>it({loan:s,schedule:o||[],currency:C}),className:n.btn,disabled:!Array.isArray(o)||!o.length,children:"Export CSV"}),e.jsx("button",{onClick:()=>nt({loan:s,schedule:o||[],currency:C}),className:n.btn,disabled:!Array.isArray(o)||!o.length,children:"Export PDF"}),Xe&&e.jsx("button",{onClick:()=>X(!0),className:n.btn,children:"Post Repayment"}),Be&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:He,className:n.btn,children:"Edit Loan"}),e.jsx("button",{onClick:Ze,className:n.btn,children:"Reschedule"})]}),e.jsx("button",{onClick:Je,className:n.btn,children:"Reissue"}),ze&&e.jsx("button",{onClick:Ve,className:"px-3 md:px-4 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700 shadow-sm",children:"Delete"}),s.status!=="closed"&&e.jsx("button",{onClick:Ke,className:n.btn,children:"Close Loan"})]}),e.jsx(de,{title:"Repayments",right:e.jsxs("div",{className:"text-sm font-semibold",children:[ne.count," record",ne.count===1?"":"s"," · Total"," ",e.jsx("span",{className:"font-extrabold",children:c(ne.sum,C)})]}),children:$?e.jsx("p",{children:"Loading repayments…"}):g.length===0?e.jsx("div",{className:"text-sm",children:"No repayments found."}):e.jsx("div",{className:n.tableWrap,children:e.jsxs("table",{className:"min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsx("tr",{className:"text-left sticky top-0 z-10",children:["#","Date","Amount","Method","Notes"].map(a=>e.jsx("th",{className:n.th,children:a},a))})}),e.jsx("tbody",{children:g.map((a,r)=>e.jsxs("tr",{className:`${r%2===0?"bg-[var(--table-row-even)]":"bg-[var(--table-row-odd)]"} hover:bg-[var(--chip-soft)] transition-colors`,children:[e.jsx("td",{className:n.td,children:r+1}),e.jsx("td",{className:n.td,children:G(a.date)}),e.jsx("td",{className:`${n.td} text-right tabular-nums`,children:c(a.amount,C)}),e.jsx("td",{className:n.td,children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-bold bg-[var(--badge-bg)] text-[var(--badge-fg)] ring-1 ring-[var(--border)]",children:a.method||"—"})}),e.jsx("td",{className:`${n.td} break-words`,children:a.notes||"—"})]},a.id||r))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:`${n.td} font-bold`,colSpan:2,children:"Total"}),e.jsx("td",{className:`${n.td} text-right text-base font-extrabold`,children:c(ne.sum,C)}),e.jsx("td",{className:n.td,colSpan:2})]})})]})})}),e.jsxs(de,{title:"Comments",children:[f?e.jsx("p",{children:"Loading comments…"}):p.length===0?e.jsx("div",{className:"text-sm",children:"No comments yet."}):e.jsx("div",{className:"space-y-3 max-h-72 overflow-auto pr-1",children:p.map((a,r)=>{var x,h;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[var(--badge-bg)] text-[var(--badge-fg)] flex items-center justify-center text-xs font-extrabold select-none",children:(((x=a.author)==null?void 0:x.name)||"U").slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-1 border-b-2 border-[var(--border)] pb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-[var(--muted)]",children:[e.jsx("span",{className:"font-bold text-[var(--fg)]",children:((h=a.author)==null?void 0:h.name)||"User"}),e.jsx("span",{children:tt(a.createdAt)})]}),e.jsx("p",{className:"text-sm mt-0.5 break-words",children:a.content})]})]},a.id||r)})}),e.jsxs("div",{className:"mt-4 flex items-start gap-2",children:[e.jsx("textarea",{value:ce,onChange:a=>oe(a.target.value),className:`${n.input} min-h-[44px]`,placeholder:"Add a comment"}),e.jsx("button",{onClick:We,className:n.primary,children:"Post"})]})]}),Fe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-3xl p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Post Repayment"}),e.jsx("button",{onClick:()=>X(!1),className:n.actionLink,children:"✕"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:U.amount,onChange:a=>Y(r=>({...r,amount:a.target.value})),className:n.input,min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Date"}),e.jsx("input",{type:"date",value:U.date,onChange:a=>Y(r=>({...r,date:a.target.value})),className:n.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Method"}),e.jsxs("select",{value:U.method,onChange:a=>Y(r=>({...r,method:a.target.value})),className:n.input,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:U.notes,onChange:a=>Y(r=>({...r,notes:a.target.value})),className:n.input,placeholder:"Receipt no., reference, etc."})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>X(!1),className:n.btn,children:"Cancel"}),e.jsx("button",{onClick:qe,disabled:be,className:n.primary,children:be?"Posting…":"Post"})]})]})}),Ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-6xl p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Repayment Schedule"}),e.jsx("button",{onClick:()=>ue(!1),className:n.actionLink,children:"✕"})]}),z?e.jsx("p",{children:"Loading schedule…"}):!Array.isArray(o)||o.length===0?e.jsx("p",{children:"No schedule available."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Disbursed:"})," ",G((s==null?void 0:s.releaseDate)||(s==null?void 0:s.startDate))||"—"]}),e.jsxs("div",{children:["Next installment: ",B?e.jsxs(e.Fragment,{children:[e.jsxs("b",{children:["#",B.idx]})," on ",G(B.date)," —"," ",e.jsx("b",{children:c(B.amount,C)})]}):"—"]})]}),e.jsx("div",{className:"max-h-[75vh] overflow-auto rounded-xl border-2 border-[var(--border-strong)]",children:e.jsx(dt,{schedule:o||[],currency:C})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>ue(!1),className:n.btn,children:"Close"})})]})}),Ee&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Edit Loan"}),e.jsx("button",{onClick:()=>Q(!1),className:n.actionLink,children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:R.amount,onChange:a=>V(r=>({...r,amount:a.target.value})),className:n.input,min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",value:R.interestRate,onChange:a=>V(r=>({...r,interestRate:a.target.value})),className:n.input,step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Term (months)"}),e.jsx("input",{type:"number",value:R.termMonths,onChange:a=>V(r=>({...r,termMonths:a.target.value})),className:n.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Start Date"}),e.jsx("input",{type:"date",value:R.startDate,onChange:a=>V(r=>({...r,startDate:a.target.value})),className:n.input})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Q(!1),className:n.btn,children:"Cancel"}),e.jsx("button",{onClick:Ye,disabled:fe,className:n.primary,children:fe?"Saving…":"Save"})]})]})}),Me&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Reschedule Loan"}),e.jsx("button",{onClick:()=>ee(!1),className:n.actionLink,children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"New Term (months)"}),e.jsx("input",{type:"number",value:M.termMonths,onChange:a=>te(r=>({...r,termMonths:a.target.value})),className:n.input,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"New Start Date"}),e.jsx("input",{type:"date",value:M.startDate,onChange:a=>te(r=>({...r,startDate:a.target.value})),className:n.input})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-semibold",children:[e.jsx("input",{type:"checkbox",checked:M.previewOnly,onChange:a=>te(r=>({...r,previewOnly:a.target.checked}))}),"Preview only (don’t save)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>ee(!1),className:n.btn,children:"Cancel"}),e.jsx("button",{onClick:Ge,disabled:je,className:n.primary,children:je?"Working…":M.previewOnly?"Preview":"Reschedule"})]})]})})]}):e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:"Loan not found."})}export{xt as default};
