import{u as re,r as d,g as b,j as e,L as j}from"./index-DyAnIdDJ.js";import{W as G}from"./wallet-CJqS3GRp.js";import{C as w}from"./circle-plus-D3ExXiUk.js";import{B as le,U as ne}from"./upload-DPFpbOi_.js";import{C as K}from"./calendar-BBzBowhN.js";import{c as W}from"./createLucideIcon-Bwt99HA0.js";import{F as oe}from"./file-up-Ck4tK_iD.js";import{X as C}from"./x-AYjj4IKu.js";import{U as ie}from"./user-CNR2a1p6.js";import{S as ce}from"./save-D-ZzO2Zg.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],me=W("landmark",de);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],he=W("shield-check",ue),z=()=>new Date().toLocaleDateString("en-CA"),l="input",h="card p-5 md:p-7",I=i=>Array.isArray(i)?i:Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i==null?void 0:i.rows)?i.rows:Array.isArray(i==null?void 0:i.results)?i.results:[],pe=[{value:"flat",label:"Flat rate"},{value:"reducing_equal_installments",label:"Reduced balance — equal installments"},{value:"reducing_equal_principal",label:"Reduced balance — equal principal"},{value:"interest_only",label:"Interest only"},{value:"compound_accrued",label:"Compound interest (accrued)"},{value:"compound_equal_installments",label:"Compound interest — equal installments"}],xe=["None","Household Items","Vehicle (Logbook)","Land Title","Business Stock","Electronics","Salary Assignment","Other"],V=[{value:"weekly",label:"Weekly",perMonth:4},{value:"biweekly",label:"Bi-weekly",perMonth:2},{value:"monthly",label:"Monthly",perMonth:1},{value:"custom",label:"Custom"}],be=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank"},{value:"mobile_money",label:"Mobile Money"},{value:"other",label:"Other"}],H=[{value:"mpesa",label:"M-Pesa"},{value:"tigopesa",label:"Tigo Pesa"},{value:"airtelmoney",label:"Airtel Money"},{value:"halopesa",label:"HaloPesa"},{value:"ttclpesa",label:"TTCL Pesa"},{value:"other",label:"Other"}],ve=["new loan","open","top-up","defaulted"],ge=[{value:"single",label:"Single"},{value:"married",label:"Married"},{value:"divorced",label:"Divorced"},{value:"widow",label:"Widow"},{value:"widower",label:"Widower"},{value:"not_specified",label:"Not specified"}];function Oe(){const i=re(),[S,P]=d.useState([]),[M,R]=d.useState([]),[_,L]=d.useState([]),[B,D]=d.useState(!1),[Y,T]=d.useState(!1),[t,n]=d.useState({productId:"",borrowerId:"",loanNumber:"",principal:"",releaseDate:z(),durationMonths:"",collateralType:"",collateralAmount:"",collateralOther:"",interestMethod:"flat",interestRate:"",interestAmount:"",fees:[],repaymentCycle:"monthly",numberOfRepayments:"",statusLabel:"new loan",disbursementMethod:"cash",disbursementBankId:"",disbursementReference:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:"",maritalStatus:"not_specified",spouseName:"",spouseOccupation:"",spouseIdNumber:"",spousePhone:"",attachmentsMeta:[],guarantors:[]}),v=d.useRef({});d.useEffect(()=>{(async()=>{try{const[a,r]=await Promise.all([b.get("/loan-products"),b.get("/borrowers",{params:{page:1,pageSize:500}}).catch(()=>({data:{items:[]}}))]);P(I(a.data)),R(I(r.data))}catch(a){console.warn("Failed to load products/borrowers",a),P([]),R([])}try{const a=await b.get("/banks");L(I(a.data))}catch{L([])}})()},[]);const N=d.useMemo(()=>Array.isArray(S)?S:[],[S]),E=d.useMemo(()=>Array.isArray(M)?M:[],[M]);d.useEffect(()=>{t.borrowerId&&(T(!0),(async()=>{var a,r,s;try{let o=0;try{const c=await b.get(`/borrowers/${t.borrowerId}/loans`);o=Array.isArray(c.data)?c.data.length:((r=(a=c.data)==null?void 0:a.items)==null?void 0:r.length)||0}catch{o=((s=(await b.get("/loans",{params:{borrowerId:t.borrowerId,page:1,pageSize:1}})).data)==null?void 0:s.total)||0}const m=(o+1).toString().padStart(3,"0");n(c=>({...c,loanNumber:m}))}catch{n(o=>({...o,loanNumber:""}))}finally{T(!1)}})())},[t.borrowerId]),d.useEffect(()=>{if(t.repaymentCycle==="custom")return;const a=V.find(o=>o.value===t.repaymentCycle),r=Number(t.durationMonths||0);if(!a||r<=0)return;const s=r*(a.perMonth||1);n(o=>({...o,numberOfRepayments:String(s)}))},[t.repaymentCycle,t.durationMonths]);const F=a=>{const r=Math.random().toString(36).slice(2);n(s=>({...s,attachmentsMeta:[...s.attachmentsMeta,{type:a||"other",note:"",fileKey:r}]}))},q=(a,r)=>{r?v.current[a]=r:delete v.current[a]},k=(a,r)=>n(s=>({...s,attachmentsMeta:s.attachmentsMeta.map((o,m)=>m===a?{...o,...r}:o)})),$=a=>n(r=>{const s=r.attachmentsMeta[a];return s!=null&&s.fileKey&&delete v.current[s.fileKey],{...r,attachmentsMeta:r.attachmentsMeta.filter((o,m)=>m!==a)}}),A=()=>t.attachmentsMeta.findIndex(a=>String(a.type||"").toLowerCase()==="spouse: consent declaration"),J=()=>n(a=>({...a,fees:[...a.fees,{name:"",amount:"",paid:!1}]})),O=(a,r)=>n(s=>({...s,fees:s.fees.map((o,m)=>m===a?{...o,...r}:o)})),X=a=>n(r=>({...r,fees:r.fees.filter((s,o)=>o!==a)})),Z=()=>n(a=>({...a,guarantors:[...a.guarantors,{type:"existing",borrowerId:"",name:"",occupation:"",residence:"",contacts:"",verification:""}]})),x=(a,r)=>n(s=>({...s,guarantors:s.guarantors.map((o,m)=>m===a?{...o,...r}:o)})),Q=a=>n(r=>({...r,guarantors:r.guarantors.filter((s,o)=>o!==a)})),ee=async a=>{var r,s,o,m;if(a.preventDefault(),!t.borrowerId)return alert("Select a borrower");if(!t.productId)return alert("Select a loan product");if(!t.principal||Number(t.principal)<=0)return alert("Enter a principal amount");if(!t.durationMonths)return alert("Enter loan duration (months)");if(t.collateralType==="Other"&&!t.collateralOther.trim())return alert("Please specify the collateral for 'Other'.");if(t.disbursementMethod==="other"&&!t.disbursementOther.trim())return alert("Please specify the disbursement method for 'Other'.");if(t.disbursementMethod==="mobile_money"){if(!t.mobileProvider)return alert("Select a mobile money provider.");if(t.mobileProvider==="other"&&!t.mobileProviderOther.trim())return alert("Please specify the mobile money provider.");if(!t.mobilePhone.trim())return alert("Enter the mobile money phone number.");const c=t.mobilePhone.replace(/\D/g,"");if(c.length<9||c.length>15)return alert("Mobile money phone number looks invalid.")}if(t.maritalStatus==="married"){const c=A(),u=c>=0?t.attachmentsMeta[c]:null;if(!(u?!!v.current[u.fileKey]:!1))return alert("Please attach the spouse consent declaration (signed).")}D(!0);try{const c=t.collateralType==="Other"&&t.collateralOther.trim()?`Other: ${t.collateralOther.trim()}`:t.collateralType||null;let u=((r=t.disbursementReference)==null?void 0:r.trim())||"";t.disbursementMethod==="mobile_money"?u=[`Provider: ${t.mobileProvider==="other"?t.mobileProviderOther.trim():((s=H.find(se=>se.value===t.mobileProvider))==null?void 0:s.label)||t.mobileProvider}`,`Phone: ${t.mobilePhone.trim()}`,u?`Ref: ${u}`:null].filter(Boolean).join(" | "):t.disbursementMethod==="other"&&(u=[`Method: ${t.disbursementOther.trim()}`,(o=t.disbursementOtherDetails)!=null&&o.trim()?`Details: ${t.disbursementOtherDetails.trim()}`:null,u?`Ref: ${u}`:null].filter(Boolean).join(" | "));const U={productId:t.productId,borrowerId:t.borrowerId,loanNumber:t.loanNumber||null,amount:String(t.principal).trim(),currency:"TZS",releaseDate:t.releaseDate||z(),durationMonths:String(t.durationMonths).trim(),collateralType:c,collateralAmount:t.collateralAmount||null,interestMethod:t.interestMethod,interestRate:t.interestRate||null,interestAmount:t.interestAmount||null,fees:t.fees.map(p=>({...p,amount:String(p.amount||"").trim()})),repaymentCycle:t.repaymentCycle,numberOfRepayments:String(t.numberOfRepayments||"").trim(),disbursementMethod:t.disbursementMethod,disbursementBankId:t.disbursementMethod==="bank"&&t.disbursementBankId||null,disbursementReference:u||null,spouse:t.maritalStatus==="married"?{name:t.spouseName||"",occupation:t.spouseOccupation||"",idNumber:t.spouseIdNumber||"",phone:t.spousePhone||""}:void 0,status:"pending",statusLabel:t.statusLabel},f=new FormData;f.append("payload",JSON.stringify(U));for(const p of t.attachmentsMeta){const g=v.current[p.fileKey];g&&(f.append("files",g,g.name),f.append("filesMeta",JSON.stringify({type:p.type,note:p.note,name:g.name})))}const te=await b.post("/loans",f,{headers:{"Content-Type":"multipart/form-data"}});alert("Loan application submitted"),i(`/loans/${((m=te.data)==null?void 0:m.id)||""}`)}catch(c){console.error(c),alert("Failed to submit loan application")}finally{D(!1)}},y=d.useMemo(()=>N.find(a=>String(a.id)===String(t.productId)),[N,t.productId]),ae=()=>{A()===-1&&F("Spouse: Consent declaration")};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Add Loan"}),e.jsx("p",{className:"text-sm muted",children:"Follow the steps below. Start by selecting a borrower, then continue down the page."})]}),e.jsx(j,{to:"/loans",className:"text-indigo-600 hover:underline text-sm",children:"Back to Loans"})]}),e.jsxs("form",{onSubmit:ee,className:"max-w-6xl mx-auto space-y-5 md:space-y-6",children:[e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(G,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"1) Borrower & Product"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Borrower"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${l} flex-1`,value:t.borrowerId,onChange:a=>n({...t,borrowerId:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select borrower…"}),E.map(a=>e.jsxs("option",{value:a.id,children:[a.name," ",a.phone?`— ${a.phone}`:""]},a.id))]}),e.jsxs(j,{target:"_blank",to:"/borrowers/add",className:"px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800 inline-flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"})," Add"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Loan Product"}),e.jsxs("select",{className:l,value:t.productId,onChange:a=>{const r=a.target.value,s=N.find(o=>String(o.id)===String(r));n(o=>({...o,productId:r,interestMethod:(s==null?void 0:s.interestMethod)||o.interestMethod,interestRate:(s==null?void 0:s.interestRate)??o.interestRate}))},required:!0,children:[e.jsx("option",{value:"",children:"Select product…"}),N.map(a=>e.jsxs("option",{value:a.id,children:[a.name,a.code?` (${a.code})`:""]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Loan # (auto)"}),e.jsx("input",{className:l,value:Y?"…":t.loanNumber||"—",readOnly:!0})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(le,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"2) Loan Terms"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Principal Amount"}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,value:t.principal,onChange:a=>n({...t,principal:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs muted flex items-center gap-1",children:[e.jsx(K,{className:"h-3.5 w-3.5"})," Loan Release Date"]}),e.jsx("input",{type:"date",className:l,value:t.releaseDate,onChange:a=>n({...t,releaseDate:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Collateral Type"}),e.jsxs("select",{className:l,value:t.collateralType,onChange:a=>n({...t,collateralType:a.target.value}),children:[e.jsx("option",{value:"",children:"Select…"}),xe.map(a=>e.jsx("option",{value:a,children:a},a))]}),t.collateralType==="Other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:l,placeholder:"Specify collateral",value:t.collateralOther,onChange:a=>n({...t,collateralOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Collateral Amount"}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,value:t.collateralAmount,onChange:a=>n({...t,collateralAmount:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Loan Duration (months)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,value:t.durationMonths,onChange:a=>n({...t,durationMonths:a.target.value}),required:!0})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(me,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"3) Interest"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs muted",children:"Interest Method"}),e.jsx("select",{className:l,value:t.interestMethod,onChange:a=>n({...t,interestMethod:a.target.value}),children:pe.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",inputMode:"decimal",className:l,value:t.interestRate,onChange:a=>n({...t,interestRate:a.target.value}),placeholder:y!=null&&y.interestRate?String(y.interestRate):"e.g. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Interest Amount (optional)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,value:t.interestAmount,onChange:a=>n({...t,interestAmount:a.target.value})})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(K,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"4) Repayments"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Repayment Cycle"}),e.jsx("select",{className:l,value:t.repaymentCycle,onChange:a=>n({...t,repaymentCycle:a.target.value}),children:V.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"# of Repayments"}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,value:t.numberOfRepayments,onChange:a=>n({...t,numberOfRepayments:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Loan Status (label)"}),e.jsx("select",{className:l,value:t.statusLabel,onChange:a=>n({...t,statusLabel:a.target.value}),children:ve.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("p",{className:"text-[11px] muted mt-1",children:"DB status stays “pending” on create."})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"5) Loan Fees"})]}),e.jsxs("button",{type:"button",onClick:J,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx(w,{className:"h-4 w-4"})," Add Fee"]})]}),t.fees.length===0?e.jsx("p",{className:"text-sm muted",children:"No fees added."}):e.jsx("div",{className:"space-y-3",children:t.fees.map((a,r)=>e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_1fr_auto] gap-3 items-center",children:[e.jsx("input",{className:l,placeholder:"Fee name (e.g. Processing)",value:a.name,onChange:s=>O(r,{name:s.target.value})}),e.jsx("input",{type:"number",inputMode:"numeric",className:l,placeholder:"Amount",value:a.amount,onChange:s=>O(r,{amount:s.target.value})}),e.jsxs("select",{className:l,value:a.paid?"paid":"not_paid",onChange:s=>O(r,{paid:s.target.value==="paid"}),children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"not_paid",children:"Not paid"})]}),e.jsx("button",{type:"button",onClick:()=>X(r),className:"p-2 rounded hover:bg-gray-50 dark:hover:bg-slate-800","aria-label":"Remove fee",children:e.jsx(C,{className:"h-4 w-4"})})]},r))}),e.jsx("p",{className:"text-xs muted mt-2",children:"Unpaid fees will be included in the repayment schedule."})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"6) Guarantors"})]}),e.jsxs("button",{type:"button",onClick:Z,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx(w,{className:"h-4 w-4"})," Add Guarantor"]})]}),t.guarantors.length===0?e.jsx("p",{className:"text-sm muted",children:"No guarantors added."}):e.jsx("div",{className:"space-y-4",children:t.guarantors.map((a,r)=>e.jsxs("div",{className:"border border-[var(--border)] rounded-xl p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Guarantor #",r+1]}),e.jsx("button",{type:"button",onClick:()=>Q(r),className:"p-1 rounded hover:bg-gray-50 dark:hover:bg-slate-800","aria-label":"Remove guarantor",children:e.jsx(C,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Source"}),e.jsxs("select",{className:l,value:a.type,onChange:s=>x(r,{type:s.target.value}),children:[e.jsx("option",{value:"existing",children:"Select from borrowers"}),e.jsx("option",{value:"manual",children:"Enter manually"})]})]}),a.type==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Borrower"}),e.jsxs("select",{className:l,value:a.borrowerId||"",onChange:s=>x(r,{borrowerId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select borrower…"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.phone?`— ${s.phone}`:""]},s.id))]})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{className:l,placeholder:"Full name",value:a.name,onChange:s=>x(r,{name:s.target.value})}),e.jsx("input",{className:l,placeholder:"Occupation",value:a.occupation,onChange:s=>x(r,{occupation:s.target.value})}),e.jsx("input",{className:l,placeholder:"Residence",value:a.residence,onChange:s=>x(r,{residence:s.target.value})}),e.jsx("input",{className:l,placeholder:"Contacts",value:a.contacts,onChange:s=>x(r,{contacts:s.target.value})}),e.jsx("input",{className:l,placeholder:"Verification (ID #, etc.)",value:a.verification,onChange:s=>x(r,{verification:s.target.value})})]})]})]},r))})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"7) Attachments"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Borrower: Loan form","Borrower: Village introduction","Borrower: Fee receipt","Borrower: ID","Borrower: Business licence","Borrower: TIN","Borrower: Employment contract","Borrower: Salary slips","Borrower: Employer letter","Guarantor: ID","Guarantor: Village introduction","Spouse: Consent declaration","Other"].map(a=>e.jsxs("button",{type:"button",onClick:()=>F(a),className:"text-xs px-2 py-1 rounded border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:["+ ",a.replace(/Borrower: |Guarantor: |Spouse: /g,"")]},a))})]}),t.attachmentsMeta.length===0?e.jsx("p",{className:"text-sm muted",children:"No files attached."}):e.jsx("div",{className:"space-y-3",children:t.attachmentsMeta.map((a,r)=>e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_auto] gap-3 items-center",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:l,value:a.type,onChange:s=>k(r,{type:s.target.value})}),e.jsx("input",{className:l,placeholder:"Note (optional)",value:a.note,onChange:s=>k(r,{note:s.target.value})})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:l,onChange:s=>{var o;return q(a.fileKey,(o=s.target.files)==null?void 0:o[0])}}),e.jsx("button",{type:"button",onClick:()=>$(r),className:"p-2 rounded hover:bg-gray-50 dark:hover:bg-slate-800","aria-label":"Remove attachment",children:e.jsx(C,{className:"h-4 w-4"})})]},a.fileKey))}),e.jsx("p",{className:"text-xs muted mt-2",children:"Accepted images/PDFs as supported by your backend."})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(G,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"8) Disbursement"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Method"}),e.jsx("select",{className:l,value:t.disbursementMethod,onChange:a=>{const r=a.target.value;n({...t,disbursementMethod:r,disbursementBankId:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:""})},children:be.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Reference (optional)"}),e.jsx("input",{className:l,value:t.disbursementReference,onChange:a=>n({...t,disbursementReference:a.target.value}),placeholder:"Txn ref / slip #"})]}),t.disbursementMethod==="bank"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs muted",children:"Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${l} flex-1`,value:t.disbursementBankId,onChange:a=>n({...t,disbursementBankId:a.target.value}),children:[e.jsx("option",{value:"",children:"Select bank…"}),_.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs(j,{to:"/banks/add",target:"_blank",className:"px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800 inline-flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"})," Add"]}),e.jsx(j,{to:"/banks",target:"_blank",className:"px-3 py-2 rounded-lg border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:"Manage"})]}),_.length===0&&e.jsx("p",{className:"text-[11px] text-amber-600 mt-1",children:"No banks found. Use “Add” to register banks; this list is tenant-scoped via your API."})]}),t.disbursementMethod==="mobile_money"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Provider"}),e.jsxs("select",{className:l,value:t.mobileProvider,onChange:a=>n({...t,mobileProvider:a.target.value}),children:[e.jsx("option",{value:"",children:"Select provider…"}),H.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),t.mobileProvider==="other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:l,placeholder:"Specify provider",value:t.mobileProviderOther,onChange:a=>n({...t,mobileProviderOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Phone Number"}),e.jsx("input",{className:l,placeholder:"e.g. 07xxxxxxxx or +2557xxxxxxxx",value:t.mobilePhone,onChange:a=>n({...t,mobilePhone:a.target.value})})]})]}),t.disbursementMethod==="other"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Specify method"}),e.jsx("input",{className:l,placeholder:"e.g., cheque, voucher, petty cash",value:t.disbursementOther,onChange:a=>n({...t,disbursementOther:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Details (optional)"}),e.jsx("input",{className:l,placeholder:"Instructions / place of collection",value:t.disbursementOtherDetails,onChange:a=>n({...t,disbursementOtherDetails:a.target.value})})]})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(ie,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"9) Marital Status & Spouse"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs muted",children:"Marital Status"}),e.jsx("select",{className:l,value:t.maritalStatus,onChange:a=>n({...t,maritalStatus:a.target.value}),children:ge.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsx("div",{className:"hidden md:block"}),t.maritalStatus==="married"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:l,placeholder:"Spouse Name",value:t.spouseName,onChange:a=>n({...t,spouseName:a.target.value})}),e.jsx("input",{className:l,placeholder:"Spouse Occupation",value:t.spouseOccupation,onChange:a=>n({...t,spouseOccupation:a.target.value})}),e.jsx("input",{className:l,placeholder:"Spouse ID Number",value:t.spouseIdNumber,onChange:a=>n({...t,spouseIdNumber:a.target.value})}),e.jsx("input",{className:l,placeholder:"Spouse Phone",value:t.spousePhone,onChange:a=>n({...t,spousePhone:a.target.value})}),e.jsxs("div",{className:"md:col-span-2 border border-[var(--border)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Spouse Consent Declaration (signed)"}),e.jsx("button",{type:"button",onClick:ae,className:"text-xs px-2 py-1 rounded border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:"+ Add consent upload"})]}),(()=>{const a=A();if(a===-1)return e.jsx("p",{className:"text-xs muted",children:"Click “Add consent upload” to attach the signed declaration."});const r=t.attachmentsMeta[a];return e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_auto] gap-3 items-center",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:l,value:r.type,readOnly:!0}),e.jsx("input",{className:l,placeholder:"Note (optional)",value:r.note,onChange:s=>k(a,{note:s.target.value})})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:l,onChange:s=>{var o;return q(r.fileKey,(o=s.target.files)==null?void 0:o[0])}}),e.jsx("button",{type:"button",onClick:()=>$(a),className:"p-2 rounded hover:bg-gray-50 dark:hover:bg-slate-800","aria-label":"Remove spouse consent",children:e.jsx(C,{className:"h-4 w-4"})})]})})(),e.jsx("p",{className:"text-[11px] muted mt-2",children:"This replaces the old text field. Upload the signed consent form here."})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 inset-x-0 z-20 bg-[var(--card)] backdrop-blur supports-[backdrop-filter]:bg-[var(--card)] border-t border-[var(--border)]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3 flex justify-end gap-3",children:[e.jsx(j,{to:"/loans",className:"px-4 py-2 rounded-xl border border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:"Cancel"}),e.jsxs("button",{disabled:B,type:"submit",className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(ce,{className:"h-4 w-4"}),B?"Submitting…":"Submit"]})]})})]})]})}export{Oe as default};
