import{r as c,j as e}from"./index-CMgmpHUd.js";import{A as p}from"./admin-P6SYWxkw.js";function A({title:f,channel:x}){const[i,d]=c.useState([]),[h,g]=c.useState(""),[v,j]=c.useState(!0),[u,o]=c.useState(!1),[y,N]=c.useState(""),b=async()=>{var s,l;try{j(!0);const t=await p.listTemplates(x,{q:h});d(t||[]),N("")}catch(t){N(((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.error)||t.message)}finally{j(!1)}};c.useEffect(()=>{b()},[x]);const S=()=>d([{id:null,name:"",subject:"",body:"",meta:{}},...i]),C=async s=>{var l,t;try{o(!0);const a={channel:x,name:s.name,subject:s.subject,body:s.body,meta:s.meta||{}},r=s.id?await p.updateTemplate(s.id,a):await p.createTemplate(a);d(n=>n.map(m=>m===s?r:m))}catch(a){alert(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.error)||a.message)}finally{o(!1)}},w=async s=>{var l,t;if(!s.id){d(i.filter(a=>a!==s));return}if(window.confirm("Delete this template?"))try{o(!0),await p.deleteTemplate(s.id),d(i.filter(a=>a.id!==s.id))}catch(a){alert(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.error)||a.message)}finally{o(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:f}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:h,onChange:s=>g(s.target.value),placeholder:"Search…",className:"text-sm border rounded px-2 py-1"}),e.jsx("button",{className:"text-sm px-3 py-1 rounded border",onClick:b,children:"Search"}),e.jsx("button",{className:"text-sm px-3 py-1 rounded bg-blue-600 text-white",onClick:S,children:"Add"})]})]}),y&&e.jsx("div",{className:"text-sm text-rose-600",children:y}),v?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-600",children:[e.jsx("th",{className:"py-2 pr-4",children:"Name"}),e.jsx("th",{className:"py-2 pr-4",children:"Subject"}),e.jsx("th",{className:"py-2 pr-4",children:"Body"}),e.jsx("th",{className:"py-2 pr-4",children:"Meta (JSON)"}),e.jsx("th",{className:"py-2 pr-4 w-40",children:"Actions"})]})}),e.jsxs("tbody",{children:[i.map((s,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.name||"",onChange:t=>d(a=>a.map((r,n)=>n===l?{...r,name:t.target.value}:r)),className:"w-full border rounded px-2 py-1"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.subject||"",onChange:t=>d(a=>a.map((r,n)=>n===l?{...r,subject:t.target.value}:r)),className:"w-full border rounded px-2 py-1"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("textarea",{rows:3,value:s.body||"",onChange:t=>d(a=>a.map((r,n)=>n===l?{...r,body:t.target.value}:r)),className:"w-full border rounded px-2 py-1 font-mono"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("input",{value:s.meta?JSON.stringify(s.meta):"",onChange:t=>{let a={};try{a=JSON.parse(t.target.value||"{}")}catch{}d(r=>r.map((n,m)=>m===l?{...n,meta:a}:n))},className:"w-full border rounded px-2 py-1 font-mono",placeholder:"{}"})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 text-sm rounded border",disabled:u,onClick:()=>C(s),children:u?"Saving…":"Save"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",disabled:u,onClick:()=>w(s),children:"Delete"})]})})]},s.id??`new-${l}`)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-6 text-center text-slate-500",children:"No templates."})})]})]})})]})}export{A as T};
