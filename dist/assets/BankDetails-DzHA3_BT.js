import{i as te,r as o,j as e,L as O}from"./index-D3cCxaCf.js";import{b as q,a as ae,e as ne,f as re,l as ce,h as le,i as ie,r as oe,t as de,j as me,k as ue,m as xe,n as he}from"./banking-Vs91DiHs.js";import{D as pe}from"./download-CifUKPPH.js";import{c as v}from"./createLucideIcon-BFF20nxP.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],M=v("arrow-right-left",ye);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ge=v("badge-check",je);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],fe=v("circle-check",Ne);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],be=v("circle-x",ve);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],we=v("plus",Ae);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ce=v("refresh-cw",ke),j="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 md:p-7",n="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 focus:border-indigo-500 transition-all",g="inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",$="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700";function Le(){const{id:a}=te(),[t,T]=o.useState(null),[c,E]=o.useState(null),[S,z]=o.useState({transactionTypes:["deposit","withdrawal","loan_repayment","disbursement","fee","transfer_in","transfer_out","other"],statuses:["posted","pending","void"],channels:["bank","cash","mobile","card","other"]}),[R,_]=o.useState([]),[d,b]=o.useState({type:"",status:"",reconciled:"",from:"",to:""}),[l,h]=o.useState({type:"deposit",direction:"in",amount:"",occurredAt:"",reference:"",description:""}),[m,A]=o.useState({loanId:"",amount:"",occurredAt:"",reference:""}),[u,w]=o.useState({toBankId:"",amount:"",occurredAt:"",reference:""}),[x,k]=o.useState({cashAccountId:"",amount:"",occurredAt:"",reference:""}),[P,U]=o.useState([]),[Z,H]=o.useState([]),[N,F]=o.useState(!0),p=async()=>{var s;F(!0);try{const[i,y,r,W,ee]=await Promise.all([ae(a),ne(a,{}),re(),q(a,D(d)),ce()]);if(T(i),E(y),z({transactionTypes:Array.isArray(r==null?void 0:r.transactionTypes)?r.transactionTypes:[],statuses:Array.isArray(r==null?void 0:r.statuses)?r.statuses:[],channels:Array.isArray(r==null?void 0:r.channels)?r.channels:[]}),_(W||[]),H((ee||[]).filter(B=>String(B.id)!==String(a))),(s=r==null?void 0:r.transactionTypes)!=null&&s.length&&!r.transactionTypes.includes(l.type)){const B=r.transactionTypes[0];h(se=>({...se,type:B,direction:L(B)}))}}catch(i){console.error(i)}finally{F(!1)}},J=async()=>{try{const s=await le();U(s||[])}catch(s){console.error(s)}};o.useEffect(()=>{p(),J()},[a]),o.useEffect(()=>{(async()=>{try{const s=await q(a,D(d));_(s||[])}catch(s){console.error(s)}})()},[d]);const V=async s=>{var i;if(s.preventDefault(),!l.amount)return alert("Amount is required");try{await ie(a,{...l,amount:Number(l.amount),occurredAt:l.occurredAt||void 0,direction:L(l.type),currency:t==null?void 0:t.currency}),h({type:((i=S.transactionTypes)==null?void 0:i[0])||"deposit",direction:"in",amount:"",occurredAt:"",reference:"",description:""}),await p()}catch(y){console.error(y),alert("Failed to create transaction")}},X=async s=>{if(s.preventDefault(),!m.loanId||!m.amount)return alert("Loan ID and amount are required");try{await oe(a,{...m,amount:Number(m.amount),occurredAt:m.occurredAt||void 0,currency:t==null?void 0:t.currency}),A({loanId:"",amount:"",occurredAt:"",reference:""}),await p()}catch(i){console.error(i),alert("Failed to record repayment")}},Y=async s=>{if(s.preventDefault(),!u.toBankId||!u.amount)return alert("Target bank and amount are required");try{await de(a,{...u,amount:Number(u.amount),occurredAt:u.occurredAt||void 0,currency:t==null?void 0:t.currency}),w({toBankId:"",amount:"",occurredAt:"",reference:""}),await p()}catch(i){console.error(i),alert("Failed to transfer")}},G=async s=>{if(s.preventDefault(),!x.cashAccountId||!x.amount)return alert("Cash account and amount are required");try{await me(a,{...x,amount:Number(x.amount),occurredAt:x.occurredAt||void 0,currency:t==null?void 0:t.currency}),k({cashAccountId:"",amount:"",occurredAt:"",reference:""}),await p()}catch(i){console.error(i),alert("Failed to transfer to cash")}},K=async s=>{try{s.reconciled?await ue(s.id):await xe(s.id,{bankRef:s.bankRef||"",note:s.note||""}),await p()}catch(i){console.error(i),alert("Failed to toggle reconciliation")}},Q=async()=>{try{const s=await he(a,{...D({...d,includeOpening:1})}),i=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(i),y.download=`bank-statement-${(t==null?void 0:t.name)||a}.json`,y.click()}catch(s){console.error(s),alert("Failed to download statement")}},I=o.useMemo(()=>Array.isArray(R)?R:[],[R]),f=(t==null?void 0:t.currency)||"TZS";return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:[(t==null?void 0:t.name)||"Bank",t!=null&&t.branch?` — ${t.branch}`:""," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",f,")"]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage transactions, repayments, transfers and reconciliation."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{to:"/banks",className:g,children:"Back"}),e.jsx(O,{to:`/banks/${a}/edit`,className:g,children:"Edit"}),e.jsxs("button",{onClick:Q,className:g,children:[e.jsx(pe,{className:"h-4 w-4"})," Statement"]}),e.jsxs("button",{onClick:p,className:g,disabled:N,children:[e.jsx(Ce,{className:"h-4 w-4"})," ",N?"Loading…":"Refresh"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Balances"}),e.jsxs("div",{className:"text-sm grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-gray-500",children:"Opening"}),e.jsx("div",{className:"text-right font-medium",children:C(c==null?void 0:c.opening,f)}),e.jsx("div",{className:"text-gray-500",children:"Inflow"}),e.jsx("div",{className:"text-right font-medium",children:C(c==null?void 0:c.inflow,f)}),e.jsx("div",{className:"text-gray-500",children:"Outflow"}),e.jsx("div",{className:"text-right font-medium",children:C(c==null?void 0:c.outflow,f)}),e.jsx("div",{className:"text-gray-500",children:"Closing"}),e.jsx("div",{className:"text-right font-semibold",children:C(c==null?void 0:c.closing,f)})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["As of ",c!=null&&c.asOf?new Date(c.asOf).toLocaleString():"—"]})]}),e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"New Transaction"}),e.jsxs("form",{onSubmit:V,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsx("select",{className:n,value:l.type,onChange:s=>h({...l,type:s.target.value,direction:L(s.target.value)}),children:S.transactionTypes.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:l.amount,onChange:s=>h({...l,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At (optional)"}),e.jsx("input",{type:"datetime-local",className:n,value:l.occurredAt,onChange:s=>h({...l,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:l.reference,onChange:s=>h({...l,reference:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Description (optional)"}),e.jsx("input",{className:n,value:l.description,onChange:s=>h({...l,description:s.target.value})})]}),e.jsxs("button",{className:$,disabled:N,children:[e.jsx(we,{className:"h-4 w-4"})," Create"]})]})]}),e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Loan Repayment (Bank)"}),e.jsxs("form",{onSubmit:X,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan ID"}),e.jsx("input",{className:n,value:m.loanId,onChange:s=>A({...m,loanId:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:m.amount,onChange:s=>A({...m,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At (optional)"}),e.jsx("input",{type:"datetime-local",className:n,value:m.occurredAt,onChange:s=>A({...m,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:m.reference,onChange:s=>A({...m,reference:s.target.value})})]}),e.jsxs("button",{className:$,disabled:N,children:[e.jsx(ge,{className:"h-4 w-4"})," Record Repayment"]})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Transfer to Another Bank"}),e.jsxs("form",{onSubmit:Y,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Target Bank"}),e.jsxs("select",{className:n,value:u.toBankId,onChange:s=>w({...u,toBankId:s.target.value}),children:[e.jsx("option",{value:"",children:"— Select —"}),Z.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:u.amount,onChange:s=>w({...u,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At"}),e.jsx("input",{type:"datetime-local",className:n,value:u.occurredAt,onChange:s=>w({...u,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:u.reference,onChange:s=>w({...u,reference:s.target.value})})]}),e.jsxs("button",{className:g,disabled:N,children:[e.jsx(M,{className:"h-4 w-4"})," Transfer"]})]})]}),e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Transfer to Cash"}),e.jsxs("form",{onSubmit:G,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Cash Account"}),e.jsxs("select",{className:n,value:x.cashAccountId,onChange:s=>k({...x,cashAccountId:s.target.value}),children:[e.jsx("option",{value:"",children:"— Select —"}),P.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:x.amount,onChange:s=>k({...x,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At"}),e.jsx("input",{type:"datetime-local",className:n,value:x.occurredAt,onChange:s=>k({...x,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:x.reference,onChange:s=>k({...x,reference:s.target.value})})]}),e.jsxs("button",{className:g,disabled:N,children:[e.jsx(M,{className:"h-4 w-4"})," Transfer"]})]})]}),e.jsxs("section",{className:j,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Filter Transactions"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsxs("select",{className:n,value:d.type,onChange:s=>b({...d,type:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),S.transactionTypes.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Status"}),e.jsxs("select",{className:n,value:d.status,onChange:s=>b({...d,status:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),S.statuses.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reconciled"}),e.jsxs("select",{className:n,value:d.reconciled,onChange:s=>b({...d,reconciled:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"1",children:"Reconciled"}),e.jsx("option",{value:"0",children:"Not Reconciled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"From"}),e.jsx("input",{type:"date",className:n,value:d.from,onChange:s=>b({...d,from:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"To"}),e.jsx("input",{type:"date",className:n,value:d.to,onChange:s=>b({...d,to:s.target.value})})]})]})]})]}),e.jsxs("section",{className:`${j} mt-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Transactions"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Showing ",I.length," row(s)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-2 pr-4",children:"Date"}),e.jsx("th",{className:"py-2 pr-4",children:"Type"}),e.jsx("th",{className:"py-2 pr-4",children:"Direction"}),e.jsx("th",{className:"py-2 pr-4 text-right",children:"Amount"}),e.jsx("th",{className:"py-2 pr-4",children:"Reference"}),e.jsx("th",{className:"py-2 pr-4",children:"Loan"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"}),e.jsx("th",{className:"py-2 pr-4",children:"Reconciled"}),e.jsx("th",{className:"py-2 pr-4"})]})}),e.jsxs("tbody",{children:[I.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4",children:Te(s.occurredAt)}),e.jsx("td",{className:"py-2 pr-4",children:s.type}),e.jsx("td",{className:"py-2 pr-4",children:s.direction}),e.jsx("td",{className:"py-2 pr-4 text-right font-medium",children:C(s.amount,s.currency||f)}),e.jsx("td",{className:"py-2 pr-4",children:s.reference||"—"}),e.jsx("td",{className:"py-2 pr-4",children:s.loanId?String(s.loanId).slice(0,8):"—"}),e.jsx("td",{className:"py-2 pr-4",children:s.status}),e.jsx("td",{className:"py-2 pr-4",children:s.reconciled?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(fe,{className:"h-4 w-4"})," Yes"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-500",children:[e.jsx(be,{className:"h-4 w-4"})," No"]})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("button",{onClick:()=>K(s),className:g,children:s.reconciled?e.jsx(e.Fragment,{children:"Unreconcile"}):e.jsx(e.Fragment,{children:"Reconcile"})})})]},s.id)),I.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"py-6 text-center text-gray-500",children:"No transactions"})})]})]})})]})]})}function C(a,t="TZS"){if(a==null)return"—";const T=Number(a);return Number.isNaN(T)?String(a):`${T.toLocaleString()} ${t}`}function Te(a){return a?new Date(a).toLocaleString():"—"}function L(a){return["withdrawal","disbursement","fee","transfer_out"].includes(a)?"out":"in"}function D(a){const t={};return a.type&&(t.type=a.type),a.status&&(t.status=a.status),a.reconciled!==""&&(t.reconciled=a.reconciled),a.from&&(t.from=a.from),a.to&&(t.to=a.to),t}export{Le as default};
