import{r as i,b as U,j as e}from"./index-CgrnwCLT.js";function $({url:a,params:c={},initialPage:x=1,initialLimit:j=20}){var o,m;const[d,h]=i.useState(x),[n,R]=i.useState(j),[N,q]=i.useState(c.q||""),[P,C]=i.useState(!0),[L,g]=i.useState(""),[v,p]=i.useState([]),[M,y]=i.useState(0),[B,S]=i.useState(null),t=i.useMemo(()=>({...c,page:d,limit:n,q:N||void 0}),[c,d,n,N]),r=i.useMemo(()=>{var A,s;if(!a||/^https?:\/\//i.test(a))return a;const f=((s=(A=U)==null?void 0:A.defaults)==null?void 0:s.baseURL)||"",E=/\/api\/?$/.test(f);let l=a;return E&&l.startsWith("/api/")&&(l=l.slice(4)),l.startsWith("/")||(l=`/${l}`),l=l.replace(/\/{2,}/g,"/"),l},[a,(m=(o=U)==null?void 0:o.defaults)==null?void 0:m.baseURL]),b=async f=>{var E,l,A;C(!0),g("");try{const s=await U.get(r,{params:t,signal:f}),u=s==null?void 0:s.data;Array.isArray(u)?(p(u),y(u.length),S(null)):u&&Array.isArray(u.data)?(p(u.data),y(((E=u.pagination)==null?void 0:E.total)??u.data.length??0),S(u.summary??null)):(p([]),y(0),S(null))}catch(s){(s==null?void 0:s.name)!=="CanceledError"&&(s==null?void 0:s.message)!=="canceled"&&g(((A=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:A.error)||s.message||"Request failed")}finally{(!f||!f.aborted)&&C(!1)}};return i.useEffect(()=>{const f=new AbortController;return b(f.signal),()=>f.abort()},[r,JSON.stringify(t)]),{rows:v,total:M,page:d,setPage:h,limit:n,setLimit:R,q:N,setQ:q,loading:P,error:L,summary:B,refresh:()=>b()}}function _({page:a,setPage:c,limit:x,setLimit:j,total:d}){const h=Math.max(1,Math.ceil((d||0)/(x||20)));return e.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows:"}),e.jsx("select",{className:"border rounded px-2 py-1",value:x,onChange:n=>{c(1),j(parseInt(n.target.value,10))},children:[10,20,50,100].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c(Math.max(1,a-1)),disabled:a<=1,children:"Prev"}),e.jsxs("span",{children:["Page ",a," / ",h]}),e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c(Math.min(h,a+1)),disabled:a>=h,children:"Next"})]})]})}function z({title:a,q:c,setQ:x,columns:j=[],rows:d=[],loading:h,error:n,page:R,setPage:N,limit:q,setLimit:P,total:C,toolbar:L,renderActions:g,renderRowActions:v}){const p=!!(g||v),M=i.useMemo(()=>(Array.isArray(d)?d:[]).filter(Boolean),[d]),y=Array.isArray(j)?j.filter(Boolean):[],B=(t,r,b,k)=>{const o=r==null?void 0:r[t.key];if(typeof t.render=="function"){try{const m=t.render({row:r,value:o,column:t,rowIndex:b,colIndex:k});if(typeof m<"u")return m}catch{}try{return t.render(o,r)}catch{}try{return t.render(r)}catch{}}return o===null||typeof o>"u"||o===""?"—":String(o)},S=t=>typeof v=="function"?v(t):typeof g=="function"?g(t):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a}),typeof c<"u"&&typeof x=="function"&&e.jsx("input",{value:c,onChange:t=>x(t.target.value),placeholder:"Search…",className:"px-3 py-2 border rounded w-full sm:w-60 dark:bg-gray-700"})]}),L?e.jsx("div",{className:"mb-3",children:L}):null,n&&e.jsxs("div",{className:"text-red-500 text-sm mb-3",children:["Error: ",String(n)]}),h?e.jsx("div",{className:"py-10 text-center text-sm opacity-70",children:"Loading…"}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b dark:border-gray-700",children:[y.map(t=>e.jsx("th",{className:"px-3 py-2",children:t.title??t.key??""},t.key||t.title)),p&&e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:y.length+(p?1:0),className:"px-3 py-10 text-center opacity-70",children:"No data"})}):M.map((t,r)=>e.jsxs("tr",{className:"border-b last:border-0 dark:border-gray-700",children:[y.map((b,k)=>e.jsx("td",{className:"px-3 py-2",children:B(b,t,r,k)},b.key||k)),p&&e.jsx("td",{className:"px-3 py-2",children:S(t)})]},(t==null?void 0:t.id)??r))})]})}),e.jsx(_,{page:R,setPage:N,limit:q,setLimit:P,total:C})]})}export{z as L,$ as u};
