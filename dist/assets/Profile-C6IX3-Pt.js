import{u as V,r as x,j as e,b as u}from"./index-DAEntYkr.js";const X=["Africa/Nairobi","Africa/Kampala","Africa/Dar_es_Salaam","Africa/Lagos","Africa/Johannesburg","UTC","Europe/London","Europe/Berlin","Asia/Dubai"],ee=[{value:"/dashboard",label:"Dashboard"},{value:"/borrowers",label:"Borrowers"},{value:"/loans/review-queue",label:"Loan Review Queue"},{value:"/collections",label:"Collections"},{value:"/reports/borrowers",label:"Reports"}];function se(){var U,E,I,L,T;const r=V(),[g,i]=x.useState(!0),[c,t]=x.useState(!1),[S,D]=x.useState([]),[l,b]=x.useState({displayName:"",name:"",email:"",phone:"",branchId:"",timezone:"Africa/Nairobi",locale:"en",avatarUrl:null,title:"",department:"",employeeCode:""}),[n,y]=x.useState({landingPage:"/dashboard",defaultCurrency:"TZS",dateFormat:"dd/MM/yyyy",numberFormat:"1,234.56",theme:"system",fontScale:"normal",reduceMotion:!1,colorBlindMode:!1}),[s,d]=x.useState({channels:{inApp:!0,email:!0,sms:!1},events:{loanAssigned:!0,approvalNeeded:!0,largeRepayment:{enabled:!0,threshold:5e5},arrearsDigest:{enabled:!0,days:7,hour:18},kycAssigned:!0}}),[M,P]=x.useState([]),G=x.useMemo(()=>{var j,f;const o=(l.displayName||l.name||l.email||"U").trim().split(/\s+/);return(((j=o[0])==null?void 0:j[0])||"U").toUpperCase()+(((f=o[1])==null?void 0:f[0])||"").toUpperCase()},[l.displayName,l.name,l.email]),R=async()=>{var a,o,j,f,z;i(!0);try{const[q,H,Q,A,F]=await Promise.all([u.get("/account/me"),u.get("/account/preferences"),u.get("/account/notifications"),u.get("/branches"),u.get("/account/security/sessions").catch(()=>({data:{sessions:[]}}))]),m=((a=q.data)==null?void 0:a.user)||{};b({displayName:m.displayName||m.name||"",name:m.name||"",email:m.email||"",phone:m.phone||"",branchId:m.branchId||"",timezone:m.timezone||"Africa/Nairobi",locale:m.locale||"en",avatarUrl:m.avatarUrl||null,title:m.title||"",department:m.department||"",employeeCode:m.employeeCode||""});const W=((o=H.data)==null?void 0:o.preferences)||{};y(N=>({...N,...W}));const w=((j=Q.data)==null?void 0:j.notifications)||{};d(N=>{var Y,B;return{channels:{...N.channels,...w.channels||{}},events:{...N.events,...w.events||{},largeRepayment:{...N.events.largeRepayment,...((Y=w.events)==null?void 0:Y.largeRepayment)||{}},arrearsDigest:{...N.events.arrearsDigest,...((B=w.events)==null?void 0:B.arrearsDigest)||{}}}}});const $=Array.isArray(A.data)?A.data:((f=A.data)==null?void 0:f.data)||[];D($),P(Array.isArray((z=F.data)==null?void 0:z.sessions)?F.data.sessions:[])}finally{i(!1)}};x.useEffect(()=>{R()},[]);const _=async()=>{t(!0);try{const a={displayName:l.displayName,name:l.name,phone:l.phone,branchId:l.branchId||null,timezone:l.timezone,locale:l.locale||"en"};await u.put("/account/me",a)}finally{t(!1)}},J=async()=>{t(!0);try{await u.put("/account/preferences",n)}finally{t(!1)}},Z=async()=>{t(!0);try{await u.put("/account/notifications",s)}finally{t(!1)}},K=async a=>{if(!a)return;const o=new FormData;o.append("avatar",a);const{data:j}=await u.post("/account/avatar",o,{headers:{"Content-Type":"multipart/form-data"}});b(f=>({...f,avatarUrl:j.avatarUrl}))},O=async()=>{await u.post("/account/security/sessions/revoke-all"),P([])};return g?e.jsx("div",{className:"p-6 text-sm text-slate-500",children:"Loading…"}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 border dark:border-slate-800 rounded-2xl p-4",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Profile"}),e.jsxs(k,{title:"Identity",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(h,{label:"Display name",value:l.displayName,onChange:a=>b({...l,displayName:a})}),e.jsx(h,{label:"Full name",value:l.name,onChange:a=>b({...l,name:a})}),e.jsx(h,{label:"Email",value:l.email,disabled:!0,hint:"Email is managed by your admin."}),e.jsx(h,{label:"Phone",value:l.phone,onChange:a=>b({...l,phone:a}),placeholder:"+2547…"}),e.jsx(C,{label:"Default branch",value:l.branchId||"",onChange:a=>b({...l,branchId:a}),options:[{value:"",label:"—"},...S.map(a=>({value:String(a.id),label:a.name}))]}),e.jsx(C,{label:"Time zone",value:l.timezone,onChange:a=>b({...l,timezone:a}),options:X.map(a=>({value:a,label:a}))}),e.jsx(h,{label:"Locale",value:l.locale,onChange:a=>b({...l,locale:a}),placeholder:"en"})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(v,{onClick:_,loading:c,children:"Save Changes"}),e.jsx(v,{type:"secondary",onClick:R,children:"Refresh"}),e.jsx(v,{type:"secondary",onClick:()=>r("/change-password"),children:"Change Password"}),e.jsx(v,{type:"secondary",onClick:()=>r("/2fa"),children:"Two-Factor"})]})]}),e.jsx(k,{title:"Professional",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(h,{label:"Job title",value:l.title,disabled:!0}),e.jsx(h,{label:"Department",value:l.department,disabled:!0}),e.jsx(h,{label:"Employee ID",value:l.employeeCode,disabled:!0})]})}),e.jsxs(k,{title:"Preferences",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(C,{label:"Default landing page",value:n.landingPage,onChange:a=>y({...n,landingPage:a}),options:ee}),e.jsx(h,{label:"Default currency",value:n.defaultCurrency,onChange:a=>y({...n,defaultCurrency:a.toUpperCase()}),placeholder:"TZS"}),e.jsx(C,{label:"Date format",value:n.dateFormat,onChange:a=>y({...n,dateFormat:a}),options:[{value:"dd/MM/yyyy",label:"DD/MM/YYYY"},{value:"MM/dd/yyyy",label:"MM/DD/YYYY"}]}),e.jsx(C,{label:"Theme",value:n.theme,onChange:a=>y({...n,theme:a}),options:[{value:"system",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]}),e.jsx(C,{label:"Font size",value:n.fontScale,onChange:a=>y({...n,fontScale:a}),options:[{value:"normal",label:"Normal"},{value:"large",label:"Large"}]}),e.jsx(p,{label:"Reduced motion",checked:n.reduceMotion,onChange:a=>y({...n,reduceMotion:a})}),e.jsx(p,{label:"Color-blind friendly palette",checked:n.colorBlindMode,onChange:a=>y({...n,colorBlindMode:a})})]}),e.jsx("div",{className:"mt-3",children:e.jsx(v,{onClick:J,loading:c,children:"Save Preferences"})})]}),e.jsxs(k,{title:"Notifications",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(p,{label:"In-app",checked:!!s.channels.inApp,onChange:a=>d({...s,channels:{...s.channels,inApp:a}})}),e.jsx(p,{label:"Email",checked:!!s.channels.email,onChange:a=>d({...s,channels:{...s.channels,email:a}})}),e.jsx(p,{label:"SMS/WhatsApp",checked:!!s.channels.sms,onChange:a=>d({...s,channels:{...s.channels,sms:a}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsx(p,{label:"New loan assigned to me",checked:!!s.events.loanAssigned,onChange:a=>d({...s,events:{...s.events,loanAssigned:a}})}),e.jsx(p,{label:"Approval needed (maker–checker)",checked:!!s.events.approvalNeeded,onChange:a=>d({...s,events:{...s.events,approvalNeeded:a}})}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("div",{className:"font-medium text-sm",children:"Large repayment"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(p,{label:"Enabled",checked:!!((U=s.events.largeRepayment)!=null&&U.enabled),onChange:a=>d({...s,events:{...s.events,largeRepayment:{...s.events.largeRepayment||{},enabled:a}}})}),e.jsx(h,{label:"Threshold",value:String(((E=s.events.largeRepayment)==null?void 0:E.threshold)??5e5),onChange:a=>d({...s,events:{...s.events,largeRepayment:{...s.events.largeRepayment||{},threshold:Number(a)||0}}})})]})]}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("div",{className:"font-medium text-sm",children:"Arrears digest"}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[e.jsx(p,{label:"Enabled",checked:!!((I=s.events.arrearsDigest)!=null&&I.enabled),onChange:a=>d({...s,events:{...s.events,arrearsDigest:{...s.events.arrearsDigest||{},enabled:a}}})}),e.jsx(h,{label:"Days",value:String(((L=s.events.arrearsDigest)==null?void 0:L.days)??7),onChange:a=>d({...s,events:{...s.events,arrearsDigest:{...s.events.arrearsDigest||{},days:Math.max(1,Number(a)||1)}}})}),e.jsx(h,{label:"Hour (24h)",value:String(((T=s.events.arrearsDigest)==null?void 0:T.hour)??18),onChange:a=>d({...s,events:{...s.events,arrearsDigest:{...s.events.arrearsDigest||{},hour:Math.min(23,Math.max(0,Number(a)||0))}}})})]})]}),e.jsx(p,{label:"KYC item assigned to me",checked:!!s.events.kycAssigned,onChange:a=>d({...s,events:{...s.events,kycAssigned:a}})})]}),e.jsx("div",{className:"mt-3",children:e.jsx(v,{onClick:Z,loading:c,children:"Save Notifications"})})]}),e.jsxs(k,{title:"Security",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(v,{type:"secondary",onClick:()=>r("/2fa"),children:"Manage Two-Factor"}),e.jsx(v,{type:"secondary",onClick:()=>r("/change-password"),children:"Change Password"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Active sessions"}),M.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"Only this device is active."}):e.jsx("ul",{className:"space-y-2",children:M.map((a,o)=>e.jsxs("li",{className:"border rounded-lg p-2 text-sm flex justify-between",children:[e.jsxs("span",{children:[a.device||"Device"," • ",a.ip||"IP"," • ",a.lastSeen?new Date(a.lastSeen).toLocaleString():""]}),e.jsx("span",{className:"opacity-60",children:a.userAgent||""})]},o))}),e.jsx("div",{className:"mt-2",children:e.jsx(v,{type:"danger",onClick:O,children:"Sign out of other devices"})})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border dark:border-slate-800 rounded-2xl p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-3",children:"Avatar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-blue-600 text-white flex items-center justify-center text-lg font-bold",children:l.avatarUrl?e.jsx("img",{src:l.avatarUrl,alt:"avatar",className:"w-14 h-14 rounded-full object-cover"}):G}),e.jsxs("div",{children:[e.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer hover:bg-slate-50",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:a=>{var o;return K((o=a.target.files)==null?void 0:o[0])}}),"Choose image"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"PNG/JPG up to 2MB."})]})]})]})]})}function k({title:r,children:g}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-800 dark:text-slate-100 mb-2",children:r}),g]})}function h({label:r,value:g,onChange:i,placeholder:c,disabled:t,hint:S}){return e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:r}),e.jsx("input",{className:"w-full border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm bg-white dark:bg-slate-800",value:g??"",placeholder:c,onChange:D=>i&&i(D.target.value),disabled:t}),S&&e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:S})]})}function C({label:r,value:g,onChange:i,options:c}){return e.jsxs("label",{className:"block",children:[e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:r}),e.jsx("select",{className:"w-full border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm bg-white dark:bg-slate-800",value:g,onChange:t=>i&&i(t.target.value),children:(c||[]).map(t=>e.jsx("option",{value:t.value,children:t.label},String(t.value)))})]})}function p({label:r,checked:g,onChange:i}){return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:!!g,onChange:c=>i&&i(c.target.checked)}),e.jsx("span",{className:"text-sm",children:r})]})}function v({children:r,onClick:g,type:i="primary",loading:c}){const t=i==="secondary"?"border bg-white hover:bg-slate-50 text-slate-800":i==="danger"?"bg-rose-600 hover:bg-rose-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white";return e.jsx("button",{onClick:g,disabled:c,className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm ${t} disabled:opacity-60`,children:c?"Saving…":r})}export{se as default};
