import{r as p,j as s,h as J,w as Xe}from"./index-_x_s48EO.js";async function k(n,c={}){try{const l=await J.get(n,c);return{ok:!0,data:l==null?void 0:l.data}}catch(l){return{ok:!1,error:l}}}async function C(n,c={},l={}){try{const m=await J.post(n,c,l);return{ok:!0,data:m==null?void 0:m.data}}catch(m){return{ok:!1,error:m}}}async function U(n,c={},l={}){try{const m=await J.put(n,c,l);return{ok:!0,data:m==null?void 0:m.data}}catch(m){return{ok:!1,error:m}}}async function fe(n,c={}){try{const l=await J.delete(n,c);return{ok:!0,data:l==null?void 0:l.data}}catch(l){return{ok:!1,error:l}}}const ge=n=>String(n||"").replace(/\D+/g,""),P=n=>{const c=String(n??"").trim();return c.length?c:null},$=n=>Array.isArray(n)?n:(n==null?void 0:n.items)||(n==null?void 0:n.rows)||(n==null?void 0:n.data)||[],re=(n,c)=>{var l,m;return((l=n.find(v=>String(v.id)===String(c)))==null?void 0:l.name)||((m=n.find(v=>String(v.id)===String(c)))==null?void 0:m.title)||""},je=(n,c)=>{var l;return((l=n.find(m=>String(m.id)===String(c)))==null?void 0:l.name)||""};function ae({children:n}){return typeof document>"u"?null:Xe.createPortal(n,document.body)}function Je(n,c){p.useEffect(()=>{const l=m=>{n.some(S=>S.current&&S.current.contains(m.target))||c()};return document.addEventListener("mousedown",l,!0),document.addEventListener("touchstart",l,{passive:!0,capture:!0}),()=>{document.removeEventListener("mousedown",l,!0),document.removeEventListener("touchstart",l,!0)}},[n,c])}function Ye({actions:n=[]}){const[c,l]=p.useState(!1),m=p.useRef(null),v=p.useRef(null),[S,D]=p.useState({top:0,left:0}),B=()=>{var O;const x=(O=m.current)==null?void 0:O.getBoundingClientRect();if(!x)return;const y=220,w=6;let Y=Math.min(Math.max(8,x.right-y),window.innerWidth-y-8),R=x.bottom+w;const H=8+n.length*36;R+H>window.innerHeight-8&&(R=Math.max(8,x.top-w-H)),D({top:R,left:Y})};return p.useLayoutEffect(()=>{if(!c)return;B();const x=()=>B(),y=()=>B();return window.addEventListener("scroll",x,!0),window.addEventListener("resize",y),()=>{window.removeEventListener("scroll",x,!0),window.removeEventListener("resize",y)}},[c,n.length]),Je([m,v],()=>l(!1)),p.useEffect(()=>{if(!c)return;const x=y=>y.key==="Escape"&&l(!1);return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[c]),s.jsxs(s.Fragment,{children:[s.jsx("button",{ref:m,className:"px-2 py-1 rounded border border-[var(--border)] text-[var(--fg)] hover:bg-[var(--nav-item-hover-bg)]",onClick:()=>l(x=>!x),"aria-haspopup":"menu","aria-expanded":c,title:"Actions",children:"⋮"}),c&&s.jsxs(ae,{children:[s.jsx("div",{className:"fixed inset-0 z-50",style:{background:"transparent"},onClick:()=>l(!1)}),s.jsx("div",{ref:v,className:"fixed z-[60] min-w-[220px] rounded-md border border-[var(--border)] shadow-lg bg-[var(--panel)] text-[var(--fg)]",style:{top:S.top,left:S.left},onClick:x=>x.stopPropagation(),role:"menu",children:n.map((x,y)=>s.jsx("button",{onClick:()=>{var w;x.disabled||(l(!1),(w=x.onClick)==null||w.call(x))},disabled:x.disabled,className:`w-full text-left px-3 py-2 text-sm hover:bg-[var(--chip-soft)] ${x.danger?"text-rose-500":""} disabled:opacity-50`,role:"menuitem",children:x.label},y))})]})]})}function ye(){p.useEffect(()=>{const{body:n}=document,c=n.style.overflow;return n.style.overflow="hidden",()=>{n.style.overflow=c||""}},[])}function X({title:n,children:c,onClose:l}){return ye(),p.useEffect(()=>{const m=v=>v.key==="Escape"&&(l==null?void 0:l());return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[l]),s.jsx(ae,{children:s.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-[var(--panel)] text-[var(--fg)] rounded-xl border border-[var(--border)] shadow p-4 w-full max-w-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"font-semibold",children:n}),s.jsx("button",{onClick:l,className:"text-sm px-2 py-1 rounded border border-[var(--border)] hover:bg-[var(--nav-item-hover-bg)]","aria-label":"Close",children:"✕"})]}),c]})})})}function Ze({title:n,children:c,onClose:l,wide:m=!1}){return ye(),p.useEffect(()=>{const v=S=>S.key==="Escape"&&(l==null?void 0:l());return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[l]),s.jsx(ae,{children:s.jsxs("div",{className:"fixed inset-0 z-50",children:[s.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:l}),s.jsxs("div",{className:`absolute right-0 top-0 h-full w-full ${m?"max-w-5xl":"max-w-3xl"} bg-[var(--panel)] text-[var(--fg)] border-l border-[var(--border)] shadow-xl p-4`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"font-semibold",children:n}),s.jsx("button",{onClick:l,className:"text-sm px-2 py-1 rounded border border-[var(--border)] hover:bg-[var(--nav-item-hover-bg)]",children:"✕"})]}),c]})]})})}function M({className:n="",children:c,...l}){return s.jsx("button",{...l,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-blue-600 text-white border border-blue-600 hover:bg-blue-700","disabled:opacity-60 disabled:hover:bg-blue-600","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-1",n].join(" "),children:c})}function E({className:n="",children:c,...l}){return s.jsx("button",{...l,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-[var(--panel)] text-[var(--fg)] border border-[var(--border)] hover:bg-[var(--nav-item-hover-bg)]","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 focus-visible:ring-offset-1","disabled:opacity-60",n].join(" "),children:c})}const ss=()=>{var be;const[n,c]=p.useState([]),[l,m]=p.useState([]),[v,S]=p.useState([]),[D,B]=p.useState(!0),[x,y]=p.useState(""),[w,Y]=p.useState(""),[R,H]=p.useState(""),[O,te]=p.useState({}),[A,V]=p.useState({}),[le,ne]=p.useState(""),[L,Z]=p.useState(new Set),oe=n.length>0&&n.every(e=>L.has(e.id)),[_,Ne]=p.useState(!0),[ee,de]=p.useState(!1),[f,we]=p.useState(null),[N,ie]=p.useState("profile"),[g,F]=p.useState({hr:null,attendance:null,leave:null,payroll:null}),[_e,z]=p.useState({hr:"",attendance:"",leave:"",payroll:""}),[T,ce]=p.useState(!1),[ke,K]=p.useState(!1),[Se,q]=p.useState(!1),[Ie,G]=p.useState(!1),[Ce,Q]=p.useState(!1),[i,j]=p.useState(null),[se,pe]=p.useState(new Set),Ee=(e,r,a)=>{const t=$(e.data),o=$(r.data),d=$(a.data);c(t),m(o),S(d);const h={};t.forEach(u=>{var b;h[u.id]={roleId:u.roleId??((b=u.role)==null?void 0:b.id)??"",branchId:u.branchId??""}}),V(h)},I=async()=>{var e,r;B(!0),ne("");try{const a={limit:1e3,q:x};w&&(a.roleId=w),R&&(a.branchId=R);const[t,o,d]=await Promise.all([k("/users",{params:a}),k("/roles",{params:{limit:1e3}}),k("/branches",{params:{limit:1e3}})]);if(!t.ok)throw t.error;if(!o.ok)throw o.error;if(!d.ok)throw d.error;Ee(t,o,d)}catch(a){ne(((r=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:r.error)||(a==null?void 0:a.message)||"Failed to load data")}finally{B(!1)}};p.useEffect(()=>{I()},[]),p.useEffect(()=>{const e=setTimeout(()=>{D||I()},400);return()=>clearTimeout(e)},[x,w,R]);const he=(e,r)=>{V(a=>({...a,[e]:{...a[e]||{},...r}}))},Re=e=>{var o;const r=A[e.id]||{},a=e.roleId??((o=e.role)==null?void 0:o.id)??"",t=e.branchId??"";return String(r.roleId||"")!==String(a)||String(r.branchId||"")!==String(t)},$e=async e=>{var o,d;const r=e.id,a=A[r]||{},t={roleId:a.roleId?Number(a.roleId):null,branchId:a.branchId?Number(a.branchId):null};te(h=>({...h,[r]:!0}));try{let h=await C(`/users/${r}/assign`,t);if(h.ok||(h=await U(`/users/${r}`,t)),!h.ok)throw h.error;c(u=>u.map(b=>b.id===r?{...b,roleId:t.roleId,branchId:t.branchId,role:t.roleId?{id:t.roleId,name:re(l,t.roleId)}:null}:b)),alert("Assigned successfully")}catch(h){alert(((d=(o=h==null?void 0:h.response)==null?void 0:o.data)==null?void 0:d.error)||(h==null?void 0:h.message)||"Failed to assign")}finally{te(h=>({...h,[r]:!1}))}},Le=e=>{Z(r=>{const a=new Set(r);return a.has(e)?a.delete(e):a.add(e),a})},De=()=>{Z(oe?new Set:new Set(n.map(e=>e.id)))},Be=async e=>{if(!e||L.size===0)return;const r=[...L];if(!(await C("/users/assign-role",{userIds:r,roleId:Number(e)})).ok)for(const t of r)await C(`/users/${t}/assign`,{roleId:Number(e)});V(t=>{const o={...t};return r.forEach(d=>{o[d]={...o[d]||{},roleId:Number(e)}}),o}),alert(`Assigned role to ${r.length} user(s).`)},Pe=async e=>{if(!e||L.size===0)return;const r=[...L];if(!(await C("/users/assign-branch",{userIds:r,branchId:Number(e)})).ok)for(const t of r)await C(`/users/${t}/assign`,{branchId:Number(e)});V(t=>{const o={...t};return r.forEach(d=>{o[d]={...o[d]||{},branchId:Number(e)}}),o}),alert(`Assigned branch to ${r.length} user(s).`)},Oe=()=>{const e=["id","name","email","phone","roleId","branchId"],r=n.map(d=>{var ve;const h=A[d.id]||{},u=h.roleId??d.roleId??((ve=d.role)==null?void 0:ve.id)??"",b=h.branchId??d.branchId??"",Ge=(d.name||`${d.firstName||""} ${d.lastName||""}`.trim()||"").replace(/"/g,'""'),Qe=(d.email||"").replace(/"/g,'""'),We=(d.phone||"").replace(/"/g,'""');return[d.id,`"${Ge}"`,`"${Qe}"`,`"${We}"`,u,b].join(",")}),a=new Blob([[e.join(","),...r].join(`
`)],{type:"text/csv;charset=utf-8"}),t=URL.createObjectURL(a),o=document.createElement("a");o.href=t,o.download="staff.csv",o.click(),URL.revokeObjectURL(t)},Ae=()=>{j({name:"",email:"",phone:"",password:"",roleId:"",branchId:""}),K(!0)},me=e=>{j({id:e.id,name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim(),email:e.email||"",phone:e.phone||""}),q(!0)},xe=e=>{j({id:e.id,password:""}),Q(!0)},ue=async e=>{j(e);const r=new Set((e.roles||e.Roles||[]).map(a=>(a==null?void 0:a.id)??(a==null?void 0:a.roleId)??(a==null?void 0:a.RoleId)).filter(a=>a!=null));if(pe(r),l.length===0){const a=await k("/roles",{params:{limit:1e3}});a.ok&&m($(a.data))}G(!0)},Fe=async e=>{var a,t,o,d;const r=await fe(`/users/${e.id}`);r.ok||alert(((o=(t=(a=r==null?void 0:r.error)==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.error)||((d=r==null?void 0:r.error)==null?void 0:d.message)||"Failed to disable user."),I()},ze=async e=>{var a,t,o,d;const r=await fe(`/users/${e.id}`,{params:{force:1,hard:1},headers:{"X-Force-Delete":"1"},data:{force:!0}});r.ok||alert(((o=(t=(a=r==null?void 0:r.error)==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.error)||((d=r==null?void 0:r.error)==null?void 0:d.message)||"Failed to delete user."),I()},Te=async()=>{var a,t,o,d;const e={name:P(i.name),email:P(i.email),phone:P(ge(i.phone)),...i.password?{password:i.password}:{},...i.roleId?{roleId:Number(i.roleId)}:{},...i.branchId?{branchId:Number(i.branchId)}:{}},r=await C("/users",e);r.ok||alert(((o=(t=(a=r==null?void 0:r.error)==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.error)||((d=r==null?void 0:r.error)==null?void 0:d.message)||"Failed to create user."),K(!1),j(null),I()},Ue=async()=>{var a,t,o,d;const e={name:P(i.name),email:P(i.email),phone:P(ge(i.phone))};let r=await U(`/users/${i.id}`,e);r.ok||(r=await C(`/users/${i.id}`,e)),r.ok||alert(((o=(t=(a=r==null?void 0:r.error)==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.error)||((d=r==null?void 0:r.error)==null?void 0:d.message)||"Failed to update user."),q(!1),j(null),I()},Me=async()=>{var r,a,t,o;let e=await C(`/users/${i.id}/password`,{password:i.password});e.ok||(e=await U(`/users/${i.id}`,{password:i.password})),e.ok||alert(((t=(a=(r=e==null?void 0:e.error)==null?void 0:r.response)==null?void 0:a.data)==null?void 0:t.error)||((o=e==null?void 0:e.error)==null?void 0:o.message)||"Failed to set password."),Q(!1),j(null),I()},He=async()=>{var a,t,o,d;const e=[...se];let r=await C(`/users/${i.id}/roles`,{roleIds:e});r.ok||(r=await U(`/users/${i.id}/roles`,{roleIds:e})),r.ok||(r=await U(`/users/${i.id}`,{roleIds:e})),r.ok||alert(((o=(t=(a=r==null?void 0:r.error)==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.error)||((d=r==null?void 0:r.error)==null?void 0:d.message)||"Failed to update roles."),G(!1),j(null),I()},Ve=e=>{const r=new Set(se);r.has(e)?r.delete(e):r.add(e),pe(r)},Ke=e=>{we(e),ie("profile"),F({hr:null,attendance:null,leave:null,payroll:null}),z({hr:"",attendance:"",leave:"",payroll:""}),de(!0)},qe=async(e,r)=>{ce(!0);try{if(e==="hr"){let a=await k("/hr/contracts",{params:{userId:r.id,limit:50}});a.ok||(a=await k(`/hr/employees/${r.id}`)),a.ok?F(t=>({...t,hr:$(a.data)})):z(t=>{var o,d,h,u;return{...t,hr:((h=(d=(o=a==null?void 0:a.error)==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"HR endpoint not enabled."}})}if(e==="attendance"){const a=await k("/hr/attendance",{params:{userId:r.id,limit:100}});a.ok?F(t=>({...t,attendance:$(a.data)})):z(t=>{var o,d,h,u;return{...t,attendance:((h=(d=(o=a==null?void 0:a.error)==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Attendance endpoint not enabled."}})}if(e==="leave"){const a=await k("/hr/leave",{params:{userId:r.id,limit:100}});a.ok?F(t=>({...t,leave:$(a.data)})):z(t=>{var o,d,h,u;return{...t,leave:((h=(d=(o=a==null?void 0:a.error)==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Leave endpoint not enabled."}})}if(e==="payroll"){let a=await k("/payroll",{params:{userId:r.id,limit:50}});a.ok||(a=await k("/payroll/entries",{params:{userId:r.id,limit:50}})),a.ok?F(t=>({...t,payroll:$(a.data)})):z(t=>{var o,d,h,u;return{...t,payroll:((h=(d=(o=a==null?void 0:a.error)==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Payroll endpoint not enabled."}})}}finally{ce(!1)}};p.useEffect(()=>{!ee||!f||N!=="profile"&&!g[N]&&qe(N,f)},[N,ee,f]);const W=e=>s.jsx("span",{className:"inline-flex items-center px-2 py-0.5 text-xs rounded-full border border-[var(--border)] bg-[var(--chip-soft)]",children:e||"—"});return s.jsxs("div",{className:"p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-bold",children:"User & Staff Management"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"relative",children:s.jsx("input",{placeholder:"Search name, email, role…",value:x,onChange:e=>y(e.target.value),className:"border border-[var(--border)] rounded px-3 py-1.5 text-sm bg-[var(--panel)] text-[var(--fg)] placeholder:text-[var(--muted)]","aria-label":"Search users"})}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm bg-[var(--panel)] text-[var(--fg)]",value:w,onChange:e=>Y(e.target.value),"aria-label":"Filter by role",children:[s.jsx("option",{value:"",children:"All roles"}),l.map(e=>s.jsx("option",{value:e.id,children:e.name||e.title},e.id))]}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm bg-[var(--panel)] text-[var(--fg)]",value:R,onChange:e=>H(e.target.value),"aria-label":"Filter by branch",children:[s.jsx("option",{value:"",children:"All branches"}),v.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("label",{className:"ml-2 inline-flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:_,onChange:e=>Ne(e.target.checked)}),"Protect roles (lock)"]}),s.jsx(E,{onClick:I,disabled:D,children:D?"Loading…":"Refresh"}),s.jsx(M,{onClick:Ae,children:"Add Staff"})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[s.jsxs("span",{className:"opacity-70",children:["Selected: ",L.size]}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 bg-[var(--panel)] text-[var(--fg)]",onChange:e=>{const r=e.target.value;r&&(Be(r),e.target.value="")},"aria-label":"Bulk assign role",defaultValue:"",children:[s.jsx("option",{value:"",children:"Bulk: set role…"}),l.map(e=>s.jsx("option",{value:e.id,children:e.name||e.title},e.id))]}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 bg-[var(--panel)] text-[var(--fg)]",onChange:e=>{const r=e.target.value;r&&(Pe(r),e.target.value="")},"aria-label":"Bulk assign branch",defaultValue:"",children:[s.jsx("option",{value:"",children:"Bulk: set branch…"}),v.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx(E,{onClick:Oe,children:"Export CSV"})]}),le&&s.jsx("div",{className:"text-sm text-rose-500",children:le}),D?s.jsx("p",{children:"Loading users..."}):s.jsx("div",{className:"overflow-x-auto border border-[var(--border)] rounded bg-[var(--panel)]",children:s.jsxs("table",{className:"min-w-full",children:[s.jsx("thead",{className:"text-sm",style:{background:"var(--table-head-bg)"},children:s.jsxs("tr",{className:"text-[var(--fg)]",children:[s.jsx("th",{className:"px-4 py-2 text-left",children:s.jsx("input",{type:"checkbox",checked:oe,onChange:De,"aria-label":"Select all"})}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Name"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Phone"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Role"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Branch"}),s.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),s.jsxs("tbody",{className:"text-sm",children:[n.map(e=>{var o,d,h,u;const r=e.roleId??((o=e.role)==null?void 0:o.id)??"",a=((d=e.role)==null?void 0:d.name)||re(l,r)||(typeof e.role=="string"?e.role:""),t=je(v,e.branchId);return s.jsxs("tr",{className:"border-t border-[var(--border)]",children:[s.jsx("td",{className:"px-4 py-2",children:s.jsx("input",{type:"checkbox",checked:L.has(e.id),onChange:()=>Le(e.id),"aria-label":`Select ${e.name||e.email||e.id}`})}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("button",{className:"text-blue-500 hover:underline",onClick:()=>Ke(e),title:"Open staff profile",children:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||"—"})}),s.jsx("td",{className:"px-4 py-2",children:e.email||"—"}),s.jsx("td",{className:"px-4 py-2",children:e.phone||"—"}),s.jsx("td",{className:"px-4 py-2",children:s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[W(a||"—"),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 min-w-[180px] bg-[var(--panel)] text-[var(--fg)]",value:((h=A[e.id])==null?void 0:h.roleId)??"",onChange:b=>he(e.id,{roleId:b.target.value}),disabled:_,title:_?"Protected (unlock to change)":"Change role (unsaved until Save)",children:[s.jsx("option",{value:"",children:"— Select Role —"}),l.map(b=>s.jsx("option",{value:b.id,children:b.name||b.title},b.id))]})]})}),s.jsx("td",{className:"px-4 py-2",children:s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[W(t||"—"),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 min-w-[180px] bg-[var(--panel)] text-[var(--fg)]",value:((u=A[e.id])==null?void 0:u.branchId)??"",onChange:b=>he(e.id,{branchId:b.target.value}),title:"Change branch (unsaved until Save)",children:[s.jsx("option",{value:"",children:"— Select Branch —"}),v.map(b=>s.jsx("option",{value:b.id,children:b.name},b.id))]})]})}),s.jsx("td",{className:"px-4 py-2 text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",disabled:!Re(e)||O[e.id],onClick:()=>$e(e),title:"Save role/branch changes",children:O[e.id]?"Saving…":"Save"}),s.jsx(Ye,{actions:[{label:"Edit",onClick:()=>me(e)},{label:"Manage Roles (multi)",onClick:()=>ue(e)},{label:"Set/Reset Password",onClick:()=>xe(e)},{label:"Disable",onClick:()=>Fe(e),danger:!0},{label:"Delete (hard)",onClick:()=>ze(e),danger:!0}]})]})})]},e.id)}),n.length===0&&s.jsx("tr",{children:s.jsx("td",{className:"px-4 py-6 text-center opacity-70",colSpan:7,children:"No users found."})})]})]})}),ke&&s.jsxs(X,{title:"Add Staff",onClose:()=>K(!1),children:[s.jsxs("div",{className:"grid gap-2",children:[["name","email","phone","password"].map(e=>s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs opacity-70 capitalize",children:e}),s.jsx("input",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm w-full bg-[var(--panel)] text-[var(--fg)]",type:e==="password"?"password":"text",value:(i==null?void 0:i[e])??"",onChange:r=>j(a=>({...a,[e]:r.target.value})),placeholder:e==="phone"?"digits only":""})]},e)),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs opacity-70",children:"Role (optional)"}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm w-full bg-[var(--panel)] text-[var(--fg)]",value:(i==null?void 0:i.roleId)??"",onChange:e=>j(r=>({...r,roleId:e.target.value})),children:[s.jsx("option",{value:"",children:"— Select Role —"}),l.map(e=>s.jsx("option",{value:e.id,children:e.name||e.title},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs opacity-70",children:"Branch (optional)"}),s.jsxs("select",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm w-full bg-[var(--panel)] text-[var(--fg)]",value:(i==null?void 0:i.branchId)??"",onChange:e=>j(r=>({...r,branchId:e.target.value})),children:[s.jsx("option",{value:"",children:"— Select Branch —"}),v.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[s.jsx(E,{onClick:()=>K(!1),children:"Cancel"}),s.jsx(M,{onClick:Te,children:"Create"})]})]}),Se&&s.jsxs(X,{title:"Edit Staff",onClose:()=>q(!1),children:[s.jsx("div",{className:"grid gap-2",children:["name","email","phone"].map(e=>s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs opacity-70 capitalize",children:e}),s.jsx("input",{className:"border border-[var(--border)] rounded px-2 py-1 text-sm w-full bg-[var(--panel)] text-[var(--fg)]",value:(i==null?void 0:i[e])??"",onChange:r=>j(a=>({...a,[e]:r.target.value})),placeholder:e==="phone"?"digits only":""})]},e))}),s.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[s.jsx(E,{onClick:()=>q(!1),children:"Cancel"}),s.jsx(M,{onClick:Ue,children:"Save"})]})]}),Ce&&s.jsxs(X,{title:"Set/Reset Password",onClose:()=>Q(!1),children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx("label",{className:"block text-xs opacity-70",children:"New Password"}),s.jsx("input",{type:"password",className:"border border-[var(--border)] rounded px-2 py-1 text-sm w-full bg-[var(--panel)] text-[var(--fg)]",value:(i==null?void 0:i.password)??"",onChange:e=>j(r=>({...r,password:e.target.value}))})]}),s.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[s.jsx(E,{onClick:()=>Q(!1),children:"Cancel"}),s.jsx(M,{onClick:Me,children:"Set Password"})]})]}),Ie&&s.jsxs(X,{title:`Manage Roles • ${(i==null?void 0:i.name)||(i==null?void 0:i.email)||""}`,onClose:()=>G(!1),children:[s.jsx("div",{className:"max-h-[50vh] overflow-auto border border-[var(--border)] rounded p-2 bg-[var(--panel)]",children:l.length===0?s.jsx("div",{className:"text-sm opacity-70",children:"No roles found."}):l.map(e=>{const r=e.id??e.roleId??e.RoleId,a=e.name||e.title||`#${r}`,t=se.has(r);return s.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-[var(--nav-item-hover-bg)]",children:[s.jsx("input",{type:"checkbox",checked:t,onChange:()=>Ve(r)}),s.jsx("span",{className:"text-sm",children:a})]},r)})}),s.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[s.jsx(E,{onClick:()=>G(!1),children:"Cancel"}),s.jsx(M,{onClick:He,children:"Save Roles"})]})]}),ee&&f&&s.jsxs(Ze,{title:`Staff • ${f.name||f.email||""}`,onClose:()=>de(!1),wide:!0,children:[s.jsx("div",{className:"border-b border-[var(--border)] mb-3",children:s.jsx("div",{className:"flex gap-2",children:["profile","hr","attendance","leave","payroll"].map(e=>s.jsx("button",{className:`px-3 py-1.5 text-sm rounded-t ${N===e?"bg-blue-600 text-white":"border border-b-0 border-[var(--border)] bg-[var(--panel)] hover:bg-[var(--nav-item-hover-bg)]"}`,onClick:()=>ie(e),children:e[0].toUpperCase()+e.slice(1)},e))})}),N==="profile"&&s.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-1",children:"Basics"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"Name:"})," ",f.name||`${f.firstName||""} ${f.lastName||""}`.trim()||"—"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"Email:"})," ",f.email||"—"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"Phone:"})," ",f.phone||"—"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"Role:"})," ",W(((be=f.role)==null?void 0:be.name)||f.role||re(l,f.roleId))]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"Branch:"})," ",je(v,f.branchId)||"—"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("b",{children:"User ID:"})," ",f.id]})]}),s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-1",children:"Quick Actions"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(E,{onClick:()=>me(f),children:"Edit"}),s.jsx(E,{onClick:()=>ue(f),children:"Roles"}),s.jsx(E,{onClick:()=>xe(f),children:"Password"})]})]})]}),N!=="profile"&&T&&s.jsx("div",{className:"text-sm opacity-70",children:"Loading…"}),N==="hr"&&!T&&s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-2",children:"HR • Contracts/Employee Info"}),!g.hr||g.hr.length===0?s.jsx("div",{className:"text-sm opacity-70",children:"No HR records."}):s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left border-b border-[var(--border)]",children:[s.jsx("th",{className:"py-1 px-2",children:"Title"}),s.jsx("th",{className:"py-1 px-2",children:"Start"}),s.jsx("th",{className:"py-1 px-2",children:"End"}),s.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),s.jsx("tbody",{children:g.hr.map((e,r)=>{var a,t;return s.jsxs("tr",{className:"border-b border-[var(--border)]",children:[s.jsx("td",{className:"py-1 px-2",children:e.title||e.position||"—"}),s.jsx("td",{className:"py-1 px-2",children:((a=e.startDate||e.start)==null?void 0:a.slice(0,10))||"—"}),s.jsx("td",{className:"py-1 px-2",children:((t=e.endDate||e.end)==null?void 0:t.slice(0,10))||"—"}),s.jsx("td",{className:"py-1 px-2",children:e.status||"—"})]},r)})})]})]}),N==="attendance"&&!T&&s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-2",children:"Attendance (latest 100)"}),!g.attendance||g.attendance.length===0?s.jsx("div",{className:"text-sm opacity-70",children:"No attendance records."}):s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left border-b border-[var(--border)]",children:[s.jsx("th",{className:"py-1 px-2",children:"Date"}),s.jsx("th",{className:"py-1 px-2",children:"In"}),s.jsx("th",{className:"py-1 px-2",children:"Out"}),s.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),s.jsx("tbody",{children:g.attendance.map((e,r)=>{var a;return s.jsxs("tr",{className:"border-b border-[var(--border)]",children:[s.jsx("td",{className:"py-1 px-2",children:((a=e.date||e.day||e.createdAt)==null?void 0:a.slice(0,10))||"—"}),s.jsx("td",{className:"py-1 px-2",children:e.clockIn||e.in||"—"}),s.jsx("td",{className:"py-1 px-2",children:e.clockOut||e.out||"—"}),s.jsx("td",{className:"py-1 px-2",children:e.status||"—"})]},r)})})]})]}),N==="leave"&&!T&&s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-2",children:"Leave Requests"}),!g.leave||g.leave.length===0?s.jsx("div",{className:"text-sm opacity-70",children:"No leave records."}):s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left border-b border-[var(--border)]",children:[s.jsx("th",{className:"py-1 px-2",children:"Type"}),s.jsx("th",{className:"py-1 px-2",children:"From"}),s.jsx("th",{className:"py-1 px-2",children:"To"}),s.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),s.jsx("tbody",{children:g.leave.map((e,r)=>{var a,t;return s.jsxs("tr",{className:"border-b border-[var(--border)]",children:[s.jsx("td",{className:"py-1 px-2",children:e.type||"—"}),s.jsx("td",{className:"py-1 px-2",children:((a=e.from||e.startDate)==null?void 0:a.slice(0,10))||"—"}),s.jsx("td",{className:"py-1 px-2",children:((t=e.to||e.endDate)==null?void 0:t.slice(0,10))||"—"}),s.jsx("td",{className:"py-1 px-2",children:e.status||"—"})]},r)})})]})]}),N==="payroll"&&!T&&s.jsxs("div",{className:"rounded border border-[var(--border)] bg-[var(--panel)] p-3",children:[s.jsx("div",{className:"text-xs opacity-70 mb-2",children:"Payroll Entries"}),!g.payroll||g.payroll.length===0?s.jsx("div",{className:"text-sm opacity-70",children:"No payroll entries."}):s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left border-b border-[var(--border)]",children:[s.jsx("th",{className:"py-1 px-2",children:"Period"}),s.jsx("th",{className:"py-1 px-2",children:"Gross"}),s.jsx("th",{className:"py-1 px-2",children:"Net"}),s.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),s.jsx("tbody",{children:g.payroll.map((e,r)=>{var a,t;return s.jsxs("tr",{className:"border-b border-[var(--border)]",children:[s.jsx("td",{className:"py-1 px-2",children:e.period||`${(t=(a=(e.month||"").toString()).padStart)==null?void 0:t.call(a,2,"0")}/${e.year||""}`}),s.jsx("td",{className:"py-1 px-2",children:e.gross!=null?Number(e.gross).toLocaleString():"—"}),s.jsx("td",{className:"py-1 px-2",children:e.net!=null?Number(e.net).toLocaleString():"—"}),s.jsx("td",{className:"py-1 px-2",children:e.status||"—"})]},r)})})]})]})]})]})};export{ss as default};
