import{i as w,r as c,j as r,g as b}from"./index-2ZVrRahO.js";import{B as N}from"./BorrowerAutoComplete-BJAv8K4i.js";async function g(e=[],s={}){let n;for(const i of e)try{const t=await b.get(i,s);return t==null?void 0:t.data}catch(t){n=t}throw n||new Error("No endpoint succeeded")}async function v(e=[],s={},n={}){let i;for(const t of e)try{const a=await b.post(t,s,n);return a==null?void 0:a.data}catch(a){i=a}throw i||new Error("No endpoint succeeded")}async function $(e=[],s={}){let n;for(const i of e)try{const t=await b.delete(i,s);return t==null?void 0:t.data}catch(t){n=t}throw n||new Error("No endpoint succeeded")}function E(e){var n,i,t;if(!e||typeof e!="object")return null;const s=Array.isArray(e.members)?e.members:e.groupMembers||e.items||[];return{id:e.id??e._id??e.groupId??e.code,name:e.name??e.groupName??e.title??"—",branchName:e.branchName??((n=e.branch)==null?void 0:n.name)??"—",officerName:e.officerName??((i=e.officer)==null?void 0:i.name)??"—",meetingDay:e.meetingDay??((t=e.meeting)==null?void 0:t.day)??"—",members:s.map(a=>({id:a.id??a._id??a.borrowerId??a.memberId,name:a.name||`${a.firstName||""} ${a.lastName||""}`.trim()||a.id,phone:a.phone,role:a.role||a.memberRole}))}}const S=()=>{const{groupId:e}=w(),[s,n]=c.useState(null),[i,t]=c.useState(!0),[a,h]=c.useState(""),[l,u]=c.useState(null),[p,x]=c.useState(!1),d=async o=>{try{t(!0);const m=await g([`/borrowers/groups/${e}`,`/groups/${e}`,`/borrower-groups/${e}`,`/api/borrowers/groups/${e}`],{signal:o});n(E(m)),h("")}catch{h("Failed to load group (endpoint not implemented)."),n(null)}finally{t(!1)}};c.useEffect(()=>{const o=new AbortController;return d(o.signal),()=>o.abort()},[e]);const f=async()=>{if(l!=null&&l.id){x(!0);try{await v([`/borrowers/groups/${e}/members`,`/groups/${e}/members`,`/borrower-groups/${e}/members`,`/api/borrowers/groups/${e}/members`],{borrowerId:l.id}),u(null),await d()}catch{alert("Failed to add member.")}finally{x(!1)}}},j=async o=>{try{await $([`/borrowers/groups/${e}/members/${o}`,`/groups/${e}/members/${o}`,`/borrower-groups/${e}/members/${o}`,`/api/borrowers/groups/${e}/members/${o}`]),await d()}catch{alert("Failed to remove member.")}},y=Array.isArray(s==null?void 0:s.members)?s.members:[];return r.jsxs("div",{className:"p-4 space-y-4",children:[r.jsxs("h1",{className:"text-2xl font-semibold",children:["Group #",e]}),i&&r.jsx("div",{children:"Loading…"}),a&&r.jsx("div",{className:"text-red-600",children:a}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-white rounded shadow p-4",children:[r.jsx("h3",{className:"font-semibold mb-2",children:"Overview"}),r.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[r.jsxs("li",{children:[r.jsx("b",{children:"Name:"})," ",(s==null?void 0:s.name)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Branch:"})," ",(s==null?void 0:s.branchName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Officer:"})," ",(s==null?void 0:s.officerName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Meeting Day:"})," ",(s==null?void 0:s.meetingDay)??"—"]})]})]}),r.jsxs("div",{className:"bg-white rounded shadow p-4 lg:col-span-2",children:[r.jsx("h3",{className:"font-semibold mb-2",children:"Members"}),r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("div",{className:"flex-1",children:r.jsx(N,{value:l,onChange:(o,m)=>u(m),placeholder:"Add borrower…"})}),r.jsx("button",{onClick:f,disabled:!l||p,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60",children:p?"Adding…":"Add"})]}),r.jsx("ul",{className:"text-sm divide-y",children:y.length===0?r.jsx("li",{className:"py-2 text-gray-500",children:"No members yet."}):y.map(o=>r.jsxs("li",{className:"py-2 flex items-center justify-between",children:[r.jsxs("div",{children:[o.name," ",r.jsxs("span",{className:"text-gray-500",children:["• ",o.phone||"—"]}),o.role&&r.jsx("span",{className:"ml-2 text-xs uppercase text-gray-400",children:o.role})]}),r.jsx("button",{className:"px-2 py-1 border rounded hover:bg-gray-50",onClick:()=>j(o.id),children:"Remove"})]},o.id))})]})]})]})};export{S as default};
