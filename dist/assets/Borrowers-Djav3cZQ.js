import{r as t,j as r,L as B}from"./index-CZryhDWz.js";import{a as d}from"./index-Dq7h7Pqt.js";import{C as k}from"./index-DrG25GLf.js";import{E as A}from"./jspdf.es.min-C7MKLJ3x.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";const O=()=>{const[j,g]=t.useState([]),[a,l]=t.useState({name:"",nationalId:"",phone:"",email:"",address:""}),[c,x]=t.useState(null),[p,N]=t.useState(""),[u,f]=t.useState(1),[b,i]=t.useState(null),h=5,n="https://mkoposuite-backend-42w2.onrender.com/api",m=async()=>{try{const e=await d.get(`${n}/borrowers`);g(e.data)}catch(e){console.error("Error fetching borrowers:",e),i("Failed to load borrowers.")}},y=async e=>{e.preventDefault();try{c?await d.put(`${n}/borrowers/${c}`,a):await d.post(`${n}/borrowers`,a),l({name:"",nationalId:"",phone:"",email:"",address:""}),x(null),m()}catch(s){console.error("Error saving borrower:",s),i("Failed to save borrower.")}},v=e=>{l(e),x(e.id)},E=async e=>{if(confirm("Are you sure you want to delete this borrower?"))try{await d.delete(`${n}/borrowers/${e}`),m()}catch(s){console.error("Error deleting borrower:",s),i("Failed to delete borrower.")}},C=()=>{const e=new A;e.text("Borrowers Report",14,16),e.autoTable({startY:20,head:[["Name","National ID","Phone","Email","Address"]],body:o.map(s=>[s.name,s.nationalId,s.phone,s.email,s.address])}),e.save("borrowers.pdf")},o=j.filter(e=>[e.name,e.nationalId,e.phone].some(s=>s.toLowerCase().includes(p.toLowerCase()))),w=u*h,S=w-h,I=o.slice(S,w),P=Math.ceil(o.length/h);return t.useEffect(()=>{m()},[]),r.jsxs("div",{className:"p-4",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Borrowers"}),b&&r.jsx("p",{className:"text-red-600 mb-4",children:b}),r.jsxs("form",{onSubmit:y,className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded shadow",children:[["name","nationalId","phone","email","address"].map(e=>r.jsx("input",{className:"border px-4 py-2 rounded",placeholder:e.charAt(0).toUpperCase()+e.slice(1),value:a[e],onChange:s=>l({...a,[e]:s.target.value}),required:e!=="email"},e)),r.jsx("button",{type:"submit",className:"col-span-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:c?"Update Borrower":"Add Borrower"})]}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-2",children:[r.jsx("input",{type:"text",placeholder:"Search borrowers...",className:"border px-4 py-2 rounded w-full md:w-1/3",value:p,onChange:e=>N(e.target.value)}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(k,{data:o,filename:"borrowers.csv",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Export CSV"}),r.jsx("button",{onClick:C,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Export PDF"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full bg-white rounded shadow table-auto border",children:[r.jsx("thead",{className:"bg-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"p-2 border",children:"Name"}),r.jsx("th",{className:"p-2 border",children:"National ID"}),r.jsx("th",{className:"p-2 border",children:"Phone"}),r.jsx("th",{className:"p-2 border",children:"Email"}),r.jsx("th",{className:"p-2 border",children:"Address"}),r.jsx("th",{className:"p-2 border",children:"Loans"}),r.jsx("th",{className:"p-2 border",children:"Actions"})]})}),r.jsxs("tbody",{children:[I.map(e=>r.jsxs("tr",{children:[r.jsx("td",{className:"border px-2",children:e.name}),r.jsx("td",{className:"border px-2",children:e.nationalId}),r.jsx("td",{className:"border px-2",children:e.phone}),r.jsx("td",{className:"border px-2",children:e.email}),r.jsx("td",{className:"border px-2",children:e.address}),r.jsx("td",{className:"border px-2 text-center",children:r.jsx(B,{to:`/borrowers/${e.id}`,className:"text-indigo-600 hover:underline",children:"View"})}),r.jsxs("td",{className:"border px-2 space-x-2 text-center",children:[r.jsx("button",{onClick:()=>v(e),className:"text-blue-600 hover:underline",children:"Edit"}),r.jsx("button",{onClick:()=>E(e.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},e.id)),o.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"text-center p-4",children:"No borrowers found."})})]})]})}),r.jsx("div",{className:"mt-4 flex justify-center space-x-2",children:Array.from({length:P},(e,s)=>r.jsx("button",{onClick:()=>f(s+1),className:`px-3 py-1 border rounded ${u===s+1?"bg-blue-600 text-white":"bg-gray-100"}`,children:s+1},s+1))})]})};export{O as default};
