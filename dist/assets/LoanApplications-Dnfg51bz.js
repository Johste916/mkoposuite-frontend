import{u as le,r as d,g,j as e,L as j}from"./index-x5m31TRy.js";import{W as G}from"./wallet-CQktAI3l.js";import{C as w}from"./circle-plus-KuJ7QRdr.js";import{B as re,U as ne}from"./upload-9RTFBsha.js";import{C as K}from"./calendar-X1UYLaeP.js";import{c as W}from"./createLucideIcon-NnuRLkM3.js";import{F as oe}from"./file-up-BEtR3-jV.js";import{X as C}from"./x-BUjtE1sn.js";import{U as ie}from"./user-aozVKAbn.js";import{S as ce}from"./save-V7n2NbHU.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],me=W("landmark",de);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],he=W("shield-check",ue),z=()=>new Date().toLocaleDateString("en-CA"),r="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 focus:border-indigo-500 transition-all",h="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 md:p-7",I=i=>Array.isArray(i)?i:Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i==null?void 0:i.rows)?i.rows:Array.isArray(i==null?void 0:i.results)?i.results:[],pe=[{value:"flat",label:"Flat rate"},{value:"reducing_equal_installments",label:"Reduced balance — equal installments"},{value:"reducing_equal_principal",label:"Reduced balance — equal principal"},{value:"interest_only",label:"Interest only"},{value:"compound_accrued",label:"Compound interest (accrued)"},{value:"compound_equal_installments",label:"Compound interest — equal installments"}],xe=["None","Household Items","Vehicle (Logbook)","Land Title","Business Stock","Electronics","Salary Assignment","Other"],V=[{value:"weekly",label:"Weekly",perMonth:4},{value:"biweekly",label:"Bi-weekly",perMonth:2},{value:"monthly",label:"Monthly",perMonth:1},{value:"custom",label:"Custom"}],ge=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank"},{value:"mobile_money",label:"Mobile Money"},{value:"other",label:"Other"}],H=[{value:"mpesa",label:"M-Pesa"},{value:"tigopesa",label:"Tigo Pesa"},{value:"airtelmoney",label:"Airtel Money"},{value:"halopesa",label:"HaloPesa"},{value:"ttclpesa",label:"TTCL Pesa"},{value:"other",label:"Other"}],be=["new loan","open","top-up","defaulted"],ve=[{value:"single",label:"Single"},{value:"married",label:"Married"},{value:"divorced",label:"Divorced"},{value:"widow",label:"Widow"},{value:"widower",label:"Widower"},{value:"not_specified",label:"Not specified"}];function Oe(){const i=le(),[S,P]=d.useState([]),[M,R]=d.useState([]),[_,L]=d.useState([]),[B,D]=d.useState(!1),[Y,T]=d.useState(!1),[a,n]=d.useState({productId:"",borrowerId:"",loanNumber:"",principal:"",releaseDate:z(),durationMonths:"",collateralType:"",collateralAmount:"",collateralOther:"",interestMethod:"flat",interestRate:"",interestAmount:"",fees:[],repaymentCycle:"monthly",numberOfRepayments:"",statusLabel:"new loan",disbursementMethod:"cash",disbursementBankId:"",disbursementReference:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:"",maritalStatus:"not_specified",spouseName:"",spouseOccupation:"",spouseIdNumber:"",spousePhone:"",attachmentsMeta:[],guarantors:[]}),b=d.useRef({});d.useEffect(()=>{(async()=>{try{const[t,l]=await Promise.all([g.get("/loan-products"),g.get("/borrowers",{params:{page:1,pageSize:500}}).catch(()=>({data:{items:[]}}))]);P(I(t.data)),R(I(l.data))}catch(t){console.warn("Failed to load products/borrowers",t),P([]),R([])}try{const t=await g.get("/banks");L(I(t.data))}catch{L([])}})()},[]);const y=d.useMemo(()=>Array.isArray(S)?S:[],[S]),E=d.useMemo(()=>Array.isArray(M)?M:[],[M]);d.useEffect(()=>{a.borrowerId&&(T(!0),(async()=>{var t,l,s;try{let o=0;try{const c=await g.get(`/borrowers/${a.borrowerId}/loans`);o=Array.isArray(c.data)?c.data.length:((l=(t=c.data)==null?void 0:t.items)==null?void 0:l.length)||0}catch{o=((s=(await g.get("/loans",{params:{borrowerId:a.borrowerId,page:1,pageSize:1}})).data)==null?void 0:s.total)||0}const m=(o+1).toString().padStart(3,"0");n(c=>({...c,loanNumber:m}))}catch{n(o=>({...o,loanNumber:""}))}finally{T(!1)}})())},[a.borrowerId]),d.useEffect(()=>{if(a.repaymentCycle==="custom")return;const t=V.find(o=>o.value===a.repaymentCycle),l=Number(a.durationMonths||0);if(!t||l<=0)return;const s=l*(t.perMonth||1);n(o=>({...o,numberOfRepayments:String(s)}))},[a.repaymentCycle,a.durationMonths]);const F=t=>{const l=Math.random().toString(36).slice(2);n(s=>({...s,attachmentsMeta:[...s.attachmentsMeta,{type:t||"other",note:"",fileKey:l}]}))},q=(t,l)=>{l?b.current[t]=l:delete b.current[t]},k=(t,l)=>n(s=>({...s,attachmentsMeta:s.attachmentsMeta.map((o,m)=>m===t?{...o,...l}:o)})),$=t=>n(l=>{const s=l.attachmentsMeta[t];return s!=null&&s.fileKey&&delete b.current[s.fileKey],{...l,attachmentsMeta:l.attachmentsMeta.filter((o,m)=>m!==t)}}),A=()=>a.attachmentsMeta.findIndex(t=>String(t.type||"").toLowerCase()==="spouse: consent declaration"),J=()=>n(t=>({...t,fees:[...t.fees,{name:"",amount:"",paid:!1}]})),O=(t,l)=>n(s=>({...s,fees:s.fees.map((o,m)=>m===t?{...o,...l}:o)})),X=t=>n(l=>({...l,fees:l.fees.filter((s,o)=>o!==t)})),Z=()=>n(t=>({...t,guarantors:[...t.guarantors,{type:"existing",borrowerId:"",name:"",occupation:"",residence:"",contacts:"",verification:""}]})),x=(t,l)=>n(s=>({...s,guarantors:s.guarantors.map((o,m)=>m===t?{...o,...l}:o)})),Q=t=>n(l=>({...l,guarantors:l.guarantors.filter((s,o)=>o!==t)})),ee=async t=>{var l,s,o,m;if(t.preventDefault(),!a.borrowerId)return alert("Select a borrower");if(!a.productId)return alert("Select a loan product");if(!a.principal||Number(a.principal)<=0)return alert("Enter a principal amount");if(!a.durationMonths)return alert("Enter loan duration (months)");if(a.collateralType==="Other"&&!a.collateralOther.trim())return alert("Please specify the collateral for 'Other'.");if(a.disbursementMethod==="other"&&!a.disbursementOther.trim())return alert("Please specify the disbursement method for 'Other'.");if(a.disbursementMethod==="mobile_money"){if(!a.mobileProvider)return alert("Select a mobile money provider.");if(a.mobileProvider==="other"&&!a.mobileProviderOther.trim())return alert("Please specify the mobile money provider.");if(!a.mobilePhone.trim())return alert("Enter the mobile money phone number.");const c=a.mobilePhone.replace(/\D/g,"");if(c.length<9||c.length>15)return alert("Mobile money phone number looks invalid.")}if(a.maritalStatus==="married"){const c=A(),u=c>=0?a.attachmentsMeta[c]:null;if(!(u?!!b.current[u.fileKey]:!1))return alert("Please attach the spouse consent declaration (signed).")}D(!0);try{const c=a.collateralType==="Other"&&a.collateralOther.trim()?`Other: ${a.collateralOther.trim()}`:a.collateralType||null;let u=((l=a.disbursementReference)==null?void 0:l.trim())||"";a.disbursementMethod==="mobile_money"?u=[`Provider: ${a.mobileProvider==="other"?a.mobileProviderOther.trim():((s=H.find(se=>se.value===a.mobileProvider))==null?void 0:s.label)||a.mobileProvider}`,`Phone: ${a.mobilePhone.trim()}`,u?`Ref: ${u}`:null].filter(Boolean).join(" | "):a.disbursementMethod==="other"&&(u=[`Method: ${a.disbursementOther.trim()}`,(o=a.disbursementOtherDetails)!=null&&o.trim()?`Details: ${a.disbursementOtherDetails.trim()}`:null,u?`Ref: ${u}`:null].filter(Boolean).join(" | "));const U={productId:a.productId,borrowerId:a.borrowerId,loanNumber:a.loanNumber||null,amount:String(a.principal).trim(),currency:"TZS",releaseDate:a.releaseDate||z(),durationMonths:String(a.durationMonths).trim(),collateralType:c,collateralAmount:a.collateralAmount||null,interestMethod:a.interestMethod,interestRate:a.interestRate||null,interestAmount:a.interestAmount||null,fees:a.fees.map(p=>({...p,amount:String(p.amount||"").trim()})),repaymentCycle:a.repaymentCycle,numberOfRepayments:String(a.numberOfRepayments||"").trim(),disbursementMethod:a.disbursementMethod,disbursementBankId:a.disbursementMethod==="bank"&&a.disbursementBankId||null,disbursementReference:u||null,spouse:a.maritalStatus==="married"?{name:a.spouseName||"",occupation:a.spouseOccupation||"",idNumber:a.spouseIdNumber||"",phone:a.spousePhone||""}:void 0,status:"pending",statusLabel:a.statusLabel},f=new FormData;f.append("payload",JSON.stringify(U));for(const p of a.attachmentsMeta){const v=b.current[p.fileKey];v&&(f.append("files",v,v.name),f.append("filesMeta",JSON.stringify({type:p.type,note:p.note,name:v.name})))}const ae=await g.post("/loans",f,{headers:{"Content-Type":"multipart/form-data"}});alert("Loan application submitted"),i(`/loans/${((m=ae.data)==null?void 0:m.id)||""}`)}catch(c){console.error(c),alert("Failed to submit loan application")}finally{D(!1)}},N=d.useMemo(()=>y.find(t=>String(t.id)===String(a.productId)),[y,a.productId]),te=()=>{A()===-1&&F("Spouse: Consent declaration")};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Add Loan"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Follow the steps below. Start by selecting a borrower, then continue down the page."})]}),e.jsx(j,{to:"/loans",className:"text-indigo-600 hover:underline text-sm",children:"Back to Loans"})]}),e.jsxs("form",{onSubmit:ee,className:"max-w-6xl mx-auto space-y-5 md:space-y-6",children:[e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(G,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"1) Borrower & Product"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Borrower"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${r} flex-1`,value:a.borrowerId,onChange:t=>n({...a,borrowerId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select borrower…"}),E.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.phone?`— ${t.phone}`:""]},t.id))]}),e.jsxs(j,{target:"_blank",to:"/borrowers/add",className:"px-3 py-2 rounded-lg border hover:bg-gray-50 inline-flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"})," Add"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan Product"}),e.jsxs("select",{className:r,value:a.productId,onChange:t=>{const l=t.target.value,s=y.find(o=>String(o.id)===String(l));n(o=>({...o,productId:l,interestMethod:(s==null?void 0:s.interestMethod)||o.interestMethod,interestRate:(s==null?void 0:s.interestRate)??o.interestRate}))},required:!0,children:[e.jsx("option",{value:"",children:"Select product…"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.name,t.code?` (${t.code})`:""]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan # (auto)"}),e.jsx("input",{className:r,value:Y?"…":a.loanNumber||"—",readOnly:!0})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(re,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"2) Loan Terms"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Principal Amount"}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,value:a.principal,onChange:t=>n({...a,principal:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(K,{className:"h-3.5 w-3.5"})," Loan Release Date"]}),e.jsx("input",{type:"date",className:r,value:a.releaseDate,onChange:t=>n({...a,releaseDate:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Collateral Type"}),e.jsxs("select",{className:r,value:a.collateralType,onChange:t=>n({...a,collateralType:t.target.value}),children:[e.jsx("option",{value:"",children:"Select…"}),xe.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.collateralType==="Other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:r,placeholder:"Specify collateral",value:a.collateralOther,onChange:t=>n({...a,collateralOther:t.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Collateral Amount"}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,value:a.collateralAmount,onChange:t=>n({...a,collateralAmount:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan Duration (months)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,value:a.durationMonths,onChange:t=>n({...a,durationMonths:t.target.value}),required:!0})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(me,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"3) Interest"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Interest Method"}),e.jsx("select",{className:r,value:a.interestMethod,onChange:t=>n({...a,interestMethod:t.target.value}),children:pe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",inputMode:"decimal",className:r,value:a.interestRate,onChange:t=>n({...a,interestRate:t.target.value}),placeholder:N!=null&&N.interestRate?String(N.interestRate):"e.g. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Interest Amount (optional)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,value:a.interestAmount,onChange:t=>n({...a,interestAmount:t.target.value})})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(K,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"4) Repayments"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Repayment Cycle"}),e.jsx("select",{className:r,value:a.repaymentCycle,onChange:t=>n({...a,repaymentCycle:t.target.value}),children:V.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"# of Repayments"}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,value:a.numberOfRepayments,onChange:t=>n({...a,numberOfRepayments:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan Status (label)"}),e.jsx("select",{className:r,value:a.statusLabel,onChange:t=>n({...a,statusLabel:t.target.value}),children:be.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("p",{className:"text-[11px] text-gray-500 mt-1",children:"DB status stays “pending” on create."})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"5) Loan Fees"})]}),e.jsxs("button",{type:"button",onClick:J,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",children:[e.jsx(w,{className:"h-4 w-4"})," Add Fee"]})]}),a.fees.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No fees added."}):e.jsx("div",{className:"space-y-3",children:a.fees.map((t,l)=>e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_1fr_auto] gap-3 items-center",children:[e.jsx("input",{className:r,placeholder:"Fee name (e.g. Processing)",value:t.name,onChange:s=>O(l,{name:s.target.value})}),e.jsx("input",{type:"number",inputMode:"numeric",className:r,placeholder:"Amount",value:t.amount,onChange:s=>O(l,{amount:s.target.value})}),e.jsxs("select",{className:r,value:t.paid?"paid":"not_paid",onChange:s=>O(l,{paid:s.target.value==="paid"}),children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"not_paid",children:"Not paid"})]}),e.jsx("button",{type:"button",onClick:()=>X(l),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove fee",children:e.jsx(C,{className:"h-4 w-4"})})]},l))}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Unpaid fees will be included in the repayment schedule."})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"6) Guarantors"})]}),e.jsxs("button",{type:"button",onClick:Z,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",children:[e.jsx(w,{className:"h-4 w-4"})," Add Guarantor"]})]}),a.guarantors.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No guarantors added."}):e.jsx("div",{className:"space-y-4",children:a.guarantors.map((t,l)=>e.jsxs("div",{className:"border rounded-xl p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:["Guarantor #",l+1]}),e.jsx("button",{type:"button",onClick:()=>Q(l),className:"p-1 rounded hover:bg-gray-50","aria-label":"Remove guarantor",children:e.jsx(C,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Source"}),e.jsxs("select",{className:r,value:t.type,onChange:s=>x(l,{type:s.target.value}),children:[e.jsx("option",{value:"existing",children:"Select from borrowers"}),e.jsx("option",{value:"manual",children:"Enter manually"})]})]}),t.type==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Borrower"}),e.jsxs("select",{className:r,value:t.borrowerId||"",onChange:s=>x(l,{borrowerId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select borrower…"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.phone?`— ${s.phone}`:""]},s.id))]})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{className:r,placeholder:"Full name",value:t.name,onChange:s=>x(l,{name:s.target.value})}),e.jsx("input",{className:r,placeholder:"Occupation",value:t.occupation,onChange:s=>x(l,{occupation:s.target.value})}),e.jsx("input",{className:r,placeholder:"Residence",value:t.residence,onChange:s=>x(l,{residence:s.target.value})}),e.jsx("input",{className:r,placeholder:"Contacts",value:t.contacts,onChange:s=>x(l,{contacts:s.target.value})}),e.jsx("input",{className:r,placeholder:"Verification (ID #, etc.)",value:t.verification,onChange:s=>x(l,{verification:s.target.value})})]})]})]},l))})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"7) Attachments"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Borrower: Loan form","Borrower: Village introduction","Borrower: Fee receipt","Borrower: ID","Borrower: Business licence","Borrower: TIN","Borrower: Employment contract","Borrower: Salary slips","Borrower: Employer letter","Guarantor: ID","Guarantor: Village introduction","Spouse: Consent declaration","Other"].map(t=>e.jsxs("button",{type:"button",onClick:()=>F(t),className:"text-xs px-2 py-1 rounded border hover:bg-gray-50",children:["+ ",t.replace(/Borrower: |Guarantor: |Spouse: /g,"")]},t))})]}),a.attachmentsMeta.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No files attached."}):e.jsx("div",{className:"space-y-3",children:a.attachmentsMeta.map((t,l)=>e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_auto] gap-3 items-center",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:r,value:t.type,onChange:s=>k(l,{type:s.target.value})}),e.jsx("input",{className:r,placeholder:"Note (optional)",value:t.note,onChange:s=>k(l,{note:s.target.value})})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:r,onChange:s=>{var o;return q(t.fileKey,(o=s.target.files)==null?void 0:o[0])}}),e.jsx("button",{type:"button",onClick:()=>$(l),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove attachment",children:e.jsx(C,{className:"h-4 w-4"})})]},t.fileKey))}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Accepted images/PDFs as supported by your backend."})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(G,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"8) Disbursement"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Method"}),e.jsx("select",{className:r,value:a.disbursementMethod,onChange:t=>{const l=t.target.value;n({...a,disbursementMethod:l,disbursementBankId:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:""})},children:ge.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:r,value:a.disbursementReference,onChange:t=>n({...a,disbursementReference:t.target.value}),placeholder:"Txn ref / slip #"})]}),a.disbursementMethod==="bank"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${r} flex-1`,value:a.disbursementBankId,onChange:t=>n({...a,disbursementBankId:t.target.value}),children:[e.jsx("option",{value:"",children:"Select bank…"}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs(j,{to:"/banks/add",target:"_blank",className:"px-3 py-2 rounded-lg border hover:bg-gray-50 inline-flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"})," Add"]}),e.jsx(j,{to:"/banks",target:"_blank",className:"px-3 py-2 rounded-lg border hover:bg-gray-50",children:"Manage"})]}),_.length===0&&e.jsx("p",{className:"text-[11px] text-amber-600 mt-1",children:"No banks found. Use “Add” to register banks; this list is tenant-scoped via your API."})]}),a.disbursementMethod==="mobile_money"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Provider"}),e.jsxs("select",{className:r,value:a.mobileProvider,onChange:t=>n({...a,mobileProvider:t.target.value}),children:[e.jsx("option",{value:"",children:"Select provider…"}),H.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),a.mobileProvider==="other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:r,placeholder:"Specify provider",value:a.mobileProviderOther,onChange:t=>n({...a,mobileProviderOther:t.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Phone Number"}),e.jsx("input",{className:r,placeholder:"e.g. 07xxxxxxxx or +2557xxxxxxxx",value:a.mobilePhone,onChange:t=>n({...a,mobilePhone:t.target.value})})]})]}),a.disbursementMethod==="other"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Specify method"}),e.jsx("input",{className:r,placeholder:"e.g., cheque, voucher, petty cash",value:a.disbursementOther,onChange:t=>n({...a,disbursementOther:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Details (optional)"}),e.jsx("input",{className:r,placeholder:"Instructions / place of collection",value:a.disbursementOtherDetails,onChange:t=>n({...a,disbursementOtherDetails:t.target.value})})]})]})]})]}),e.jsxs("section",{className:h,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(ie,{className:"h-5 w-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-lg",children:"9) Marital Status & Spouse"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Marital Status"}),e.jsx("select",{className:r,value:a.maritalStatus,onChange:t=>n({...a,maritalStatus:t.target.value}),children:ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx("div",{className:"hidden md:block"}),a.maritalStatus==="married"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:r,placeholder:"Spouse Name",value:a.spouseName,onChange:t=>n({...a,spouseName:t.target.value})}),e.jsx("input",{className:r,placeholder:"Spouse Occupation",value:a.spouseOccupation,onChange:t=>n({...a,spouseOccupation:t.target.value})}),e.jsx("input",{className:r,placeholder:"Spouse ID Number",value:a.spouseIdNumber,onChange:t=>n({...a,spouseIdNumber:t.target.value})}),e.jsx("input",{className:r,placeholder:"Spouse Phone",value:a.spousePhone,onChange:t=>n({...a,spousePhone:t.target.value})}),e.jsxs("div",{className:"md:col-span-2 border rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Spouse Consent Declaration (signed)"}),e.jsx("button",{type:"button",onClick:te,className:"text-xs px-2 py-1 rounded border hover:bg-gray-50",children:"+ Add consent upload"})]}),(()=>{const t=A();if(t===-1)return e.jsx("p",{className:"text-xs text-gray-500",children:"Click “Add consent upload” to attach the signed declaration."});const l=a.attachmentsMeta[t];return e.jsxs("div",{className:"grid md:grid-cols-[2fr_1fr_auto] gap-3 items-center",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:r,value:l.type,readOnly:!0}),e.jsx("input",{className:r,placeholder:"Note (optional)",value:l.note,onChange:s=>k(t,{note:s.target.value})})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:r,onChange:s=>{var o;return q(l.fileKey,(o=s.target.files)==null?void 0:o[0])}}),e.jsx("button",{type:"button",onClick:()=>$(t),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove spouse consent",children:e.jsx(C,{className:"h-4 w-4"})})]})})(),e.jsx("p",{className:"text-[11px] text-gray-500 mt-2",children:"This replaces the old text field. Upload the signed consent form here."})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 inset-x-0 z-20 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70 border-t",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3 flex justify-end gap-3",children:[e.jsx(j,{to:"/loans",className:"px-4 py-2 rounded-xl border hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{disabled:B,type:"submit",className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(ce,{className:"h-4 w-4"}),B?"Submitting…":"Submit"]})]})})]})]})}export{Oe as default};
