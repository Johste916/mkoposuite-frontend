import{i as He,u as Ke,r as o,j as e,L as U,g as d}from"./index-CeHYLxUd.js";import{c as Qe,f as h,d as F,e as Xe,g as Ye,h as et,S as tt,n as st,i as we}from"./ScheduleTable-wZ1qcRVq.js";const at={pending:"bg-yellow-100 text-yellow-900 ring-yellow-300",approved:"bg-blue-100 text-blue-900 ring-blue-300",rejected:"bg-gray-200 text-gray-900 ring-gray-300",disbursed:"bg-indigo-100 text-indigo-900 ring-indigo-300",active:"bg-emerald-100 text-emerald-900 ring-emerald-300",closed:"bg-slate-200 text-slate-900 ring-slate-300"},Ne="inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-[11px] font-bold uppercase ring-2 ring-inset",Se="inline-flex items-center gap-1 text-blue-700 font-bold underline underline-offset-4 decoration-2 hover:text-blue-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 rounded",lt=()=>{try{return(JSON.parse(localStorage.getItem("user")||"{}").role||"").toLowerCase()}catch{return""}},R=l=>l==="admin"||l==="director"||l==="superadmin",nt=l=>["branch_manager","manager","bm"].includes(l)||R(l),rt=l=>["compliance","compliance_officer","legal"].includes(l)||R(l),ot=l=>["accountant","finance"].includes(l)||R(l),dt=l=>["loan_officer","officer"].includes(l)&&!R(l);function it(l){if(!l)return"";const g=String(l).toLowerCase();return g==="pending"?"submitted":g==="approved"?"accounting":""}const V=({title:l,subtitle:g,right:s,children:J,dense:c=!1})=>e.jsxs("div",{className:"bg-white border-2 border-slate-400 rounded-2xl shadow-lg w-full",children:[e.jsxs("div",{className:`px-6 ${c?"py-3":"py-4"} border-b-2 border-slate-300 bg-slate-100 flex items-center justify-between`,children:[e.jsxs("div",{className:"min-w-0",children:[l&&e.jsx("h3",{className:"text-xl md:text-2xl font-extrabold tracking-tight text-slate-900",children:l}),g&&e.jsx("p",{className:"text-sm text-slate-800 mt-0.5",children:g})]}),s]}),e.jsx("div",{className:`px-6 ${c?"py-4":"py-6"} text-[15px] text-slate-900`,children:J})]}),v=({children:l})=>e.jsx("div",{className:"text-[12px] uppercase tracking-wide text-slate-900 font-semibold",children:l});function xt(){var je,ve;const{id:l}=He(),g=Ke(),[s,J]=o.useState(null),[c,X]=o.useState(null),[y,Y]=o.useState([]),[ee,$]=o.useState([]),[x,P]=o.useState(null),[Ce,te]=o.useState(!0),[ke,se]=o.useState(!0),[Re,ae]=o.useState(!0),[De,le]=o.useState(!1),[ne,re]=o.useState(null),[i,D]=o.useState(""),[N,oe]=o.useState(""),[p,E]=o.useState(!1),[Z,G]=o.useState(""),[Le,O]=o.useState(!1),[de,ie]=o.useState(!1),[S,L]=o.useState({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),[Ae,H]=o.useState(!1),[Me,T]=o.useState(!1),[u,A]=o.useState({amount:"",interestRate:"",termMonths:"",startDate:""}),[ce,me]=o.useState(!1),[Fe,_]=o.useState(!1),[f,I]=o.useState({termMonths:"",startDate:"",previewOnly:!1}),[xe,ue]=o.useState(!1),m=(s==null?void 0:s.currency)||"TZS",$e=at[s==null?void 0:s.status]||"bg-slate-100 text-slate-900 ring-slate-300",C=lt(),K=nt(C),he=rt(C),Pe=ot(C),Ee=dt(C),Oe=R(C)||K||he,Te=R(C)||K,k=(s==null?void 0:s.workflowStage)||it(s==null?void 0:s.status),pe=Ee&&["changes_requested","bm_changes_requested","compliance_changes_requested","returned_to_officer","request_changes"].includes(k),B=K&&["submitted","bm_review","changes_resubmitted"].includes(k),be=he&&["compliance","compliance_review"].includes(k),ge=Pe&&((s==null?void 0:s.status)==="approved"||k==="accounting"),fe=o.useRef(null),b=async()=>{te(!0),re(null);try{const{data:t}=await d.get(`/loans/${l}`);J(t),oe(String((t==null?void 0:t.amount)??""));const a=[d.get(`/repayments/loan/${l}`).then(r=>Y(r.data||[])).catch(()=>Y([])).finally(()=>se(!1)),d.get(`/comments/loan/${l}`).then(r=>$(Array.isArray(r.data)?r.data:[])).catch(r=>{var n;console.warn("Comments fetch failed:",((n=r==null?void 0:r.response)==null?void 0:n.data)||(r==null?void 0:r.message)),$([])}).finally(()=>ae(!1))];t!=null&&t.productId&&a.push(d.get(`/loan-products/${t.productId}`).then(r=>X(r.data)).catch(()=>X(null))),le(!0),a.push(d.get(`/loans/${l}/schedule`).then(r=>P(st(r.data))).catch(()=>P(null)).finally(()=>le(!1))),await Promise.all(a)}catch(t){console.error(t),re("Failed to fetch loan.")}finally{te(!1)}};o.useEffect(()=>{fe.current!==l&&(fe.current=l,P(null),D(""),G(""),se(!0),ae(!0),b())},[l]),o.useEffect(()=>{const t=()=>b();return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[]),o.useEffect(()=>{const t=a=>{var r;String((r=a==null?void 0:a.detail)==null?void 0:r.id)===String(l)&&b()};return window.addEventListener("loan:updated",t),()=>window.removeEventListener("loan:updated",t)},[l]);async function M(t){try{await d.post("/comments",{loanId:l,content:t});const a=await d.get(`/comments/loan/${l}`);$(Array.isArray(a.data)?a.data:[])}catch{}}async function q(t,a={}){E(!0);try{await d.post(`/loans/${l}/workflow`,{action:t,comment:(i==null?void 0:i.trim())||void 0,suggestedAmount:a.suggestedAmount!=null&&a.suggestedAmount!==""?Number(a.suggestedAmount):void 0}),await b(),D(""),alert("Action applied.")}catch{try{t==="bm_approve"||t==="compliance_approve"?(await d.patch(`/loans/${l}/status`,{status:"approved"}),i.trim()&&await M(i.trim())):t==="reject"?(await d.patch(`/loans/${l}/status`,{status:"rejected"}),i.trim()&&await M(i.trim())):t==="request_changes"?i.trim()&&await M(`Changes requested: ${i.trim()}`):t==="resubmit"&&(await d.patch(`/loans/${l}/status`,{status:"pending"}),i.trim()&&await M(`Resubmitted: ${i.trim()}`)),await b(),D(""),alert("Action applied (fallback).")}catch(n){console.error(n),alert("Failed to apply action.")}}finally{E(!1)}}async function _e(){if(!N||Number(N)<=0){alert("Enter a valid amount.");return}E(!0);try{await d.patch(`/loans/${l}`,{amount:Number(N)}),i.trim()&&await M(`Suggested amount: ${h(N,m)} — ${i.trim()}`),await b(),alert("Suggestion saved.")}catch(t){console.error(t),alert("Failed to save suggestion.")}finally{E(!1)}}const Ie=async()=>{const t=Number(z||0);if(!(t>0&&!window.confirm("Outstanding > 0. Close anyway?")))try{await d.patch(`/loans/${l}/status`,{status:"closed",override:t>0}),await b(),alert("Loan closed.")}catch(a){console.error(a),alert("Failed to close loan.")}},Be=async()=>{if(Z.trim())try{const t=await d.post("/comments",{loanId:l,content:Z});$(a=>[t.data,...a]),G("")}catch(t){console.error(t),alert("Failed to add comment.")}},qe=async()=>{const t=Number(S.amount);if(!t||t<=0)return alert("Enter a valid amount.");ie(!0);try{if(await d.post("/repayments",{loanId:l,...S,amount:t}),s!=null&&s.status&&!["active","closed"].includes(String(s.status).toLowerCase()))try{await d.patch(`/loans/${l}/status`,{status:"active"})}catch{}await b(),O(!1),L({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),window.dispatchEvent(new CustomEvent("loan:updated",{detail:{id:l}})),alert("Repayment posted.")}catch(a){console.error(a),alert("Failed to post repayment.")}finally{ie(!1)}},ze=()=>{A({amount:(s==null?void 0:s.amount)??"",interestRate:(s==null?void 0:s.interestRate)??"",termMonths:(s==null?void 0:s.termMonths)??(s==null?void 0:s.durationMonths)??"",startDate:we((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate))}),T(!0)},We=async()=>{var a,r;const t={amount:u.amount===""?void 0:Number(u.amount),interestRate:u.interestRate===""?void 0:Number(u.interestRate),termMonths:u.termMonths===""?void 0:Number(u.termMonths),startDate:u.startDate||void 0};if(Number.isFinite(t.amount)&&t.amount<=0)return alert("Amount must be > 0");if(Number.isFinite(t.termMonths)&&t.termMonths<=0)return alert("Term must be > 0");me(!0);try{await d.patch(`/loans/${l}`,t),T(!1),await b(),alert("Loan updated.")}catch(n){console.error(n),alert(((r=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to update loan.")}finally{me(!1)}},Ue=async()=>{var t,a;if(window.confirm("This will permanently delete this loan. Continue?"))try{await d.delete(`/loans/${l}`),alert("Loan deleted."),g("/loans")}catch(r){console.error(r),alert(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to delete loan.")}},Ve=()=>{I({termMonths:(s==null?void 0:s.termMonths)??"",startDate:we((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate)),previewOnly:!1}),_(!0)},Je=async()=>{var a,r;const t={termMonths:f.termMonths===""?void 0:Number(f.termMonths),startDate:f.startDate||void 0,previewOnly:!!f.previewOnly};if(Number.isFinite(t.termMonths)&&t.termMonths<=0)return alert("Term must be > 0");ue(!0);try{const{data:n}=await d.post(`/loans/${l}/reschedule`,t);Array.isArray(n==null?void 0:n.schedule)&&P(n.schedule),_(!1),await b(),alert((n==null?void 0:n.message)||"Schedule updated.")}catch(n){console.error(n),alert(((r=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to reschedule.")}finally{ue(!1)}},Ze=async()=>{var t,a,r;if(window.confirm("Reissue creates a new pending loan cloned from this one. Continue?"))try{const{data:n}=await d.post(`/loans/${l}/reissue`),ye=((t=n==null?void 0:n.loan)==null?void 0:t.id)||(n==null?void 0:n.id);alert("New loan created."),ye&&g(`/loans/${ye}`)}catch(n){console.error(n),alert(((r=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to reissue loan.")}},j=o.useMemo(()=>Qe(x||[],y||[]),[x,y]),Q=Array.isArray(x)&&x.length>0,z=(s==null?void 0:s.status)==="closed"?0:Q?j.outstanding:(s==null?void 0:s.outstanding)??null,w=Q?j.nextDue:null,W=o.useMemo(()=>{const t=y.length||0,a=y.reduce((r,n)=>r+Number(n.amount||0),0);return{count:t,sum:a}},[y]),Ge=(s==null?void 0:s.status)!=="closed"&&Number(z||0)>0;return Ce?e.jsx("div",{className:"w-full px-6 py-6",children:"Loading loan…"}):ne?e.jsx("div",{className:"w-full px-6 py-6 text-red-700 font-semibold",children:ne}):s?e.jsxs("div",{className:"w-full px-4 md:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"text-4xl font-extrabold tracking-tight text-slate-900",children:"Loan Details"}),e.jsx("span",{className:`${Ne} ${$e}`,children:s.status}),k&&e.jsxs("span",{className:`${Ne} bg-indigo-50 text-indigo-900 ring-indigo-300`,children:["Stage: ",k.replaceAll("_"," ")]})]}),e.jsx("button",{onClick:()=>g(-1),className:Se,children:"← Back"})]}),e.jsxs(V,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-2 min-w-0",children:[e.jsx(v,{children:"Borrower"}),e.jsxs(U,{className:`${Se} text-lg md:text-xl truncate`,to:`/borrowers/${s.borrowerId}`,title:((je=s.Borrower)==null?void 0:je.name)||s.borrowerName||"N/A",children:[((ve=s.Borrower)==null?void 0:ve.name)||s.borrowerName||"N/A"," ",e.jsx("span",{children:"›"})]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Amount"}),e.jsx("div",{className:"text-2xl font-extrabold",children:h(s.amount,m)})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Interest"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-bold",children:[s.interestRate,"%"]})," ",e.jsxs("span",{className:"text-slate-900",children:["· ",s.interestMethod||"—"]})]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Term"}),e.jsxs("div",{className:"text-base font-semibold",children:[s.termMonths||s.durationMonths," months"]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Start / Release"}),e.jsx("div",{className:"text-base font-semibold",children:F(s.startDate||s.releaseDate)})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Outstanding"}),e.jsx("div",{className:"text-2xl font-extrabold",children:z==null?"—":h(z,m)})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Next Due"}),e.jsx("div",{className:"text-base font-semibold",children:w?e.jsxs(e.Fragment,{children:[F(w.date)," ·"," ",e.jsx("span",{className:"font-extrabold",children:h(w.amount,m)})]}):"—"})]}),c&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3 xl:col-span-4",children:[e.jsx(v,{children:"Product"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-extrabold",children:[c.name,c.code?` (${c.code})`:""]}),e.jsxs("div",{className:"text-slate-900 text-sm mt-0.5",children:["Defaults: ",c.interestMethod," @"," ",c.interestRate??c.defaultInterestRate,"% · Limits:"," ",h(c.minPrincipal,m)," –"," ",h(c.maxPrincipal,m),", ",c.minTermMonths,"-",c.maxTermMonths," months"]})]})]})]}),e.jsx("div",{className:"mt-6 grid sm:grid-cols-3 lg:grid-cols-6 gap-4 text-sm",children:[["Paid Principal",j.paidPrincipal],["Paid Interest",j.paidInterest],["Paid Penalties",j.paidPenalty],["Paid Fees",j.paidFees],["Total Paid",j.totalPaid],["Total Scheduled",j.scheduledTotal]].map(([t,a])=>e.jsxs("div",{className:"rounded-xl border-2 border-slate-400 p-3 bg-white shadow-sm",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-900 font-semibold",children:t}),e.jsx("div",{className:"font-bold text-lg",children:Q?h(a,m):"—"})]},t))})]}),(pe||B||be||ge)&&e.jsxs(V,{dense:!0,children:[pe&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-extrabold",children:"Changes Requested"}),e.jsxs("p",{className:"text-sm text-slate-900",children:["Update the application and attach missing documents, then"," ",e.jsx("strong",{children:"Resubmit"}),". Add a short note if helpful."]}),e.jsx("label",{className:"block text-xs text-slate-900 font-semibold",children:"Comment (optional)"}),e.jsx("textarea",{value:i,onChange:t=>D(t.target.value),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full min-h-[44px]",placeholder:"What did you fix / add?"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>q("resubmit"),disabled:p,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-60 font-semibold shadow-sm",title:"Send for review again",children:p?"Submitting…":"Resubmit for Review"}),e.jsx(U,{to:"/loans/applications",className:"px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",title:"Open applications to edit details/attachments",children:"Edit Application"})]})]}),(B||be)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-extrabold",children:B?"Branch Manager Review":"Compliance Review"})}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-900 font-semibold",children:"Suggested Principal"}),e.jsx("input",{type:"number",className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",value:N,onChange:t=>oe(t.target.value),min:"0",step:"0.01"}),e.jsx("p",{className:"text-[11px] text-slate-700 mt-1",children:"Save a suggestion or approve with a different amount."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-900 font-semibold",children:"Comment"}),e.jsx("textarea",{className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full min-h-[44px]",placeholder:"Why approving / changes / rejection?",value:i,onChange:t=>D(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>q(B?"bm_approve":"compliance_approve",{suggestedAmount:N}),disabled:p,className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 disabled:opacity-60 font-semibold shadow-sm",children:p?"Working…":"Approve"}),e.jsx("button",{onClick:()=>q("request_changes"),disabled:p,className:"bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 disabled:opacity-60 font-semibold shadow-sm",title:"Send back to Loan Officer with requested changes",children:p?"Working…":"Request Changes"}),e.jsx("button",{onClick:()=>q("reject"),disabled:p,className:"bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-900 disabled:opacity-60 font-semibold shadow-sm",children:p?"Working…":"Reject"}),e.jsx("button",{onClick:_e,disabled:p,className:"px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 disabled:opacity-60 font-semibold",children:p?"Saving…":"Save Suggestion"})]})]}),ge&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-slate-900",children:"This loan is approved. Proceed to disbursement to finalize payout."}),e.jsx(U,{to:`/loans/${l}/disburse`,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 font-semibold shadow-sm",children:"Disburse"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(U,{to:"/loans",className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"Back to Loans"}),e.jsx("button",{onClick:()=>H(!0),className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"View Schedule"}),e.jsx("button",{onClick:()=>Xe({loan:s,schedule:x||[],currency:m}),className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",disabled:!Array.isArray(x)||!x.length,children:"Export CSV"}),e.jsx("button",{onClick:()=>Ye({loan:s,schedule:x||[],currency:m}),className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",disabled:!Array.isArray(x)||!x.length,children:"Export PDF"}),Ge&&e.jsx("button",{onClick:()=>O(!0),className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"Post Repayment"}),Oe&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ze,className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"Edit Loan"}),e.jsx("button",{onClick:Ve,className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"Reschedule"})]}),e.jsx("button",{onClick:Ze,className:"px-3 md:px-4 py-2 rounded-lg border-2 border-slate-400 hover:bg-slate-50 font-semibold",children:"Reissue"}),Te&&e.jsx("button",{onClick:Ue,className:"bg-red-600 text-white px-3 md:px-4 py-2 rounded-lg hover:bg-red-700 font-semibold shadow-sm",children:"Delete"}),s.status!=="closed"&&e.jsx("button",{onClick:Ie,className:"bg-red-50 text-red-700 px-3 md:px-4 py-2 rounded-lg border-2 border-red-300 hover:bg-red-100 font-semibold",children:"Close Loan"})]}),e.jsx(V,{title:"Repayments",right:e.jsxs("div",{className:"text-sm text-slate-900 font-semibold",children:[W.count," record",W.count===1?"":"s"," · Total"," ",e.jsx("span",{className:"font-extrabold",children:h(W.sum,m)})]}),children:ke?e.jsx("p",{children:"Loading repayments…"}):y.length===0?e.jsx("div",{className:"text-sm text-slate-900",children:"No repayments found."}):e.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-slate-400",children:e.jsxs("table",{className:"min-w-full table-fixed",children:[e.jsx("thead",{className:"bg-slate-100 sticky top-0 z-10",children:e.jsx("tr",{className:"text-left",children:["#","Date","Amount","Method","Notes"].map(t=>e.jsx("th",{className:"px-3 py-3 border border-slate-400 font-bold text-slate-900",children:t},t))})}),e.jsx("tbody",{children:y.map((t,a)=>e.jsxs("tr",{className:a%2?"bg-slate-50":"bg-white",children:[e.jsx("td",{className:"px-3 py-2 border border-slate-300 whitespace-nowrap",children:a+1}),e.jsx("td",{className:"px-3 py-2 border border-slate-300 whitespace-nowrap",children:F(t.date)}),e.jsx("td",{className:"px-3 py-2 border border-slate-300 text-right whitespace-nowrap",children:h(t.amount,m)}),e.jsx("td",{className:"px-3 py-2 border border-slate-300 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-bold bg-slate-100 text-slate-900 ring-1 ring-slate-300",children:t.method||"—"})}),e.jsx("td",{className:"px-3 py-2 border border-slate-300 break-words",children:t.notes||"—"})]},t.id||a))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-slate-100",children:[e.jsx("td",{className:"px-3 py-3 border-t-2 border-slate-400 text-sm font-bold",colSpan:2,children:"Total"}),e.jsx("td",{className:"px-3 py-3 border-t-2 border-slate-400 text-right text-base font-extrabold",children:h(W.sum,m)}),e.jsx("td",{className:"px-3 py-3 border-t-2 border-slate-400",colSpan:2})]})})]})})}),e.jsxs(V,{title:"Comments",children:[Re?e.jsx("p",{children:"Loading comments…"}):ee.length===0?e.jsx("div",{className:"text-sm text-slate-900",children:"No comments yet."}):e.jsx("div",{className:"space-y-3 max-h-72 overflow-auto pr-1",children:ee.map((t,a)=>{var r,n;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 text-indigo-900 flex items-center justify-center text-xs font-extrabold select-none",children:(((r=t.author)==null?void 0:r.name)||"U").slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-1 border-b-2 border-slate-300 pb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-700",children:[e.jsx("span",{className:"font-bold text-slate-900",children:((n=t.author)==null?void 0:n.name)||"User"}),e.jsx("span",{children:et(t.createdAt)})]}),e.jsx("p",{className:"text-sm mt-0.5 break-words",children:t.content})]})]},t.id||a)})}),e.jsxs("div",{className:"mt-4 flex items-start gap-2",children:[e.jsx("textarea",{value:Z,onChange:t=>G(t.target.value),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full min-h-[44px]",placeholder:"Add a comment"}),e.jsx("button",{onClick:Be,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-semibold shadow-sm",children:"Post"})]})]}),Le&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl p-6 border-2 border-slate-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Post Repayment"}),e.jsx("button",{onClick:()=>O(!1),className:"text-slate-700 hover:text-slate-900",children:"✕"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:S.amount,onChange:t=>L(a=>({...a,amount:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Date"}),e.jsx("input",{type:"date",value:S.date,onChange:t=>L(a=>({...a,date:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Method"}),e.jsxs("select",{value:S.method,onChange:t=>L(a=>({...a,method:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:S.notes,onChange:t=>L(a=>({...a,notes:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",placeholder:"Receipt no., reference, etc."})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 rounded-lg border-2 border-slate-400 font-semibold",children:"Cancel"}),e.jsx("button",{onClick:qe,disabled:de,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-60 font-semibold shadow-sm",children:de?"Posting…":"Post"})]})]})}),Ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl p-6 border-2 border-slate-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Repayment Schedule"}),e.jsx("button",{onClick:()=>H(!1),className:"text-slate-700 hover:text-slate-900",children:"✕"})]}),De?e.jsx("p",{children:"Loading schedule…"}):!Array.isArray(x)||x.length===0?e.jsx("p",{children:"No schedule available."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-sm text-slate-900 space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Disbursed:"})," ",F((s==null?void 0:s.releaseDate)||(s==null?void 0:s.startDate))||"—"]}),e.jsxs("div",{children:["Next installment: ",w?e.jsxs(e.Fragment,{children:[e.jsxs("b",{children:["#",w.idx]})," on ",F(w.date)," —"," ",e.jsx("b",{children:h(w.amount,m)})]}):"—"]})]}),e.jsx("div",{className:"max-h-[75vh] overflow-auto rounded-xl border-2 border-slate-400",children:e.jsx(tt,{schedule:x||[],currency:m})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>H(!1),className:"px-4 py-2 rounded-lg border-2 border-slate-400 font-semibold",children:"Close"})})]})}),Me&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-slate-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Edit Loan"}),e.jsx("button",{onClick:()=>T(!1),className:"text-slate-700 hover:text-slate-900",children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:u.amount,onChange:t=>A(a=>({...a,amount:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",value:u.interestRate,onChange:t=>A(a=>({...a,interestRate:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Term (months)"}),e.jsx("input",{type:"number",value:u.termMonths,onChange:t=>A(a=>({...a,termMonths:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"Start Date"}),e.jsx("input",{type:"date",value:u.startDate,onChange:t=>A(a=>({...a,startDate:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full"})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 rounded-lg border-2 border-slate-400 font-semibold",children:"Cancel"}),e.jsx("button",{onClick:We,disabled:ce,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-60 font-semibold shadow-sm",children:ce?"Saving…":"Save"})]})]})}),Fe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-slate-400",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Reschedule Loan"}),e.jsx("button",{onClick:()=>_(!1),className:"text-slate-700 hover:text-slate-900",children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"New Term (months)"}),e.jsx("input",{type:"number",value:f.termMonths,onChange:t=>I(a=>({...a,termMonths:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-900 font-semibold",children:"New Start Date"}),e.jsx("input",{type:"date",value:f.startDate,onChange:t=>I(a=>({...a,startDate:t.target.value})),className:"border-2 border-slate-400 rounded-lg px-3 py-2 w-full"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-semibold text-slate-900",children:[e.jsx("input",{type:"checkbox",checked:f.previewOnly,onChange:t=>I(a=>({...a,previewOnly:t.target.checked}))}),"Preview only (don’t save)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 rounded-lg border-2 border-slate-400 font-semibold",children:"Cancel"}),e.jsx("button",{onClick:Je,disabled:xe,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-60 font-semibold shadow-sm",children:xe?"Working…":f.previewOnly?"Preview":"Reschedule"})]})]})})]}):e.jsx("div",{className:"w-full px-6 py-6",children:"Loan not found."})}export{xt as default};
