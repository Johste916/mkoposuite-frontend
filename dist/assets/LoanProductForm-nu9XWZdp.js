import{u as C,i as S,r as u,g,j as t,L as f}from"./index-sYV8Q1B4.js";const k=(...s)=>s.filter(Boolean).join(" "),l=s=>{if(s===""||s===null||s===void 0||String(s).trim()===".")return null;const c=Number(s);return Number.isFinite(c)?c:null};function F(){const s=C(),{id:c}=S(),d=!!c,[h,b]=u.useState(!1),[y,N]=u.useState(d),[p,P]=u.useState({}),[n,v]=u.useState({name:"",code:"",status:"active",interestMethod:"flat",interestRate:"",penaltyRate:"",minPrincipal:"",maxPrincipal:"",minTermMonths:"",maxTermMonths:"",description:""}),i=(e,o)=>v(m=>({...m,[e]:o}));u.useEffect(()=>{d&&(async()=>{try{const{data:e}=await g.get(`/loan-products/${c}`);v({name:(e==null?void 0:e.name)??"",code:(e==null?void 0:e.code)??"",status:(e==null?void 0:e.status)??"active",interestMethod:(e==null?void 0:e.interestMethod)??"flat",interestRate:((e==null?void 0:e.interestRate)??"")===""?"":String((e==null?void 0:e.interestRate)??""),penaltyRate:((e==null?void 0:e.penaltyRate)??"")===""?"":String((e==null?void 0:e.penaltyRate)??""),minPrincipal:((e==null?void 0:e.minPrincipal)??"")===""?"":String((e==null?void 0:e.minPrincipal)??""),maxPrincipal:((e==null?void 0:e.maxPrincipal)??"")===""?"":String((e==null?void 0:e.maxPrincipal)??""),minTermMonths:((e==null?void 0:e.minTermMonths)??"")===""?"":String((e==null?void 0:e.minTermMonths)??""),maxTermMonths:((e==null?void 0:e.maxTermMonths)??"")===""?"":String((e==null?void 0:e.maxTermMonths)??""),description:(e==null?void 0:e.description)??""})}catch{alert("Failed to load product"),s("/loans/products",{replace:!0})}finally{N(!1)}})()},[d,c,s]);const R=()=>{const e={},o=l(n.interestRate),m=l(n.minPrincipal),x=l(n.maxPrincipal),j=l(n.minTermMonths),M=l(n.maxTermMonths);return String(n.name).trim()||(e.name="Name is required"),String(n.code).trim()||(e.code="Code is required"),(o===null||o<0)&&(e.interestRate="Interest rate must be 0 or more"),m!==null&&x!==null&&x<m&&(e.maxPrincipal="Max must be ≥ Min"),j!==null&&M!==null&&M<j&&(e.maxTermMonths="Max must be ≥ Min"),P(e),Object.keys(e).length===0},T=async e=>{if(e.preventDefault(),!R())return;b(!0);const o={name:n.name.trim(),code:n.code.trim().toUpperCase(),status:n.status,interestMethod:n.interestMethod,interestRate:l(n.interestRate)??0,penaltyRate:l(n.penaltyRate),minPrincipal:l(n.minPrincipal),maxPrincipal:l(n.maxPrincipal),minTermMonths:l(n.minTermMonths),maxTermMonths:l(n.maxTermMonths),description:n.description||""};try{d?await g.put(`/loan-products/${c}`,o):await g.post("/loan-products",o),s("/loans/products")}catch{alert("Failed to save product")}finally{b(!1)}},r=({id:e,label:o,error:m,children:x})=>t.jsxs("div",{children:[t.jsx("label",{htmlFor:e,className:"text-xs font-medium text-slate-600 dark:text-slate-300 mb-1 block",children:o}),x,m&&t.jsx("div",{className:"mt-1 text-xs text-rose-600",children:m})]}),a="w-full input border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 text-sm";return t.jsxs("div",{className:"p-4 md:p-6 lg:p-8 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:d?"Edit Loan Product":"Create Loan Product"}),t.jsx(f,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700",children:"Back to list"})]}),y?t.jsx("div",{className:"card p-4",children:"Loading…"}):t.jsxs("form",{onSubmit:T,className:"card p-4 space-y-4",children:[t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[t.jsx(r,{id:"lp-name",label:"Name",error:p.name,children:t.jsx("input",{id:"lp-name",className:a,value:n.name,onChange:e=>i("name",e.target.value),placeholder:"e.g. Business Working Capital",required:!0})}),t.jsx(r,{id:"lp-code",label:"Code",error:p.code,children:t.jsx("input",{id:"lp-code",className:a,value:n.code,onChange:e=>i("code",e.target.value),onBlur:e=>i("code",e.target.value.toUpperCase()),placeholder:"e.g. BWC",required:!0})}),t.jsx(r,{id:"lp-status",label:"Status",children:t.jsxs("select",{id:"lp-status",className:a,value:n.status,onChange:e=>i("status",e.target.value),children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx(r,{id:"lp-method",label:"Interest Method",children:t.jsxs("select",{id:"lp-method",className:a,value:n.interestMethod,onChange:e=>i("interestMethod",e.target.value),children:[t.jsx("option",{value:"flat",children:"Flat"}),t.jsx("option",{value:"reducing",children:"Reducing"})]})}),t.jsx(r,{id:"lp-rate",label:"Interest Rate (%)",error:p.interestRate,children:t.jsx("input",{id:"lp-rate",type:"number",step:"0.0001",className:a,value:n.interestRate,onChange:e=>i("interestRate",e.target.value),placeholder:"e.g. 3 or 3.5",inputMode:"decimal"})}),t.jsx(r,{id:"lp-penalty",label:"Penalty Rate (%)",children:t.jsx("input",{id:"lp-penalty",type:"number",step:"0.0001",className:a,value:n.penaltyRate,onChange:e=>i("penaltyRate",e.target.value),placeholder:"e.g. 1.5",inputMode:"decimal"})}),t.jsx(r,{id:"lp-minp",label:"Min Principal",children:t.jsx("input",{id:"lp-minp",type:"number",className:a,value:n.minPrincipal,onChange:e=>i("minPrincipal",e.target.value),placeholder:"e.g. 100000",inputMode:"numeric"})}),t.jsx(r,{id:"lp-maxp",label:"Max Principal",error:p.maxPrincipal,children:t.jsx("input",{id:"lp-maxp",type:"number",className:a,value:n.maxPrincipal,onChange:e=>i("maxPrincipal",e.target.value),placeholder:"e.g. 10000000",inputMode:"numeric"})}),t.jsx(r,{id:"lp-mint",label:"Min Term (months)",children:t.jsx("input",{id:"lp-mint",type:"number",className:a,value:n.minTermMonths,onChange:e=>i("minTermMonths",e.target.value),placeholder:"e.g. 3",inputMode:"numeric"})}),t.jsx(r,{id:"lp-maxt",label:"Max Term (months)",error:p.maxTermMonths,children:t.jsx("input",{id:"lp-maxt",type:"number",className:a,value:n.maxTermMonths,onChange:e=>i("maxTermMonths",e.target.value),placeholder:"e.g. 36",inputMode:"numeric"})}),t.jsx("div",{className:"sm:col-span-2",children:t.jsx(r,{id:"lp-desc",label:"Internal Notes / Description",children:t.jsx("textarea",{id:"lp-desc",rows:3,className:a,value:n.description||"",onChange:e=>i("description",e.target.value),placeholder:"Optional details visible to staff only."})})})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[t.jsx(f,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700 text-sm hover:bg-slate-50 dark:hover:bg-slate-800",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:!!h,className:k("px-4 py-2 rounded text-white text-sm",h?"bg-indigo-400":"bg-indigo-600 hover:bg-indigo-700"),children:h?"Saving…":d?"Update Product":"Create Product"})]})]})]})}export{F as default};
