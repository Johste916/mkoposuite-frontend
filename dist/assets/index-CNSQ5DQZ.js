import{f as S}from"./index-DSXeOGvG.js";const m={};var s={},y,T;const A=typeof import.meta<"u"&&"https://mkoposuite-backend-42w2.onrender.com/api".replace(/\/+$/,"")||typeof process<"u"&&((y=s==null?void 0:s.REACT_APP_API_BASE_URL)==null?void 0:y.replace(/\/+$/,""))||`${typeof window<"u"&&((T=window.location)==null?void 0:T.origin)||""}/api`,i=S.create({baseURL:A,timeout:3e4,withCredentials:!1,headers:{Accept:"application/json"}}),E=["token","jwt","authToken","accessToken","access_token"],D=["tenant","tenantId","x-tenant-id","tenantID"],N=()=>{for(const t of E){const e=localStorage.getItem(t)||sessionStorage.getItem(t);if(e)return String(e).replace(/^Bearer\s+/i,"")}return null},x=()=>{try{const e=localStorage.getItem("tenant")||sessionStorage.getItem("tenant");if(e){const n=JSON.parse(e);if(n!=null&&n.id)return n.id}}catch{}for(const e of D){const n=localStorage.getItem(e)||sessionStorage.getItem(e);if(n)return n}return typeof import.meta<"u"&&(m==null?void 0:m.VITE_DEFAULT_TENANT_ID)||typeof process<"u"&&(s==null?void 0:s.REACT_APP_DEFAULT_TENANT_ID)||null},P=()=>localStorage.getItem("activeBranchId")||sessionStorage.getItem("activeBranchId")||null,R=()=>{var t;return((t=crypto==null?void 0:crypto.randomUUID)==null?void 0:t.call(crypto))||`req_${Date.now()}_${Math.random().toString(36).slice(2)}`};i.interceptors.request.use(t=>{var l,c;const e=N();e&&(t.headers.Authorization=`Bearer ${e}`);const n=x();n&&(t.headers["x-tenant-id"]=n);const a=P();a&&(t.headers["x-branch-id"]=a);try{const o=Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC";t.headers["x-timezone"]||(t.headers["x-timezone"]=o)}catch{}if(!t.headers["x-tz-offset"])try{const o=new Date().getTimezoneOffset();t.headers["x-tz-offset"]=String(o)}catch{}return(l=t.headers)["x-request-id"]||(l["x-request-id"]=R()),(c=t.headers)["Content-Type"]||(c["Content-Type"]="application/json"),t});const z=()=>{var t;try{[...E,"user","tenant","tenantId","tenantName","activeBranchId"].forEach(e=>{try{localStorage.removeItem(e)}catch{}try{sessionStorage.removeItem(e)}catch{}}),delete i.defaults.headers.common.Authorization,delete i.defaults.headers.common["x-tenant-id"],delete i.defaults.headers.common["x-branch-id"]}catch{}typeof window<"u"&&!/^\/(login|auth)/.test(((t=window.location)==null?void 0:t.pathname)||"")&&window.location.replace("/login")};i.interceptors.response.use(t=>t,async t=>{var c,o,u,r,h,p,f,g,I;if((t==null?void 0:t.name)==="CanceledError"||(t==null?void 0:t.code)==="ERR_CANCELED")return Promise.reject(t);const e=(c=t==null?void 0:t.response)==null?void 0:c.status,n=t==null?void 0:t.code;try{const d=((u=(o=t==null?void 0:t.response)==null?void 0:o.headers)==null?void 0:u["x-request-id"])||((h=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:h.requestId);d&&(t.requestId=d)}catch{}if(t.normalizedMessage=n==="ECONNABORTED"?"Request timeout. Please try again.":e===401?"Unauthorized. Please sign in again.":e>=500?"Server error. Please try again.":((f=(p=t==null?void 0:t.response)==null?void 0:p.data)==null?void 0:f.message)||((I=(g=t==null?void 0:t.response)==null?void 0:g.data)==null?void 0:I.error)||(t==null?void 0:t.message)||"Request failed",e===401)return z(),Promise.reject(t);const a=t.config||{};if((n==="ECONNABORTED"||e>=500&&e<600)&&(a._retry||0)<2){a._retry=(a._retry||0)+1;const d=300*Math.pow(2,a._retry-1);return await new Promise(w=>setTimeout(w,d)),i(a)}return Promise.reject(t)});export{i as a};
