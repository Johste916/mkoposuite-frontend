import{u as ge,r as p,g,j as e,L as M}from"./index-DSXeOGvG.js";import{W as se}from"./wallet-BLqSiRkB.js";import{C as O}from"./circle-plus-h7G6c-rV.js";import{B as je,U as Ne}from"./upload-DT3U_1Rq.js";import{C as le}from"./calendar-CNaVLYLN.js";import{c as me}from"./createLucideIcon-De5UgybM.js";import{F as fe}from"./file-up-DIthVI4O.js";import{X as P}from"./x-D10koR8d.js";import{U as ye}from"./user-DPjbc6m9.js";import{S as we}from"./save-Dc7Krin1.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Me=me("landmark",ke);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ce=me("shield-check",Se),re=()=>new Date().toLocaleDateString("en-CA"),o="input text-black dark:text-white placeholder-black/60 dark:placeholder-white/70",h="border-2 border-black/20 dark:border-white/30",Ie="ring-2 ring-black/10 dark:ring-white/20",Ae="divide-y-2 divide-black/10 dark:divide-white/20",v=`bg-white dark:bg-slate-900/40 rounded-2xl shadow-sm ${Ie} ${h} p-5 md:p-7`,$="grid items-center gap-3 p-3 md:p-4",ne=`rounded-xl overflow-hidden ${h}`,oe="bg-slate-50/80 dark:bg-slate-800/60 text-xs font-bold text-black dark:text-white grid gap-3 p-3 md:p-3.5",ie=`${Ae}`,T=d=>Array.isArray(d)?d:Array.isArray(d==null?void 0:d.items)?d.items:Array.isArray(d==null?void 0:d.rows)?d.rows:Array.isArray(d==null?void 0:d.results)?d.results:[],S=d=>(d??"").toString().replace(/[^\d.]/g,""),_=d=>{const j=S(d);if(!j)return"";const[C,N]=j.split("."),y=C.replace(/\B(?=(\d{3})+(?!\d))/g,",");return N?`${y}.${N.slice(0,2)}`:y},Oe=[{value:"schedule_equal",label:"Distribute equally on the loan schedule"},{value:"first_installment",label:"To be paid on the first installment"},{value:"last_installment",label:"To be paid on the last repayment"},{value:"manual",label:"Manually collected"}],Pe=[{value:"flat",label:"Flat rate"},{value:"reducing_equal_installments",label:"Reduced balance — equal installments"},{value:"reducing_equal_principal",label:"Reduced balance — equal principal"},{value:"interest_only",label:"Interest only"},{value:"compound_accrued",label:"Compound interest (accrued)"},{value:"compound_equal_installments",label:"Compound interest — equal installments"}],_e=["None","Household Items","Vehicle (Logbook)","Land Title","Business Stock","Electronics","Salary Assignment","Other"],ce=[{value:"weekly",label:"Weekly",perMonth:4},{value:"biweekly",label:"Bi-weekly",perMonth:2},{value:"monthly",label:"Monthly",perMonth:1},{value:"custom",label:"Custom"}],Re=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank"},{value:"mobile_money",label:"Mobile Money"},{value:"other",label:"Other"}],de=[{value:"mpesa",label:"M-Pesa"},{value:"tigopesa",label:"Tigo Pesa"},{value:"airtelmoney",label:"Airtel Money"},{value:"halopesa",label:"HaloPesa"},{value:"ttclpesa",label:"TTCL Pesa"},{value:"other",label:"Other"}],Le=["new loan","open","top-up","defaulted"],$e=[{value:"single",label:"Single"},{value:"married",label:"Married"},{value:"divorced",label:"Divorced"},{value:"widow",label:"Widow"},{value:"widower",label:"Widower"},{value:"not_specified",label:"Not specified"}];function Ge(){const d=ge(),[j,C]=p.useState([]),[N,y]=p.useState([]),[B,D]=p.useState([]),[E,F]=p.useState(!1),[ue,q]=p.useState(!1),[t,n]=p.useState({productId:"",borrowerId:"",loanNumber:"",principal:"",releaseDate:re(),durationMonths:"",collateralType:"",collateralAmount:"",collateralOther:"",interestMethod:"flat",interestRate:"",interestAmount:"",fees:[],repaymentCycle:"monthly",numberOfRepayments:"",statusLabel:"new loan",disbursementMethod:"cash",disbursementBankId:"",disbursementReference:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:"",maritalStatus:"not_specified",spouseName:"",spouseOccupation:"",spouseIdNumber:"",spousePhone:"",attachmentsMeta:[],guarantors:[]}),f=p.useRef({});p.useEffect(()=>{(async()=>{try{const[a,l]=await Promise.all([g.get("/loan-products"),g.get("/borrowers",{params:{page:1,pageSize:500}}).catch(()=>({data:{items:[]}}))]);C(T(a.data)),y(T(l.data))}catch{C([]),y([])}try{const a=await g.get("/banks");D(T(a.data))}catch{D([])}})()},[]);const w=p.useMemo(()=>Array.isArray(j)?j:[],[j]),U=p.useMemo(()=>Array.isArray(N)?N:[],[N]);p.useEffect(()=>{t.borrowerId&&(q(!0),(async()=>{var a,l,s;try{let r=0;try{const c=await g.get(`/borrowers/${t.borrowerId}/loans`);r=Array.isArray(c.data)?c.data.length:((l=(a=c.data)==null?void 0:a.items)==null?void 0:l.length)||0}catch{r=((s=(await g.get("/loans",{params:{borrowerId:t.borrowerId,page:1,pageSize:1}})).data)==null?void 0:s.total)||0}const i=(r+1).toString().padStart(3,"0");n(c=>({...c,loanNumber:i}))}catch{n(r=>({...r,loanNumber:""}))}finally{q(!1)}})())},[t.borrowerId]),p.useEffect(()=>{if(t.repaymentCycle==="custom")return;const a=ce.find(r=>r.value===t.repaymentCycle),l=Number(t.durationMonths||0);if(!a||l<=0)return;const s=l*(a.perMonth||1);n(r=>({...r,numberOfRepayments:String(s)}))},[t.repaymentCycle,t.durationMonths]);const K=a=>{const l=Math.random().toString(36).slice(2);n(s=>({...s,attachmentsMeta:[...s.attachmentsMeta,{type:a||"other",note:"",fileKey:l}]}))},V=(a,l)=>{l?f.current[a]=l:delete f.current[a]},he=(a,l)=>n(s=>({...s,attachmentsMeta:s.attachmentsMeta.map((r,i)=>i===a?{...r,...l}:r)})),W=a=>n(l=>{const s=l.attachmentsMeta[a];return s!=null&&s.fileKey&&delete f.current[s.fileKey],{...l,attachmentsMeta:l.attachmentsMeta.filter((r,i)=>i!==a)}}),R=()=>t.attachmentsMeta.findIndex(a=>String(a.type||"").toLowerCase()==="spouse: consent declaration"),z=()=>n(a=>({...a,fees:[...a.fees,{name:"",amount:"",paid:!1,paymentMode:"schedule_equal"}]})),I=(a,l)=>n(s=>({...s,fees:s.fees.map((r,i)=>i===a?{...r,...l,...l.amount!==void 0?{amount:_(l.amount)}:{}}:r)})),pe=a=>n(l=>({...l,fees:l.fees.filter((s,r)=>r!==a)})),xe=async a=>{var G,H,Y,J,X,Z,Q,ee,ae;if(a.preventDefault(),!t.borrowerId)return alert("Select a borrower");if(!t.productId)return alert("Select a loan product");const l=S(t.principal);if(!l||Number(l)<=0)return alert("Enter a principal amount");if(!t.durationMonths)return alert("Enter loan duration (months)");const s=w.find(m=>String(m.id)===String(t.productId)),r=Number((s==null?void 0:s.minPrincipal)??(s==null?void 0:s.minAmount)??0)||0,i=Number((s==null?void 0:s.maxPrincipal)??(s==null?void 0:s.maxAmount)??Number.POSITIVE_INFINITY)||Number.POSITIVE_INFINITY,c=Number(l);if(c<r)return alert(`Principal below minimum (${r.toLocaleString()}).`);if(c>i)return alert(`Principal above maximum (${i.toLocaleString()}).`);if(t.collateralType==="Other"&&!t.collateralOther.trim())return alert("Please specify the collateral for 'Other'.");if(t.disbursementMethod==="other"&&!t.disbursementOther.trim())return alert("Please specify the disbursement method for 'Other'.");if(t.disbursementMethod==="mobile_money"){if(!t.mobileProvider)return alert("Select a mobile money provider.");if(t.mobileProvider==="other"&&!t.mobileProviderOther.trim())return alert("Please specify the mobile money provider.");if(!t.mobilePhone.trim())return alert("Enter the mobile money phone number.");const m=t.mobilePhone.replace(/\D/g,"");if(m.length<9||m.length>15)return alert("Mobile money phone number looks invalid.")}if(t.maritalStatus==="married"){const m=R(),x=m>=0?t.attachmentsMeta[m]:null;if(!(x?!!f.current[x.fileKey]:!1))return alert("Please attach the spouse consent declaration (signed).")}F(!0);try{const m=t.collateralType==="Other"&&t.collateralOther.trim()?`Other: ${t.collateralOther.trim()}`:t.collateralType||null;let x=((G=t.disbursementReference)==null?void 0:G.trim())||"";t.disbursementMethod==="mobile_money"?x=[`Provider: ${t.mobileProvider==="other"?t.mobileProviderOther.trim():((H=de.find(k=>k.value===t.mobileProvider))==null?void 0:H.label)||t.mobileProvider}`,`Phone: ${t.mobilePhone.trim()}`,x?`Ref: ${x}`:null].filter(Boolean).join(" | "):t.disbursementMethod==="other"&&(x=[`Method: ${t.disbursementOther.trim()}`,(Y=t.disbursementOtherDetails)!=null&&Y.trim()?`Details: ${t.disbursementOtherDetails.trim()}`:null,x?`Ref: ${x}`:null].filter(Boolean).join(" | "));const L={productId:t.productId,borrowerId:t.borrowerId,loanNumber:t.loanNumber||null,amount:l,currency:"TZS",releaseDate:t.releaseDate||re(),durationMonths:String(t.durationMonths).trim(),collateralType:m,collateralAmount:S(t.collateralAmount)||null,interestMethod:t.interestMethod,interestRate:t.interestRate||null,interestAmount:S(t.interestAmount)||null,fees:t.fees.map(u=>({name:u.name||"",amount:S(u.amount)||"0",paid:!!u.paid,paymentMode:u.paymentMode||"schedule_equal"})),repaymentCycle:t.repaymentCycle,numberOfRepayments:String(t.numberOfRepayments||"").trim(),disbursementMethod:t.disbursementMethod,disbursementBankId:t.disbursementMethod==="bank"&&t.disbursementBankId||null,disbursementReference:x||null,spouse:t.maritalStatus==="married"?{name:t.spouseName||"",occupation:t.spouseOccupation||"",idNumber:t.spouseIdNumber||"",phone:t.spousePhone||""}:void 0,status:"pending",statusLabel:t.statusLabel};if(t.attachmentsMeta.map(u=>f.current[u.fileKey]).filter(Boolean).length===0){const u=await g.post("/loans",L);alert("Loan application submitted"),d(`/loans/${((J=u.data)==null?void 0:J.id)||""}`)}else{const u=new FormData;u.append("payload",JSON.stringify(L));for(const k of t.attachmentsMeta){const A=f.current[k.fileKey];A&&(u.append("files",A,A.name),u.append("filesMeta[]",JSON.stringify({type:k.type,note:k.note,name:A.name})))}const te=await g.post("/loans",u,{headers:{"Content-Type":"multipart/form-data"}});alert("Loan application submitted"),d(`/loans/${((X=te.data)==null?void 0:X.id)||""}`)}}catch(m){const x=((Q=(Z=m==null?void 0:m.response)==null?void 0:Z.data)==null?void 0:Q.message)||((ae=(ee=m==null?void 0:m.response)==null?void 0:ee.data)==null?void 0:ae.error)||(m==null?void 0:m.message)||"Failed to submit loan application";alert(x)}finally{F(!1)}},b=p.useMemo(()=>w.find(a=>String(a.id)===String(t.productId)),[w,t.productId]),be=a=>{const l=w.find(s=>String(s.id)===String(a));n(s=>({...s,productId:a,interestMethod:(l==null?void 0:l.interestMethod)||s.interestMethod,interestRate:(l==null?void 0:l.interestRate)??""}))},ve=()=>{R()===-1&&K("Spouse: Consent declaration")};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8 text-black dark:text-white",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Add Loan"}),e.jsx("p",{className:"text-sm",children:"Follow the steps below. Start by selecting a borrower, then continue down the page."})]}),e.jsx(M,{to:"/loans",className:"text-black underline text-sm font-semibold",children:"Back to Loans"})]}),e.jsxs("form",{onSubmit:xe,className:"max-w-6xl mx-auto space-y-5 md:space-y-6",children:[e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(se,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"1) Borrower & Product"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Borrower"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${o} flex-1`,value:t.borrowerId,onChange:a=>n({...t,borrowerId:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select borrower…"}),U.map(a=>e.jsxs("option",{value:a.id,children:[a.name," ",a.phone?`— ${a.phone}`:""]},a.id))]}),e.jsxs(M,{target:"_blank",to:"/borrowers/add",className:`px-3 py-2 rounded-lg hover:bg-gray-50 inline-flex items-center gap-2 ${h}`,children:[e.jsx(O,{className:"h-4 w-4"})," Add"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Loan Product"}),e.jsxs("select",{className:o,value:t.productId,onChange:a=>be(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select product…"}),w.map(a=>e.jsxs("option",{value:a.id,children:[a.name,a.code?` (${a.code})`:""]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Loan # (auto)"}),e.jsx("input",{className:o,value:ue?"…":t.loanNumber||"—",readOnly:!0})]})]})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(je,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"2) Loan Terms"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Principal Amount"}),e.jsx("input",{type:"text",inputMode:"numeric",className:o,value:t.principal,onChange:a=>n({...t,principal:_(a.target.value)}),placeholder:"e.g. 1,000,000",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold flex items-center gap-1",children:[e.jsx(le,{className:"h-3.5 w-3.5"})," Loan Release Date"]}),e.jsx("input",{type:"date",className:o,value:t.releaseDate,onChange:a=>n({...t,releaseDate:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Collateral Type"}),e.jsxs("select",{className:o,value:t.collateralType,onChange:a=>n({...t,collateralType:a.target.value}),children:[e.jsx("option",{value:"",children:"Select…"}),_e.map(a=>e.jsx("option",{value:a,children:a},a))]}),t.collateralType==="Other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:o,placeholder:"Specify collateral",value:t.collateralOther,onChange:a=>n({...t,collateralOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Collateral Amount"}),e.jsx("input",{type:"text",inputMode:"numeric",className:o,value:t.collateralAmount,onChange:a=>n({...t,collateralAmount:_(a.target.value)}),placeholder:"e.g. 500,000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Loan Duration (months)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:o,value:t.durationMonths,onChange:a=>n({...t,durationMonths:a.target.value}),required:!0})]})]})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(Me,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"3) Interest"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold",children:"Interest Method"}),e.jsx("select",{className:o,value:t.interestMethod,onChange:a=>n({...t,interestMethod:a.target.value}),children:Pe.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",inputMode:"decimal",className:o,value:t.interestRate,onChange:a=>n({...t,interestRate:a.target.value}),placeholder:b!=null&&b.interestRate?String(b.interestRate):"e.g. 3",readOnly:(b==null?void 0:b.interestRate)!=null}),(b==null?void 0:b.interestRate)!=null&&e.jsx("p",{className:"text-[11px] mt-1",children:"Auto-picked from product."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Interest Amount (optional)"}),e.jsx("input",{type:"text",inputMode:"numeric",className:o,value:t.interestAmount,onChange:a=>n({...t,interestAmount:_(a.target.value)}),placeholder:"e.g. 120,000"})]})]})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(le,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"4) Repayments"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Repayment Cycle"}),e.jsx("select",{className:o,value:t.repaymentCycle,onChange:a=>n({...t,repaymentCycle:a.target.value}),children:ce.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"# of Repayments"}),e.jsx("input",{type:"number",inputMode:"numeric",className:o,value:t.numberOfRepayments,onChange:a=>n({...t,numberOfRepayments:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Loan Status (label)"}),e.jsx("select",{className:o,value:t.statusLabel,onChange:a=>n({...t,statusLabel:a.target.value}),children:Le.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("p",{className:"text-[11px] mt-1",children:"DB status stays “pending” on create."})]})]})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"5) Loan Fees"})]}),e.jsxs("button",{type:"button",onClick:z,className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-50 ${h}`,children:[e.jsx(O,{className:"h-4 w-4"})," Add Fee"]})]}),t.fees.length===0?e.jsx("p",{className:"text-sm",children:"No fees added."}):e.jsxs("div",{className:ne,children:[e.jsxs("div",{className:`${oe} grid-cols-[2fr_1fr_1fr_1fr_40px] ${h}`,children:[e.jsx("div",{children:"Fee Name"}),e.jsx("div",{children:"Amount"}),e.jsx("div",{children:"Way of payment"}),e.jsx("div",{children:"Paid?"}),e.jsx("div",{className:"text-right pr-1",children:"—"})]}),e.jsx("div",{className:ie,children:t.fees.map((a,l)=>e.jsxs("div",{className:`${$} grid-cols-[2fr_1fr_1fr_1fr_40px]`,children:[e.jsx("input",{className:o,placeholder:"Fee name (e.g. Processing)",value:a.name,onChange:s=>I(l,{name:s.target.value})}),e.jsx("input",{type:"text",inputMode:"numeric",className:o,placeholder:"Amount",value:a.amount,onChange:s=>I(l,{amount:s.target.value})}),e.jsx("select",{className:o,value:a.paymentMode,onChange:s=>I(l,{paymentMode:s.target.value}),children:Oe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("select",{className:o,value:a.paid?"paid":"not_paid",onChange:s=>I(l,{paid:s.target.value==="paid"}),children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"not_paid",children:"Not paid"})]}),e.jsx("button",{type:"button",onClick:()=>pe(l),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove fee",children:e.jsx(P,{className:"h-4 w-4"})})]},l))})]}),e.jsx("p",{className:"text-xs mt-2",children:"Unpaid fees will be handled according to the selected way of payment."})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"6) Guarantors"})]}),e.jsx("button",{type:"button",onClick:z,className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>n(a=>({...a,guarantors:[...a.guarantors,{type:"existing",borrowerId:"",name:"",occupation:"",residence:"",contacts:"",verification:""}]})),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-50 ${h}`,children:[e.jsx(O,{className:"h-4 w-4"})," Add Guarantor"]})]}),t.guarantors.length===0?e.jsx("p",{className:"text-sm",children:"No guarantors added."}):e.jsx("div",{className:"space-y-4",children:t.guarantors.map((a,l)=>e.jsxs("div",{className:`rounded-xl p-3 md:p-4 space-y-3 ${h}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-bold",children:["Guarantor #",l+1]}),e.jsx("button",{type:"button",onClick:()=>n(s=>({...s,guarantors:s.guarantors.filter((r,i)=>i!==l)})),className:"p-1 rounded hover:bg-gray-50","aria-label":"Remove guarantor",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Source"}),e.jsxs("select",{className:o,value:a.type,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,type:s.target.value}:i)})),children:[e.jsx("option",{value:"existing",children:"Select from borrowers"}),e.jsx("option",{value:"manual",children:"Enter manually"})]})]}),a.type==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Borrower"}),e.jsxs("select",{className:o,value:a.borrowerId||"",onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,borrowerId:s.target.value}:i)})),children:[e.jsx("option",{value:"",children:"Select borrower…"}),U.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.phone?`— ${s.phone}`:""]},s.id))]})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{className:o,placeholder:"Full name",value:a.name,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,name:s.target.value}:i)}))}),e.jsx("input",{className:o,placeholder:"Occupation",value:a.occupation,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,occupation:s.target.value}:i)}))}),e.jsx("input",{className:o,placeholder:"Residence",value:a.residence,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,residence:s.target.value}:i)}))}),e.jsx("input",{className:o,placeholder:"Contacts",value:a.contacts,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,contacts:s.target.value}:i)}))}),e.jsx("input",{className:o,placeholder:"Verification (ID #, etc.)",value:a.verification,onChange:s=>n(r=>({...r,guarantors:r.guarantors.map((i,c)=>c===l?{...i,verification:s.target.value}:i)}))})]})]})]},l))})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"7) Attachments"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Borrower: Loan form","Borrower: Village introduction","Borrower: Fee receipt","Borrower: ID","Borrower: Business licence","Borrower: TIN","Borrower: Employment contract","Borrower: Salary slips","Borrower: Employer letter","Guarantor: ID","Guarantor: Village introduction","Spouse: Consent declaration","Other"].map(a=>e.jsxs("button",{type:"button",onClick:()=>K(a),className:`text-xs px-2 py-1 rounded hover:bg-gray-50 ${h}`,children:["+ ",a.replace(/Borrower: |Guarantor: |Spouse: /g,"")]},a))})]}),t.attachmentsMeta.length===0?e.jsx("p",{className:"text-sm",children:"No files attached."}):e.jsxs("div",{className:ne,children:[e.jsxs("div",{className:`${oe} grid-cols-[2fr_1fr_40px] ${h}`,children:[e.jsx("div",{children:"Type & Note"}),e.jsx("div",{children:"File"}),e.jsx("div",{className:"text-right pr-1",children:"—"})]}),e.jsx("div",{className:ie,children:t.attachmentsMeta.map((a,l)=>e.jsxs("div",{className:`${$} grid-cols-[2fr_1fr_40px]`,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:o,value:a.type,onChange:s=>n(r=>({...r,attachmentsMeta:r.attachmentsMeta.map((i,c)=>c===l?{...i,type:s.target.value}:i)}))}),e.jsx("input",{className:o,placeholder:"Note (optional)",value:a.note,onChange:s=>n(r=>({...r,attachmentsMeta:r.attachmentsMeta.map((i,c)=>c===l?{...i,note:s.target.value}:i)}))})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:o,onChange:s=>{var r;return V(a.fileKey,(r=s.target.files)==null?void 0:r[0])}}),e.jsx("button",{type:"button",onClick:()=>W(l),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove attachment",children:e.jsx(P,{className:"h-4 w-4"})})]},a.fileKey))})]}),e.jsx("p",{className:"text-xs mt-2",children:"Accepted images/PDFs as supported by your backend."})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(se,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"8) Disbursement"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Method"}),e.jsx("select",{className:o,value:t.disbursementMethod,onChange:a=>{const l=a.target.value;n({...t,disbursementMethod:l,disbursementBankId:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:""})},children:Re.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Reference (optional)"}),e.jsx("input",{className:o,value:t.disbursementReference,onChange:a=>n({...t,disbursementReference:a.target.value}),placeholder:"Txn ref / slip #"})]}),t.disbursementMethod==="bank"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold",children:"Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${o} flex-1`,value:t.disbursementBankId,onChange:a=>n({...t,disbursementBankId:a.target.value}),children:[e.jsx("option",{value:"",children:"Select bank…"}),B.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs(M,{to:"/banks/add",target:"_blank",className:`px-3 py-2 rounded-lg hover:bg-gray-50 inline-flex items-center gap-2 ${h}`,children:[e.jsx(O,{className:"h-4 w-4"})," Add"]}),e.jsx(M,{to:"/banks",target:"_blank",className:`px-3 py-2 rounded-lg hover:bg-gray-50 ${h}`,children:"Manage"})]}),B.length===0&&e.jsx("p",{className:"text-[11px] mt-1",children:"No banks found. Use “Add” to register banks; this list is tenant-scoped via your API."})]}),t.disbursementMethod==="mobile_money"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Provider"}),e.jsxs("select",{className:o,value:t.mobileProvider,onChange:a=>n({...t,mobileProvider:a.target.value}),children:[e.jsx("option",{value:"",children:"Select provider…"}),de.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),t.mobileProvider==="other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:o,placeholder:"Specify provider",value:t.mobileProviderOther,onChange:a=>n({...t,mobileProviderOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Phone Number"}),e.jsx("input",{className:o,placeholder:"e.g. 07xxxxxxxx or +2557xxxxxxxx",value:t.mobilePhone,onChange:a=>n({...t,mobilePhone:a.target.value})})]})]}),t.disbursementMethod==="other"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Specify method"}),e.jsx("input",{className:o,placeholder:"e.g., cheque, voucher, petty cash",value:t.disbursementOther,onChange:a=>n({...t,disbursementOther:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Details (optional)"}),e.jsx("input",{className:o,placeholder:"Instructions / place of collection",value:t.disbursementOtherDetails,onChange:a=>n({...t,disbursementOtherDetails:a.target.value})})]})]})]})]}),e.jsxs("section",{className:v,children:[e.jsxs("div",{className:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-black/20 dark:border-white/20",children:[e.jsx(ye,{className:"h-5 w-5 text-black dark:text-white"}),e.jsx("h2",{className:"font-bold text-lg",children:"9) Marital Status & Spouse"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold",children:"Marital Status"}),e.jsx("select",{className:o,value:t.maritalStatus,onChange:a=>n({...t,maritalStatus:a.target.value}),children:$e.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsx("div",{className:"hidden md:block"}),t.maritalStatus==="married"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:o,placeholder:"Spouse Name",value:t.spouseName,onChange:a=>n({...t,spouseName:a.target.value})}),e.jsx("input",{className:o,placeholder:"Spouse Occupation",value:t.spouseOccupation,onChange:a=>n({...t,spouseOccupation:a.target.value})}),e.jsx("input",{className:o,placeholder:"Spouse ID Number",value:t.spouseIdNumber,onChange:a=>n({...t,spouseIdNumber:a.target.value})}),e.jsx("input",{className:o,placeholder:"Spouse Phone",value:t.spousePhone,onChange:a=>n({...t,spousePhone:a.target.value})}),e.jsxs("div",{className:`md:col-span-2 rounded-xl p-3 ${h}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-bold",children:"Spouse Consent Declaration (signed)"}),e.jsx("button",{type:"button",onClick:ve,className:`text-xs px-2 py-1 rounded hover:bg-gray-50 ${h}`,children:"+ Add consent upload"})]}),(()=>{const a=R();if(a===-1)return e.jsx("p",{className:"text-xs",children:"Click “Add consent upload” to attach the signed declaration."});const l=t.attachmentsMeta[a];return e.jsxs("div",{className:`${$} grid-cols-[2fr_1fr_40px] p-0`,children:[e.jsxs("div",{className:"grid gap-2 p-3",children:[e.jsx("input",{className:o,value:l.type,readOnly:!0}),e.jsx("input",{className:o,placeholder:"Note (optional)",value:l.note,onChange:s=>he(a,{note:s.target.value})})]}),e.jsx("div",{className:"p-3",children:e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:o,onChange:s=>{var r;return V(l.fileKey,(r=s.target.files)==null?void 0:r[0])}})}),e.jsx("div",{className:"p-3",children:e.jsx("button",{type:"button",onClick:()=>W(a),className:"p-2 rounded hover:bg-gray-50","aria-label":"Remove spouse consent",children:e.jsx(P,{className:"h-4 w-4"})})})]})})(),e.jsx("p",{className:"text-[11px] mt-2",children:"This replaces the old text field. Upload the signed consent form here."})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 inset-x-0 z-20 bg-white/90 backdrop-blur border-t-2 border-black/20",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3 flex justify-end gap-3",children:[e.jsx(M,{to:"/loans",className:`px-4 py-2 rounded-xl hover:bg-gray-50 ${h}`,children:"Cancel"}),e.jsxs("button",{disabled:E,type:"submit",className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-black text-white hover:opacity-90 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm",children:[e.jsx(we,{className:"h-4 w-4"}),E?"Submitting…":"Submit"]})]})})]})]})}export{Ge as default};
