import{u as ge,r as m,h as b,j as e,L as w}from"./index-BdJ97RMf.js";import{B as je}from"./badge-check-cyqn_kSN.js";import{c as T}from"./createLucideIcon-DNL7ncPI.js";import{C as _}from"./circle-plus-AVeSyc-e.js";import{B as Ne,U as fe}from"./upload-DJGgKTdM.js";import{C as te}from"./calendar-CV-gedX_.js";import{F as ye}from"./file-up-BC8yRGj3.js";import{X as L}from"./x-BzZ8pb5N.js";import{U as Se}from"./user-BvVns51z.js";import{S as Me}from"./save-Pz9Oe970.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Ce=T("landmark",we);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ke=T("shield-check",Ie);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],se=T("wallet",Ae),le=()=>new Date().toLocaleDateString("en-CA"),s={container:"p-4 md:p-6 lg:p-8 bg-[var(--bg)] text-[var(--fg)]",sectionHeader:"flex items-center gap-2 pb-4 mb-5 border-b-2 border-[var(--border)]",card:"bg-[var(--card)] rounded-2xl shadow p-5 md:p-7 border-2 border-[var(--border-strong)]",icon:"h-5 w-5 text-[var(--fg)]",label:"text-xs font-semibold",note:"text-[11px] text-[var(--muted)]",link:"text-[var(--ring)] underline decoration-2 underline-offset-4 font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] rounded",btn:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border-2 border-[var(--border-strong)] bg-[var(--card)] hover:bg-[var(--kpi-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",btnIcon:"p-2 rounded hover:bg-[var(--kpi-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",primary:"inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-[var(--accent)] text-[var(--on-accent)] hover:opacity-90 disabled:opacity-60 disabled:cursor-not-allowed shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",input:"h-10 rounded-lg border-2 px-3 outline-none bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)] focus:ring-2 focus:ring-[var(--ring)] placeholder:text-[var(--muted)]",listShell:"rounded-xl overflow-hidden border-2 border-[var(--border-strong)] bg-[var(--card)]",listHead:"bg-[var(--kpi-bg)] text-xs font-bold text-[var(--fg)] grid gap-3 p-3 md:p-3.5 border-b-2 border-[var(--border)]",listBody:"divide-y-2 divide-[var(--border)]",rowShell:"grid items-center gap-3 p-3 md:p-4"},C=d=>Array.isArray(d)?d:Array.isArray(d==null?void 0:d.items)?d.items:Array.isArray(d==null?void 0:d.rows)?d.rows:Array.isArray(d==null?void 0:d.results)?d.results:[],I=d=>(d??"").toString().replace(/[^\d.]/g,""),R=d=>{const g=I(d);if(!g)return"";const[k,j]=g.split("."),y=k.replace(/\B(?=(\d{3})+(?!\d))/g,",");return j?`${y}.${j.slice(0,2)}`:y},Oe=[{value:"schedule_equal",label:"Distribute equally on the loan schedule"},{value:"first_installment",label:"To be paid on the first installment"},{value:"last_installment",label:"To be paid on the last repayment"},{value:"manual",label:"Manually collected"}],Pe=[{value:"flat",label:"Flat rate"},{value:"reducing_equal_installments",label:"Reduced balance — equal installments"},{value:"reducing_equal_principal",label:"Reduced balance — equal principal"},{value:"interest_only",label:"Interest only"},{value:"compound_accrued",label:"Compound interest (accrued)"},{value:"compound_equal_installments",label:"Compound interest — equal installments"}],_e=["None","Household Items","Vehicle (Logbook)","Land Title","Business Stock","Electronics","Salary Assignment","Other"],ne=[{value:"weekly",label:"Weekly",perMonth:4},{value:"biweekly",label:"Bi-weekly",perMonth:2},{value:"monthly",label:"Monthly",perMonth:1},{value:"custom",label:"Custom"}],Re=[{value:"cash",label:"Cash"},{value:"bank",label:"Bank"},{value:"mobile_money",label:"Mobile Money"},{value:"other",label:"Other"}],re=[{value:"mpesa",label:"M-Pesa"},{value:"tigopesa",label:"Tigo Pesa"},{value:"airtelmoney",label:"Airtel Money"},{value:"halopesa",label:"HaloPesa"},{value:"ttclpesa",label:"TTCL Pesa"},{value:"other",label:"Other"}],Be=["new loan","open","top-up","defaulted"];function Ke(){var Y;const d=ge(),[g,k]=m.useState([]),[j,y]=m.useState([]),[D,$]=m.useState([]),[ie,E]=m.useState([]),[oe,F]=m.useState([]),[v,ce]=m.useState(null),[q,H]=m.useState(!1),[de,U]=m.useState(!1),[t,i]=m.useState({productId:"",borrowerId:"",loanNumber:"",principal:"",releaseDate:le(),durationMonths:"",collateralType:"",collateralAmount:"",collateralOther:"",interestMethod:"flat",interestRate:"",interestAmount:"",fees:[],repaymentCycle:"monthly",numberOfRepayments:"",statusLabel:"new loan",disbursementMethod:"cash",disbursementBankId:"",disbursementReference:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:"",maritalStatus:"not_specified",spouseName:"",spouseOccupation:"",spouseIdNumber:"",spousePhone:"",attachmentsMeta:[],guarantors:[],officerId:"",branchId:""}),N=m.useRef({});m.useEffect(()=>{(async()=>{try{const a=await b.get("/me").catch(()=>b.get("/auth/me")),n=(a==null?void 0:a.data)||null;ce(n||null);const[l,r,o,c,O]=await Promise.all([b.get("/loan-products"),b.get("/borrowers",{params:{page:1,pageSize:500}}).catch(()=>({data:{items:[]}})),b.get("/banks").catch(()=>({data:{items:[]}})),b.get("/users",{params:{role:"loan_officer",pageSize:500}}).catch(()=>({data:{items:[]}})),b.get("/branches",{params:{pageSize:500}}).catch(()=>({data:{items:[]}}))]);k(C(l.data)),y(C(r.data)),$(C(o.data)),E(C(c.data)),F(C(O.data)),i(f=>({...f,officerId:f.officerId||(n==null?void 0:n.id)||"",branchId:f.branchId||(n==null?void 0:n.branchId)||""}))}catch{k([]),y([]),$([]),E([]),F([])}})()},[]);const S=m.useMemo(()=>Array.isArray(g)?g:[],[g]),V=m.useMemo(()=>Array.isArray(j)?j:[],[j]);m.useEffect(()=>{t.borrowerId&&(U(!0),(async()=>{var a,n,l;try{let r=0;try{const c=await b.get(`/borrowers/${t.borrowerId}/loans`);r=Array.isArray(c.data)?c.data.length:((n=(a=c.data)==null?void 0:a.items)==null?void 0:n.length)||0}catch{r=((l=(await b.get("/loans",{params:{borrowerId:t.borrowerId,page:1,pageSize:1}})).data)==null?void 0:l.total)||0}const o=(r+1).toString().padStart(3,"0");i(c=>({...c,loanNumber:o}))}catch{i(r=>({...r,loanNumber:""}))}finally{U(!1)}})())},[t.borrowerId]),m.useEffect(()=>{if(t.repaymentCycle==="custom")return;const a=ne.find(r=>r.value===t.repaymentCycle),n=Number(t.durationMonths||0);if(!a||n<=0)return;const l=n*(a.perMonth||1);i(r=>({...r,numberOfRepayments:String(l)}))},[t.repaymentCycle,t.durationMonths]);const z=a=>{const n=Math.random().toString(36).slice(2);i(l=>({...l,attachmentsMeta:[...l.attachmentsMeta,{type:a||"other",note:"",fileKey:n}]}))},ue=(a,n)=>{n?N.current[a]=n:delete N.current[a]},me=a=>i(n=>{const l=n.attachmentsMeta[a];return l!=null&&l.fileKey&&delete N.current[l.fileKey],{...n,attachmentsMeta:n.attachmentsMeta.filter((r,o)=>o!==a)}}),K=()=>t.attachmentsMeta.findIndex(a=>String(a.type||"").toLowerCase()==="spouse: consent declaration"),he=()=>i(a=>({...a,fees:[...a.fees,{name:"",amount:"",paid:!1,paymentMode:"schedule_equal"}]})),A=(a,n)=>i(l=>({...l,fees:l.fees.map((r,o)=>o===a?{...r,...n,...n.amount!==void 0?{amount:R(n.amount)}:{}}:r)})),pe=a=>i(n=>({...n,fees:n.fees.filter((l,r)=>r!==a)})),be=async a=>{var O,f,G,W,J,X,Z,Q,ee;if(a.preventDefault(),!t.borrowerId)return alert("Select a borrower");if(!t.productId)return alert("Select a loan product");const n=I(t.principal);if(!n||Number(n)<=0)return alert("Enter a principal amount");if(!t.durationMonths)return alert("Enter loan duration (months)");const l=S.find(u=>String(u.id)===String(t.productId)),r=Number((l==null?void 0:l.minPrincipal)??(l==null?void 0:l.minAmount)??0)||0,o=Number((l==null?void 0:l.maxPrincipal)??(l==null?void 0:l.maxAmount)??Number.POSITIVE_INFINITY)||Number.POSITIVE_INFINITY,c=Number(n);if(c<r)return alert(`Principal below minimum (${r.toLocaleString()}).`);if(c>o)return alert(`Principal above maximum (${o.toLocaleString()}).`);if(t.collateralType==="Other"&&!t.collateralOther.trim())return alert("Please specify the collateral for 'Other'.");if(t.disbursementMethod==="other"&&!t.disbursementOther.trim())return alert("Please specify the disbursement method for 'Other'.");if(t.disbursementMethod==="mobile_money"){if(!t.mobileProvider)return alert("Select a mobile money provider.");if(t.mobileProvider==="other"&&!t.mobileProviderOther.trim())return alert("Please specify the mobile money provider.");if(!t.mobilePhone.trim())return alert("Enter the mobile money phone number.");const u=t.mobilePhone.replace(/\D/g,"");if(u.length<9||u.length>15)return alert("Mobile money phone number looks invalid.")}if(t.maritalStatus==="married"){const u=K(),p=u>=0?t.attachmentsMeta[u]:null;if(!(p?!!N.current[p.fileKey]:!1))return alert("Please attach the spouse consent declaration (signed).")}H(!0);try{const u=t.collateralType==="Other"&&t.collateralOther.trim()?`Other: ${t.collateralOther.trim()}`:t.collateralType||null;let p=((O=t.disbursementReference)==null?void 0:O.trim())||"";t.disbursementMethod==="mobile_money"?p=[`Provider: ${t.mobileProvider==="other"?t.mobileProviderOther.trim():((f=re.find(M=>M.value===t.mobileProvider))==null?void 0:f.label)||t.mobileProvider}`,`Phone: ${t.mobilePhone.trim()}`,p?`Ref: ${p}`:null].filter(Boolean).join(" | "):t.disbursementMethod==="other"&&(p=[`Method: ${t.disbursementOther.trim()}`,(G=t.disbursementOtherDetails)!=null&&G.trim()?`Details: ${t.disbursementOtherDetails.trim()}`:null,p?`Ref: ${p}`:null].filter(Boolean).join(" | "));const B={productId:t.productId,borrowerId:t.borrowerId,loanNumber:t.loanNumber||null,amount:n,currency:"TZS",releaseDate:t.releaseDate||le(),durationMonths:String(t.durationMonths).trim(),collateralType:u,collateralAmount:I(t.collateralAmount)||null,interestMethod:t.interestMethod,interestRate:t.interestRate||null,interestAmount:I(t.interestAmount)||null,fees:t.fees.map(h=>({name:h.name||"",amount:I(h.amount)||"0",paid:!!h.paid,paymentMode:h.paymentMode||"schedule_equal"})),repaymentCycle:t.repaymentCycle,numberOfRepayments:String(t.numberOfRepayments||"").trim(),disbursementMethod:t.disbursementMethod,disbursementBankId:t.disbursementMethod==="bank"&&t.disbursementBankId||null,disbursementReference:p||null,spouse:t.maritalStatus==="married"?{name:t.spouseName||"",occupation:t.spouseOccupation||"",idNumber:t.spouseIdNumber||"",phone:t.spousePhone||""}:void 0,status:"pending",statusLabel:t.statusLabel,officerId:t.officerId||void 0,branchId:t.branchId||void 0};if(t.attachmentsMeta.map(h=>N.current[h.fileKey]).filter(Boolean).length===0){const h=await b.post("/loans",B);alert("Loan application submitted"),d(`/loans/${((W=h.data)==null?void 0:W.id)||""}`)}else{const h=new FormData;h.append("payload",JSON.stringify(B));for(const M of t.attachmentsMeta){const P=N.current[M.fileKey];P&&(h.append("files",P,P.name),h.append("filesMeta[]",JSON.stringify({type:M.type,note:M.note,name:P.name})))}const ae=await b.post("/loans",h,{headers:{"Content-Type":"multipart/form-data"}});alert("Loan application submitted"),d(`/loans/${((J=ae.data)==null?void 0:J.id)||""}`)}}catch(u){const p=((Z=(X=u==null?void 0:u.response)==null?void 0:X.data)==null?void 0:Z.message)||((ee=(Q=u==null?void 0:u.response)==null?void 0:Q.data)==null?void 0:ee.error)||(u==null?void 0:u.message)||"Failed to submit loan application";alert(p)}finally{H(!1)}},x=m.useMemo(()=>S.find(a=>String(a.id)===String(t.productId)),[S,t.productId]),xe=a=>{const n=S.find(l=>String(l.id)===String(a));i(l=>({...l,productId:a,interestMethod:(n==null?void 0:n.interestMethod)||l.interestMethod,interestRate:(n==null?void 0:n.interestRate)??""}))},ve=()=>{K()===-1&&z("Spouse: Consent declaration")};return e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Add Loan"}),e.jsx("p",{className:"text-sm",children:"Follow the steps below. Start by selecting a borrower, then continue down the page."})]}),e.jsx(w,{to:"/loans",className:s.link,children:"Back to Loans"})]}),e.jsxs("form",{onSubmit:be,className:"max-w-6xl mx-auto space-y-5 md:space-y-6",children:[e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(je,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"0) Assignment"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Loan Officer"}),e.jsxs("select",{className:s.input,value:t.officerId,onChange:a=>i({...t,officerId:a.target.value}),children:[e.jsxs("option",{value:"",children:["(Auto) Current user ",v!=null&&v.name?`— ${v.name}`:""]}),ie.map(a=>e.jsx("option",{value:a.id,children:a.name||a.email||`User #${a.id}`},a.id))]}),e.jsx("p",{className:s.note,children:"Defaults to the logged-in user if left blank."})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Branch"}),e.jsxs("select",{className:s.input,value:t.branchId,onChange:a=>i({...t,branchId:a.target.value}),children:[e.jsxs("option",{value:"",children:["(Auto) Your branch ",(Y=v==null?void 0:v.branch)!=null&&Y.name?`— ${v.branch.name}`:""]}),oe.map(a=>e.jsx("option",{value:a.id,children:a.name||a.code||`Branch #${a.id}`},a.id))]}),e.jsx("p",{className:s.note,children:"Defaults to the logged-in user’s branch if left blank."})]})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(se,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"1) Borrower & Product"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Borrower"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${s.input} flex-1`,value:t.borrowerId,onChange:a=>i({...t,borrowerId:a.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select borrower…"}),V.map(a=>e.jsxs("option",{value:a.id,children:[a.name," ",a.phone?`— ${a.phone}`:""]},a.id))]}),e.jsxs(w,{target:"_blank",to:"/borrowers/add",className:s.btn,children:[e.jsx(_,{className:"h-4 w-4"})," Add"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Loan Product"}),e.jsxs("select",{className:s.input,value:t.productId,onChange:a=>xe(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select product…"}),S.map(a=>e.jsxs("option",{value:a.id,children:[a.name,a.code?` (${a.code})`:""]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Loan # (auto)"}),e.jsx("input",{className:s.input,value:de?"…":t.loanNumber||"—",readOnly:!0})]}),e.jsx("div",{className:"hidden md:block"})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(Ne,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"2) Loan Terms"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Principal Amount"}),e.jsx("input",{type:"text",inputMode:"numeric",className:s.input,value:t.principal,onChange:a=>i({...t,principal:R(a.target.value)}),placeholder:"e.g. 1,000,000",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`${s.label} flex items-center gap-1`,children:[e.jsx(te,{className:"h-3.5 w-3.5"})," Loan Release Date"]}),e.jsx("input",{type:"date",className:s.input,value:t.releaseDate,onChange:a=>i({...t,releaseDate:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Collateral Type"}),e.jsxs("select",{className:s.input,value:t.collateralType,onChange:a=>i({...t,collateralType:a.target.value}),children:[e.jsx("option",{value:"",children:"Select…"}),_e.map(a=>e.jsx("option",{value:a,children:a},a))]}),t.collateralType==="Other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:s.input,placeholder:"Specify collateral",value:t.collateralOther,onChange:a=>i({...t,collateralOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Collateral Amount"}),e.jsx("input",{type:"text",inputMode:"numeric",className:s.input,value:t.collateralAmount,onChange:a=>i({...t,collateralAmount:R(a.target.value)}),placeholder:"e.g. 500,000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Loan Duration (months)"}),e.jsx("input",{type:"number",inputMode:"numeric",className:s.input,value:t.durationMonths,onChange:a=>i({...t,durationMonths:a.target.value}),required:!0})]})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(Ce,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"3) Interest"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:s.label,children:"Interest Method"}),e.jsx("select",{className:s.input,value:t.interestMethod,onChange:a=>i({...t,interestMethod:a.target.value}),children:Pe.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Interest Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",inputMode:"decimal",className:s.input,value:t.interestRate,onChange:a=>i({...t,interestRate:a.target.value}),placeholder:x!=null&&x.interestRate?String(x.interestRate):"e.g. 3",readOnly:(x==null?void 0:x.interestRate)!=null}),(x==null?void 0:x.interestRate)!=null&&e.jsx("p",{className:s.note,children:"Auto-picked from product."})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Interest Amount (optional)"}),e.jsx("input",{type:"text",inputMode:"numeric",className:s.input,value:t.interestAmount,onChange:a=>i({...t,interestAmount:R(a.target.value)}),placeholder:"e.g. 120,000"})]})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(te,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"4) Repayments"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Repayment Cycle"}),e.jsx("select",{className:s.input,value:t.repaymentCycle,onChange:a=>i({...t,repaymentCycle:a.target.value}),children:ne.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"# of Repayments"}),e.jsx("input",{type:"number",inputMode:"numeric",className:s.input,value:t.numberOfRepayments,onChange:a=>i({...t,numberOfRepayments:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Loan Status (label)"}),e.jsx("select",{className:s.input,value:t.statusLabel,onChange:a=>i({...t,statusLabel:a.target.value}),children:Be.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("p",{className:s.note,children:"DB status stays “pending” on create."})]})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"5) Loan Fees"})]}),e.jsxs("button",{type:"button",onClick:he,className:s.btn,children:[e.jsx(_,{className:"h-4 w-4"})," Add Fee"]})]}),t.fees.length===0?e.jsx("p",{className:"text-sm",children:"No fees added."}):e.jsxs("div",{className:s.listShell,children:[e.jsxs("div",{className:`${s.listHead} grid-cols-[2fr_1fr_1fr_1fr_40px]`,children:[e.jsx("div",{children:"Fee Name"}),e.jsx("div",{children:"Amount"}),e.jsx("div",{children:"Way of payment"}),e.jsx("div",{children:"Paid?"}),e.jsx("div",{className:"text-right pr-1",children:"—"})]}),e.jsx("div",{className:s.listBody,children:t.fees.map((a,n)=>e.jsxs("div",{className:`${s.rowShell} grid-cols-[2fr_1fr_1fr_1fr_40px]`,children:[e.jsx("input",{className:s.input,placeholder:"Fee name (e.g. Processing)",value:a.name,onChange:l=>A(n,{name:l.target.value})}),e.jsx("input",{type:"text",inputMode:"numeric",className:s.input,placeholder:"Amount",value:a.amount,onChange:l=>A(n,{amount:l.target.value})}),e.jsx("select",{className:s.input,value:a.paymentMode,onChange:l=>A(n,{paymentMode:l.target.value}),children:Oe.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsxs("select",{className:s.input,value:a.paid?"paid":"not_paid",onChange:l=>A(n,{paid:l.target.value==="paid"}),children:[e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"not_paid",children:"Not paid"})]}),e.jsx("button",{type:"button",onClick:()=>pe(n),className:s.btnIcon,"aria-label":"Remove fee",children:e.jsx(L,{className:"h-4 w-4"})})]},n))})]}),e.jsx("p",{className:"text-xs mt-2",children:"Unpaid fees will be handled according to the selected way of payment."})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"6) Guarantors"})]}),e.jsxs("button",{type:"button",onClick:()=>i(a=>({...a,guarantors:[...a.guarantors,{type:"existing",borrowerId:"",name:"",occupation:"",residence:"",contacts:"",verification:""}]})),className:s.btn,children:[e.jsx(_,{className:"h-4 w-4"})," Add Guarantor"]})]}),t.guarantors.length===0?e.jsx("p",{className:"text-sm",children:"No guarantors added."}):e.jsx("div",{className:"space-y-4",children:t.guarantors.map((a,n)=>e.jsxs("div",{className:"rounded-xl p-3 md:p-4 space-y-3 border-2 border-[var(--border-strong)] bg-[var(--card)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-bold",children:["Guarantor #",n+1]}),e.jsx("button",{type:"button",onClick:()=>i(l=>({...l,guarantors:l.guarantors.filter((r,o)=>o!==n)})),className:s.btnIcon,"aria-label":"Remove guarantor",children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Source"}),e.jsxs("select",{className:s.input,value:a.type,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,type:l.target.value}:o)})),children:[e.jsx("option",{value:"existing",children:"Select from borrowers"}),e.jsx("option",{value:"manual",children:"Enter manually"})]})]}),a.type==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Borrower"}),e.jsxs("select",{className:s.input,value:a.borrowerId||"",onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,borrowerId:l.target.value}:o)})),children:[e.jsx("option",{value:"",children:"Select borrower…"}),V.map(l=>e.jsxs("option",{value:l.id,children:[l.name," ",l.phone?`— ${l.phone}`:""]},l.id))]})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx("input",{className:s.input,placeholder:"Full name",value:a.name,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,name:l.target.value}:o)}))}),e.jsx("input",{className:s.input,placeholder:"Occupation",value:a.occupation,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,occupation:l.target.value}:o)}))}),e.jsx("input",{className:s.input,placeholder:"Residence",value:a.residence,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,residence:l.target.value}:o)}))}),e.jsx("input",{className:s.input,placeholder:"Contacts",value:a.contacts,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,contacts:l.target.value}:o)}))}),e.jsx("input",{className:s.input,placeholder:"Verification (ID #, etc.)",value:a.verification,onChange:l=>i(r=>({...r,guarantors:r.guarantors.map((o,c)=>c===n?{...o,verification:l.target.value}:o)}))})]})]})]},n))})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-5 border-b-2 border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"7) Attachments"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Borrower: Loan form","Borrower: Village introduction","Borrower: Fee receipt","Borrower: ID","Borrower: Business licence","Borrower: TIN","Borrower: Employment contract","Borrower: Salary slips","Borrower: Employer letter","Guarantor: ID","Guarantor: Village introduction","Spouse: Consent declaration","Other"].map(a=>e.jsxs("button",{type:"button",onClick:()=>z(a),className:`${s.btn} text-xs px-2 py-1`,children:["+ ",a.replace(/Borrower: |Guarantor: |Spouse: /g,"")]},a))})]}),t.attachmentsMeta.length===0?e.jsx("p",{className:"text-sm",children:"No files attached."}):e.jsxs("div",{className:s.listShell,children:[e.jsxs("div",{className:`${s.listHead} grid-cols-[2fr_1fr_40px]`,children:[e.jsx("div",{children:"Type & Note"}),e.jsx("div",{children:"File"}),e.jsx("div",{className:"text-right pr-1",children:"—"})]}),e.jsx("div",{className:s.listBody,children:t.attachmentsMeta.map((a,n)=>e.jsxs("div",{className:`${s.rowShell} grid-cols-[2fr_1fr_40px]`,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("input",{className:s.input,value:a.type,onChange:l=>i(r=>({...r,attachmentsMeta:r.attachmentsMeta.map((o,c)=>c===n?{...o,type:l.target.value}:o)}))}),e.jsx("input",{className:s.input,placeholder:"Note (optional)",value:a.note,onChange:l=>i(r=>({...r,attachmentsMeta:r.attachmentsMeta.map((o,c)=>c===n?{...o,note:l.target.value}:o)}))})]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",className:s.input,onChange:l=>{var r;return ue(a.fileKey,(r=l.target.files)==null?void 0:r[0])}}),e.jsx("button",{type:"button",onClick:()=>me(n),className:s.btnIcon,"aria-label":"Remove attachment",children:e.jsx(L,{className:"h-4 w-4"})})]},a.fileKey))})]}),e.jsx("p",{className:s.note,children:"Accepted images/PDFs as supported by your backend."})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(se,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"8) Disbursement"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Method"}),e.jsx("select",{className:s.input,value:t.disbursementMethod,onChange:a=>{const n=a.target.value;i({...t,disbursementMethod:n,disbursementBankId:"",mobileProvider:"",mobileProviderOther:"",mobilePhone:"",disbursementOther:"",disbursementOtherDetails:""})},children:Re.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Reference (optional)"}),e.jsx("input",{className:s.input,value:t.disbursementReference,onChange:a=>i({...t,disbursementReference:a.target.value}),placeholder:"Txn ref / slip #"})]}),t.disbursementMethod==="bank"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:s.label,children:"Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:`${s.input} flex-1`,value:t.disbursementBankId,onChange:a=>i({...t,disbursementBankId:a.target.value}),children:[e.jsx("option",{value:"",children:"Select bank…"}),D.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs(w,{to:"/banks/add",target:"_blank",className:s.btn,children:[e.jsx(_,{className:"h-4 w-4"})," Add"]}),e.jsx(w,{to:"/banks",target:"_blank",className:s.btn,children:"Manage"})]}),D.length===0&&e.jsx("p",{className:s.note,children:"No banks found. Use “Add” to register banks; this list is tenant-scoped via your API."})]}),t.disbursementMethod==="mobile_money"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Provider"}),e.jsxs("select",{className:s.input,value:t.mobileProvider,onChange:a=>i({...t,mobileProvider:a.target.value}),children:[e.jsx("option",{value:"",children:"Select provider…"}),re.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),t.mobileProvider==="other"&&e.jsx("div",{className:"mt-2",children:e.jsx("input",{className:s.input,placeholder:"Specify provider",value:t.mobileProviderOther,onChange:a=>i({...t,mobileProviderOther:a.target.value}),required:!0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Phone Number"}),e.jsx("input",{className:s.input,placeholder:"e.g. 07xxxxxxxx or +2557xxxxxxxx",value:t.mobilePhone,onChange:a=>i({...t,mobilePhone:a.target.value})})]})]}),t.disbursementMethod==="other"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Specify method"}),e.jsx("input",{className:s.input,placeholder:"e.g., cheque, voucher, petty cash",value:t.disbursementOther,onChange:a=>i({...t,disbursementOther:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Details (optional)"}),e.jsx("input",{className:s.input,placeholder:"Instructions / place of collection",value:t.disbursementOtherDetails,onChange:a=>i({...t,disbursementOtherDetails:a.target.value})})]})]})]})]}),e.jsxs("section",{className:s.card,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx(Se,{className:s.icon}),e.jsx("h2",{className:"font-bold text-lg",children:"9) Marital Status & Spouse"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s.label,children:"Marital Status"}),e.jsx("select",{className:s.input,value:t.maritalStatus,onChange:a=>i({...t,maritalStatus:a.target.value}),children:["single","married","divorced","widow","widower","not_specified"].map(a=>e.jsx("option",{value:a,children:a.replace("_"," ")},a))})]}),e.jsx("div",{className:"hidden md:block"}),t.maritalStatus==="married"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{className:s.input,placeholder:"Spouse Name",value:t.spouseName,onChange:a=>i({...t,spouseName:a.target.value})}),e.jsx("input",{className:s.input,placeholder:"Spouse Occupation",value:t.spouseOccupation,onChange:a=>i({...t,spouseOccupation:a.target.value})}),e.jsx("input",{className:s.input,placeholder:"Spouse ID Number",value:t.spouseIdNumber,onChange:a=>i({...t,spouseIdNumber:a.target.value})}),e.jsx("input",{className:s.input,placeholder:"Spouse Phone",value:t.spousePhone,onChange:a=>i({...t,spousePhone:a.target.value})}),e.jsxs("div",{className:"md:col-span-2 rounded-xl p-3 border-2 border-[var(--border-strong)] bg-[var(--card)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-bold",children:"Spouse Consent Declaration (signed)"}),e.jsx("button",{type:"button",onClick:ve,className:`${s.btn} text-xs px-2 py-1`,children:"+ Add consent upload"})]}),e.jsx("p",{className:s.note,children:"Upload the signed consent form here."})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 inset-x-0 z-20 backdrop-blur border-t-2 border-[var(--border)] bg-[var(--card)]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-3 flex justify-end gap-3",children:[e.jsx(w,{to:"/loans",className:s.btn,children:"Cancel"}),e.jsxs("button",{disabled:q,type:"submit",className:s.primary,children:[e.jsx(Me,{className:"h-4 w-4"}),q?"Submitting…":"Submit"]})]})})]})]})}export{Ke as default};
