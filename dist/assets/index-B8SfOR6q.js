import{f as E}from"./index-DYDSVKWX.js";const T={MODE:"production",VITE_API_BASE_URL:"https://mkoposuite-backend-42w2.onrender.com/api"},l=typeof import.meta<"u"&&T||{},A=String(l.VITE_API_BASE_URL||l.VITE_API_BASE||typeof window<"u"&&window.__API_BASE_URL__||""),N=A.replace(/\/+$/,""),O=typeof window<"u"?window.location.origin:"http://localhost:10000",R=N||O,h=R.replace(/\/+$/,""),w=/\/api$/i.test(h)?h:`${h}/api`,v=String(l.VITE_API_WITH_CREDENTIALS??"0")==="1",D=Number(l.VITE_API_TIMEOUT??3e4)||3e4,I=Number(l.VITE_API_RETRIES??0)||0,b=String(l.VITE_SEND_TZ_HEADERS??"1")!=="0",n=E.create({baseURL:w,withCredentials:v,timeout:D,headers:{Accept:"application/json"}}),y=["access_token","accessToken","token","authToken","jwt"],P=/\/api$/i.test(w);function i(t){if(!t)return"/";if(/^https?:\/\//i.test(t))return t;let e=String(t).trim();return e.startsWith("/")||(e=`/${e}`),P&&e.startsWith("/api/")&&(e=e.slice(4)),e=e.replace(/\/{2,}/g,"/"),e}function C(t){const a=i(t).replace(/^\/api\//,"/"),c=a.startsWith("/api/")?a:`/api${a}`;return Array.from(new Set([a,c]))}function k(t){return typeof FormData<"u"&&t instanceof FormData}function $(){var t;try{if((t=globalThis==null?void 0:globalThis.crypto)!=null&&t.randomUUID)return crypto.randomUUID()}catch{}return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}let p=null;n.interceptors.request.use(t=>{var u,d,r;t.url&&!/^https?:\/\//i.test(t.url)&&(t.url=i(t.url));let e=null;for(const o of y){const s=typeof localStorage<"u"?localStorage.getItem(o):null;if(s){e=String(s).replace(/^Bearer\s+/i,"");break}}e&&(t.headers.Authorization=`Bearer ${e}`);try{if(typeof window<"u"&&!p){const s=new URL(window.location.href).searchParams.get("tenantId");s&&(p=s)}}catch{}let a=p||typeof localStorage<"u"&&(localStorage.getItem("activeTenantId")||localStorage.getItem("x-tenant-id"));if(!a&&typeof localStorage<"u")try{const o=JSON.parse(localStorage.getItem("user")||"{}");a=(o==null?void 0:o.tenantId)||((u=o==null?void 0:o.tenant)==null?void 0:u.id)||(o==null?void 0:o.orgId)||(o==null?void 0:o.companyId)||null}catch{}a&&(t.headers["x-tenant-id"]=a);const c=typeof localStorage<"u"?localStorage.getItem("activeBranchId"):null;if(c&&(t.headers["x-branch-id"]=c),b){try{const o=Intl.DateTimeFormat().resolvedOptions().timeZone;o&&(t.headers["x-timezone"]=o)}catch{}try{t.headers["x-tz-offset"]=String(new Date().getTimezoneOffset())}catch{}}return k(t.data)?t.headers&&"Content-Type"in t.headers&&delete t.headers["Content-Type"]:((d=t.headers)["x-request-id"]||(d["x-request-id"]=$()),(r=t.headers)["Content-Type"]||(r["Content-Type"]="application/json")),t});let S=!1;n.interceptors.response.use(t=>t,async t=>{var d,r,o,s,_;const e=(d=t==null?void 0:t.response)==null?void 0:d.status,a=(t==null?void 0:t.config)||{};if(t.normalizedMessage=e?((o=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:o.error)||((_=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:_.message)||(t==null?void 0:t.message)||`Request failed (${e})`:(t==null?void 0:t.message)==="Network Error"?"Network error: server unreachable.":(t==null?void 0:t.code)==="ECONNABORTED"?"Request timeout. Please try again.":(t==null?void 0:t.message)||"Request failed.",e===401){try{[...y,"user","tenant","tenantId","tenantName","activeTenantId","activeBranchId"].forEach(m=>{try{typeof localStorage<"u"&&localStorage.removeItem(m),typeof sessionStorage<"u"&&sessionStorage.removeItem(m)}catch{}}),delete n.defaults.headers.common.Authorization,delete n.defaults.headers.common["x-tenant-id"],delete n.defaults.headers.common["x-branch-id"]}catch{}return!S&&typeof window<"u"&&(S=!0,/\/login$/.test(window.location.pathname)||window.location.replace("/login")),Promise.reject(t)}const c=e&&[429,502,503,504].includes(e),u=(a.method||"get").toLowerCase()==="get";if(a.__retryCount=a.__retryCount||0,I>0&&u&&c&&a.__retryCount<I){a.__retryCount+=1;const m=Math.min(1e3*2**(a.__retryCount-1),4e3);return await new Promise(g=>setTimeout(g,m)),n.request(a)}return l.MODE!=="production"&&console.error("API error:",t.normalizedMessage,(t==null?void 0:t.response)||t),Promise.reject(t)});n.getJSON=async(t,e)=>(await n.get(i(t),e)).data;n.postJSON=async(t,e,a)=>(await n.post(i(t),e,a)).data;n.putJSON=async(t,e,a)=>(await n.put(i(t),e,a)).data;n.patchJSON=async(t,e,a)=>(await n.patch(i(t),e,a)).data;n.deleteJSON=async(t,e)=>(await n.delete(i(t),e)).data;async function f(t,e,a,c){const u=Array.isArray(e)?e:[e],d=Array.from(new Set(u.flatMap(o=>C(o))));let r;for(const o of d)try{const s=i(o);return(t==="get"||t==="delete"?await n[t](s,c):await n[t](s,a,c)).data}catch(s){r=s}throw r||new Error("No endpoint succeeded")}n.getFirst=(t,e)=>f("get",t,void 0,e);n.postFirst=(t,e,a)=>f("post",t,e,a);n.putFirst=(t,e,a)=>f("put",t,e,a);n.patchFirst=(t,e,a)=>f("patch",t,e,a);n.deleteFirst=(t,e)=>f("delete",t,void 0,e);n.setTenantId=t=>{p=t||null};n.clearTenantId=()=>{p=null};n.getTenantId=()=>p||(typeof localStorage<"u"?localStorage.getItem("activeTenantId"):null)||null;n.path=i;n.withAbort=()=>{const t=new AbortController;return{signal:t.signal,cancel:()=>t.abort()}};["get","post","put","patch","delete"].forEach(t=>{n[`_${t}`]=(e,...a)=>n[t](i(e),...a)});export{n as a};
