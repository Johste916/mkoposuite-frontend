import{r as d,j as e,b as k}from"./index-BjuKJokO.js";function _(){const[y,c]=d.useState(null),[f,j]=d.useState(null),[h,w]=d.useState(null),[v,E]=d.useState([]),[b,m]=d.useState("loading"),[C,g]=d.useState("");async function u(t,s){var x;for(const a of t)try{const n=await k.get(a,s);if((n==null?void 0:n.data)!==void 0)return n.data}catch(n){if(((x=n==null?void 0:n.response)==null?void 0:x.status)!==404)throw n}const i=new Error("Not Found");throw i.code=404,i}function S(t=[]){const s=i=>t.includes(i);return{savings:s("savings.view"),loans:s("loans.view"),collections:s("collections.view"),accounting:s("accounting.view"),sms:s("sms.send")||s("sms.view"),esignatures:s("esign.view")||s("esignatures.view"),payroll:s("payroll.view"),investors:s("investors.view"),assets:s("assets.view"),collateral:s("collateral.view"),reports:s("reports.view")}}const p=async()=>{var t,s,i,x;m("loading"),g("");try{const a=await u(["/tenants/me","/tenant/me","/account/tenant","/account/organization"],{});c(a);const n=await u(["/tenants/me/entitlements","/tenant/me/entitlements","/account/tenant/entitlements","/account/organization/entitlements","/org/entitlements"],{}).catch(()=>({}));j(n||{});const r=await u(["/tenants/me/limits","/tenant/me/limits","/account/tenant/limits","/account/organization/limits","/org/limits"],{}).catch(()=>({})),D=r&&typeof r=="object"&&r.limits?r.limits:r||{};w(D||{}),!(n&&n.modules&&Object.keys(n.modules).length>0)&&Array.isArray(r==null?void 0:r.entitlements)&&j({modules:S(r.entitlements),planCode:(((t=r==null?void 0:r.plan)==null?void 0:t.code)||((s=r==null?void 0:r.plan)==null?void 0:s.name)||(a==null?void 0:a.planCode)||"basic").toString().toLowerCase(),status:(a==null?void 0:a.status)||"trial"});const o=await u(["/tenants/me/invoices","/tenant/me/invoices","/account/tenant/invoices","/account/organization/invoices","/org/invoices"],{}).catch(()=>[]),O=Array.isArray(o)?o:Array.isArray(o==null?void 0:o.invoices)?o.invoices:[];E(O),m("ready")}catch(a){(a==null?void 0:a.code)===404?m("unavailable"):(m("error"),g(((x=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:x.error)||a.message||"Unknown error"))}};if(d.useEffect(()=>{p()},[]),b==="loading")return e.jsx("div",{className:"p-4 text-sm text-slate-500 dark:text-slate-400",children:"Loading…"});if(b==="unavailable")return e.jsxs("div",{className:"ms-card p-4 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Organization"}),e.jsx("div",{className:"rounded border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40 p-3",children:e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:["Organization settings aren’t available on this server (the ",e.jsx("code",{children:"/tenants/me"})," API is not implemented). If you don’t need this module you can ignore this page."]})})]});if(b==="error")return e.jsxs("div",{className:"p-4 text-sm text-rose-600 dark:text-rose-400",children:["Error: ",C,e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:p,className:"h-9 px-3 rounded ms-btn",children:"Retry"})})]});const l=y||{},N=f||{},A=async()=>{var t,s;try{await k.patch("/tenants/me",{planCode:l.planCode,trialEndsAt:l.trialEndsAt,autoDisableOverdue:l.autoDisableOverdue,graceDays:l.graceDays,billingEmail:l.billingEmail}),await p()}catch(i){m("error"),g(((s=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:s.error)||i.message||"Save failed")}};return e.jsxs("div",{className:"ms-card p-4 space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Plan"}),e.jsxs("select",{value:l.planCode||"basic",onChange:t=>c({...l,planCode:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Trial ends"}),e.jsx("input",{type:"date",value:l.trialEndsAt||"",onChange:t=>c({...l,trialEndsAt:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!l.autoDisableOverdue,onChange:t=>c({...l,autoDisableOverdue:t.target.checked}),className:"h-4 w-4"}),e.jsx("span",{children:"Auto suspend overdue"})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Grace days"}),e.jsx("input",{type:"number",value:l.graceDays??7,onChange:t=>c({...l,graceDays:Number(t.target.value||0)}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",min:0,max:90})]}),e.jsxs("label",{className:"md:col-span-2",children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Billing email"}),e.jsx("input",{type:"email",value:l.billingEmail||"",onChange:t=>c({...l,billingEmail:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:A,className:"h-9 px-3 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:p,className:"h-9 px-3 rounded ms-btn",children:"Refresh"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Entitlements"}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(N.modules||{}).length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No entitlements available."}):Object.entries(N.modules||{}).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300"}`,children:s?"enabled":"disabled"})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Limits"}),!h||Object.keys(h).length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No limits configured."}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(h).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 dark:text-slate-200",children:s===null?"Unlimited":String(s)})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Invoices"}),v.length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No invoices yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4",children:"Number"}),e.jsx("th",{className:"py-2 pr-4",children:"Amount"}),e.jsx("th",{className:"py-2 pr-4",children:"Due date"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"})]})}),e.jsx("tbody",{className:"align-top",children:v.map(t=>e.jsxs("tr",{className:"border-top border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"py-2 pr-4",children:t.number||t.id}),e.jsx("td",{className:"py-2 pr-4",children:Number((t.amount_cents??t.amountCents??0)/100).toLocaleString(void 0,{style:"currency",currency:t.currency||"USD"})}),e.jsx("td",{className:"py-2 pr-4",children:t.due_date||t.dueDate?String(t.due_date||t.dueDate).slice(0,10):"-"}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${(t.status||"open")==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":(t.status||"open")==="past_due"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300"}`,children:t.status||"open"})})]},t.id))})]})})]})]})}export{_ as default};
