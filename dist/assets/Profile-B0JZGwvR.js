import{r as p,b,j as e,L as H}from"./index-CakYFgIn.js";const te=["Africa/Nairobi","Africa/Dar_es_Salaam","Africa/Kampala","Africa/Addis_Ababa","Africa/Kigali","UTC"],ne=["en","sw","fr"];function ie(){var T,I,z,E,L,B,U,O,_,K,Z,G,J,W,$;const[r,v]=p.useState(null),[o,S]=p.useState([]),[l,n]=p.useState({displayName:"",name:"",phone:"",branchId:"",timezone:"Africa/Nairobi",locale:"en",title:"",department:"",employeeCode:""}),[c,g]=p.useState({landingPage:"/dashboard",defaultCurrency:"TZS",dateFormat:"DD/MM/YYYY",numberFormat:"1,234.56",theme:"system",fontScale:"normal",reduceMotion:!1,colorBlindMode:!1}),[d,m]=p.useState({channels:{inApp:!0,email:!0,sms:!1},events:{loanAssigned:!0,approvalNeeded:!0,largeRepayment:{enabled:!0,threshold:5e5},arrearsDigest:{enabled:!0,days:7,hour:18},kycAssigned:!0}}),[re,P]=p.useState([]),[w,j]=p.useState(!1),F=p.useMemo(()=>{var a;return((a=r==null?void 0:r.user)==null?void 0:a.avatarUrl)||""},[r]);p.useEffect(()=>{const a=new AbortController;return(async()=>{var s,t,f;try{const[i,D,Y,le,M]=await Promise.all([b.get("/account/me",{signal:a.signal}),b.get("/account/preferences",{signal:a.signal}),b.get("/account/notifications",{signal:a.signal}),b.get("/account/security/sessions",{signal:a.signal}),b.get("/branches",{signal:a.signal}).catch(()=>({data:[]}))]);v(i.data);const u=((s=i.data)==null?void 0:s.user)||{};n(C=>({...C,displayName:u.displayName||u.name||"",name:u.name||"",phone:u.phone||"",branchId:u.branchId||"",timezone:u.timezone||C.timezone,locale:u.locale||C.locale,title:u.title||"",department:u.department||"",employeeCode:u.employeeCode||""})),g(C=>{var k;return{...C,...((k=D.data)==null?void 0:k.preferences)||{}}}),m(C=>{var k;return{...C,...((k=Y.data)==null?void 0:k.notifications)||{}}}),P(((t=le.data)==null?void 0:t.sessions)||[]),S(Array.isArray(M.data)?M.data:((f=M.data)==null?void 0:f.items)||[])}catch(i){console.error("Failed to load profile:",(i==null?void 0:i.message)||i)}})(),()=>a.abort()},[]);const q=async()=>{var a;j(!0);try{const s={displayName:l.displayName,name:l.name,phone:l.phone,timezone:l.timezone,locale:l.locale,branchId:l.branchId||null,title:l.title,department:l.department,employeeCode:l.employeeCode},t=await b.put("/account/me",s);v({user:((a=t.data)==null?void 0:a.user)||{}}),h("Saved profile")}catch{h("Failed to save profile","error")}finally{j(!1)}},Q=async()=>{j(!0);try{await b.put("/account/preferences",c),h("Saved preferences")}catch{h("Failed to save preferences","error")}finally{j(!1)}},V=async()=>{j(!0);try{await b.put("/account/notifications",d),h("Saved notifications")}catch{h("Failed to save notifications","error")}finally{j(!1)}},X=async()=>{j(!0);try{await b.post("/account/security/sessions/revoke-all"),P([]),h("Signed out from other devices")}catch{h("Failed to revoke sessions","error")}finally{j(!1)}},ee=async a=>{var f;const s=(f=a.target.files)==null?void 0:f[0];if(!s)return;if(s.size>2*1024*1024){h("Image too large (max 2MB)","error");return}const t=new FormData;t.append("avatar",s);try{const i=await b.post("/account/avatar",t,{headers:{"Content-Type":"multipart/form-data"}});v(D=>{var Y;return{...D||{},user:{...(D==null?void 0:D.user)||{},avatarUrl:((Y=i.data)==null?void 0:Y.avatarUrl)||""}}}),h("Avatar updated")}catch{h("Failed to upload avatar","error")}finally{a.target.value=""}},[ae,R]=p.useState([]);function h(a,s="ok"){const t=Math.random().toString(36).slice(2);R(f=>[...f,{id:t,msg:a,type:s}]),setTimeout(()=>R(f=>f.filter(i=>i.id!==t)),2500)}const A=(r==null?void 0:r.user)||{},se=(A.displayName||A.name||"S").split(" ").map(a=>a[0]).join("").slice(0,2).toUpperCase();return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:ae.map(a=>e.jsx("div",{className:`px-3 py-2 rounded shadow text-sm text-white ${a.type==="error"?"bg-rose-600":"bg-emerald-600"}`,children:a.msg},a.id))}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Identity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(x,{label:"Display name",value:l.displayName,onChange:a=>n(s=>({...s,displayName:a}))}),e.jsx(x,{label:"Full name",value:l.name,onChange:a=>n(s=>({...s,name:a}))}),e.jsx(x,{label:"Email",value:A.email||"",readOnly:!0,helper:"Email is managed by your admin."}),e.jsx(x,{label:"Phone",value:l.phone,onChange:a=>n(s=>({...s,phone:a})),placeholder:"+2547…"}),e.jsx(N,{label:"Default branch",value:String(l.branchId||""),onChange:a=>n(s=>({...s,branchId:a||""})),options:[{value:"",label:"—"},...o.map(a=>({value:String(a.id),label:a.name}))]}),e.jsx(N,{label:"Time zone",value:l.timezone,onChange:a=>n(s=>({...s,timezone:a})),options:te.map(a=>({value:a,label:a}))}),e.jsx(N,{label:"Locale",value:l.locale,onChange:a=>n(s=>({...s,locale:a})),options:ne.map(a=>({value:a,label:a}))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Professional"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(x,{label:"Job title",value:l.title,onChange:a=>n(s=>({...s,title:a}))}),e.jsx(x,{label:"Department",value:l.department,onChange:a=>n(s=>({...s,department:a}))}),e.jsx(x,{label:"Employee ID",value:l.employeeCode,onChange:a=>n(s=>({...s,employeeCode:a}))})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2",children:e.jsx("button",{onClick:q,disabled:w,className:"px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-60",children:w?"Saving…":"Save Changes"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(N,{label:"Default landing page",value:c.landingPage,onChange:a=>g(s=>({...s,landingPage:a})),options:[{value:"/dashboard",label:"Dashboard"},{value:"/loans",label:"Loans"},{value:"/borrowers",label:"Borrowers"},{value:"/collections",label:"Collections"}]}),e.jsx(N,{label:"Default currency",value:c.defaultCurrency,onChange:a=>g(s=>({...s,defaultCurrency:a})),options:[{value:"TZS",label:"TZS"},{value:"USD",label:"USD"},{value:"KES",label:"KES"}]}),e.jsx(N,{label:"Date format",value:c.dateFormat,onChange:a=>g(s=>({...s,dateFormat:a})),options:[{value:"DD/MM/YYYY",label:"DD/MM/YYYY"},{value:"YYYY-MM-DD",label:"YYYY-MM-DD"},{value:"MM/DD/YYYY",label:"MM/DD/YYYY"}]}),e.jsx(N,{label:"Theme",value:c.theme,onChange:a=>g(s=>({...s,theme:a})),options:[{value:"system",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]}),e.jsx(N,{label:"Font size",value:c.fontScale,onChange:a=>g(s=>({...s,fontScale:a})),options:[{value:"small",label:"Small"},{value:"normal",label:"Normal"},{value:"large",label:"Large"}]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(y,{label:"Color-blind friendly palette",checked:!!c.colorBlindMode,onChange:a=>g(s=>({...s,colorBlindMode:a}))}),e.jsx(y,{label:"Reduced motion",checked:!!c.reduceMotion,onChange:a=>g(s=>({...s,reduceMotion:a}))})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:Q,disabled:w,className:"px-3 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-900 disabled:opacity-60",children:w?"Saving…":"Save Preferences"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Notifications"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(y,{label:"In-app",checked:!!((T=d.channels)!=null&&T.inApp),onChange:a=>m(s=>({...s,channels:{...s.channels,inApp:a}}))}),e.jsx(y,{label:"Email",checked:!!((I=d.channels)!=null&&I.email),onChange:a=>m(s=>({...s,channels:{...s.channels,email:a}}))}),e.jsx(y,{label:"SMS/WhatsApp",checked:!!((z=d.channels)!=null&&z.sms),onChange:a=>m(s=>({...s,channels:{...s.channels,sms:a}}))})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(y,{label:"New loan assigned to me",checked:!!((E=d.events)!=null&&E.loanAssigned),onChange:a=>m(s=>({...s,events:{...s.events,loanAssigned:a}}))}),e.jsx(y,{label:"Approval needed (maker-checker)",checked:!!((L=d.events)!=null&&L.approvalNeeded),onChange:a=>m(s=>({...s,events:{...s.events,approvalNeeded:a}}))})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx(y,{label:"Large repayment",checked:!!((U=(B=d.events)==null?void 0:B.largeRepayment)!=null&&U.enabled),onChange:a=>m(s=>{var t;return{...s,events:{...s.events,largeRepayment:{...((t=s.events)==null?void 0:t.largeRepayment)||{},enabled:a}}}})}),e.jsx("div",{className:"mt-2",children:e.jsx(x,{label:"Threshold",type:"number",value:String(((_=(O=d.events)==null?void 0:O.largeRepayment)==null?void 0:_.threshold)??5e5),onChange:a=>m(s=>{var t;return{...s,events:{...s.events,largeRepayment:{...((t=s.events)==null?void 0:t.largeRepayment)||{},threshold:Number(a||0)}}}})})})]}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx(y,{label:"Arrears digest",checked:!!((Z=(K=d.events)==null?void 0:K.arrearsDigest)!=null&&Z.enabled),onChange:a=>m(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},enabled:a}}}})}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsx(x,{label:"Days",type:"number",value:String(((J=(G=d.events)==null?void 0:G.arrearsDigest)==null?void 0:J.days)??7),onChange:a=>m(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},days:Number(a||0)}}}})}),e.jsx(x,{label:"Hour (24h)",type:"number",value:String((($=(W=d.events)==null?void 0:W.arrearsDigest)==null?void 0:$.hour)??18),onChange:a=>m(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},hour:Number(a||0)}}}})})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:V,disabled:w,className:"px-3 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-900 disabled:opacity-60",children:w?"Saving…":"Save Notifications"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Security"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(H,{to:"/2fa",className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Manage Two-Factor"}),e.jsx(H,{to:"/change-password",className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Change Password"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Active sessions"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Only this device is active."}),e.jsx("button",{onClick:X,className:"px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700",children:"Sign out of other devices"})]})]})]}),e.jsxs("aside",{className:"bg-white border rounded-2xl p-4 h-fit shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Avatar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[F?e.jsx("img",{src:F,alt:"Avatar",className:"w-14 h-14 rounded-full object-cover border"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-600 text-white flex items-center justify-center text-lg font-semibold",children:se}),e.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:ee}),"Choose image"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"PNG/JPG/WEBP up to 2MB."})]})]})]})}function x({label:r,value:v,onChange:o,type:S="text",placeholder:l="",readOnly:n=!1,helper:c=""}){return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-slate-600",children:r}),e.jsx("input",{className:`mt-1 w-full border rounded-lg px-3 py-2 outline-none ${n?"bg-gray-50":"focus:ring-2 focus:ring-indigo-200"}`,type:S,value:v??"",placeholder:l,onChange:g=>o==null?void 0:o(g.target.value),readOnly:n}),c&&e.jsx("span",{className:"block mt-1 text-[11px] text-slate-500",children:c})]})}function N({label:r,value:v,onChange:o,options:S}){return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-slate-600",children:r}),e.jsx("select",{className:"mt-1 w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-200",value:v??"",onChange:l=>o==null?void 0:o(l.target.value),children:S.map((l,n)=>e.jsx("option",{value:l.value,children:l.label},n))})]})}function y({label:r,checked:v,onChange:o}){return e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!v,onChange:S=>o==null?void 0:o(S.target.checked)}),e.jsx("span",{children:r})]})}export{ie as default};
