import{r,j as e}from"./index-DX7Us0v_.js";import{S as o}from"./settings-CLFHPjR4.js";import"./index-CvoA56ja.js";const N=[{value:"inapp",label:"In-app"},{value:"email",label:"Email"},{value:"sms",label:"SMS"}];function y(){const[m,x]=r.useState([]),[h,n]=r.useState(""),[p,u]=r.useState(!1),[i,c]=r.useState({title:"",text:"",channel:"inapp"});async function d(){var t,s,l;n("");try{const a=await o.listComms();x(Array.isArray(a)?a:a?[a]:[])}catch(a){console.warn("Failed to list communications, treating as empty.",(t=a==null?void 0:a.response)==null?void 0:t.status,(s=a==null?void 0:a.response)==null?void 0:s.data),x([]),((l=a==null?void 0:a.response)==null?void 0:l.status)===401&&n("You are not authorized. Please sign in again.")}}r.useEffect(()=>{d()},[]);async function b(){var t,s;if(n(""),!i.title.trim()||!i.text.trim()){n("title and text are required");return}u(!0);try{await o.createComm({title:i.title.trim(),text:i.text.trim(),channel:i.channel}),c({title:"",text:"",channel:i.channel}),await d()}catch(l){n(((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.error)||l.message||"Failed to create communication")}finally{u(!1)}}async function j(t){var s,l;if(confirm("Delete this communication?")){n("");try{await o.deleteComm(t),await d()}catch(a){n(((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.error)||a.message||"Delete failed")}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Communications"}),h&&e.jsx("div",{className:"text-sm text-rose-600",children:h}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Title"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:i.title,onChange:t=>c(s=>({...s,title:t.target.value})),placeholder:"Important Notice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Channel"}),e.jsx("select",{className:"w-full border rounded px-2 py-1 text-sm",value:i.channel,onChange:t=>c(s=>({...s,channel:t.target.value})),children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs mb-1",children:"Body"}),e.jsx("textarea",{className:"w-full min-h-[120px] border rounded px-2 py-1 text-sm",value:i.text,onChange:t=>c(s=>({...s,text:t.target.value})),placeholder:"REMINDER: Submit weekly PAR review by Friday 4:00 PM."})]}),e.jsx("div",{children:e.jsx("button",{onClick:b,disabled:p,className:"px-3 py-2 border rounded bg-white disabled:opacity-60",children:p?"Savingâ€¦":"Add"})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Title"}),e.jsx("th",{className:"p-2 text-left",children:"Channel"}),e.jsx("th",{className:"p-2 text-left",children:"Preview"}),e.jsx("th",{className:"p-2"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-slate-500",colSpan:4,children:"No communications"})}):m.map(t=>e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"p-2",children:t.title}),e.jsx("td",{className:"p-2",children:t.channel||"inapp"}),e.jsx("td",{className:"p-2 max-w-[480px]",children:e.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap",children:t.text||t.body||""})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>j(t.id||t._id),children:"Delete"})})]},t.id||t._id||t.title))})]})})]})}export{y as default};
