import{f as S}from"./index-CF8R0B4H.js";const m={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://mkoposuite-backend-42w2.onrender.com/api"};var f={};const A=typeof import.meta<"u"&&m&&"https://mkoposuite-backend-42w2.onrender.com/api"||"",T=typeof globalThis<"u"&&globalThis.process&&f&&(f.REACT_APP_API_BASE_URL||f.REACT_APP_API_URL)||"",E=typeof window<"u"&&window.location&&window.location.origin||"http://localhost:10000",_=String(A||T||E).replace(/\/+$/,""),y=/\/api$/i.test(_)?_:`${_}/api`,b=String(typeof import.meta<"u"&&m&&void 0)==="1",k=Number(typeof import.meta<"u"&&m&&void 0)||3e4,w=Number(typeof import.meta<"u"&&m&&void 0)||0,a=S.create({baseURL:y,withCredentials:b,timeout:k,headers:{Accept:"application/json"}}),N=/\/api$/i.test(y);function i(t){if(!t)return"/";if(/^https?:\/\//i.test(t))return t;let e=String(t).trim();return e.startsWith("/")||(e=`/${e}`),N&&e.startsWith("/api/")&&(e=e.slice(4)),e.replace(/\/{2,}/g,"/")}function R(t){const n=i(t).replace(/^\/api\//,"/"),r=n.startsWith("/api/")?n:`/api${n}`;return Array.from(new Set([n,r]))}function v(t){return typeof FormData<"u"&&t instanceof FormData}function C(){var t;try{if((t=globalThis==null?void 0:globalThis.crypto)!=null&&t.randomUUID)return crypto.randomUUID()}catch{}return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}let g=null;a.interceptors.request.use(t=>{var l,c;t.url&&!/^https?:\/\//i.test(t.url)&&(t.url=i(t.url));const e=localStorage.getItem("token")||localStorage.getItem("jwt")||localStorage.getItem("access_token")||localStorage.getItem("authToken")||localStorage.getItem("accessToken");e&&(t.headers.Authorization=`Bearer ${String(e).replace(/^Bearer\s+/i,"")}`);const n=g||localStorage.getItem("activeTenantId")||(()=>{var s;try{const o=JSON.parse(localStorage.getItem("user")||"{}");return(o==null?void 0:o.tenantId)||((s=o==null?void 0:o.tenant)==null?void 0:s.id)||(o==null?void 0:o.orgId)||(o==null?void 0:o.companyId)||null}catch{return null}})()||localStorage.getItem("tenantId")||localStorage.getItem("x-tenant-id");n&&(t.headers["x-tenant-id"]=n);const r=localStorage.getItem("activeBranchId");r&&(t.headers["x-branch-id"]=r);try{const s=Intl.DateTimeFormat().resolvedOptions().timeZone;s&&(t.headers["x-timezone"]=s)}catch{}try{t.headers["x-tz-offset"]=String(new Date().getTimezoneOffset())}catch{}return v(t.data)?t.headers&&"Content-Type"in t.headers&&delete t.headers["Content-Type"]:((l=t.headers)["x-request-id"]||(l["x-request-id"]=C()),(c=t.headers)["Content-Type"]||(c["Content-Type"]="application/json")),t});a.interceptors.response.use(t=>t,async t=>{var c,s,o,d,h;const e=(c=t==null?void 0:t.response)==null?void 0:c.status,n=(t==null?void 0:t.config)||{};if(t.normalizedMessage=e?((o=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:o.error)||((h=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:h.message)||(t==null?void 0:t.message)||`Request failed (${e})`:(t==null?void 0:t.message)==="Network Error"?"Network error: server unreachable.":(t==null?void 0:t.code)==="ECONNABORTED"?"Request timeout. Please try again.":(t==null?void 0:t.message)||"Request failed.",e===401){try{["token","jwt","authToken","accessToken","access_token","user","tenant","tenantId","tenantName","activeBranchId"].forEach(u=>{try{localStorage.removeItem(u),sessionStorage.removeItem(u)}catch{}}),delete a.defaults.headers.common.Authorization,delete a.defaults.headers.common["x-tenant-id"],delete a.defaults.headers.common["x-branch-id"]}catch{}return typeof window<"u"&&!window.location.pathname.includes("/login")&&window.location.replace("/login"),Promise.reject(t)}const r=e&&[429,502,503,504].includes(e),l=(n.method||"get").toLowerCase()==="get";if(n.__retryCount=n.__retryCount||0,w>0&&l&&r&&n.__retryCount<w){n.__retryCount+=1;const u=Math.min(1e3*2**(n.__retryCount-1),4e3);return await new Promise(I=>setTimeout(I,u)),a.request(n)}return Promise.reject(t)});a.getJSON=async(t,e)=>(await a.get(i(t),e)).data;a.postJSON=async(t,e,n)=>(await a.post(i(t),e,n)).data;a.putJSON=async(t,e,n)=>(await a.put(i(t),e,n)).data;a.patchJSON=async(t,e,n)=>(await a.patch(i(t),e,n)).data;a.deleteJSON=async(t,e)=>(await a.delete(i(t),e)).data;async function p(t,e,n,r){const l=Array.isArray(e)?e:[e],c=Array.from(new Set(l.flatMap(o=>R(o))));let s;for(const o of c)try{const d=i(o);return(t==="get"||t==="delete"?await a[t](d,r):await a[t](d,n,r)).data}catch(d){s=d}throw s||new Error("No endpoint succeeded")}a.getFirst=a.getFirst||((t,e)=>p("get",t,void 0,e));a.postFirst=a.postFirst||((t,e,n)=>p("post",t,e,n));a.putFirst=a.putFirst||((t,e,n)=>p("put",t,e,n));a.patchFirst=a.patchFirst||((t,e,n)=>p("patch",t,e,n));a.deleteFirst=a.deleteFirst||((t,e)=>p("delete",t,void 0,e));a.setTenantId=t=>{g=t||null};a.clearTenantId=()=>{g=null};a.path=i;a.withAbort=()=>{const t=new AbortController;return{signal:t.signal,cancel:()=>t.abort()}};["get","post","put","patch","delete"].forEach(t=>{a[`_${t}`]=(e,...n)=>a[t](i(e),...n)});export{a};
