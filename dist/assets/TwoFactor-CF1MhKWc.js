import{r as l,j as t,h as v}from"./index-DFzTBWzb.js";async function A(o){for(const c of o)try{const{data:a}=await v.get(c);return a}catch{}throw new Error("All GET endpoints failed")}async function h(o,c){for(const a of o)try{const{data:i}=await v.post(a,c);return i}catch{}throw new Error("All POST endpoints failed")}function U(){const[o,c]=l.useState(!0),[a,i]=l.useState(!1),[m,p]=l.useState(""),[f,b]=l.useState(""),[d,g]=l.useState(""),[u,x]=l.useState(""),[y,r]=l.useState(""),j=["/auth/2fa/status","/account/2fa/status","/2fa/status"],k=["/auth/2fa/setup","/account/2fa/setup","/2fa/setup"],N=["/auth/2fa/verify","/account/2fa/verify","/2fa/verify"],w=["/auth/2fa/disable","/account/2fa/disable","/2fa/disable"],E=async()=>{c(!0),r("");try{const s=await A(j);i(!!(s!=null&&s.enabled))}catch{r("Failed to load 2FA status")}finally{c(!1)}};l.useEffect(()=>{E()},[]);const S=async()=>{var s,n;r("");try{const e=await h(k,{});p((e==null?void 0:e.secret)||""),b((e==null?void 0:e.otpauthUrl)||""),g((e==null?void 0:e.qrDataUrl)||(e==null?void 0:e.qr)||(e==null?void 0:e.qrSvg)||"")}catch(e){r(((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to start setup")}},F=async()=>{var s,n;r("");try{await h(N,{token:u}),i(!0),p(""),b(""),g(""),x("")}catch(e){r(((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"Invalid code")}},T=async()=>{var s,n;r("");try{await h(w,{token:u}),i(!1),x("")}catch(e){r(((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to disable")}};return o?t.jsx("div",{className:"p-4 text-sm text-slate-500 dark:text-slate-400",children:"Loading…"}):t.jsxs("div",{className:"ms-card p-4 max-w-xl",children:[t.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Two-Factor Authentication"}),t.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["Status: ",t.jsx("span",{className:a?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400",children:a?"Enabled":"Disabled"})]}),!!y&&t.jsx("div",{className:"mt-3 text-sm text-rose-600 dark:text-rose-400",children:y}),!a&&t.jsx("div",{className:"mt-4 space-y-3",children:m?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{className:"font-medium",children:"Secret"}),t.jsx("div",{className:"font-mono break-all",children:m}),t.jsx("div",{className:"mt-1 text-slate-500 dark:text-slate-400",children:"Scan the QR below (or use “Enter a setup key”) in your authenticator app."})]}),d?typeof d=="string"&&d.startsWith("<svg")?t.jsx("div",{className:"p-2 bg-white dark:bg-slate-800 rounded",dangerouslySetInnerHTML:{__html:d}}):t.jsx("img",{src:d,alt:"Authenticator QR",className:"w-40 h-40 object-contain bg-white rounded"}):null,f&&t.jsx("div",{className:"text-xs break-all text-slate-500 dark:text-slate-400",children:f}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{className:"border rounded px-2 py-1 text-sm bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",placeholder:"Enter 6-digit code",value:u,onChange:s=>x(s.target.value.replace(/\D/g,"").slice(0,6))}),t.jsx("button",{onClick:F,className:"px-3 py-1.5 rounded bg-emerald-600 text-white hover:bg-emerald-700",children:"Verify & Turn On"})]})]}):t.jsx("button",{onClick:S,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Enable 2FA"})}),a&&t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"To disable, confirm a current code from your authenticator app."}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{className:"border rounded px-2 py-1 text-sm bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",placeholder:"Enter 6-digit code",value:u,onChange:s=>x(s.target.value.replace(/\D/g,"").slice(0,6))}),t.jsx("button",{onClick:T,className:"px-3 py-1.5 rounded bg-rose-600 text-white hover:bg-rose-700",children:"Disable 2FA"})]})]})]})}export{U as default};
