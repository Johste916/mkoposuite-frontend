import{e as M,u as I,r as n,j as e,L as b,c as l}from"./index-e8vE1R-K.js";const $=()=>{var y;const{id:o}=M(),N=I(),[s,f]=n.useState(null),[a,d]=n.useState(null),[i,w]=n.useState([]),[m,h]=n.useState([]),[c,x]=n.useState(""),[L,p]=n.useState(!0),[S,u]=n.useState(!0),[v,j]=n.useState(!0),g=async()=>{var t;p(!0);try{const r=await l.get(`/loans/${o}`);if(f(r.data),(t=r.data)!=null&&t.productId)try{const A=await l.get(`/loan-products/${r.data.productId}`);d(A.data)}catch{}else d(null)}catch{alert("Failed to fetch loan")}finally{p(!1)}},C=async()=>{u(!0);try{const t=await l.get(`/repayments/loan/${o}`);w(t.data||[])}catch{}finally{u(!1)}},D=async()=>{j(!0);try{const t=await l.get(`/comments/loan/${o}`);h(t.data||[])}catch{}finally{j(!1)}};n.useEffect(()=>{g(),C(),D()},[o]);const k=async()=>{if(confirm("Mark this loan as closed?"))try{await l.patch(`/loans/${o}/status`,{status:"closed"}),await g(),alert("Loan marked as closed.")}catch{alert("Failed to mark as closed")}},R=async()=>{if(c.trim())try{await l.post("/comments",{loanId:o,content:c}),h(t=>[...t,{content:c,createdAt:new Date().toISOString()}]),x("")}catch{alert("Failed to add comment")}};return L?e.jsx("div",{className:"p-4",children:"Loading loan..."}):s?e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Loan Details"}),e.jsx("button",{onClick:()=>N(-1),className:"text-blue-600 hover:underline",children:"← Back"})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Summary"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Borrower:"})," ",e.jsx(b,{className:"text-blue-600 hover:underline",to:`/borrowers/${s.borrowerId}`,children:((y=s.Borrower)==null?void 0:y.name)||"N/A"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," TZS ",Number(s.amount||0).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Interest Rate:"})," ",s.interestRate,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Interest Method:"})," ",s.interestMethod]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Term:"})," ",s.termMonths," months"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start Date:"})," ",s.startDate?new Date(s.startDate).toLocaleDateString():"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:"capitalize font-semibold",children:s.status})]}),a&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Product:"})," ",a.name," ",a.code?`(${a.code})`:""]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Product Defaults:"})," ",a.interestMethod," @ ",a.interestRate??a.defaultInterestRate,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Limits:"})," TZS ",a.minPrincipal," - ",a.maxPrincipal,", ",a.minTermMonths,"-",a.maxTermMonths," months"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{to:"/loans",className:"px-3 py-2 rounded border",children:"Back to Loans"}),s.status!=="closed"&&e.jsx("button",{onClick:k,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Mark as Closed"})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Repayments"}),S?e.jsx("p",{children:"Loading repayments..."}):i.length===0?e.jsx("p",{children:"No repayments found."}):e.jsxs("table",{className:"min-w-full text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-2 py-1",children:"Date"}),e.jsx("th",{className:"border px-2 py-1",children:"Amount"}),e.jsx("th",{className:"border px-2 py-1",children:"Method"})]})}),e.jsx("tbody",{children:i.map((t,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:t.date?new Date(t.date).toLocaleDateString():"—"}),e.jsxs("td",{className:"border px-2 py-1",children:["TZS ",Number(t.amount||0).toLocaleString()]}),e.jsx("td",{className:"border px-2 py-1",children:t.method||"—"})]},r))})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Comments"}),v?e.jsx("p",{children:"Loading comments..."}):m.length===0?e.jsx("p",{children:"No comments yet."}):e.jsx("div",{className:"space-y-2 mb-3",children:m.map((t,r)=>e.jsxs("div",{className:"text-sm border-b pb-1",children:[e.jsx("p",{children:t.content}),e.jsx("span",{className:"text-gray-400 text-xs",children:t.createdAt?new Date(t.createdAt).toLocaleString():""})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:t=>x(t.target.value),className:"border rounded px-2 py-1 w-full",placeholder:"Add a comment"}),e.jsx("button",{onClick:R,className:"bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700",children:"Post"})]})]})]}):e.jsx("div",{className:"p-4",children:"Loan not found."})};export{$ as default};
