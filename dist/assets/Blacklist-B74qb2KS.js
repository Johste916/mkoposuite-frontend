import{r as a,h as u,j as t}from"./index-DYDSVKWX.js";const s={container:"w-full px-4 md:px-6 lg:px-8 py-6 bg-[var(--bg)] text-[var(--fg)]",h1:"text-3xl font-extrabold tracking-tight",card:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",input:"h-10 w-full rounded-lg border-2 px-3 outline-none focus:ring-2 focus:ring-[var(--ring)] bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)]",primary:"inline-flex items-center rounded-lg bg-rose-600 text-white px-4 py-2 font-semibold hover:bg-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] disabled:opacity-60",tableWrap:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow overflow-x-auto",th:"bg-[var(--kpi-bg)] text-left text-[13px] uppercase tracking-wide text-[var(--muted)] font-semibold px-3 py-2 border-2 border-[var(--border)]",td:"px-3 py-2 border-2 border-[var(--border)] text-sm",btn:"inline-flex items-center rounded-lg border-2 border-[var(--border-strong)] px-3 py-1.5 hover:bg-[var(--kpi-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",alert:"rounded-2xl px-4 py-3",dropdown:"absolute z-20 mt-1 w-full max-h-60 overflow-auto rounded-lg border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",option:"w-full text-left px-3 py-2 hover:bg-[var(--kpi-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",muted:"text-[var(--muted)]"};function $(r){return Array.isArray(r)?r:Array.isArray(r==null?void 0:r.items)?r.items:Array.isArray(r==null?void 0:r.rows)?r.rows:Array.isArray(r==null?void 0:r.data)?r.data:[]}const T=r=>(r==null?void 0:r.name)||`${(r==null?void 0:r.firstName)||""} ${(r==null?void 0:r.lastName)||""}`.trim()||(r==null?void 0:r.fullName)||(r==null?void 0:r.customerName)||(r==null?void 0:r.businessName)||""||"—",q=()=>{const[r,w]=a.useState([]),[I,j]=a.useState(!0),[N,S]=a.useState(""),[n,c]=a.useState({borrowerId:"",reason:"",until:""}),[h,m]=a.useState(""),[C,k]=a.useState(!1),[x,g]=a.useState([]),[R,l]=a.useState(!1),[d,p]=a.useState(null),f=async e=>{try{j(!0);const o=e?{signal:e}:{},v=await u.get("/borrowers/blacklist/list",o),b=$(v.data);w(b),S("")}catch{S("Failed to load blacklist"),w([])}finally{j(!1)}};a.useEffect(()=>{const e=new AbortController;return f(e.signal),()=>e.abort()},[]),a.useEffect(()=>{const e=h.trim();if(!e||e.length<2){g([]),l(!1);return}const o=new AbortController,v=setTimeout(async()=>{try{k(!0);const b=await u.get("/borrowers",{signal:o.signal,params:{q:e,pageSize:10}}),z=$(b.data).map(i=>({id:i.id,name:T(i),phone:i.phone||i.msisdn||i.mobile||""}));g(z),l(!0)}catch{g([]),l(!1)}finally{k(!1)}},250);return()=>{clearTimeout(v),o.abort()}},[h]);const y=e=>c(o=>({...o,[e.target.name]:e.target.value})),B=e=>{p(e),c(o=>({...o,borrowerId:e.id})),m(e.name),l(!1)},A=()=>{p(null),c(e=>({...e,borrowerId:""}))},D=async e=>{if(e.preventDefault(),!n.borrowerId){alert("Please select a borrower from the search results.");return}try{await u.post(`/borrowers/${encodeURIComponent(n.borrowerId)}/blacklist`,{reason:n.reason||null,until:n.until||null}),c({borrowerId:"",reason:"",until:""}),p(null),m(""),await f()}catch{alert("Failed to blacklist")}},E=async e=>{try{await u.delete(`/borrowers/${encodeURIComponent(e)}/blacklist`),await f()}catch{}},F=e=>e?new Date(e).toLocaleDateString():"—",O=e=>(e==null?void 0:e.name)||`${(e==null?void 0:e.firstName)||""} ${(e==null?void 0:e.lastName)||""}`.trim()||(e==null?void 0:e.id)||"—",U=e=>(e==null?void 0:e.blacklistReason)??(e==null?void 0:e.reason)??"—",L=e=>(e==null?void 0:e.blacklistUntil)??(e==null?void 0:e.until)??null;return t.jsxs("div",{className:s.container,children:[t.jsx("h1",{className:s.h1,children:"Blacklist"}),t.jsxs("form",{onSubmit:D,className:`${s.card} mt-4 p-4`,children:[t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{placeholder:"Search borrower by name or phone",className:s.input,value:h,onChange:e=>{m(e.target.value),l(!0),d&&A()},onFocus:()=>{x.length&&l(!0)}}),R&&x.length>0&&t.jsx("div",{className:s.dropdown,children:x.map(e=>t.jsxs("button",{type:"button",className:s.option,onClick:()=>B(e),children:[t.jsx("div",{className:"font-semibold",children:e.name}),t.jsxs("div",{className:`text-xs ${s.muted}`,children:["ID: ",e.id,e.phone?` • ${e.phone}`:""]})]},e.id))}),C&&t.jsx("div",{className:`mt-1 text-xs ${s.muted}`,children:"Searching…"}),d&&t.jsxs("div",{className:`mt-1 text-xs ${s.muted}`,children:["Selected: ",t.jsx("strong",{children:d.name})," (ID: ",d.id,")"," ",t.jsx("button",{type:"button",className:"underline decoration-2 underline-offset-4",onClick:A,children:"change"})]})]}),t.jsx("input",{name:"reason",placeholder:"Reason",className:s.input,value:n.reason,onChange:y}),t.jsx("input",{name:"until",type:"date",className:s.input,value:n.until,onChange:y})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("button",{className:s.primary,disabled:!n.borrowerId,children:"Add to Blacklist"}),!n.borrowerId&&t.jsx("span",{className:`ml-3 text-sm ${s.muted}`,children:"Select a borrower above to enable."})]})]}),t.jsx("div",{className:`${s.tableWrap} mt-4`,children:t.jsxs("table",{className:"w-full table-auto text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:s.th,children:"Borrower"}),t.jsx("th",{className:s.th,children:"Reason"}),t.jsx("th",{className:s.th,children:"Until"}),t.jsx("th",{className:s.th,children:"Actions"})]})}),t.jsx("tbody",{children:I?t.jsx("tr",{children:t.jsx("td",{className:s.td,colSpan:4,children:"Loading…"})}):N?t.jsx("tr",{children:t.jsx("td",{className:s.td,colSpan:4,children:t.jsx("div",{className:s.alert,style:{border:"2px solid var(--danger-border)",background:"var(--danger-bg)",color:"var(--danger-fg)",borderRadius:"1rem"},children:N})})}):r.length===0?t.jsx("tr",{children:t.jsx("td",{className:s.td,colSpan:4,children:"No blacklisted borrowers."})}):r.map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:s.td,children:O(e)}),t.jsx("td",{className:s.td,children:U(e)}),t.jsx("td",{className:s.td,children:F(L(e))}),t.jsx("td",{className:s.td,children:t.jsx("button",{className:s.btn,onClick:()=>E(e.id),children:"Remove"})})]},e.id))})]})})]})};export{q as default};
