import{r as x,j as e}from"./index-DzNpvMXd.js";import{c as f}from"./repayments-ByRlRBb-.js";const u=()=>({loanId:"",loanReference:"",date:new Date().toISOString().slice(0,10),amount:"",method:"cash",notes:"",waivePenalties:!1}),g=c=>Number(c||0).toLocaleString();function R(){const[c,i]=x.useState([u()]),[m,h]=x.useState(!1),[p,r]=x.useState(""),d=(a,t)=>{i(s=>s.map((l,n)=>n===a?{...l,...t}:l))},j=()=>i(a=>[...a,u()]),N=a=>i(t=>t.filter((s,l)=>l!==a)),v=async()=>{var a,t,s;h(!0),r("");try{const l=c.filter(o=>o.amount&&(o.loanId||o.loanReference)&&o.date),n=await f(l);r(`Saved ${(n==null?void 0:n.saved)||l.length} rows.`),(a=n==null?void 0:n.errors)!=null&&a.length&&r(o=>`${o} ${n.errors.length} error(s) occurred.`)}catch(l){r(((s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.error)||"Bulk save failed")}finally{h(!1)}},b=c.reduce((a,t)=>a+Number(t.amount||0),0);return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border rounded-xl shadow p-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Add Bulk Repayments"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",g(b)]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"text-left p-2",children:"Loan ID"}),e.jsx("th",{className:"text-left p-2",children:"Loan Ref"}),e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Amount"}),e.jsx("th",{className:"text-left p-2",children:"Method"}),e.jsx("th",{className:"text-left p-2",children:"Notes"}),e.jsx("th",{className:"text-left p-2",children:"Waive Pen."}),e.jsx("th",{className:"text-right p-2",children:"Actions"})]})}),e.jsx("tbody",{children:c.map((a,t)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:a.loanId,onChange:s=>d(t,{loanId:s.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-36",value:a.loanReference,onChange:s=>d(t,{loanReference:s.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"date",className:"border rounded px-2 py-1",value:a.date,onChange:s=>d(t,{date:s.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",step:"0.01",className:"border rounded px-2 py-1 w-28",value:a.amount,onChange:s=>d(t,{amount:s.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"border rounded px-2 py-1",value:a.method,onChange:s=>d(t,{method:s.target.value}),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank"})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-56",value:a.notes,onChange:s=>d(t,{notes:s.target.value})})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"checkbox",checked:a.waivePenalties,onChange:s=>d(t,{waivePenalties:s.target.checked})})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 rounded border",onClick:()=>N(t),children:"Remove"})})]},t))})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{className:"px-3 py-2 rounded border",onClick:j,children:"Add Row"}),e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-60",disabled:m,onClick:v,children:m?"Savingâ€¦":"Save All"})]}),!!p&&e.jsx("div",{className:"text-sm mt-2",children:p})]})})}export{R as default};
