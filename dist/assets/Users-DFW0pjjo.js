import{r,j as e,g as h}from"./index-DSXeOGvG.js";const N=(i="")=>/.+@.+\..+/.test(i),U=()=>{const[i,o]=r.useState([]),[n,d]=r.useState(""),[p,b]=r.useState(!1),[w,g]=r.useState(!1),[m,y]=r.useState(!1),[a,x]=r.useState({name:"",email:"",id:null}),j=r.useRef(),u=async(s="")=>{var l;b(!0);try{const t=await h.get("/users",{params:{q:s,limit:100}}),c=Array.isArray(t.data)?t.data:((l=t.data)==null?void 0:l.items)||[];o(c)}catch(t){console.error("Error fetching users:",t)}finally{b(!1)}};r.useEffect(()=>{u()},[]),r.useEffect(()=>(clearTimeout(j.current),j.current=setTimeout(()=>u(n),300),()=>clearTimeout(j.current)),[n]);const v=(s={name:"",email:"",id:null})=>{x(s),g(!0)},f=()=>{m||(x({name:"",email:"",id:null}),g(!1))},k=async()=>{var s,l;if(!a.name.trim()||!N(a.email))return alert("Please provide a valid name and email.");y(!0);try{a.id?(await h.put(`/users/${a.id}`,{name:a.name.trim(),email:a.email.trim()}),alert("User updated")):(await h.post("/users",{name:a.name.trim(),email:a.email.trim()}),alert("User created")),f(),u(n)}catch(t){console.error("Submit error:",t),alert(((l=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:l.error)||"Error saving user")}finally{y(!1)}},E=async s=>{var l,t;if(window.confirm("Delete this user?"))try{await h.delete(`/users/${s}`),alert("User deleted"),u(n)}catch(c){console.error("Delete error:",c),alert(((t=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:t.error)||"Error deleting user")}};return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Users"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Create, edit, and search users."})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Search"}),e.jsx("input",{className:"border rounded px-3 py-2 w-64",placeholder:"name or email…",value:n,onChange:s=>d(s.target.value)})]}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>v(),children:"+ New User"})]})]}),e.jsx("div",{className:"bg-white border rounded",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Email"}),e.jsx("th",{className:"p-2",children:"Actions"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-4 text-center text-gray-500",children:"Loading…"})}):i.length?i.map((s,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:l+1}),e.jsx("td",{className:"p-2",children:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()}),e.jsx("td",{className:"p-2",children:s.email}),e.jsxs("td",{className:"p-2 space-x-2",children:[e.jsx("button",{className:"text-blue-500 underline",onClick:()=>v(s),children:"Edit"}),e.jsx("button",{className:"text-red-500 underline",onClick:()=>E(s.id),children:"Delete"})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-4 text-center text-gray-500",children:"No users found"})})})]})}),w&&e.jsx(S,{title:a.id?"Edit User":"Add New User",onClose:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Full name"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>x({...a,name:s.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:s=>x({...a,email:s.target.value}),className:`w-full px-3 py-2 border rounded ${a.email&&!N(a.email)?"border-red-400":""}`}),a.email&&!N(a.email)&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"Please enter a valid email."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded",onClick:f,disabled:m,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",onClick:k,disabled:m,children:m?"Saving…":a.id?"Update":"Create"})]})]})})]})};function S({title:i,onClose:o,children:n}){return r.useEffect(()=>{const d=p=>{p.key==="Escape"&&o()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[o]),e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o,children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",onClick:d=>d.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:i}),n]})})}export{U as default};
