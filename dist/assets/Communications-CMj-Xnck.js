import{r as n,j as e,b as x}from"./index-DQ2zHQaz.js";function w(){const[m,g]=n.useState([]),[p,v]=n.useState(""),[j,u]=n.useState(!1),[h,c]=n.useState(""),[a,l]=n.useState({title:"",text:"",type:"notice",priority:"normal",isActive:!0}),o=async()=>{var t,i;u(!0),c("");try{const s=await x.get("/settings/communications",{params:{q:p}});g(s.data.items||[])}catch(s){c(((i=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:i.error)||s.message||"Failed to load communications")}finally{u(!1)}};n.useEffect(()=>{o()},[]);const y=async()=>{var t,i;if(!(!a.title.trim()||!a.text.trim()))try{await x.post("/settings/communications",a),l({title:"",text:"",type:"notice",priority:"normal",isActive:!0}),await o()}catch(s){c(((i=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:i.error)||s.message||"Failed to create")}},N=async(t,i)=>{var s,r;try{await x.put(`/settings/communications/${t}`,{isActive:!i}),await o()}catch(d){c(((r=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:r.error)||d.message||"Failed to update")}},b=async t=>{var i,s;if(window.confirm("Delete this communication?"))try{await x.delete(`/settings/communications/${t}`),await o()}catch(r){c(((s=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:s.error)||r.message||"Failed to delete")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Communications"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Notices, alerts, and policies for staff/branches."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"rounded border px-3 py-2 text-sm flex-1",placeholder:"Search title/text…",value:p,onChange:t=>v(t.target.value)}),e.jsx("button",{className:"px-3 py-2 rounded bg-slate-100",onClick:o,children:"Search"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx("input",{placeholder:"Title",className:"rounded border px-3 py-2 text-sm md:col-span-2",value:a.title,onChange:t=>l({...a,title:t.target.value})}),e.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:a.type,onChange:t=>l({...a,type:t.target.value}),children:[e.jsx("option",{value:"notice",children:"Notice"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"alert",children:"Alert"}),e.jsx("option",{value:"guideline",children:"Guideline"})]}),e.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:a.priority,onChange:t=>l({...a,priority:t.target.value}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]}),e.jsx("textarea",{placeholder:"Text",className:"rounded border px-3 py-2 text-sm md:col-span-3 h-24",value:a.text,onChange:t=>l({...a,text:t.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!a.isActive,onChange:t=>l({...a,isActive:t.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",onClick:y,children:"Create"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[h&&e.jsx("div",{className:"text-sm text-rose-600 mb-2",children:h}),j?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):m.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No communications yet."}):e.jsx("div",{className:"space-y-2",children:m.map(t=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100",children:t.type}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100",children:t.priority}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-slate-100",onClick:()=>N(t.id,t.isActive),children:t.isActive?"Deactivate":"Activate"}),e.jsx("button",{className:"text-sm px-2 py-1 rounded bg-rose-600 text-white",onClick:()=>b(t.id),children:"Delete"})]})]}),e.jsx("div",{className:"text-sm text-slate-600 mt-1 whitespace-pre-wrap",children:t.text})]},t.id))})]})]})}export{w as default};
