import{r as i,j as e,g as p}from"./index-SCX1ScrD.js";function f(){const[r,x]=i.useState(""),[l,o]=i.useState(!1),[d,c]=i.useState([]),[h,a]=i.useState(""),[t,s]=i.useState({amount:"",currency:"TZS",memo:""}),[u,m]=i.useState(!1);async function g(){if(r.trim()){o(!0),a("");try{const n=await p.getFirst([`/billing/by-phone/${encodeURIComponent(r.trim())}`,`/admin/billing/by-phone/${encodeURIComponent(r.trim())}`,`/billing/phone/${encodeURIComponent(r.trim())}`,`/billing/invoices?phone=${encodeURIComponent(r.trim())}`]),y=Array.isArray(n)?n:n.items||n.invoices||[];c(y)}catch(n){a(n.normalizedMessage||"Lookup failed."),c([])}finally{o(!1)}}}async function j(){if(!(!r.trim()||!t.amount)){m(!0),a("");try{await p.postFirst(["/billing/charge-by-phone","/admin/billing/charge-by-phone"],{phone:r.trim(),amount:Number(t.amount),currency:t.currency||"TZS",memo:t.memo||void 0}),await g(),s({amount:"",currency:t.currency,memo:""})}catch(n){a(n.normalizedMessage||"Charge failed.")}finally{m(!1)}}}return e.jsxs("div",{style:{padding:16},children:[e.jsx("h1",{children:"Billing by Phone"}),e.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8,marginBottom:16},children:[e.jsx("h3",{style:{marginTop:0},children:"Lookup invoices"}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Phone number",value:r,onChange:n=>x(n.target.value)}),e.jsx("button",{onClick:g,disabled:l,children:l?"Looking up…":"Search"})]})]}),e.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8,marginBottom:16},children:[e.jsx("h3",{style:{marginTop:0},children:"Charge phone"}),e.jsxs("div",{style:{display:"grid",gap:8,maxWidth:420},children:[e.jsxs("label",{children:["Amount",e.jsx("input",{type:"number",value:t.amount,onChange:n=>s({...t,amount:n.target.value})})]}),e.jsxs("label",{children:["Currency",e.jsx("input",{value:t.currency,onChange:n=>s({...t,currency:n.target.value}),placeholder:"TZS"})]}),e.jsxs("label",{children:["Memo (optional)",e.jsx("input",{value:t.memo,onChange:n=>s({...t,memo:n.target.value})})]}),e.jsx("div",{children:e.jsx("button",{onClick:j,disabled:u,children:u?"Charging…":"Charge"})})]})]}),h?e.jsx("p",{style:{color:"crimson"},children:h}):null,e.jsx("h3",{children:"Invoices"}),d.length===0?e.jsx("p",{style:{opacity:.7},children:"No invoices."}):e.jsxs("table",{width:"100%",cellPadding:8,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{align:"left",children:"Number"}),e.jsx("th",{align:"left",children:"Date"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"right",children:"Amount"})]})}),e.jsx("tbody",{children:d.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.number||n.id}),e.jsx("td",{children:n.date||n.issuedAt||n.createdAt}),e.jsx("td",{children:n.status||"—"}),e.jsx("td",{align:"right",children:n.totalFormatted||n.total||n.amount||"—"})]},n.id||n.number))})]})]})}export{f as default};
