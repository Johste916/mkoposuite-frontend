import{u as O,r as i,j as a,m as Y,L as G,n as J,e as K,o as Q,p as V,q as H,s as X,g as b}from"./index-DQxdAjNY.js";const I={page:"page",limit:"limit",search:"q"};function ee(){const F=O(),[k,u]=i.useState([]),[p,x]=i.useState(0),[o,f]=i.useState(1),[c,L]=i.useState(10),[S,M]=i.useState(""),[E,d]=i.useState(!1),[P,j]=i.useState(""),_=i.useRef(null),w=e=>{var s,r;const t=(s=e==null?void 0:e.response)==null?void 0:s.data;return typeof t=="string"?t:t!=null&&t.message?t.message:t!=null&&t.error?t.error:((r=e==null?void 0:e.response)==null?void 0:r.statusText)||(e==null?void 0:e.message)||"Server error"},g=()=>{var m;const e=localStorage.getItem("token")||localStorage.getItem("jwt")||localStorage.getItem("access_token")||localStorage.getItem("authToken")||localStorage.getItem("accessToken");let t="";try{const h=localStorage.getItem("tenant");h&&(t=((m=JSON.parse(h))==null?void 0:m.id)||"")}catch{}t=t||localStorage.getItem("tenantId")||"";const s=localStorage.getItem("activeBranchId")||"",r={Accept:"application/json"};return e&&(r.Authorization=e.startsWith("Bearer ")?e:`Bearer ${e}`),t&&(r["x-tenant-id"]=t),s&&(r["x-branch-id"]=String(s)),r},$=e=>{if(e==null||e==="")return"-";const t=Number(e);return Number.isFinite(t)?new Intl.NumberFormat().format(t):String(e)},l=(...e)=>{for(const t of e)if(t!=null&&t!=="")return t},N=e=>{if(e==null||e===""||e==="-")return"-";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)},T=e=>{const t=Number(e);return Number.isFinite(t)?t.toFixed(2):e??"-"},z=(e,t)=>{if(!e)return"-";const s=Number(t),r=String(e).toLowerCase();if(!Number.isFinite(s))return N(r);const m={months:"Month",weeks:"Week",days:"Day",years:"Year"}[r]||N(r.replace(/s$/,""));return s===1?m:N(r.endsWith("s")?r:`${r}s`)},R=(e={})=>{const t={page:e.page??o,pageSize:e.pageSize??c,q:(e.q??S)||void 0},s={[I.page]:t.page,[I.limit]:t.pageSize};return t.q!==void 0&&(s[I.search]=t.q),s},v=async(e={})=>{d(!0),j("");try{const{data:t}=await b.get("/loan-products",{params:R(e),headers:g()});Array.isArray(t)?(u(t),x(t.length)):Array.isArray(t==null?void 0:t.items)?(u(t.items),x(Number(t.total??t.count??t.items.length))):Array.isArray(t==null?void 0:t.data)?(u(t.data),x(Number(t.total??t.count??t.data.length))):(u([]),x(0))}catch(t){j(w(t)),u([]),x(0)}finally{d(!1)}};i.useEffect(()=>{v()},[o,c]),i.useEffect(()=>(clearTimeout(_.current),_.current=setTimeout(()=>{f(1),v({page:1})},300),()=>clearTimeout(_.current)),[S]);const q=async e=>{try{d(!0);const t=e.id||e.uuid||e._id,s=!(e.active??e.isActive??String(e.status||"").toLowerCase()==="active");try{await b.patch(`/loan-products/${t}/toggle`,{},{headers:g()})}catch{try{await b.patch(`/loan-products/${t}`,{active:s,isActive:s,status:s?"active":"inactive"},{headers:g()})}catch{await b.put(`/loan-products/${t}`,{active:s,isActive:s,status:s?"active":"inactive"},{headers:g()})}}await v()}catch(t){j(w(t))}finally{d(!1)}},A=i.useMemo(()=>Math.max(1,Math.ceil(p/c)),[p,c]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Loan Products"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),a.jsx("input",{value:S,onChange:e=>M(e.target.value),placeholder:"Search products…",className:"w-56 pl-9 pr-3 py-2 rounded-md text-sm border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800"})]}),a.jsxs(G,{to:"/loans/products/new",className:"inline-flex items-center gap-2 px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:[a.jsx(J,{})," Add Product"]})]})]}),P&&a.jsx("div",{className:"rounded-md border border-rose-300 bg-rose-50 text-rose-700 px-3 py-2 text-sm",children:P}),a.jsxs("div",{className:"rounded-2xl border border-slate-300 dark:border-slate-800 overflow-hidden bg-white dark:bg-slate-900 shadow-sm",children:[a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm border-separate border-spacing-0",children:[a.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800/70 text-slate-700 dark:text-slate-200",children:a.jsx("tr",{children:["Name","Code","Rate %","Period","Term","Unit","Principal Min","Principal Max","Fees","Active","Actions"].map((e,t)=>a.jsx("th",{className:`px-3 py-2 font-semibold text-left border-b border-slate-300 dark:border-slate-700 ${t===2||t===4||t===6||t===7||t===8?"text-right":""} ${t===9?"text-center":""} ${t?"border-l border-slate-200 dark:border-slate-800":""}`,children:e},e))})}),a.jsx("tbody",{children:E&&k.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:11,className:"px-3 py-8 text-center text-slate-500",children:a.jsxs("span",{className:"inline-flex items-center gap-2",children:[a.jsx(K,{className:"animate-spin"})," Loading…"]})})}):k.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:11,className:"px-3 py-8 text-center text-slate-500",children:"No products found."})}):k.map((e,t)=>{const s=e.id||e.uuid||e._id,r=l(e.interestRate,e.interest_rate,e.rate_percent),m=l(e.interestPeriod,e.interest_period,e.period,e.periodicity),h=l(e.term,e.term_value,e.tenor,e.tenure,e.duration,e.period_count,e.loanTerm,e.repayment_term),B=l(e.termUnit,e.term_unit,e.termType,e.term_type,e.unit,e.duration_unit,e.tenor_unit,e.tenure_unit,e.period_unit,e.loanTermUnit,e.repayment_term_unit),C=l(e.feePercent,e.fee_percent,e.fees_percent,e.feeRate,e.rate_fee),D=l(e.fees,e.fees_total,e.fee,e.fee_amount),U=C!=null?`${T(C)}%`:$(D),y=e.active??e.isActive??String(e.status||"").toLowerCase()==="active",n="px-3 py-2 border-t border-slate-200 dark:border-slate-800 border-l first:border-l-0 border-slate-200 dark:border-slate-800";return a.jsxs("tr",{className:t%2?"bg-slate-50/40 dark:bg-slate-800/20":"",children:[a.jsx("td",{className:`${n} font-medium`,children:e.name||"-"}),a.jsx("td",{className:n,children:e.code||"-"}),a.jsx("td",{className:`${n} text-right`,children:T(r)}),a.jsx("td",{className:n,children:N(m??"-")}),a.jsx("td",{className:`${n} text-right`,children:h??"-"}),a.jsx("td",{className:n,children:z(B??"-",h)}),a.jsx("td",{className:`${n} text-right`,children:$(l(e.principalMin,e.principal_min,e.min_amount,e.minimum_principal,e.minPrincipal))}),a.jsx("td",{className:`${n} text-right`,children:$(l(e.principalMax,e.principal_max,e.max_amount,e.maximum_principal,e.maxPrincipal))}),a.jsx("td",{className:`${n} text-right`,children:U}),a.jsx("td",{className:`${n} text-center`,children:a.jsxs("button",{onClick:()=>q(e),className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full ring-1 transition
                                      ${y?"bg-emerald-50 ring-emerald-300 text-emerald-700 hover:bg-emerald-100":"bg-slate-50 ring-slate-300 text-slate-600 hover:bg-slate-100"}`,title:y?"Deactivate":"Activate",children:[y?a.jsx(Q,{size:18}):a.jsx(V,{size:18}),a.jsx("span",{className:"text-xs font-medium",children:y?"Active":"Inactive"})]})}),a.jsx("td",{className:`${n} text-right`,children:a.jsxs("div",{className:"inline-flex items-center gap-2",children:[a.jsx("button",{onClick:()=>F(`/loans/products/${s}/edit`),className:"p-2 rounded-md border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800",title:"Edit",children:a.jsx(H,{})}),a.jsx("button",{onClick:async()=>{if(window.confirm(`Delete product "${e.name}"?`))try{d(!0),await b.delete(`/loan-products/${s}`,{headers:g()}),await v()}catch(W){j(w(W))}finally{d(!1)}},className:"p-2 rounded-md border border-rose-300 text-rose-600 hover:bg-rose-50 dark:border-rose-900/40 dark:hover:bg-rose-900/20",title:"Delete",children:a.jsx(X,{})})]})})]},s)})})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-3 py-3 bg-slate-100 dark:bg-slate-800/40 border-t border-slate-300 dark:border-slate-800",children:[a.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:p?`Showing ${(o-1)*c+1}-${Math.min(o*c,p)} of ${p}`:"—"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("select",{value:c,onChange:e=>{L(Number(e.target.value)),f(1)},className:"rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-2 py-1 text-sm","aria-label":"Rows per page",children:[10,20,50].map(e=>a.jsxs("option",{value:e,children:[e," / page"]},e))}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:o<=1,className:"px-2 py-1 rounded-md border border-slate-300 dark:border-slate-700 disabled:opacity-50",children:"Prev"}),a.jsxs("span",{className:"px-2 text-sm tabular-nums",children:[o," / ",A]}),a.jsx("button",{onClick:()=>f(e=>Math.min(A,e+1)),disabled:o>=A,className:"px-2 py-1 rounded-md border border-slate-300 dark:border-slate-700 disabled:opacity-50",children:"Next"})]})]})]})]})]})}export{ee as default};
