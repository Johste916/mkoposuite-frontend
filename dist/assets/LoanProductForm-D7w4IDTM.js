import{u as k,i as D,r as x,g as v,j as t,L as N}from"./index-DUtn1vUj.js";const K=(...c)=>c.filter(Boolean).join(" "),l=c=>{if(c===""||c===null||c===void 0)return null;const u=Number(c);return Number.isFinite(u)?u:null},o={"data-gramm":"false","data-gramm_editor":"false","data-enable-grammarly":"false","data-ms-editor":"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1};function B(){const c=k(),{id:u}=D(),d=!!u,[b,j]=x.useState(!1),[T,R]=x.useState(d),[g,C]=x.useState({}),[n,f]=x.useState({name:"",code:"",status:"active",interestMethod:"flat",interestRate:"",minPrincipal:"",maxPrincipal:"",minTermMonths:"",maxTermMonths:"",penaltyRate:"",description:""}),a=x.useCallback((e,m)=>{f(p=>({...p,[e]:m}))},[]);x.useEffect(()=>{d&&(async()=>{try{const{data:e}=await v.get(`/loan-products/${u}`);f({name:(e==null?void 0:e.name)??"",code:(e==null?void 0:e.code)??"",status:(e==null?void 0:e.status)??"active",interestMethod:(e==null?void 0:e.interestMethod)??"flat",interestRate:(e==null?void 0:e.interestRate)===0||e!=null&&e.interestRate?String(e.interestRate):"",minPrincipal:(e==null?void 0:e.minPrincipal)===0||e!=null&&e.minPrincipal?String(e.minPrincipal):"",maxPrincipal:(e==null?void 0:e.maxPrincipal)===0||e!=null&&e.maxPrincipal?String(e.maxPrincipal):"",minTermMonths:(e==null?void 0:e.minTermMonths)===0||e!=null&&e.minTermMonths?String(e.minTermMonths):"",maxTermMonths:(e==null?void 0:e.maxTermMonths)===0||e!=null&&e.maxTermMonths?String(e.maxTermMonths):"",penaltyRate:(e==null?void 0:e.penaltyRate)===0||e!=null&&e.penaltyRate?String(e.penaltyRate):"",description:(e==null?void 0:e.description)??""})}catch{alert("Failed to load product"),c("/loans/products",{replace:!0})}finally{R(!1)}})()},[d,u,c]);const s=e=>{e.stopPropagation()},h=e=>{e.target.blur(),e.stopPropagation(),setTimeout(()=>e.target&&e.target.focus(),0)},w=()=>{const e={},m=l(n.interestRate),p=l(n.minPrincipal),y=l(n.maxPrincipal),M=l(n.minTermMonths),P=l(n.maxTermMonths);return String(n.name).trim()||(e.name="Name is required"),String(n.code).trim()||(e.code="Code is required"),(m===null||m<0)&&(e.interestRate="Interest rate must be 0 or more"),p!==null&&y!==null&&y<p&&(e.maxPrincipal="Max must be ≥ Min"),M!==null&&P!==null&&P<M&&(e.maxTermMonths="Max must be ≥ Min"),C(e),Object.keys(e).length===0},S=async e=>{if(e.preventDefault(),!w())return;j(!0);const m={name:n.name.trim(),code:n.code.trim().toUpperCase(),status:n.status,interestMethod:n.interestMethod,interestRate:l(n.interestRate)??0,minPrincipal:l(n.minPrincipal),maxPrincipal:l(n.maxPrincipal),minTermMonths:l(n.minTermMonths),maxTermMonths:l(n.maxTermMonths),penaltyRate:l(n.penaltyRate),description:n.description||""};try{d?await v.put(`/loan-products/${u}`,m):await v.post("/loan-products",m),c("/loans/products")}catch{alert("Failed to save product")}finally{j(!1)}},r=({label:e,children:m,error:p})=>t.jsxs("label",{className:"block",children:[t.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 mb-1",children:e}),m,p&&t.jsx("div",{className:"mt-1 text-xs text-rose-600",children:p})]}),i="w-full input border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 text-sm";return t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("h2",{className:"text-2xl font-bold",children:d?"Edit Loan Product":"Create Loan Product"})}),t.jsx(N,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700",children:"Back to list"})]}),T?t.jsx("div",{className:"card p-4",children:"Loading…"}):t.jsxs("form",{onSubmit:S,className:"card p-4 space-y-4",children:[t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[t.jsx(r,{label:"Name",error:g.name,children:t.jsx("input",{...o,name:"name",className:i,value:n.name,onKeyDown:s,onChange:e=>a("name",e.target.value),placeholder:"e.g. Business Working Capital",required:!0})}),t.jsx(r,{label:"Code",error:g.code,children:t.jsx("input",{...o,name:"code",className:i,value:n.code,onKeyDown:s,onChange:e=>a("code",e.target.value),onBlur:e=>a("code",e.target.value.toUpperCase()),placeholder:"e.g. BWC",required:!0})}),t.jsx(r,{label:"Status",children:t.jsxs("select",{...o,name:"status",className:i,value:n.status,onKeyDown:s,onChange:e=>a("status",e.target.value),children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx(r,{label:"Interest Method",children:t.jsxs("select",{...o,name:"interestMethod",className:i,value:n.interestMethod,onKeyDown:s,onChange:e=>a("interestMethod",e.target.value),children:[t.jsx("option",{value:"flat",children:"Flat"}),t.jsx("option",{value:"reducing",children:"Reducing"})]})}),t.jsx(r,{label:"Interest Rate (%)",error:g.interestRate,children:t.jsx("input",{...o,name:"interestRate",type:"number",step:"0.0001",className:i,value:n.interestRate,onWheel:h,onKeyDown:s,onChange:e=>a("interestRate",e.target.value),placeholder:"e.g. 3",inputMode:"decimal"})}),t.jsx(r,{label:"Penalty Rate (%)",children:t.jsx("input",{...o,name:"penaltyRate",type:"number",step:"0.0001",className:i,value:n.penaltyRate,onWheel:h,onKeyDown:s,onChange:e=>a("penaltyRate",e.target.value),placeholder:"e.g. 1.5",inputMode:"decimal"})}),t.jsx(r,{label:"Min Principal",children:t.jsx("input",{...o,name:"minPrincipal",type:"number",className:i,value:n.minPrincipal,onWheel:h,onKeyDown:s,onChange:e=>a("minPrincipal",e.target.value),placeholder:"e.g. 100000",inputMode:"numeric"})}),t.jsx(r,{label:"Max Principal",error:g.maxPrincipal,children:t.jsx("input",{...o,name:"maxPrincipal",type:"number",className:i,value:n.maxPrincipal,onWheel:h,onKeyDown:s,onChange:e=>a("maxPrincipal",e.target.value),placeholder:"e.g. 10000000",inputMode:"numeric"})}),t.jsx(r,{label:"Min Term (months)",children:t.jsx("input",{...o,name:"minTermMonths",type:"number",className:i,value:n.minTermMonths,onWheel:h,onKeyDown:s,onChange:e=>a("minTermMonths",e.target.value),placeholder:"e.g. 3",inputMode:"numeric"})}),t.jsx(r,{label:"Max Term (months)",error:g.maxTermMonths,children:t.jsx("input",{...o,name:"maxTermMonths",type:"number",className:i,value:n.maxTermMonths,onWheel:h,onKeyDown:s,onChange:e=>a("maxTermMonths",e.target.value),placeholder:"e.g. 36",inputMode:"numeric"})}),t.jsx("div",{className:"sm:col-span-2",children:t.jsx(r,{label:"Internal Notes / Description",children:t.jsx("textarea",{...o,name:"description",rows:3,className:i,value:n.description||"",onKeyDown:s,onChange:e=>a("description",e.target.value),placeholder:"Optional details visible to staff only."})})})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[t.jsx(N,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700 text-sm hover:bg-slate-50 dark:hover:bg-slate-800",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:!!b,className:K("px-4 py-2 rounded text-white text-sm",b?"bg-indigo-400":"bg-indigo-600 hover:bg-indigo-700"),children:b?"Saving…":d?"Update Product":"Create Product"})]})]})]})}export{B as default};
