import{r as d,j as e}from"./index-Beh6sWFf.js";import{r as v}from"./repayments-BcxY46WB.js";import"./index-Ckw_KXDy.js";const y=()=>new Date().toISOString().slice(0,10),m=()=>({loanId:"",loanReference:"",amount:"",date:y(),method:"cash",reference:"",notes:""});function C(){const[o,r]=d.useState([m()]),[h,u]=d.useState(!1),[x,c]=d.useState(null),[p,i]=d.useState(""),n=(s,l,t)=>r(a=>a.map((j,f)=>f===s?{...j,[l]:t}:j)),b=()=>r(s=>[...s,m()]),N=s=>r(l=>l.filter((t,a)=>a!==s)),g=async()=>{var l,t;const s=o.map(a=>({loanId:a.loanId?Number(a.loanId):void 0,loanReference:a.loanReference||void 0,amount:Number(a.amount||0),date:a.date,method:a.method||"cash",reference:a.reference||void 0,notes:a.notes||void 0})).filter(a=>(a.loanId||a.loanReference)&&a.amount>0&&a.date);if(!s.length)return alert("Fill at least one valid row (loanId or loanReference, amount, date).");u(!0),i(""),c(null);try{const{data:a}=await v.createBulk(s);c(a||{ok:!0})}catch(a){i(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.error)||"Bulk posting failed")}finally{u(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Add Bulk Repayments"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Each row must include ",e.jsx("code",{children:"loanId"})," ",e.jsx("em",{children:"or"})," ",e.jsx("code",{children:"loanReference"}),", plus ",e.jsx("code",{children:"amount"})," and ",e.jsx("code",{children:"date"}),"."]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl mt-4",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"p-3 text-left",children:"Loan ID"}),e.jsx("th",{className:"p-3 text-left",children:"Loan Ref"}),e.jsx("th",{className:"p-3 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-left",children:"Method"}),e.jsx("th",{className:"p-3 text-left",children:"Reference"}),e.jsx("th",{className:"p-3 text-left",children:"Notes"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[o.map((s,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:s.loanId,onChange:t=>n(l,"loanId",t.target.value),placeholder:"123"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-36",value:s.loanReference,onChange:t=>n(l,"loanReference",t.target.value),placeholder:"LN-…"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"date",className:"border rounded px-2 py-1",value:s.date,onChange:t=>n(l,"date",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",min:"0.01",step:"0.01",className:"border rounded px-2 py-1 w-28",value:s.amount,onChange:t=>n(l,"amount",t.target.value),placeholder:"0.00"})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"border rounded px-2 py-1",value:s.method,onChange:t=>n(l,"method",t.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1",value:s.reference,onChange:t=>n(l,"reference",t.target.value),placeholder:"MPESA-… / Bank txn"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-64",value:s.notes,onChange:t=>n(l,"notes",t.target.value),placeholder:"optional"})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 rounded border hover:bg-gray-50",onClick:()=>N(l),disabled:o.length===1,children:"Remove"})})]},l)),e.jsx("tr",{className:"border-t",children:e.jsx("td",{colSpan:8,className:"p-3",children:e.jsx("button",{className:"px-3 py-1.5 rounded border hover:bg-gray-50",onClick:b,children:"+ Add Row"})})})]})]})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:g,disabled:h,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:h?"Submitting…":"Submit Bulk"}),e.jsx("button",{className:"px-3 py-2 rounded border hover:bg-gray-50",onClick:()=>{r([m()]),c(null),i("")},children:"Reset"})]}),p&&e.jsx("div",{className:"mt-4 p-3 rounded bg-red-50 text-red-700 text-sm border border-red-200",children:p}),x&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold",children:"Result"}),e.jsx("pre",{className:"mt-2 p-3 text-sm bg-gray-50 dark:bg-gray-900 rounded border overflow-auto",children:JSON.stringify(x,null,2)})]})]})})}export{C as default};
