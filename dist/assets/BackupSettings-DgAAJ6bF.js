import{r as y,b as k,j as a}from"./index-CMgmpHUd.js";function j({f:n,value:r,onChange:c}){const i="w-full border rounded px-2 py-1 text-sm";return n.type==="boolean"?a.jsxs("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:!!r,onChange:s=>c(s.target.checked)}),a.jsx("span",{children:n.label})]}):n.type==="select"?a.jsxs("select",{className:i,value:r??"",onChange:s=>c(s.target.value||null),children:[a.jsx("option",{value:"",children:"—"}),(n.options||[]).map(s=>a.jsx("option",{value:s.value,children:s.label},s.value))]}):n.type==="json"?a.jsx("textarea",{rows:6,className:i,value:typeof r=="string"?r:JSON.stringify(r??{},null,2),onChange:s=>{const u=s.target.value;try{c(JSON.parse(u))}catch{c(u)}}}):a.jsx("input",{className:i,type:n.type==="number"?"number":n.type==="secret"?"password":"text",value:r??"",onChange:s=>c(n.type==="number"?s.target.value===""?null:Number(s.target.value):s.target.value),placeholder:n.placeholder||""})}function N({title:n,prefix:r,fields:c}){const[i,s]=y.useState([]),[u,x]=y.useState(!1),[m,b]=y.useState("");y.useEffect(()=>{(async()=>{var e,l;b("");try{const{data:t}=await k.get("/settings");s(Array.isArray(t)?t:[])}catch(t){b(((l=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:l.error)||t.message)}})()},[]);const h=y.useMemo(()=>{const e={};for(const l of c){const t=r?`${r}${l.key}`:l.key,o=i.find(d=>d.key===t);e[l.key]=o?o.value:l.default??null}return e},[i,c,r]),g=(e,l)=>{const t=r?`${r}${e}`:e;s(o=>{const d=o.findIndex(p=>p.key===t);if(d>=0){const p=[...o];return p[d]={...p[d],value:l},p}return[...o,{key:t,value:l}]})},v=async()=>{var e,l;x(!0),b("");try{const t=c.map(o=>({key:r?`${r}${o.key}`:o.key,value:h[o.key]}));await k.put("/settings",t)}catch(t){b(((l=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:l.error)||t.message)}x(!1)};return a.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-6 shadow-sm space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-xl font-semibold",children:n}),a.jsx("button",{onClick:v,disabled:u,className:"px-3 py-2 border rounded bg-white",children:u?"Saving…":"Save"})]}),m&&a.jsx("div",{className:"text-sm text-rose-600",children:m}),a.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:c.map(e=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-semibold mb-1",children:e.label}),a.jsx(j,{f:e,value:h[e.key],onChange:l=>g(e.key,l)}),e.help&&a.jsx("div",{className:"text-[12px] text-slate-500 mt-1",children:e.help})]},e.key))})]})}function w(){return a.jsx(N,{title:"Backup Settings",prefix:"backup.",fields:[{key:"provider",label:"Provider",type:"select",options:[{value:"none",label:"None"},{value:"s3",label:"Amazon S3 / S3-compatible"},{value:"gcs",label:"Google Cloud Storage"}],default:"none"},{key:"bucket",label:"Bucket/Container",type:"text",placeholder:"my-backups"},{key:"accessKey",label:"Access Key",type:"text"},{key:"secretKey",label:"Secret Key",type:"secret"},{key:"region",label:"Region",type:"text",placeholder:"eu-central-1"},{key:"prefix",label:"Path Prefix",type:"text",placeholder:"mkoposuite"},{key:"cron",label:"Automatic Schedule (cron)",type:"text",placeholder:"0 3 * * *"},{key:"enabled",label:"Enable automatic backups",type:"boolean",default:!1}]})}export{w as default};
