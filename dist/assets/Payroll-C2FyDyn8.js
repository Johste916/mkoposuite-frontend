import{r as l,h as x,j as e,L as j}from"./index-DF0UeGdD.js";const $=a=>{var d;return!!a&&(a.role==="admin"||a.role==="director"||((d=a.permissions)==null?void 0:d.includes("payroll:read_all")))};function A(){const[a,d]=l.useState(null),[c,p]=l.useState([]),[w,g]=l.useState(!0),[N,L]=l.useState(""),[b,E]=l.useState(""),[u,P]=l.useState(""),[T,I]=l.useState([]),[o,C]=l.useState(null),[f,v]=l.useState(""),n=l.useMemo(()=>a?$(a):!0,[a]);l.useEffect(()=>{let s=!1;return(async()=>{var r;try{const[i,t]=await Promise.allSettled([x.get("/auth/me"),x.get("/hr/employees",{params:{limit:500}})]);if(s)return;i.status==="fulfilled"&&d(i.value.data||null),t.status==="fulfilled"&&I(((r=t.value.data)==null?void 0:r.items)||[])}catch{}})(),()=>s=!0},[]);const S=async()=>{var s,r,i;g(!0),v("");try{const t={from:N||void 0,to:b||void 0};n||(t.scope="me"),n&&u&&(t.employeeId=u);const[h,y]=await Promise.all([x.get("/hr/payroll/runs",{params:t}),x.get("/hr/payroll/stats",{params:t})]);p(((s=h==null?void 0:h.data)==null?void 0:s.items)||[]),C((y==null?void 0:y.data)||null)}catch(t){v(((i=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:i.message)||(t==null?void 0:t.message)||"Failed to load payroll.")}finally{g(!1)}};return l.useEffect(()=>{S()},[n]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"View Payroll"}),e.jsx("div",{className:"flex gap-2",children:n&&e.jsx(j,{to:"/payroll/add",className:"px-3 py-2 text-sm border rounded-lg bg-white hover:bg-gray-50",children:"Run Payroll"})})]}),e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"From"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:N,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"To"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:b,onChange:s=>E(s.target.value)})]}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Employee"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm min-w-[220px]",value:u,onChange:s=>P(s.target.value),children:[e.jsx("option",{value:"",children:"All employees"}),T.map(s=>e.jsxs("option",{value:s.id,children:[s.firstName," ",s.lastName," ",s.staffNo?`(${s.staffNo})`:""]},s.id))]})]}),e.jsx("button",{onClick:S,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Apply"})]}),o&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(m,{title:"Employees",value:o.employees,tone:"indigo"}),e.jsx(m,{title:"On Leave",value:o.onLeave,tone:"amber"}),e.jsx(m,{title:"Active Contracts",value:o.activeContracts,tone:"emerald"}),e.jsx(m,{title:"This Period Net",value:`TZS ${Number(o.netThisPeriod||0).toLocaleString()}`,tone:"blue"})]}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Period"}),e.jsx("th",{className:"py-2 px-3",children:"Employee"}),e.jsx("th",{className:"py-2 px-3",children:"Gross"}),e.jsx("th",{className:"py-2 px-3",children:"Deductions"}),e.jsx("th",{className:"py-2 px-3",children:"Net"}),e.jsx("th",{className:"py-2 px-3",children:"Status"}),e.jsx("th",{className:"py-2 px-3",children:"Actions"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-500",colSpan:7,children:"Loading…"})}):f?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-red-600",colSpan:7,children:f})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-500",colSpan:7,children:"No payroll found."})}):c.map(s=>{var r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:s.periodLabel||`${s.periodFrom} → ${s.periodTo}`}),e.jsx("td",{className:"py-2 px-3",children:((r=s.employee)==null?void 0:r.name)||s.employeeName||"—"}),e.jsxs("td",{className:"py-2 px-3",children:["TZS ",Number(s.totalGross||s.gross||0).toLocaleString()]}),e.jsxs("td",{className:"py-2 px-3",children:["TZS ",Number(s.deductions||0).toLocaleString()]}),e.jsxs("td",{className:"py-2 px-3 font-medium",children:["TZS ",Number(s.totalNet||s.net||0).toLocaleString()]}),e.jsx("td",{className:"py-2 px-3",children:s.status||"finalized"}),e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{className:"text-blue-600 underline text-xs",href:s.payslipUrl||"#",target:"_blank",rel:"noreferrer",children:"Payslip"}),e.jsx(j,{className:"text-xs border rounded px-2 py-0.5",to:`/payroll/report?runId=${s.runId||s.id}`,children:"Run report"}),e.jsx(j,{className:"text-xs border rounded px-2 py-0.5",to:`/payroll/add?clone=${s.runId||s.id}`,children:"Clone"})]})})]},s.id||s.runId)})})]})})]})}function m({title:a,value:d,tone:c="indigo"}){const p={indigo:"text-indigo-600 bg-indigo-50",amber:"text-amber-600 bg-amber-50",emerald:"text-emerald-600 bg-emerald-50",blue:"text-blue-600 bg-blue-50"}[c]||"text-slate-600 bg-slate-50";return e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:`px-2 py-1 rounded ${p}`,children:a}),e.jsx("div",{className:"font-semibold",children:d??"—"})]})}export{A as default};
