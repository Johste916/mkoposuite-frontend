import{u as j,r as d,j as e,g as v}from"./index-DyuA89p_.js";function k(){const x=j(),[n,b]=d.useState(null),[o,m]=d.useState(!1),[a,p]=d.useState(null),[u,c]=d.useState(""),h=()=>{const l=`date,type,amount,vendor,reference,note,branch_id
2025-08-01,OPERATING,125000,Office Supplies Ltd,INV-001,Stationery,
`,t=new Blob([l],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="expenses_template.csv",document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(r)},f=async l=>{var t,r;if(l.preventDefault(),c(""),p(null),!n){c("Please choose a CSV file.");return}m(!0);try{const s=new FormData;s.append("file",n);const i=await v._post("/expenses/csv",s,{headers:{"Content-Type":"multipart/form-data"}});p((i==null?void 0:i.data)||{inserted:0,failed:0,errors:[]})}catch(s){c(((r=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:r.error)||(s==null?void 0:s.normalizedMessage)||(s==null?void 0:s.message)||"Upload failed")}finally{m(!1)}};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Upload Expenses CSV"}),e.jsxs("p",{className:"text-xs opacity-70",children:["Columns supported: ",e.jsx("code",{children:"date,type,amount,vendor,reference,note,branch_id"}),". Date format: ",e.jsx("code",{children:"YYYY-MM-DD"}),"."]})]}),u?e.jsxs("div",{className:"mb-3 text-sm text-rose-600 dark:text-rose-300",children:["Error: ",String(u)]}):null,e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"CSV File"}),e.jsx("input",{type:"file",accept:".csv,text/csv",className:"w-full px-3 py-2 border rounded-md dark:bg-slate-700 dark:border-slate-600",onChange:l=>{var t;return b(((t=l.target.files)==null?void 0:t[0])||null)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"submit",disabled:o||!n,className:`px-4 py-2 rounded text-white ${o||!n?"bg-blue-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:o?"Uploading…":"Upload"}),e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 rounded border dark:border-slate-600",children:"Download Template"}),e.jsx("button",{type:"button",onClick:()=>x("/expenses"),className:"px-4 py-2 rounded border dark:border-slate-600",children:"Back to Expenses"})]})]}),a&&e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("div",{className:"font-medium",children:"Result"}),e.jsxs("div",{className:"mt-1",children:["Inserted: ",e.jsx("b",{children:a.inserted})]}),e.jsxs("div",{children:["Failed: ",e.jsx("b",{children:a.failed})]}),Array.isArray(a.errors)&&a.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Errors:"}),e.jsxs("ul",{className:"list-disc ml-6 space-y-1",children:[a.errors.slice(0,20).map((l,t)=>e.jsxs("li",{children:["Row ",l.index,": ",l.error]},t)),a.errors.length>20&&e.jsxs("li",{children:["…and ",a.errors.length-20," more"]})]})]})]})]})}export{k as default};
