import{f as y}from"./index-CSL_HVM5.js";const i={};var a={},g,h;const E=typeof import.meta<"u"&&"https://mkoposuite-backend-42w2.onrender.com/api".replace(/\/+$/,"")||typeof process<"u"&&((g=a==null?void 0:a.REACT_APP_API_BASE_URL)==null?void 0:g.replace(/\/+$/,""))||`${typeof window<"u"&&((h=window.location)==null?void 0:h.origin)||""}/api`,s=y.create({baseURL:E,timeout:3e4,withCredentials:!1}),f=["token","jwt","authToken","accessToken","access_token"],T=["tenant","tenantId","x-tenant-id","tenantID"],w=()=>{for(const t of f){const e=localStorage.getItem(t)||sessionStorage.getItem(t);if(e)return String(e).replace(/^Bearer\s+/i,"")}return null},S=()=>{try{const e=localStorage.getItem("tenant")||sessionStorage.getItem("tenant");if(e){const n=JSON.parse(e);if(n!=null&&n.id)return n.id}}catch{}for(const e of T){const n=localStorage.getItem(e)||sessionStorage.getItem(e);if(n)return n}return typeof import.meta<"u"&&(i==null?void 0:i.VITE_DEFAULT_TENANT_ID)||typeof process<"u"&&(a==null?void 0:a.REACT_APP_DEFAULT_TENANT_ID)||null},A=()=>localStorage.getItem("activeBranchId")||sessionStorage.getItem("activeBranchId")||null,N=()=>{var t;return((t=crypto==null?void 0:crypto.randomUUID)==null?void 0:t.call(crypto))||`req_${Date.now()}_${Math.random().toString(36).slice(2)}`};s.interceptors.request.use(t=>{var c;const e=w();e&&(t.headers.Authorization=`Bearer ${e}`);const n=S();n&&(t.headers["x-tenant-id"]=n);const o=A();return o&&(t.headers["x-branch-id"]=o),(c=t.headers)["x-request-id"]||(c["x-request-id"]=N()),t});const D=()=>{var t;try{[...f,"user","tenant","tenantId","tenantName","activeBranchId"].forEach(e=>{try{localStorage.removeItem(e)}catch{}try{sessionStorage.removeItem(e)}catch{}}),delete s.defaults.headers.common.Authorization,delete s.defaults.headers.common["x-tenant-id"],delete s.defaults.headers.common["x-branch-id"]}catch{}typeof window<"u"&&((t=window.location)==null?void 0:t.pathname)!=="/login"&&window.location.replace("/login")};s.interceptors.response.use(t=>t,async t=>{var d,r,l,u,m;if((t==null?void 0:t.name)==="CanceledError"||(t==null?void 0:t.code)==="ERR_CANCELED")return Promise.reject(t);const e=(d=t==null?void 0:t.response)==null?void 0:d.status,n=t==null?void 0:t.code;if(t.normalizedMessage=n==="ECONNABORTED"?"Request timeout. Please try again.":e===401?"Unauthorized. Please sign in again.":e>=500?"Server error. Please try again.":((l=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:l.message)||((m=(u=t==null?void 0:t.response)==null?void 0:u.data)==null?void 0:m.error)||(t==null?void 0:t.message)||"Request failed",e===401)return D(),Promise.reject(t);const o=t.config||{};if((n==="ECONNABORTED"||e>=500&&e<600)&&(o._retry||0)<2){o._retry=(o._retry||0)+1;const p=300*Math.pow(2,o._retry-1);return await new Promise(I=>setTimeout(I,p)),s(o)}return Promise.reject(t)});export{s as a};
