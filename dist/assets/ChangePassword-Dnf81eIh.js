import{r as n,j as e,g as b}from"./index-sYV8Q1B4.js";const A=s=>{let l=0;return s?(s.length>=8&&(l+=1),s.length>=12&&(l+=1),/[a-z]/.test(s)&&/[A-Z]/.test(s)&&(l+=1),/\d/.test(s)&&(l+=1),/[^A-Za-z0-9]/.test(s)&&(l+=1),Math.min(l,5)):0},P=s=>s<=2?"bg-rose-500":s===3?"bg-amber-500":"bg-emerald-600";function U(){const[s,l]=n.useState(""),[a,x]=n.useState(""),[u,h]=n.useState(""),[g,f]=n.useState(!1),[w,N]=n.useState(null),[j,i]=n.useState(null),[o,p]=n.useState({cur:!1,next:!1,conf:!1}),[m,k]=n.useState(!1),y=n.useMemo(()=>A(a),[a]),v=!g&&s.length>0&&a.length>=8&&a===u&&a!==s,S=()=>{const t=new Uint8Array(16);crypto.getRandomValues(t);const c=Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join(""),d=c.slice(0,8)+"A!"+c.slice(8,14)+"7#";x(d),h(d)},C=async t=>{var c,d;if(t.preventDefault(),N(null),i(null),a!==u){i("New password and confirmation do not match.");return}if(a===s){i("New password must be different from current password.");return}f(!0);try{let r;try{({data:r}=await b.post("/account/change-password",{currentPassword:s,newPassword:a,signOutAll:m}))}catch{({data:r}=await b.post("/auth/change-password",{currentPassword:s,newPassword:a,signOutAll:m}))}if(N((r==null?void 0:r.message)||"Password updated."),l(""),x(""),h(""),m){try{await b.post("/auth/logout-all")}catch{}try{localStorage.clear()}catch{}}}catch(r){i(((d=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:d.message)||"Failed to change password")}finally{f(!1)}};return e.jsxs("div",{className:"max-w-md ms-card p-4",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Change Password"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Use a strong password you don’t use elsewhere."}),w&&e.jsx("div",{className:"mt-3 text-sm text-emerald-600 dark:text-emerald-400",children:w}),j&&e.jsx("div",{className:"mt-3 text-sm text-rose-600 dark:text-rose-400",children:j}),e.jsxs("form",{onSubmit:C,className:"mt-4 space-y-3",children:[e.jsxs("label",{className:"text-sm block",children:[e.jsx("span",{className:"mb-1 block",children:"Current password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o.cur?"text":"password",className:"w-full border rounded px-3 py-2 text-sm bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:s,onChange:t=>l(t.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,cur:!t.cur})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-0.5 ms-btn",children:o.cur?"Hide":"Show"})]})]}),e.jsxs("label",{className:"text-sm block",children:[e.jsx("span",{className:"mb-1 block",children:"New password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o.next?"text":"password",className:"w-full border rounded px-3 py-2 text-sm bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:a,onChange:t=>x(t.target.value),required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,next:!t.next})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-0.5 ms-btn",children:o.next?"Hide":"Show"})]}),e.jsx("div",{className:"mt-2 h-2 w-full bg-slate-100 dark:bg-slate-800 rounded",children:e.jsx("div",{className:`h-2 rounded ${P(y)}`,style:{width:`${y/5*100}%`}})}),e.jsxs("ul",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400 space-y-1",children:[e.jsx("li",{className:a.length>=8?"text-emerald-600 dark:text-emerald-400":"",children:"At least 8 characters"}),e.jsx("li",{className:/[a-z]/.test(a)&&/[A-Z]/.test(a)?"text-emerald-600 dark:text-emerald-400":"",children:"Upper & lower case letters"}),e.jsx("li",{className:/\d/.test(a)?"text-emerald-600 dark:text-emerald-400":"",children:"At least one number"}),e.jsx("li",{className:/[^A-Za-z0-9]/.test(a)?"text-emerald-600 dark:text-emerald-400":"",children:"At least one symbol"})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",onClick:S,className:"text-xs px-2 py-1 ms-btn",children:"Generate strong password"})})]}),e.jsxs("label",{className:"text-sm block",children:[e.jsx("span",{className:"mb-1 block",children:"Confirm new password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o.conf?"text":"password",className:"w-full border rounded px-3 py-2 text-sm bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:u,onChange:t=>h(t.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,conf:!t.conf})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-0.5 ms-btn",children:o.conf?"Hide":"Show"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:m,onChange:t=>k(t.target.checked)}),"Sign out of all other devices after update"]}),e.jsx("button",{type:"submit",disabled:!v,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:g?"Saving…":"Update Password"})]})]})}export{U as default};
