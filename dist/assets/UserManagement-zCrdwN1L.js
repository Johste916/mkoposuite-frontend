import{r as o,j as e,h as V,x as Qe}from"./index-DYDSVKWX.js";async function P(n,h={}){try{const l=await V.get(n,h);return{ok:!0,data:l==null?void 0:l.data}}catch(l){return{ok:!1,error:l}}}async function S(n,h={},l={}){try{const p=await V.post(n,h,l);return{ok:!0,data:p==null?void 0:p.data}}catch(p){return{ok:!1,error:p}}}async function M(n,h={},l={}){try{const p=await V.put(n,h,l);return{ok:!0,data:p==null?void 0:p.data}}catch(p){return{ok:!1,error:p}}}async function je(n,h={}){try{const l=await V.delete(n,h);return{ok:!0,data:l==null?void 0:l.data}}catch(l){return{ok:!1,error:l}}}async function J(n=[],h={}){try{return{ok:!0,data:await V.getFirst(n,h)}}catch(l){return{ok:!1,error:l}}}const ye=n=>String(n||"").replace(/\D+/g,""),A=n=>{const h=String(n??"").trim();return h.length?h:null},$=n=>Array.isArray(n)?n:(n==null?void 0:n.items)||(n==null?void 0:n.rows)||(n==null?void 0:n.data)||[];function te({children:n}){return typeof document>"u"?null:Qe.createPortal(n,document.body)}function We(n,h){o.useEffect(()=>{const l=p=>{n.some(w=>w.current&&w.current.contains(p.target))||h()};return document.addEventListener("mousedown",l,!0),document.addEventListener("touchstart",l,{passive:!0,capture:!0}),()=>{document.removeEventListener("mousedown",l,!0),document.removeEventListener("touchstart",l,!0)}},[n,h])}function Xe({actions:n=[]}){const[h,l]=o.useState(!1),p=o.useRef(null),b=o.useRef(null),[w,D]=o.useState({top:0,left:0}),O=()=>{var F;const m=(F=p.current)==null?void 0:F.getBoundingClientRect();if(!m)return;const g=220,N=6;let Z=Math.min(Math.max(8,m.right-g),window.innerWidth-g-8),C=m.bottom+N;const G=8+n.length*36;C+G>window.innerHeight-8&&(C=Math.max(8,m.top-N-G)),D({top:C,left:Z})};return o.useLayoutEffect(()=>{if(!h)return;O();const m=()=>O(),g=()=>O();return window.addEventListener("scroll",m,!0),window.addEventListener("resize",g),()=>{window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",g)}},[h,n.length]),We([p,b],()=>l(!1)),o.useEffect(()=>{if(!h)return;const m=g=>g.key==="Escape"&&l(!1);return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[h]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:p,className:"px-2 py-1 border rounded hover:bg-gray-50",onClick:()=>l(m=>!m),"aria-haspopup":"menu","aria-expanded":h,children:"⋮"}),h&&e.jsxs(te,{children:[e.jsx("div",{className:"fixed inset-0 z-50",style:{background:"transparent"},onClick:()=>l(!1)}),e.jsx("div",{ref:b,className:"fixed z-[60] min-w-[220px] bg-white border shadow-lg rounded-md",style:{top:w.top,left:w.left},onClick:m=>m.stopPropagation(),role:"menu",children:n.map((m,g)=>e.jsx("button",{onClick:()=>{var N;m.disabled||(l(!1),(N=m.onClick)==null||N.call(m))},disabled:m.disabled,className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${m.danger?"text-red-700":""} disabled:opacity-50`,children:m.label},g))})]})]})}function ge(){o.useEffect(()=>{const{body:n}=document,h=n.style.overflow;return n.style.overflow="hidden",()=>{n.style.overflow=h||""}},[])}function Y({title:n,children:h,onClose:l}){return ge(),o.useEffect(()=>{const p=b=>b.key==="Escape"&&(l==null?void 0:l());return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[l]),e.jsx(te,{children:e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl border shadow p-4 w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:n}),e.jsx("button",{onClick:l,className:"text-sm px-2 py-1 border rounded","aria-label":"Close",children:"✕"})]}),h]})})})}function Je({title:n,children:h,onClose:l,wide:p=!1}){return ge(),o.useEffect(()=>{const b=w=>w.key==="Escape"&&(l==null?void 0:l());return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[l]),e.jsx(te,{children:e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:l}),e.jsxs("div",{className:`absolute right-0 top-0 h-full w-full ${p?"max-w-5xl":"max-w-3xl"} bg-white border-l shadow-xl p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:n}),e.jsx("button",{onClick:l,className:"text-sm px-2 py-1 border rounded",children:"✕"})]}),h]})]})})}function H({className:n="",children:h,...l}){return e.jsx("button",{...l,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-blue-600 text-white border border-blue-600 hover:bg-blue-700","disabled:opacity-60 disabled:hover:bg-blue-600","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-1",n].join(" "),children:h})}function I({className:n="",children:h,...l}){return e.jsx("button",{...l,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-white text-slate-800 border border-slate-300 hover:bg-slate-50","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 focus-visible:ring-offset-1","disabled:opacity-60",n].join(" "),children:h})}const Ze=()=>{var ue,fe;const[n,h]=o.useState([]),[l,p]=o.useState([]),[b,w]=o.useState([]),[D,O]=o.useState(!0),[m,g]=o.useState(""),[N,Z]=o.useState(""),[C,G]=o.useState(""),[F,ae]=o.useState({}),[B,K]=o.useState({}),[re,le]=o.useState(""),[L,_]=o.useState(new Set),ne=n.length>0&&n.every(s=>L.has(s.id)),[ee,ie]=o.useState(!1),[f,ve]=o.useState(null),[v,ce]=o.useState("profile"),[j,T]=o.useState({hr:null,attendance:null,leave:null,payroll:null}),[E,z]=o.useState({hr:"",attendance:"",leave:"",payroll:""}),[U,de]=o.useState(!1),[Ne,q]=o.useState(!1),[we,Q]=o.useState(!1),[ke,W]=o.useState(!1),[Se,X]=o.useState(!1),[d,y]=o.useState(null),[se,oe]=o.useState(new Set),Ie=(s,t,a)=>{const r=$(s.data),i=$(t.data),c=$(a.data);h(r),p(i),w(c);const x={};r.forEach(u=>{var R;x[u.id]={roleId:u.roleId??((R=u.role)==null?void 0:R.id)??"",branchId:u.branchId??""}}),K(x)},k=async()=>{var s,t;O(!0),le("");try{const a={limit:1e3,q:m};N&&(a.roleId=N),C&&(a.branchId=C);const[r,i,c]=await Promise.all([J(["/users","/v1/users"],{params:a}),J(["/roles","/v1/roles","/auth/roles","/iam/roles"],{params:{limit:1e3}}),J(["/branches","/v1/branches","/org/branches"],{params:{limit:1e3}})]);if(!r.ok)throw r.error;if(!i.ok)throw i.error;if(!c.ok)throw c.error;Ie(r,i,c)}catch(a){le(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||(a==null?void 0:a.message)||"Failed to load data")}finally{O(!1)}};o.useEffect(()=>{k()},[]),o.useEffect(()=>{const s=setTimeout(()=>{D||k()},400);return()=>clearTimeout(s)},[m,N,C]);const he=(s,t)=>{K(a=>({...a,[s]:{...a[s]||{},...t}}))},Ce=s=>{var i;const t=B[s.id]||{},a=s.roleId??((i=s.role)==null?void 0:i.id)??"",r=s.branchId??"";return String(t.roleId||"")!==String(a)||String(t.branchId||"")!==String(r)},Ee=async s=>{var i,c;const t=s.id,a=B[t]||{},r={roleId:a.roleId?Number(a.roleId):null,branchId:a.branchId?Number(a.branchId):null};ae(x=>({...x,[t]:!0}));try{let x=await S(`/users/${t}/assign`,r);if(x.ok||(x=await M(`/users/${t}`,r)),!x.ok)throw x.error;h(u=>u.map(R=>R.id===t?{...R,roleId:r.roleId,branchId:r.branchId}:R)),alert("Assigned successfully")}catch(x){alert(((c=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:c.error)||(x==null?void 0:x.message)||"Failed to assign")}finally{ae(x=>({...x,[t]:!1}))}},Re=s=>{_(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},$e=()=>{_(ne?new Set:new Set(n.map(s=>s.id)))},Le=async s=>{if(!s||L.size===0)return;const t=[...L];if(!(await S("/users/assign-role",{userIds:t,roleId:Number(s)})).ok)for(const r of t)await S(`/users/${r}/assign`,{roleId:Number(s)});K(r=>{const i={...r};return t.forEach(c=>{i[c]={...i[c]||{},roleId:Number(s)}}),i}),alert(`Assigned role to ${t.length} user(s).`)},De=async s=>{if(!s||L.size===0)return;const t=[...L];if(!(await S("/users/assign-branch",{userIds:t,branchId:Number(s)})).ok)for(const r of t)await S(`/users/${r}/assign`,{branchId:Number(s)});K(r=>{const i={...r};return t.forEach(c=>{i[c]={...i[c]||{},branchId:Number(s)}}),i}),alert(`Assigned branch to ${t.length} user(s).`)},Oe=()=>{const s=["id","name","email","phone","roleId","branchId"],t=n.map(c=>{var be;const x=B[c.id]||{},u=x.roleId??c.roleId??((be=c.role)==null?void 0:be.id)??"",R=x.branchId??c.branchId??"",Ge=(c.name||`${c.firstName||""} ${c.lastName||""}`.trim()||"").replace(/"/g,'""'),Ke=(c.email||"").replace(/"/g,'""'),qe=(c.phone||"").replace(/"/g,'""');return[c.id,`"${Ge}"`,`"${Ke}"`,`"${qe}"`,u,R].join(",")}),a=new Blob([[s.join(","),...t].join(`
`)],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download="staff.csv",i.click(),URL.revokeObjectURL(r)},Pe=()=>{y({name:"",email:"",phone:"",password:"",roleId:"",branchId:""}),q(!0)},xe=s=>{y({id:s.id,name:s.name||`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email||"",phone:s.phone||""}),Q(!0)},me=s=>{y({id:s.id,password:""}),X(!0)},pe=async s=>{y(s);const t=new Set((s.roles||s.Roles||[]).map(a=>(a==null?void 0:a.id)??(a==null?void 0:a.roleId)??(a==null?void 0:a.RoleId)).filter(a=>a!=null));if(oe(t),l.length===0){const a=await J(["/roles","/v1/roles","/auth/roles","/iam/roles"],{params:{limit:1e3}});a.ok&&p($(a.data))}W(!0)},Ae=async s=>{var a,r,i,c;const t=await je(`/users/${s.id}`);t.ok||alert(((i=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.error)||((c=t==null?void 0:t.error)==null?void 0:c.message)||"Failed to disable user."),k()},Fe=async s=>{var a,r,i,c;const t=await je(`/users/${s.id}`,{params:{force:1,hard:1},headers:{"X-Force-Delete":"1"},data:{force:!0}});t.ok||alert(((i=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.error)||((c=t==null?void 0:t.error)==null?void 0:c.message)||"Failed to delete user."),k()},Be=async()=>{var a,r,i,c;const s={name:A(d.name),email:A(d.email),phone:A(ye(d.phone)),...d.password?{password:d.password}:{},...d.roleId?{roleId:Number(d.roleId)}:{},...d.branchId?{branchId:Number(d.branchId)}:{}},t=await S("/users",s);t.ok||alert(((i=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.error)||((c=t==null?void 0:t.error)==null?void 0:c.message)||"Failed to create user."),q(!1),y(null),k()},Te=async()=>{var a,r,i,c;const s={name:A(d.name),email:A(d.email),phone:A(ye(d.phone))};let t=await M(`/users/${d.id}`,s);t.ok||(t=await S(`/users/${d.id}`,s)),t.ok||alert(((i=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.error)||((c=t==null?void 0:t.error)==null?void 0:c.message)||"Failed to update user."),Q(!1),y(null),k()},ze=async()=>{var t,a,r,i;let s=await S(`/users/${d.id}/password`,{password:d.password});s.ok||(s=await M(`/users/${d.id}`,{password:d.password})),s.ok||alert(((r=(a=(t=s==null?void 0:s.error)==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.error)||((i=s==null?void 0:s.error)==null?void 0:i.message)||"Failed to set password."),X(!1),y(null),k()},Ue=async()=>{var a,r,i,c;const s=[...se];let t=await S(`/users/${d.id}/roles`,{roleIds:s});t.ok||(t=await M(`/users/${d.id}/roles`,{roleIds:s})),t.ok||(t=await M(`/users/${d.id}`,{roleIds:s})),t.ok||alert(((i=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.error)||((c=t==null?void 0:t.error)==null?void 0:c.message)||"Failed to update roles."),W(!1),y(null),k()},Me=s=>{const t=new Set(se);t.has(s)?t.delete(s):t.add(s),oe(t)},He=s=>{ve(s),ce("profile"),T({hr:null,attendance:null,leave:null,payroll:null}),z({hr:"",attendance:"",leave:"",payroll:""}),ie(!0)},Ve=async(s,t)=>{de(!0);try{if(s==="hr"){let a=await P("/hr/contracts",{params:{userId:t.id,limit:50}});a.ok||(a=await P(`/hr/employees/${t.id}`)),a.ok?T(r=>({...r,hr:$(a.data)})):z(r=>{var i,c,x,u;return{...r,hr:((x=(c=(i=a==null?void 0:a.error)==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"HR endpoint not enabled."}})}if(s==="attendance"){const a=await P("/hr/attendance",{params:{userId:t.id,limit:100}});a.ok?T(r=>({...r,attendance:$(a.data)})):z(r=>{var i,c,x,u;return{...r,attendance:((x=(c=(i=a==null?void 0:a.error)==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Attendance endpoint not enabled."}})}if(s==="leave"){const a=await P("/hr/leave",{params:{userId:t.id,limit:100}});a.ok?T(r=>({...r,leave:$(a.data)})):z(r=>{var i,c,x,u;return{...r,leave:((x=(c=(i=a==null?void 0:a.error)==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Leave endpoint not enabled."}})}if(s==="payroll"){let a=await P("/payroll",{params:{userId:t.id,limit:50}});a.ok||(a=await P("/payroll/entries",{params:{userId:t.id,limit:50}})),a.ok?T(r=>({...r,payroll:$(a.data)})):z(r=>{var i,c,x,u;return{...r,payroll:((x=(c=(i=a==null?void 0:a.error)==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Payroll endpoint not enabled."}})}}finally{de(!1)}};return o.useEffect(()=>{!ee||!f||v!=="profile"&&!j[v]&&Ve(v,f)},[v,ee,f]),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"User & Staff Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{placeholder:"Search name, email, role…",value:m,onChange:s=>g(s.target.value),className:"border rounded px-3 py-1.5 text-sm","aria-label":"Search users"})}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:N,onChange:s=>Z(s.target.value),"aria-label":"Filter by role",children:[e.jsx("option",{value:"",children:"All roles"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:C,onChange:s=>G(s.target.value),"aria-label":"Filter by branch",children:[e.jsx("option",{value:"",children:"All branches"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(I,{onClick:k,disabled:D,children:D?"Loading…":"Refresh"}),e.jsx(H,{onClick:Pe,children:"Add Staff"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsxs("span",{className:"opacity-70",children:["Selected: ",L.size]}),e.jsxs("select",{className:"border rounded px-2 py-1",onChange:s=>{const t=s.target.value;t&&(Le(t),s.target.value="")},"aria-label":"Bulk assign role",defaultValue:"",children:[e.jsx("option",{value:"",children:"Bulk: set role…"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]}),e.jsxs("select",{className:"border rounded px-2 py-1",onChange:s=>{const t=s.target.value;t&&(De(t),s.target.value="")},"aria-label":"Bulk assign branch",defaultValue:"",children:[e.jsx("option",{value:"",children:"Bulk: set branch…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(I,{onClick:Oe,children:"Export CSV"})]}),re&&e.jsx("div",{className:"text-sm text-red-600",children:re}),D?e.jsx("p",{children:"Loading users..."}):e.jsx("div",{className:"overflow-x-auto bg-white border rounded",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-100 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsx("input",{type:"checkbox",checked:ne,onChange:$e,"aria-label":"Select all"})}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Phone"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Role"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Branch"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"text-sm",children:[n.map(s=>{var t,a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:L.has(s.id),onChange:()=>Re(s.id),"aria-label":`Select ${s.name||s.email||s.id}`})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>He(s),title:"Open staff profile",children:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||"—"})}),e.jsx("td",{className:"px-4 py-2",children:s.email||"—"}),e.jsx("td",{className:"px-4 py-2",children:s.phone||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 min-w-[180px]",value:((t=B[s.id])==null?void 0:t.roleId)??"",onChange:r=>he(s.id,{roleId:r.target.value}),children:[e.jsx("option",{value:"",children:"— Select Role —"}),l.map(r=>e.jsx("option",{value:r.id,children:r.name||r.title},r.id))]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 min-w-[180px]",value:((a=B[s.id])==null?void 0:a.branchId)??"",onChange:r=>he(s.id,{branchId:r.target.value}),children:[e.jsx("option",{value:"",children:"— Select Branch —"}),b.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",disabled:!Ce(s)||F[s.id],onClick:()=>Ee(s),children:F[s.id]?"Saving…":"Save"}),e.jsx(Xe,{actions:[{label:"Edit",onClick:()=>xe(s)},{label:"Manage Roles (multi)",onClick:()=>pe(s)},{label:"Set/Reset Password",onClick:()=>me(s)},{label:"Disable",onClick:()=>Ae(s),danger:!0},{label:"Delete (hard)",onClick:()=>Fe(s),danger:!0}]})]})})]},s.id)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-500",colSpan:7,children:"No users found."})})]})]})}),Ne&&e.jsxs(Y,{title:"Add Staff",onClose:()=>q(!1),children:[e.jsxs("div",{className:"grid gap-2",children:[["name","email","phone","password"].map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:s}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",type:s==="password"?"password":"text",value:(d==null?void 0:d[s])??"",onChange:t=>y(a=>({...a,[s]:t.target.value})),placeholder:s==="phone"?"digits only":""})]},s)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Role (optional)"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:(d==null?void 0:d.roleId)??"",onChange:s=>y(t=>({...t,roleId:s.target.value})),children:[e.jsx("option",{value:"",children:"— Select Role —"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch (optional)"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:(d==null?void 0:d.branchId)??"",onChange:s=>y(t=>({...t,branchId:s.target.value})),children:[e.jsx("option",{value:"",children:"— Select Branch —"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(I,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(H,{onClick:Be,children:"Create"})]})]}),we&&e.jsxs(Y,{title:"Edit Staff",onClose:()=>Q(!1),children:[e.jsx("div",{className:"grid gap-2",children:["name","email","phone"].map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:s}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:(d==null?void 0:d[s])??"",onChange:t=>y(a=>({...a,[s]:t.target.value})),placeholder:s==="phone"?"digits only":""})]},s))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(I,{onClick:()=>Q(!1),children:"Cancel"}),e.jsx(H,{onClick:Te,children:"Save"})]})]}),Se&&e.jsxs(Y,{title:"Set/Reset Password",onClose:()=>X(!1),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"New Password"}),e.jsx("input",{type:"password",className:"border rounded px-2 py-1 text-sm w-full",value:(d==null?void 0:d.password)??"",onChange:s=>y(t=>({...t,password:s.target.value}))})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(I,{onClick:()=>X(!1),children:"Cancel"}),e.jsx(H,{onClick:ze,children:"Set Password"})]})]}),ke&&e.jsxs(Y,{title:`Manage Roles • ${(d==null?void 0:d.name)||(d==null?void 0:d.email)||""}`,onClose:()=>W(!1),children:[e.jsx("div",{className:"max-h-[50vh] overflow-auto border rounded p-2",children:l.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No roles found."}):l.map(s=>{const t=s.id??s.roleId??s.RoleId,a=s.name||s.title||`#${t}`,r=se.has(t);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>Me(t)}),e.jsx("span",{className:"text-sm",children:a})]},t)})}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(I,{onClick:()=>W(!1),children:"Cancel"}),e.jsx(H,{onClick:Ue,children:"Save Roles"})]})]}),ee&&f&&e.jsxs(Je,{title:`Staff • ${f.name||f.email||""}`,onClose:()=>ie(!1),wide:!0,children:[e.jsx("div",{className:"border-b mb-3",children:e.jsx("div",{className:"flex gap-2",children:["profile","hr","attendance","leave","payroll"].map(s=>e.jsx("button",{className:`px-3 py-1.5 text-sm rounded-t ${v===s?"bg-blue-600 text-white":"bg-slate-100 hover:bg-slate-200"}`,onClick:()=>ce(s),children:s[0].toUpperCase()+s.slice(1)},s))})}),v==="profile"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Basics"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Name:"})," ",f.name||`${f.firstName||""} ${f.lastName||""}`.trim()||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Email:"})," ",f.email||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Phone:"})," ",f.phone||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Role:"})," ",((ue=f.role)==null?void 0:ue.name)||f.role||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Branch:"})," ",((fe=b.find(s=>String(s.id)===String(f.branchId)))==null?void 0:fe.name)||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"User ID:"})," ",f.id]})]}),e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:()=>xe(f),children:"Edit"}),e.jsx(I,{onClick:()=>pe(f),children:"Roles"}),e.jsx(I,{onClick:()=>me(f),children:"Password"})]})]})]}),v!=="profile"&&U&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading…"}),v==="hr"&&!U&&e.jsx("div",{children:E.hr?e.jsx("div",{className:"text-sm text-amber-700",children:E.hr}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"HR • Contracts/Employee Info"}),!j.hr||j.hr.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No HR records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Title"}),e.jsx("th",{className:"py-1 px-2",children:"Start"}),e.jsx("th",{className:"py-1 px-2",children:"End"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.hr.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.title||s.position||"—"}),e.jsx("td",{className:"py-1 px-2",children:((a=s.startDate||s.start)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:((r=s.endDate||s.end)==null?void 0:r.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),v==="attendance"&&!U&&e.jsx("div",{children:E.attendance?e.jsx("div",{className:"text-sm text-amber-700",children:E.attendance}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Attendance (latest 100)"}),!j.attendance||j.attendance.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No attendance records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Date"}),e.jsx("th",{className:"py-1 px-2",children:"In"}),e.jsx("th",{className:"py-1 px-2",children:"Out"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.attendance.map((s,t)=>{var a;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:((a=s.date||s.day||s.createdAt)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.clockIn||s.in||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.clockOut||s.out||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),v==="leave"&&!U&&e.jsx("div",{children:E.leave?e.jsx("div",{className:"text-sm text-amber-700",children:E.leave}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Leave Requests"}),!j.leave||j.leave.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No leave records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Type"}),e.jsx("th",{className:"py-1 px-2",children:"From"}),e.jsx("th",{className:"py-1 px-2",children:"To"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.leave.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.type||"—"}),e.jsx("td",{className:"py-1 px-2",children:((a=s.from||s.startDate)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:((r=s.to||s.endDate)==null?void 0:r.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),v==="payroll"&&!U&&e.jsx("div",{children:E.payroll?e.jsx("div",{className:"text-sm text-amber-700",children:E.payroll}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Payroll Entries"}),!j.payroll||j.payroll.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No payroll entries."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Period"}),e.jsx("th",{className:"py-1 px-2",children:"Gross"}),e.jsx("th",{className:"py-1 px-2",children:"Net"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.payroll.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.period||`${(r=(a=(s.month||"").toString()).padStart)==null?void 0:r.call(a,2,"0")}/${s.year||""}`}),e.jsx("td",{className:"py-1 px-2",children:s.gross!=null?Number(s.gross).toLocaleString():"—"}),e.jsx("td",{className:"py-1 px-2",children:s.net!=null?Number(s.net).toLocaleString():"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})})]})]})};export{Ze as default};
