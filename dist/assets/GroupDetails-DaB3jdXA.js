import{i as N,r as m,j as s,g as h}from"./index-CSL_HVM5.js";import{B as j}from"./BorrowerAutoComplete-BnLcnrEs.js";async function b(e=[],o={}){let r;for(const c of e)try{const n=await h.get(c,o);return n==null?void 0:n.data}catch(n){r=n}throw r||new Error("No endpoint succeeded")}async function S(e=[],o={},r={}){let c;for(const n of e)try{const a=await h.post(n,o,r);return a==null?void 0:a.data}catch(a){c=a}throw c||new Error("No endpoint succeeded")}async function v(e=[],o={}){let r;for(const c of e)try{const n=await h.delete(c,o);return n==null?void 0:n.data}catch(n){r=n}throw r||new Error("No endpoint succeeded")}function A(e){return{id:e.id??e._id??e.borrowerId??e.memberId,name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||e.fullName||e.id,phone:e.phone??e.msisdn??e.mobile,role:e.role||e.memberRole}}function g(e){var r,c,n;if(!e||typeof e!="object")return null;const o=Array.isArray(e.members)?e.members:e.groupMembers||e.items||[];return{id:e.id??e._id??e.groupId??e.code,name:e.name??e.groupName??e.title??"—",branchName:e.branchName??((r=e.branch)==null?void 0:r.name)??"—",officerName:e.officerName??((c=e.officer)==null?void 0:c.name)??"—",meetingDay:e.meetingDay??((n=e.meeting)==null?void 0:n.day)??"—",members:o.map(A)}}async function E(e,o){const r=encodeURIComponent(e),c=await b([`/borrowers/groups/${r}`,`/groups/${r}`,`/borrower-groups/${r}`,`/api/borrowers/groups/${r}`,`/api/groups/${r}`,`/api/borrower-groups/${r}`],{signal:o}).catch(()=>null);if(c)return g(c);const n=await b([`/borrowers/groups?id=${r}&include=members`,`/borrowers/groups?groupId=${r}&include=members`,`/borrowers/groups?code=${r}&include=members`,`/groups?id=${r}&include=members`,`/groups?groupId=${r}&include=members`,`/groups?code=${r}&include=members`,`/borrower-groups?id=${r}&include=members`,`/borrower-groups?groupId=${r}&include=members`,`/borrower-groups?code=${r}&include=members`,`/api/borrowers/groups?id=${r}&include=members`,`/api/borrowers/groups?groupId=${r}&include=members`,`/api/borrowers/groups?code=${r}&include=members`,`/api/groups?id=${r}&include=members`,`/api/groups?groupId=${r}&include=members`,`/api/groups?code=${r}&include=members`,`/api/borrower-groups?id=${r}&include=members`,`/api/borrower-groups?groupId=${r}&include=members`,`/api/borrower-groups?code=${r}&include=members`],{signal:o}).catch(()=>null)||null;if(n){const d=Array.isArray(n)?n:n.items||n.rows||n.data||[];if(d.length){const l=d.find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e))||d[0];if(l)return g(l)}}const a=await b(["/borrowers/groups?include=members","/groups?include=members","/borrower-groups?include=members","/api/borrowers/groups?include=members","/api/groups?include=members","/api/borrower-groups?include=members"],{signal:o}).catch(()=>null);if(a){const l=(Array.isArray(a)?a:a.items||a.rows||a.data||[]).find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e));if(l)return g(l)}return null}const C=()=>{const{groupId:e}=N(),[o,r]=m.useState(null),[c,n]=m.useState(!0),[a,d]=m.useState(""),[l,i]=m.useState(null),[f,w]=m.useState(!1),p=async t=>{try{n(!0),d("");const u=await E(e,t);u?r(u):(d("Group not found."),r(null))}catch{d("Failed to load group (endpoint not implemented)."),r(null)}finally{n(!1)}};m.useEffect(()=>{const t=new AbortController;return p(t.signal),()=>t.abort()},[e]);const y=async()=>{if(l!=null&&l.id){w(!0);try{await S([`/borrowers/groups/${e}/members`,`/groups/${e}/members`,`/borrower-groups/${e}/members`,`/api/borrowers/groups/${e}/members`,`/api/groups/${e}/members`,`/api/borrower-groups/${e}/members`],{borrowerId:l.id}),i(null),await p()}catch{alert("Failed to add member.")}finally{w(!1)}}},$=async t=>{try{await v([`/borrowers/groups/${e}/members/${t}`,`/groups/${e}/members/${t}`,`/borrower-groups/${e}/members/${t}`,`/api/borrowers/groups/${e}/members/${t}`,`/api/groups/${e}/members/${t}`,`/api/borrower-groups/${e}/members/${t}`]),await p()}catch{alert("Failed to remove member.")}},x=Array.isArray(o==null?void 0:o.members)?o.members:[];return s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("h1",{className:"text-2xl font-semibold",children:["Group #",e]}),c&&s.jsx("div",{children:"Loading…"}),a&&s.jsx("div",{className:"text-red-600",children:a}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white rounded shadow p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Overview"}),s.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[s.jsxs("li",{children:[s.jsx("b",{children:"Name:"})," ",(o==null?void 0:o.name)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Branch:"})," ",(o==null?void 0:o.branchName)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Officer:"})," ",(o==null?void 0:o.officerName)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Meeting Day:"})," ",(o==null?void 0:o.meetingDay)??"—"]})]})]}),s.jsxs("div",{className:"bg-white rounded shadow p-4 lg:col-span-2",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Members"}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx(j,{value:l,onChange:(t,u)=>i(u),placeholder:"Add borrower…"})}),s.jsx("button",{onClick:y,disabled:!l||f,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60",children:f?"Adding…":"Add"})]}),s.jsx("ul",{className:"text-sm divide-y",children:x.length===0?s.jsx("li",{className:"py-2 text-gray-500",children:"No members yet."}):x.map(t=>s.jsxs("li",{className:"py-2 flex items-center justify-between",children:[s.jsxs("div",{children:[t.name," ",s.jsxs("span",{className:"text-gray-500",children:["• ",t.phone||"—"]}),t.role&&s.jsx("span",{className:"ml-2 text-xs uppercase text-gray-400",children:t.role})]}),s.jsx("button",{className:"px-2 py-1 border rounded hover:bg-gray-50",onClick:()=>$(t.id),children:"Remove"})]},t.id))})]})]})]})};export{C as default};
