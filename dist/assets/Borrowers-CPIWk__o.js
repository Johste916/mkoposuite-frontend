import{u as he,r,c as g,j as e,L as X}from"./index-DKzQi57G.js";import{C as pe,U as ue}from"./users-6ZcuTmEW.js";import{U as ge,P as je,B as Ne,X as ye,I as fe}from"./x-FIlXLLB6.js";import{c as C}from"./createLucideIcon-D_CKCQ4i.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],be=C("chevron-left",ve);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Se=C("chevron-right",we);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],ke=C("file-up",Ce);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Le=C("funnel",Ae);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],De=C("search",$e),S=10,Fe=()=>{const t=he(),[a,m]=r.useState([]),[d,u]=r.useState(0),[o,k]=r.useState(""),[w,J]=r.useState(""),[I,W]=r.useState(""),[O,ee]=r.useState(""),[B,se]=r.useState(""),[x,te]=r.useState("createdAt"),[h,U]=r.useState("desc"),[p,j]=r.useState(1),[ae,re]=r.useState([]),[le,ne]=r.useState([]),[E,F]=r.useState(!0),[T,ce]=r.useState(null),[_,K]=r.useState(!1),[N,q]=r.useState("overview"),[ie,z]=r.useState(!1),[A,L]=r.useState({overview:null,loans:[],savings:[],documents:[]}),[de,R]=r.useState([]),$=(s,l="info")=>{const n=Math.random().toString(36).slice(2);R(i=>[...i,{id:n,msg:s,type:l}]),setTimeout(()=>R(i=>i.filter(c=>c.id!==n)),3500)};r.useEffect(()=>{const s=setTimeout(()=>J(o.trim()),300);return()=>clearTimeout(s)},[o]),r.useEffect(()=>{const s=new AbortController;return Promise.all([g.get("/branches",{signal:s.signal}).catch(()=>({data:[]})),g.get("/users",{params:{role:"loan_officer"},signal:s.signal}).catch(()=>({data:[]}))]).then(([l,n])=>{re(Array.isArray(l.data)?l.data:[]),ne(Array.isArray(n.data)?n.data:[])}).catch(()=>$("Failed to load filters","error")),()=>s.abort()},[]);const V=r.useCallback(async s=>{var l,n,i;F(!0);try{const c=await g.get("/borrowers",{signal:s,params:{q:w||void 0,branchId:I||void 0,officerId:O||void 0,status:B||void 0,page:p,pageSize:S,sort:x,dir:h}});let D=[],M=0;Array.isArray(c.data)?(D=c.data,M=c.data.length):(D=((l=c.data)==null?void 0:l.items)||((n=c.data)==null?void 0:n.rows)||[],M=Number(((i=c.data)==null?void 0:i.total)??D.length??0)),m(D),u(M)}catch{$("Failed to load borrowers","error"),m([]),u(0)}finally{F(!1)}},[w,I,O,B,p,x,h]);r.useEffect(()=>{const s=new AbortController;return V(s.signal),()=>s.abort()},[V]);const Z=s=>{ce(s),q("overview"),K(!0)},Q=r.useCallback(async(s,l,n)=>{z(!0);try{if(s==="overview"){const i=await g.get(`/borrowers/${l}`,{signal:n});L(c=>({...c,overview:i.data||null}))}else if(s==="loans"){const i=await g.get(`/borrowers/${l}/loans`,{signal:n});L(c=>({...c,loans:i.data||[]}))}else if(s==="savings"){const i=await g.get(`/borrowers/${l}/savings`,{signal:n});L(c=>({...c,savings:i.data||[]}))}else if(s==="documents"){const i=await g.get(`/borrowers/${l}/documents`,{signal:n});L(c=>({...c,documents:i.data||[]}))}}catch{$("Failed to load borrower details","error")}finally{z(!1)}},[]);r.useEffect(()=>{if(!_||!T)return;const s=new AbortController;return Q(N,T,s.signal),()=>s.abort()},[_,N,T,Q]);const y=s=>{x===s?U(l=>l==="asc"?"desc":"asc"):(te(s),U("asc"))},Y=s=>`TZS ${Number(s||0).toLocaleString()}`,oe=r.useMemo(()=>d===0?0:(p-1)*S+1,[p,d]),xe=r.useMemo(()=>Math.min(p*S,d),[p,d]),H=s=>s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||"â€”",G=s=>{var l,n;return s.branchName||((l=s.Branch)==null?void 0:l.name)||((n=s.branch)==null?void 0:n.name)||"â€”"},me=s=>{var l,n;return s.officerName||((l=s.officer)==null?void 0:l.name)||((n=s.loanOfficer)==null?void 0:n.name)||"â€”"};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:de.map(s=>e.jsx("div",{className:`px-3 py-2 rounded shadow text-sm text-white ${s.type==="error"?"bg-red-600":s.type==="success"?"bg-emerald-600":"bg-slate-800"}`,children:s.msg},s.id))}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:"ðŸ‘¥ Borrowers"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>t("/borrowers/add"),className:"inline-flex items-center gap-2 px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:[e.jsx(pe,{className:"w-4 h-4"})," Add Borrower"]}),e.jsxs("button",{onClick:()=>$("CSV import coming soon","info"),className:"inline-flex items-center gap-2 px-3 py-2 rounded border bg-white hover:bg-gray-50",children:[e.jsx(ge,{className:"w-4 h-4"})," Import CSV"]})]})]}),e.jsx("div",{className:"bg-white rounded-md shadow p-3 md:p-4 mb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(De,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{value:o,onChange:s=>{k(s.target.value),j(1)},placeholder:"Search by name, phone, national IDâ€¦",className:"w-full border rounded pl-9 pr-3 py-2"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:I,onChange:s=>{W(s.target.value),j(1)},className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"All Branches"}),ae.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:O,onChange:s=>{ee(s.target.value),j(1)},className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"All Officers"}),le.map(s=>e.jsx("option",{value:s.id,children:s.name||s.email},s.id))]}),e.jsxs("select",{value:B,onChange:s=>{se(s.target.value),j(1)},className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending_kyc",children:"Pending KYC"}),e.jsx("option",{value:"blacklisted",children:"Blacklisted"})]}),e.jsxs("div",{className:"hidden md:flex items-center text-gray-500 text-sm px-2",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"})," Filters"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-md shadow",children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm hidden md:table",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx(f,{label:"Name",sortKey:"name",sort:x,dir:h,onSort:y}),e.jsx(f,{label:"Phone",sortKey:"phone",sort:x,dir:h,onSort:y}),e.jsx(f,{label:"Branch",sortKey:"branchName",sort:x,dir:h,onSort:y}),e.jsx(f,{label:"Officer",sortKey:"officerName",sort:x,dir:h,onSort:y}),e.jsx(f,{label:"Outstanding",sortKey:"outstanding",sort:x,dir:h,onSort:y}),e.jsx(f,{label:"Status",sortKey:"status",sort:x,dir:h,onSort:y}),e.jsx("th",{className:"px-3 py-2 text-right pr-4",children:"Actions"})]})}),e.jsx("tbody",{children:E?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500",children:"Loadingâ€¦"})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500",children:"No borrowers."})}):a.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:H(s)}),e.jsx("td",{className:"px-4 py-2",children:s.phone||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:G(s)}),e.jsx("td",{className:"px-4 py-2",children:me(s)}),e.jsx("td",{className:"px-4 py-2",children:Y(s.outstanding)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded border ${s.status==="active"?"bg-emerald-50 border-emerald-300 text-emerald-700":s.status==="pending_kyc"?"bg-yellow-50 border-yellow-300 text-yellow-700":s.status==="blacklisted"?"bg-red-50 border-red-300 text-red-700":"bg-gray-50 border-gray-300 text-gray-700"}`,children:s.status||"â€”"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>Z(s.id),className:"underline text-indigo-600",children:"View"}),e.jsx(X,{to:`/loans/applications?borrowerId=${encodeURIComponent(s.id)}`,className:"underline text-blue-600",children:"New Loan"})]})})]},s.id))})]}),e.jsx("div",{className:"md:hidden divide-y",children:E?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loadingâ€¦"}):a.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No borrowers."}):a.map(s=>e.jsxs("div",{className:"p-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"})," ",H(s)]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1 mt-1",children:[e.jsx(je,{className:"w-3 h-3"})," ",s.phone||"â€”"]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3"})," ",G(s)]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Outstanding: ",Y(s.outstanding)]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`text-[11px] px-2 py-0.5 rounded border ${s.status==="active"?"bg-emerald-50 border-emerald-300 text-emerald-700":s.status==="pending_kyc"?"bg-yellow-50 border-yellow-300 text-yellow-700":s.status==="blacklisted"?"bg-red-50 border-red-300 text-red-700":"bg-gray-50 border-gray-300 text-gray-700"}`,children:s.status||"â€”"})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:()=>Z(s.id),className:"underline text-indigo-600",children:"View"}),e.jsx(X,{to:`/loans/applications?borrowerId=${encodeURIComponent(s.id)}`,className:"underline text-blue-600 text-sm",children:"New Loan"})]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:[oe,"â€“",xe," of ",d]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(s=>Math.max(1,s-1)),disabled:p===1,className:"p-1 border rounded disabled:opacity-50",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(s=>s*S<d?s+1:s),disabled:p*S>=d,className:"p-1 border rounded disabled:opacity-50",children:e.jsx(Se,{className:"w-4 h-4"})})]})]})]}),_&&e.jsxs(Ie,{onClose:()=>K(!1),title:"Borrower Details",children:[e.jsx("div",{className:"flex gap-2 border-b mb-3",children:["overview","loans","savings","documents"].map(s=>e.jsx("button",{onClick:()=>q(s),className:`px-3 py-2 text-sm border-b-2 -mb-px ${N===s?"border-indigo-600 text-indigo-700":"border-transparent text-gray-600"}`,children:s[0].toUpperCase()+s.slice(1)},s))}),e.jsx("div",{children:ie?e.jsx("div",{className:"text-gray-500 text-sm",children:"Loadingâ€¦"}):N==="overview"?e.jsx(Oe,{data:A.overview}):N==="loans"?e.jsx(Be,{items:A.loans}):N==="savings"?e.jsx(Te,{items:A.savings}):e.jsx(_e,{items:A.documents})})]})]})},f=({label:t,sortKey:a,sort:m,dir:d,onSort:u})=>{const o=m===a;return e.jsx("th",{className:"px-3 py-2 cursor-pointer select-none",onClick:()=>u(a),title:"Sort",children:e.jsxs("span",{className:`inline-flex items-center gap-1 ${o?"text-indigo-700":""}`,children:[t,o?d==="asc"?"â–²":"â–¼":""]})})},Ie=({title:t,onClose:a,children:m})=>e.jsxs("div",{className:"fixed inset-0 z-[60]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:a}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full sm:w-[540px] bg-white shadow-xl p-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:t}),e.jsx("button",{onClick:a,className:"p-1 rounded hover:bg-gray-100",children:e.jsx(ye,{className:"w-5 h-5"})})]}),m]})]}),Oe=({data:t})=>{var u,o,k,w;if(!t)return e.jsx("p",{className:"text-gray-500 text-sm",children:"No overview data."});const a=t.name||`${t.firstName||""} ${t.lastName||""}`.trim()||"â€”",m=t.branchName||((u=t.Branch)==null?void 0:u.name)||((o=t.branch)==null?void 0:o.name)||"â€”",d=t.officerName||((k=t.officer)==null?void 0:k.name)||((w=t.loanOfficer)==null?void 0:w.name)||"â€”";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(v,{label:"Full Name",value:a}),e.jsx(v,{label:"Phone",value:t.phone||"â€”"}),e.jsx(v,{label:"Branch",value:m}),e.jsx(v,{label:"Loan Officer",value:d}),e.jsx(v,{label:"Status",value:t.status||"â€”"}),e.jsx(v,{label:"National ID",value:t.nationalId||"â€”"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(P,{label:"Outstanding Loan",value:b(t.outstandingLoan)}),e.jsx(P,{label:"Outstanding Interest",value:b(t.outstandingInterest)}),e.jsx(P,{label:"Net Savings",value:b(t.netSavings)})]})]})},Be=({items:t})=>!Array.isArray(t)||t.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No loans."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Loan #"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Disbursed"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Outstanding"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:t.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:a.id}),e.jsx("td",{className:"px-3 py-2",children:a.product||"â€”"}),e.jsx("td",{className:"px-3 py-2",children:b(a.disbursed)}),e.jsx("td",{className:"px-3 py-2",children:b(a.outstanding)}),e.jsx("td",{className:"px-3 py-2",children:a.status||"â€”"})]},a.id))})]})}),Te=({items:t})=>!Array.isArray(t)||t.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No savings accounts."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Account #"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Balance"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:t.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:a.id}),e.jsx("td",{className:"px-3 py-2",children:b(a.balance)}),e.jsx("td",{className:"px-3 py-2",children:a.status||"â€”"})]},a.id))})]})}),_e=({items:t})=>e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("button",{onClick:()=>alert("KYC upload coming soon"),className:"inline-flex items-center gap-2 px-3 py-2 border rounded bg-white hover:bg-gray-50",children:[e.jsx(ke,{className:"w-4 h-4"})," Upload Document"]})}),!Array.isArray(t)||t.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No documents."}):e.jsx("ul",{className:"space-y-2",children:t.map(a=>e.jsxs("li",{className:"border rounded p-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:a.fileName||"Document"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.type||"KYC"," â€¢ ",new Date(a.createdAt).toLocaleString()]})]})]}),a.url&&e.jsx("a",{className:"text-indigo-600 underline text-sm",href:a.url,target:"_blank",rel:"noreferrer",children:"Open"})]},a.id))})]}),v=({label:t,value:a})=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:t}),e.jsx("p",{className:"text-sm font-medium text-gray-800 mt-0.5",children:a})]}),P=({label:t,value:a})=>e.jsxs("div",{className:"bg-gray-50 border rounded p-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:t}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-0.5",children:a})]}),b=t=>`TZS ${Number(t||0).toLocaleString()}`;export{Fe as default};
