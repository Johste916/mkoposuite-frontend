import{u as D,r as l,j as e,g as y}from"./index-CecoMAn-.js";const m=(...d)=>d.filter(Boolean).join(" "),P=d=>Number.isFinite(Number(d))?new Intl.NumberFormat().format(Number(d)):"—";function B(){const d=D(),[g,S]=l.useState([]),[M,v]=l.useState(!1),[j,R]=l.useState(""),[u,$]=l.useState({by:"name",dir:"asc"}),[r,b]=l.useState(1),[c,A]=l.useState(10),f="rounded-md border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900",w="px-3 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm focus:outline-none",N=async t=>{var a,n;v(!0);try{const s=await y.get("/loan-products",{params:{q:j},signal:t}),i=Array.isArray(s.data)?s.data:Array.isArray((a=s.data)==null?void 0:a.items)?s.data.items:((n=s.data)==null?void 0:n.data)||[];S(i)}catch(s){(s==null?void 0:s.name)!=="CanceledError"&&alert("Failed to load loan products.")}finally{v(!1)}};l.useEffect(()=>{const t=new AbortController,a=setTimeout(()=>N(t.signal),220);return()=>{clearTimeout(a),t.abort()}},[j]);const x=l.useMemo(()=>{const t=[...g],{by:a,dir:n}=u;return t.sort((s,i)=>{const h=(((s==null?void 0:s[a])??"")+"").toLowerCase(),C=(((i==null?void 0:i[a])??"")+"").toLowerCase();return h<C?n==="asc"?-1:1:h>C?n==="asc"?1:-1:0}),t},[g,u]),p=Math.max(1,Math.ceil(x.length/c)),L=l.useMemo(()=>{const t=(r-1)*c;return x.slice(t,t+c)},[x,r,c]),k=()=>d("/loans/products/new"),E=t=>d(`/loans/products/${t.id}/edit`),F=async t=>{if(confirm(`Set "${t.name}" to ${t.status==="active"?"inactive":"active"}?`))try{await y.patch(`/loan-products/${t.id}/toggle`),await N()}catch{alert("Failed to update status.")}},T=async t=>{if(confirm(`Delete product "${t.name}" permanently?`))try{await y.delete(`/loan-products/${t.id}`),await N()}catch{alert("Failed to delete product.")}},z=({value:t})=>{const a=(t||"").toLowerCase(),n=a==="active"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-slate-200 text-slate-700 dark:bg-slate-800 dark:text-slate-300";return e.jsx("span",{className:m("px-2 py-0.5 rounded text-xs font-medium",n),children:a||"—"})},o=({id:t,children:a,className:n})=>{const s=u.by===t,i=s?u.dir:"asc";return e.jsx("th",{className:m("p-2 border-b border-[var(--border)] text-left text-xs uppercase tracking-wide",n),children:e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 hover:underline",onClick:()=>$(h=>h.by===t?{by:t,dir:h.dir==="asc"?"desc":"asc"}:{by:t,dir:"asc"}),children:[e.jsx("span",{children:a}),s&&e.jsx("span",{className:"opacity-60",children:i==="asc"?"▲":"▼"})]})})};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Loan Products"}),e.jsx("p",{className:"muted text-sm",children:"Define the lending terms your team can use."})]}),e.jsx("button",{onClick:k,className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"New Product"})]}),e.jsxs("div",{className:`${f} p-3 flex flex-col md:flex-row gap-3 md:items-center md:justify-between`,children:[e.jsx("input",{className:m(w,"md:w-96"),placeholder:"Search by name or code…",value:j,onChange:t=>{R(t.target.value),b(1)},"aria-label":"Search products"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"text-xs",children:["Page size",e.jsx("select",{className:m(w,"ml-2 px-2 py-1"),value:c,onChange:t=>{A(Number(t.target.value)),b(1)},"aria-label":"Page size",children:[10,20,50].map(t=>e.jsx("option",{value:t,children:t},t))})]})})]}),e.jsx("div",{className:`${f} overflow-x-auto`,children:M?e.jsx("p",{className:"p-4 muted",children:"Loading…"}):g.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-sm muted mb-3",children:"No products found."}),e.jsx("button",{onClick:k,className:"px-3 py-2 rounded bg-indigo-600 text-white",children:"Create your first product"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(o,{id:"name",children:"Name"}),e.jsx(o,{id:"code",children:"Code"}),e.jsx(o,{id:"interestMethod",children:"Method"}),e.jsx(o,{id:"interestRate",className:"text-right",children:"Rate (%)"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)] text-right",children:"Principal Range"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)] text-right",children:"Term Range"}),e.jsx(o,{id:"penaltyRate",className:"text-right",children:"Penalty (%)"}),e.jsx(o,{id:"status",children:"Status"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)]",children:"Actions"})]})}),e.jsx("tbody",{children:L.map(t=>e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-2 py-2 font-medium",children:t.name}),e.jsx("td",{className:"px-2 py-2",children:t.code}),e.jsx("td",{className:"px-2 py-2",children:t.interestMethod}),e.jsx("td",{className:"px-2 py-2 text-right",children:t.interestRate??"—"}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[t.minPrincipal!=null?P(t.minPrincipal):"—"," – ",t.maxPrincipal!=null?P(t.maxPrincipal):"—"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[t.minTermMonths??"—"," – ",t.maxTermMonths??"—"," m"]}),e.jsx("td",{className:"px-2 py-2 text-right",children:t.penaltyRate??"—"}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(z,{value:t.status})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>E(t),children:"Edit"}),e.jsx("button",{className:"text-amber-700 hover:underline",onClick:()=>F(t),children:t.status==="active"?"Deactivate":"Activate"}),e.jsx("button",{className:"text-rose-600 hover:underline",onClick:()=>T(t),children:"Delete"})]})})]},t.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("div",{className:"text-xs muted",children:["Showing ",(r-1)*c+1,"–",Math.min(r*c,x.length)," of ",x.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:r===1,onClick:()=>b(t=>Math.max(1,t-1)),className:m("px-3 py-1 rounded border text-sm",r===1?"opacity-50 cursor-not-allowed border-slate-200 dark:border-slate-800":"border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"),children:"Prev"}),e.jsxs("div",{className:"text-sm",children:[r," / ",p]}),e.jsx("button",{disabled:r>=p,onClick:()=>b(t=>Math.min(p,t+1)),className:m("px-3 py-1 rounded border text-sm",r>=p?"opacity-50 cursor-not-allowed border-slate-200 dark:border-slate-800":"border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"),children:"Next"})]})]})]})})]})}export{B as default};
