import{r as c,h as b,j as r,L as h}from"./index-DYDSVKWX.js";const w=()=>(typeof b.getTenantId=="function"?b.getTenantId():null)||localStorage.getItem("activeTenantId")||null,v="00000000-0000-0000-0000-000000000000",y=e=>!!e&&e!==v&&e!=="null"&&e!=="undefined",$=e=>e?{headers:{"x-tenant-id":e}}:{};function C(e){const o=(e||"").replace(/^\/+/,"");return Array.from(new Set([`/${o}`,`/api/${o}`,`/api/v1/${o}`,`/v1/${o}`]))}async function S(e=[],o={}){let t;for(const d of e)try{const a=await b.get(d,o);return a==null?void 0:a.data}catch(a){t=a}throw t||new Error("No endpoint succeeded")}const f=e=>Array.isArray(e)?e:(e==null?void 0:e.items)||(e==null?void 0:e.rows)||(e==null?void 0:e.data)||(e==null?void 0:e.results)||(e==null?void 0:e.groups)||[];function A(e){return f(e).map(t=>{var a,l,u;return{id:t.id??t._id??t.groupId??t.code??t.slug??t.uuid??String(Math.random()),name:t.name??t.groupName??t.title??"—",membersCount:t.membersCount??t.memberCount??f(t.members).length??t.size??0,branchName:t.branchName??((a=t.branch)==null?void 0:a.name)??"—",totalLoans:t.totalLoans??t.loanCount??((l=t.stats)==null?void 0:l.loans)??0,outstanding:t.totalLoanAmount??t.outstanding??((u=t.stats)==null?void 0:u.outstanding)??0}})}const n={container:"w-full px-4 md:px-6 lg:px-8 py-6 min-h-screen bg-[var(--bg)] text-[var(--fg)]",card:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow-lg",head:"bg-[var(--kpi-bg)] sticky top-0",th:"px-3 py-3 font-semibold border-b-2 border-[var(--border)] text-left",td:"px-3 py-2",row:"odd:bg-[var(--card)] even:bg-[var(--kpi-bg)] border-t border-[var(--border)]",actions:"px-3 py-2 text-right",linkStrong:"inline-flex items-center gap-1 font-semibold no-underline text-indigo-700 hover:text-indigo-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 rounded",muted:"text-[var(--muted)]",danger:"text-[var(--danger-fg)]",btn:"px-3 py-2 rounded-lg border-2 border-[var(--border-strong)] hover:bg-[var(--kpi-bg)]",cta:"px-4 py-2 rounded-lg bg-white text-indigo-700 font-semibold border border-indigo-600 shadow hover:bg-indigo-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-300"};function L(){const e=c.useMemo(()=>w(),[]),o=y(e)?e:null,t=o?`?tenantId=${encodeURIComponent(o)}`:"",d=$(o),[a,l]=c.useState([]),[u,p]=c.useState(!0),[x,g]=c.useState(""),m=async s=>{p(!0),g("");try{const i=[o&&`tenants/${o}/groups?include=members`,o&&`tenants/${o}/groups`,"groups?include=members","groups","loan-groups?include=members","loan-groups","borrowers/groups?include=members","borrowers/groups","borrower-groups?include=members","borrower-groups"].filter(Boolean).flatMap(C),j=await S(i,{...d,signal:s});l(A(j))}catch(i){(i==null?void 0:i.name)!=="CanceledError"&&(i==null?void 0:i.code)!=="ERR_CANCELED"&&(console.warn("Group list fetch failed:",i),l([]),g("Failed to load groups (endpoint not implemented)."))}finally{p(!1)}};c.useEffect(()=>{const s=new AbortController;return m(s.signal),()=>s.abort()},[o]);const N=s=>`TZS ${Number(s||0).toLocaleString()}`;return r.jsxs("div",{className:n.container,children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[r.jsx("h1",{className:"text-3xl font-extrabold tracking-tight",children:"Borrower Groups"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{className:n.btn,onClick:()=>{const s=new AbortController;m(s.signal)},children:"Refresh"}),r.jsx(h,{to:`/borrowers/groups/add${t}`,className:n.cta,"aria-label":"Add a new borrower group",children:"Add Group"})]})]}),r.jsx("div",{className:`${n.card} overflow-hidden`,children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-[15px] border-collapse",children:[r.jsx("thead",{className:n.head,children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:n.th,children:"Name"}),r.jsx("th",{className:n.th,children:"Members"}),r.jsx("th",{className:n.th,children:"Branch"}),r.jsx("th",{className:n.th,children:"Loans"}),r.jsx("th",{className:n.th,children:"Outstanding"}),r.jsx("th",{className:`${n.th} text-right pr-4`,children:"Actions"})]})}),r.jsx("tbody",{children:u?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:`p-4 ${n.muted}`,children:"Loading…"})}):x?r.jsx("tr",{children:r.jsxs("td",{colSpan:6,className:`p-4 ${n.danger}`,children:[x," ",r.jsx("button",{className:`${n.btn} ml-2`,onClick:()=>{const s=new AbortController;m(s.signal)},children:"Retry"})]})}):a.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:`p-4 ${n.muted}`,children:"No groups yet."})}):a.map(s=>r.jsxs("tr",{className:n.row,children:[r.jsx("td",{className:n.td,children:r.jsx(h,{to:`/borrowers/groups/${encodeURIComponent(s.id)}${t}`,className:n.linkStrong,children:s.name})}),r.jsx("td",{className:n.td,children:s.membersCount}),r.jsx("td",{className:n.td,children:s.branchName}),r.jsx("td",{className:n.td,children:s.totalLoans}),r.jsx("td",{className:n.td,children:N(s.outstanding)}),r.jsx("td",{className:n.actions,children:r.jsx(h,{to:`/borrowers/groups/${encodeURIComponent(s.id)}${t}`,className:n.linkStrong,children:"View"})})]},s.id))})]})})})]})}export{L as default};
