import{j as s}from"./index-DuCvDBMs.js";import{u as v}from"./useSettingsResource-DeOzSLgW.js";import{S as p}from"./settings-DFGjkdLL.js";const b=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function y(){const{data:n,setData:o,loading:u,saving:d,error:i,success:c,save:x}=v(p.getLoanApprovals,p.saveLoanApprovals,{workflows:[]}),h=()=>o(a=>({...a,workflows:[...a.workflows||[],{id:b(),name:"Default flow",mode:"straight",productIds:[],branchIds:[],approverRoles:["manager"],minAmount:null,maxAmount:null,active:!0}]})),t=(a,e)=>o(r=>({...r,workflows:(r.workflows||[]).map(l=>l.id===a?{...l,...e}:l)})),g=a=>o(e=>({...e,workflows:(e.workflows||[]).filter(r=>r.id!==a)})),m=a=>a.split(",").map(e=>e.trim()).filter(Boolean).map(e=>Number(e)).filter(e=>!Number.isNaN(e));return u?s.jsx("div",{className:"p-4 text-sm text-slate-500",children:"Loading…"}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Manage Loan Status and Approvals"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Define approval flows per product/branch and amount ranges."})]}),i&&s.jsx("div",{className:"text-sm text-rose-600",children:i}),c&&s.jsx("div",{className:"text-sm text-emerald-600",children:c}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[s.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:h,children:"Add Workflow"}),(n.workflows||[]).length===0?s.jsx("div",{className:"text-sm text-slate-500",children:"No workflows yet."}):s.jsx("div",{className:"space-y-3",children:n.workflows.map(a=>s.jsxs("div",{className:"p-3 border rounded-lg grid grid-cols-1 md:grid-cols-7 gap-2",children:[s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Name",value:a.name||"",onChange:e=>t(a.id,{name:e.target.value})}),s.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:a.mode||"straight",onChange:e=>t(a.id,{mode:e.target.value}),children:[s.jsx("option",{value:"straight",children:"Straight (auto)"}),s.jsx("option",{value:"approval",children:"Requires approval"})]}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Product IDs (comma)",value:(a.productIds||[]).join(","),onChange:e=>t(a.id,{productIds:m(e.target.value)})}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Branch IDs (comma)",value:(a.branchIds||[]).join(","),onChange:e=>t(a.id,{branchIds:m(e.target.value)})}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Approver roles (comma)",value:(a.approverRoles||[]).join(","),onChange:e=>t(a.id,{approverRoles:e.target.value.split(",").map(r=>r.trim()).filter(Boolean)})}),s.jsx("input",{type:"number",className:"rounded border px-3 py-2 text-sm",placeholder:"Min amount",value:a.minAmount??"",onChange:e=>t(a.id,{minAmount:e.target.value===""?null:Number(e.target.value)})}),s.jsx("input",{type:"number",className:"rounded border px-3 py-2 text-sm",placeholder:"Max amount",value:a.maxAmount??"",onChange:e=>t(a.id,{maxAmount:e.target.value===""?null:Number(e.target.value)})}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:!!a.active,onChange:e=>t(a.id,{active:e.target.checked})}),"Active"]}),s.jsx("div",{className:"md:col-span-7 flex items-center gap-2",children:s.jsx("button",{className:"px-3 py-1.5 rounded bg-rose-50 text-rose-700",onClick:()=>g(a.id),children:"Delete"})})]},a.id))})]}),s.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm",disabled:d,onClick:()=>x(),children:d?"Saving…":"Save"})]})}export{y as default};
