import{i as N,r as m,j as s,g as h}from"./index-LbmMX0zK.js";import{B as j}from"./BorrowerAutoComplete-BoZOfCQz.js";async function b(e=[],o={}){let r;for(const c of e)try{const n=await h.get(c,o);return n==null?void 0:n.data}catch(n){r=n}throw r||new Error("No endpoint succeeded")}async function S(e=[],o={},r={}){let c;for(const n of e)try{const i=await h.post(n,o,r);return i==null?void 0:i.data}catch(i){c=i}throw c||new Error("No endpoint succeeded")}async function v(e=[],o={}){let r;for(const c of e)try{const n=await h.delete(c,o);return n==null?void 0:n.data}catch(n){r=n}throw r||new Error("No endpoint succeeded")}function A(e){return{id:e.id??e._id??e.borrowerId??e.memberId,name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||e.fullName||e.id,phone:e.phone??e.msisdn??e.mobile,role:e.role||e.memberRole}}function g(e){var r,c,n;if(!e||typeof e!="object")return null;const o=Array.isArray(e.members)?e.members:e.groupMembers||e.items||[];return{id:e.id??e._id??e.groupId??e.code,name:e.name??e.groupName??e.title??"—",branchName:e.branchName??((r=e.branch)==null?void 0:r.name)??"—",officerName:e.officerName??((c=e.officer)==null?void 0:c.name)??"—",meetingDay:e.meetingDay??((n=e.meeting)==null?void 0:n.day)??"—",members:o.map(A)}}async function E(e,o){const r=encodeURIComponent(e),c=await b([`/borrowers/groups/${r}`,`/groups/${r}`,`/borrower-groups/${r}`,`/api/borrowers/groups/${r}`,`/api/groups/${r}`,`/api/borrower-groups/${r}`],{signal:o}).catch(()=>null);if(c)return g(c);const n=await b([`/borrowers/groups?id=${r}&include=members`,`/borrowers/groups?groupId=${r}&include=members`,`/borrowers/groups?code=${r}&include=members`,`/groups?id=${r}&include=members`,`/groups?groupId=${r}&include=members`,`/groups?code=${r}&include=members`,`/borrower-groups?id=${r}&include=members`,`/borrower-groups?groupId=${r}&include=members`,`/borrower-groups?code=${r}&include=members`,`/api/borrowers/groups?id=${r}&include=members`,`/api/borrowers/groups?groupId=${r}&include=members`,`/api/borrowers/groups?code=${r}&include=members`,`/api/groups?id=${r}&include=members`,`/api/groups?groupId=${r}&include=members`,`/api/groups?code=${r}&include=members`,`/api/borrower-groups?id=${r}&include=members`,`/api/borrower-groups?groupId=${r}&include=members`,`/api/borrower-groups?code=${r}&include=members`],{signal:o}).catch(()=>null)||null;if(n){const l=Array.isArray(n)?n:n.items||n.rows||n.data||[];if(l.length){const d=l.find(t=>String(t.id)===String(e)||String(t._id)===String(e)||String(t.groupId)===String(e)||String(t.code)===String(e)||String(t.name)===String(e)||String(t.groupName)===String(e))||l[0];if(d)return g(d)}}const i=await b(["/borrowers/groups?include=members","/groups?include=members","/borrower-groups?include=members","/api/borrowers/groups?include=members","/api/groups?include=members","/api/borrower-groups?include=members"],{signal:o}).catch(()=>null);if(i){const d=(Array.isArray(i)?i:i.items||i.rows||i.data||[]).find(t=>String(t.id)===String(e)||String(t._id)===String(e)||String(t.groupId)===String(e)||String(t.code)===String(e)||String(t.name)===String(e)||String(t.groupName)===String(e));if(d)return g(d)}return null}const C=()=>{const{groupId:e}=N(),[o,r]=m.useState(null),[c,n]=m.useState(!0),[i,l]=m.useState(""),[d,t]=m.useState(null),[f,w]=m.useState(!1),p=async a=>{try{n(!0),l("");const u=await E(e,a);u?r(u):(l("Group not found."),r(null))}catch{l("Failed to load group (endpoint not implemented)."),r(null)}finally{n(!1)}};m.useEffect(()=>{const a=new AbortController;return p(a.signal),()=>a.abort()},[e]);const y=async()=>{if(d!=null&&d.id){w(!0);try{await S([`/borrowers/groups/${e}/members`,`/groups/${e}/members`,`/borrower-groups/${e}/members`,`/api/borrowers/groups/${e}/members`,`/api/groups/${e}/members`,`/api/borrower-groups/${e}/members`],{borrowerId:d.id}),t(null),await p()}catch{alert("Failed to add member.")}finally{w(!1)}}},$=async a=>{try{await v([`/borrowers/groups/${e}/members/${a}`,`/groups/${e}/members/${a}`,`/borrower-groups/${e}/members/${a}`,`/api/borrowers/groups/${e}/members/${a}`,`/api/groups/${e}/members/${a}`,`/api/borrower-groups/${e}/members/${a}`]),await p()}catch{alert("Failed to remove member.")}},x=Array.isArray(o==null?void 0:o.members)?o.members:[];return s.jsxs("div",{className:"p-4 space-y-4 bg-[var(--bg)] text-[var(--fg)]",children:[s.jsxs("h1",{className:"text-2xl font-semibold",children:["Group #",e]}),c&&s.jsx("div",{className:"muted",children:"Loading…"}),i&&s.jsx("div",{className:"text-rose-600 dark:text-rose-400",children:i}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"card p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Overview"}),s.jsxs("ul",{className:"text-sm space-y-1",children:[s.jsxs("li",{children:[s.jsx("b",{children:"Name:"})," ",(o==null?void 0:o.name)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Branch:"})," ",(o==null?void 0:o.branchName)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Officer:"})," ",(o==null?void 0:o.officerName)??"—"]}),s.jsxs("li",{children:[s.jsx("b",{children:"Meeting Day:"})," ",(o==null?void 0:o.meetingDay)??"—"]})]})]}),s.jsxs("div",{className:"card p-4 lg:col-span-2",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Members"}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx(j,{value:d,onChange:(a,u)=>t(u),placeholder:"Add borrower…"})}),s.jsx("button",{onClick:y,disabled:!d||f,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60",children:f?"Adding…":"Add"})]}),s.jsx("ul",{className:"text-sm divide-y divide-[var(--border)]",children:x.length===0?s.jsx("li",{className:"py-2 muted",children:"No members yet."}):x.map(a=>s.jsxs("li",{className:"py-2 flex items-center justify-between",children:[s.jsxs("div",{children:[a.name," ",s.jsxs("span",{className:"muted",children:["• ",a.phone||"—"]}),a.role&&s.jsx("span",{className:"ml-2 text-[11px] uppercase muted",children:a.role})]}),s.jsx("button",{className:"px-2 py-1 border rounded border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",onClick:()=>$(a.id),children:"Remove"})]},a.id))})]})]})]})};export{C as default};
