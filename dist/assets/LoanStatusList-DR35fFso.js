import{j as t,e as Ue,u as Be,f as _e,h as ze,r as d,c as T,L as je}from"./index-CNQNOAHr.js";const v=(s,o="TZS")=>s==null||s===""?"—":`‎${o} ${Number(s||0).toLocaleString()}`,ye=s=>s==null||s===""?"—":Number(s).toLocaleString(),He=s=>s==null||s===""?"—":`${Number(s)}%`,ge=s=>{var c;if(!s)return"—";const o=typeof s=="string"||typeof s=="number"?new Date(s):s;return!isNaN((c=o==null?void 0:o.getTime)==null?void 0:c.call(o))?o.toLocaleDateString():"—"},Ne=(s,o="TZS",h)=>{if(s==null||s==="")return"—";try{return new Intl.NumberFormat(h,{style:"currency",currency:o,maximumFractionDigits:0}).format(Number(s||0))}catch{return`‎${o} ${Number(s||0).toLocaleString()}`}},M=(s="")=>String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");function Ve(s,o){const{rows:h,headers:c,filename:y}=Array.isArray(s)?{rows:s,headers:F(s),filename:o||"export.csv"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.csv"},m=N=>String(N??"").replace(/"/g,'""'),x=c.join(","),f=h.map(N=>c.map(V=>`"${m(N[V])}"`).join(",")).join(`
`),g=`${x}
${f}`;we(new Blob([g],{type:"text/csv;charset=utf-8"}),y)}function qe(s,o){const{rows:h,headers:c,filename:y,title:m}=Array.isArray(s)?{rows:s,headers:F(s),filename:o||"export.xls"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.xls",title:(s==null?void 0:s.title)||"Export"},x=`<h1>${M(m||"")}</h1><table border="1"><thead><tr>${c.map(g=>`<th>${M(g)}</th>`).join("")}</tr></thead><tbody>`+h.map(g=>`<tr>${c.map(N=>`<td>${M(String(g[N]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",f=new Blob([`\uFEFF${x}`],{type:"application/vnd.ms-excel"});we(f,y)}function Ze(s){const{rows:o,headers:h,title:c}=Array.isArray(s)?{rows:s,headers:F(s),title:"Export"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),title:(s==null?void 0:s.title)||"Export"},y=`
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; padding: 16px; }
      h1 { font-size: 16px; margin: 0 0 12px 0; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap; }
      thead { background: #f3f4f6; }
    </style>
  `,m=`<h1>${M(c)}</h1><table><thead><tr>${h.map(f=>`<th>${M(f)}</th>`).join("")}</tr></thead><tbody>`+o.map(f=>`<tr>${h.map(g=>`<td>${M(String(f[g]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",x=window.open("","_blank");x&&(x.document.write(`<html><head><title>${M(c)}</title>${y}</head><body>${m}</body></html>`),x.document.close(),x.focus(),x.print())}function Ye(s,o){return Ve(s,o)}function Je(s,o){return qe(s,o)}function Qe(s,o){return Ze(s)}function F(s=[]){return s[0]?Object.keys(s[0]):[]}function we(s,o){const h=URL.createObjectURL(s),c=document.createElement("a");c.href=h,c.download=o||"export",document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(h)}function Ge({page:s=1,pageSize:o=25,total:h=0,onPageChange:c,onPageSizeChange:y}){const m=Math.max(1,Math.ceil(h/o));return t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-2 py-3",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",t.jsx("span",{className:"font-medium",children:s})," of"," ",t.jsx("span",{className:"font-medium",children:m})," •"," ",t.jsx("span",{className:"font-medium",children:h})," rows"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:o,onChange:x=>y==null?void 0:y(Number(x.target.value)),"aria-label":"Rows per page",children:[10,25,50,100].map(x=>t.jsxs("option",{value:x,children:[x," / page"]},x))}),t.jsxs("div",{className:"inline-flex rounded border overflow-hidden",children:[t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50",onClick:()=>c==null?void 0:c(Math.max(1,s-1)),disabled:s<=1,"aria-label":"Previous page",children:"‹ Prev"}),t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 border-l",onClick:()=>c==null?void 0:c(Math.min(m,s+1)),disabled:s>=m,"aria-label":"Next page",children:"Next ›"})]})]})]})}function Ke({open:s,title:o="Are you sure?",description:h="",confirmText:c="Confirm",cancelText:y="Cancel",destructive:m=!1,onConfirm:x,onClose:f}){return s?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"mt-1 w-8 h-8 rounded-full flex items-center justify-center text-white "+(m?"bg-rose-600":"bg-indigo-600"),children:"!"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold",children:o}),h&&t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:h})]}),t.jsx("button",{className:"text-gray-500 hover:text-gray-700","aria-label":"Close",onClick:f,children:"✕"})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded border",onClick:f,children:y}),t.jsx("button",{className:"px-4 py-2 rounded text-white "+(m?"bg-rose-600 hover:bg-rose-700":"bg-indigo-600 hover:bg-indigo-700"),onClick:()=>{x==null||x(),f==null||f()},children:c})]})]})}):null}const We=["pending","approved","rejected","disbursed","active","closed"],X={pending:"Pending Approval",approved:"Approved Loans",rejected:"Rejected Loans",disbursed:"Disbursed Loans",active:"Active Loans",closed:"Closed Loans",due:"Due Loans",missed:"Missed Repayments",arrears:"Loans in Arrears","no-repayments":"No Repayments","past-maturity":"Past Maturity Loans","principal-outstanding":"Principal Outstanding","1-month-late":"1 Month Late","3-months-late":"3 Months Late"};function tt(){var he,pe,fe,be;const{status:s}=Ue(),o=Be(),{success:h,error:c,info:y}=_e(),[m,x]=ze(),[f,g]=d.useState([]),[N,V]=d.useState(0),[ee,te]=d.useState(!1),[ve,se]=d.useState([]),[q,ne]=d.useState([]),[P,re]=d.useState(m.get("q")||""),[L,ae]=d.useState(m.get("productId")||""),[S,oe]=d.useState(m.get("officerId")||""),[$,ie]=d.useState(m.get("startDate")||""),[D,le]=d.useState(m.get("endDate")||""),[I,ce]=d.useState(m.get("minAmt")||""),[R,de]=d.useState(m.get("maxAmt")||""),Se=Number(m.get("page")||1),ue=Number(m.get("pageSize")||25),[E,Z]=d.useState(Math.max(1,Se)),[k,Ae]=d.useState([10,25,50,100].includes(ue)?ue:25),[Le,w]=d.useState(null),[O,U]=d.useState({open:!1,loan:null,officerId:""}),[B,J]=d.useState({open:!1,title:"",description:"",destructive:!1,onConfirm:null}),$e=X[s]||"Loans",Y=["disbursed","active"].includes(String(s||"").toLowerCase());d.useEffect(()=>{(async()=>{var e,a;try{const r=await T.get("/loan-products"),n=Array.isArray(r.data)?r.data:((e=r.data)==null?void 0:e.items)||[];se(n)}catch{se([])}try{const r=await T.get("/users",{params:{role:"loan_officer",pageSize:500}}),n=Array.isArray(r.data)?r.data:((a=r.data)==null?void 0:a.items)||[];ne(n)}catch{ne([])}})()},[]);const Q=async(e={})=>{var a,r;te(!0);try{const n={page:E,pageSize:k};We.includes(String(s))?n.status=s:s&&(n.scope=s),P.trim()&&(n.q=P.trim()),L&&(n.productId=L),S&&(n.officerId=S),$&&(n.startDate=$),D&&(n.endDate=D),I&&(n.minAmount=I),R&&(n.maxAmount=R);const i=await T.get("/loans",{params:n}),u=Array.isArray(i.data)?i.data:Array.isArray((a=i.data)==null?void 0:a.items)?i.data.items:[],p=((r=i.data)==null?void 0:r.total)??u.length;g(u),V(p)}catch(n){console.error(n),g([]),V(0),c("Failed to load loans.")}finally{te(!1)}if(!e.skipSyncUrl){const n=new URLSearchParams;P&&n.set("q",P),L&&n.set("productId",L),S&&n.set("officerId",S),$&&n.set("startDate",$),D&&n.set("endDate",D),I&&n.set("minAmt",I),R&&n.set("maxAmt",R),n.set("page",String(E)),n.set("pageSize",String(k)),x(n)}};d.useEffect(()=>{Q({skipSyncUrl:!0}),w(null)},[s,E,k]);const C=d.useMemo(()=>{const e=$?new Date($):null,a=D?new Date(D):null;return f.filter(r=>{if(e||a){const u=r.releaseDate||r.startDate||r.disbursementDate||r.createdAt||null,p=u?new Date(u):null;if(e&&(!p||p<e)||a&&(!p||p>a))return!1}if(L&&String(r.productId)!==String(L)||S&&String(r.officerId)!==String(S)&&String(r.loanOfficerId)!==String(S))return!1;const n=Number(r.amount??r.principal??0);if(I&&!(n>=Number(I))||R&&!(n<=Number(R)))return!1;const i=P.trim().toLowerCase();if(i){const u=r.Borrower||r.borrower||{},p=r.Product||r.product||{};if(![u.name,u.phone,r.borrowerName,r.borrowerPhone,p.name,r.productName,r.loanNumber,r.id].filter(Boolean).join(" ").toLowerCase().includes(i))return!1}return!0})},[f,P,L,S,$,D,I,R]),me=d.useMemo(()=>{if(N>f.length)return C;const e=(E-1)*k;return C.slice(e,e+k)},[C,E,k,f.length,N]),_=d.useMemo(()=>{let e=0,a=0,r=0,n=0,i=0;return C.forEach(u=>{const p=Number(u.outstandingPrincipal||0),j=Number(u.outstandingInterest||0),b=Number(u.outstandingFees||0),l=Number(u.outstandingPenalty||0),A=u.outstanding!=null?Number(u.outstanding):p+j+b+l;e+=p,a+=j,r+=b,n+=l,i+=A}),{p:e,i:a,f:r,pen:n,t:i}},[C]),G=()=>C.map(e=>{const a=e.Borrower||e.borrower||{},r=e.Product||e.product||{},n=e.officer||{},i=e.currency||"TZS",u=e.releaseDate||e.startDate||e.disbursementDate||e.createdAt||null,p=e.outstandingPrincipal??null,j=e.outstandingInterest??null,b=e.outstandingFees??null,l=e.outstandingPenalty??null,A=e.outstanding!=null?e.outstanding:[p,j,b,l].every(H=>H==null)?null:Number(p||0)+Number(j||0)+Number(b||0)+Number(l||0),z=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,W=e.termMonths??e.durationMonths??null;return{Date:ge(u),"Borrower Name":a.name||e.borrowerName||"","Phone Number":a.phone||e.borrowerPhone||"","Loan Product":r.name||e.productName||"","Principal Amount":`${i} ${Number(e.amount??e.principal??0)}`,"Interest Amount":`${i} ${Number(e.interestAmount??0)}`,"Outstanding Principal":`${i} ${Number(p??0)}`,"Outstanding Interest":`${i} ${Number(j??0)}`,"Outstanding Fees":`${i} ${Number(b??0)}`,"Outstanding Penalty":`${i} ${Number(l??0)}`,"Total Outstanding":`${i} ${Number(A??0)}`,"Interest Rate/Year (%)":z??"","Loan Duration (Months)":W??"","Loan Officer":e.officerName||n.name||"",Status:e.status||""}}),De=()=>Ye(G(),(X[s]||"loans").toLowerCase().replace(/\s+/g,"-")),Ie=()=>Je(G(),(X[s]||"loans").toLowerCase().replace(/\s+/g,"-")),Re=()=>Qe(G()),Ce=e=>o(`/loans/${e}`),Pe=e=>o(`/loans/${e}?edit=1`),ke=e=>J({open:!0,destructive:!1,title:"Re-disburse this loan?",description:"You will be taken to the disbursement screen to create a new disbursement tied to this loan.",onConfirm:()=>o(`/loans/${e}/disburse`)}),Oe=e=>o(`/repayments/new?loanId=${e}`),Me=e=>J({open:!0,destructive:!1,title:"Reschedule repayments?",description:"Open the schedule tool to recompute the repayment plan for this loan.",onConfirm:()=>o(`/loans/schedule?loanId=${e}`)}),Ee=async e=>{try{const a=await T.get(`/loans/${e.id}/schedule`),r=Array.isArray(a.data)?a.data:[],n=[{label:"#",value:(l,A)=>A+1},{label:"Due Date",value:l=>l.dueDate?new Date(l.dueDate).toISOString().slice(0,10):""},{label:"Principal",value:l=>l.principal??0},{label:"Interest",value:l=>l.interest??0},{label:"Penalty",value:l=>l.penalty??0},{label:"Total",value:l=>l.total??(l.principal||0)+(l.interest||0)+(l.penalty||0)},{label:"Balance",value:l=>l.balance??""}],i=n.map(l=>`"${l.label.replace(/"/g,'""')}"`).join(","),u=r.map((l,A)=>n.map(z=>`"${String(z.value(l,A)??"").replace(/"/g,'""')}"`).join(",")).join(`
`),p=`${i}
${u}`,j=new Blob([p],{type:"text/csv;charset=utf-8"}),b=document.createElement("a");b.href=URL.createObjectURL(j),b.download=`loan_${e.id}_schedule.csv`,b.click(),h("Schedule downloaded.")}catch(a){console.error(a),c("Couldn't download schedule.")}},Te=e=>U({open:!0,loan:e,officerId:(e==null?void 0:e.loanOfficerId)||(e==null?void 0:e.officerId)||""}),Fe=async()=>{const{loan:e,officerId:a}=O;if(!(!e||!a))try{await T.patch(`/loans/${e.id}/assign-officer`,{userId:a}).catch(()=>T.patch(`/loans/${e.id}`,{loanOfficerId:a})),g(r=>r.map(n=>{var i;return n.id===e.id?{...n,loanOfficerId:a,officerId:a,officerName:((i=q.find(u=>String(u.id)===String(a)))==null?void 0:i.name)||n.officerName}:n})),U({open:!1,loan:null,officerId:""}),h("Loan officer assigned.")}catch(r){console.error(r),c("Failed to assign officer.")}},xe=15+(Y?1:0),K=d.useRef(null);return d.useEffect(()=>{const e=a=>{K.current&&(K.current.contains(a.target)||w(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:$e}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",ye(N)," ",t.jsx("span",{className:"mx-2 text-gray-400",children:"•"}),t.jsx(je,{to:"/loans",className:"text-indigo-600 underline",children:"All Loans"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:De,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export CSV"}),t.jsx("button",{onClick:Ie,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export Excel"}),t.jsx("button",{onClick:Re,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export PDF"})]})]}),t.jsxs("div",{className:"bg-white rounded shadow border p-3",children:[t.jsxs("div",{className:"grid md:grid-cols-3 lg:grid-cols-6 gap-3",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Search (borrower / phone / product / loan #)"}),t.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"e.g. Jane, 0712…, Business Loan",value:P,onChange:e=>re(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Product"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:L,onChange:e=>ae(e.target.value),children:[t.jsx("option",{value:"",children:"All"}),ve.map(e=>t.jsxs("option",{value:e.id,children:[e.name,e.code?` (${e.code})`:""]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Loan Officer"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:S,onChange:e=>oe(e.target.value),children:[t.jsx("option",{value:"",children:"All"}),q.map(e=>t.jsx("option",{value:e.id,children:e.name||e.email},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"From Date"}),t.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:$,onChange:e=>ie(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"To Date"}),t.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:D,onChange:e=>le(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Min Amount"}),t.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:I,onChange:e=>ce(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Max Amount"}),t.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:R,onChange:e=>de(e.target.value)})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsx("button",{onClick:()=>{Z(1),Q()},className:"px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Apply Filters"}),t.jsx("button",{onClick:()=>{re(""),ae(""),oe(""),ie(""),le(""),ce(""),de(""),Z(1),x(new URLSearchParams),setTimeout(()=>Q({skipSyncUrl:!0}),0)},className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Reset"})]})]}),t.jsx("div",{className:"bg-white rounded shadow border overflow-x-auto",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 text-gray-700",children:t.jsxs("tr",{className:"[&>th]:px-2 [&>th]:py-2 [&>th]:border",children:[t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Borrower Name"}),t.jsx("th",{children:"Phone Number"}),t.jsx("th",{children:"Loan Product"}),t.jsx("th",{children:"Principal Amount"}),t.jsx("th",{children:"Interest Amount"}),t.jsx("th",{children:"Outstanding Principal"}),t.jsx("th",{children:"Outstanding Interest"}),t.jsx("th",{children:"Outstanding Fees"}),t.jsx("th",{children:"Outstanding Penalty"}),t.jsx("th",{children:"Total Outstanding"}),t.jsx("th",{children:"Interest Rate/Year (%)"}),t.jsx("th",{children:"Loan Duration (Months)"}),t.jsx("th",{children:"Loan Officer"}),t.jsx("th",{children:"Status"}),Y&&t.jsx("th",{children:"Action"})]})}),t.jsx("tbody",{ref:K,children:ee?t.jsx("tr",{children:t.jsx("td",{colSpan:xe,className:"p-6 text-center text-gray-500",children:"Loading…"})}):me.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:xe,className:"p-6 text-center text-gray-500",children:"No loans found."})}):me.map(e=>{const a=e.Borrower||e.borrower||{},r=e.Product||e.product||{},n=e.officer||{},i=e.currency||"TZS",u=e.releaseDate||e.startDate||e.createdAt||e.disbursementDate||null,p=e.outstandingPrincipal??null,j=e.outstandingInterest??null,b=e.outstandingFees??null,l=e.outstandingPenalty??null,A=e.outstanding!=null?e.outstanding:[p,j,b,l].every(H=>H==null)?null:Number(p||0)+Number(j||0)+Number(b||0)+Number(l||0),z=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,W=e.termMonths??e.durationMonths??null;return t.jsxs("tr",{className:"[&>td]:px-2 [&>td]:py-2 [&>td]:border hover:bg-gray-50",children:[t.jsx("td",{children:ge(u)}),t.jsx("td",{children:a.id?t.jsx(je,{to:`/borrowers/${a.id}`,className:"text-indigo-700 hover:underline",children:a.name||e.borrowerName||"—"}):a.name||e.borrowerName||"—"}),t.jsx("td",{children:a.phone||e.borrowerPhone||"—"}),t.jsx("td",{children:r.name||e.productName||"—"}),t.jsx("td",{children:Ne(e.amount??e.principal,i)}),t.jsx("td",{children:Ne(e.interestAmount,i)}),t.jsx("td",{children:v(p,i)}),t.jsx("td",{children:v(j,i)}),t.jsx("td",{children:v(b,i)}),t.jsx("td",{children:v(l,i)}),t.jsx("td",{children:v(A,i)}),t.jsx("td",{children:He(z)}),t.jsx("td",{children:ye(W)}),t.jsx("td",{children:e.officerName||n.name||"—"}),t.jsx("td",{children:e.status||"—"}),Y&&t.jsx("td",{className:"whitespace-nowrap",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"px-2 py-1 rounded border hover:bg-gray-50",onClick:()=>w(H=>H===e.id?null:e.id),children:"Actions ▾"}),Le===e.id&&t.jsxs("div",{className:"absolute right-0 mt-1 w-56 bg-white border rounded shadow-lg z-10",children:[t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),Ce(e.id)},children:"View (details & repayments)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),Pe(e.id)},children:"Edit"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),Oe(e.id)},children:"Record Repayment"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:async()=>{w(null),await Ee(e)},children:"Download Schedule (CSV)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),Me(e.id)},children:"Reschedule Repayments"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),ke(e.id)},children:"Re-disburse"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{w(null),Te(e)},children:"Assign Loan Officer"})]})]})})]},e.id)})}),!ee&&C.length>0&&t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-50 font-semibold [&>td]:px-2 [&>td]:py-2 [&>td]:border",children:[t.jsx("td",{colSpan:6,className:"text-right",children:"Totals:"}),t.jsx("td",{children:v(_.p)}),t.jsx("td",{children:v(_.i)}),t.jsx("td",{children:v(_.f)}),t.jsx("td",{children:v(_.pen)}),t.jsx("td",{children:v(_.t)}),t.jsx("td",{colSpan:4+(Y?1:0)})]})})]})}),t.jsx(Ge,{page:E,pageSize:k,total:N||C.length,onPageChange:e=>Z(e),onPageSizeChange:e=>{Ae(e),Z(1)}}),O.open&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-lg font-semibold",children:"Assign Loan Officer"}),t.jsx("button",{onClick:()=>U({open:!1,loan:null,officerId:""}),className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:"✕"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Loan:"," ",t.jsx("span",{className:"font-medium",children:((pe=(he=O.loan)==null?void 0:he.Borrower)==null?void 0:pe.name)||((fe=O.loan)==null?void 0:fe.borrowerName)||`#${(be=O.loan)==null?void 0:be.id}`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Officer"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:O.officerId,onChange:e=>U(a=>({...a,officerId:e.target.value})),children:[t.jsx("option",{value:"",children:"Select officer…"}),q.map(e=>t.jsx("option",{value:e.id,children:e.name||e.fullName||e.email||`User ${e.id}`},e.id))]}),!q.length&&t.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No officers found. Ensure users with role “loan_officer” exist."})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>U({open:!1,loan:null,officerId:""}),className:"px-3 py-2 rounded border",children:"Cancel"}),t.jsx("button",{onClick:Fe,disabled:!O.officerId,className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60",children:"Assign"})]})]})}),t.jsx(Ke,{open:B.open,title:B.title,description:B.description,destructive:B.destructive,onConfirm:B.onConfirm,onClose:()=>J(e=>({...e,open:!1}))})]})}export{tt as default};
