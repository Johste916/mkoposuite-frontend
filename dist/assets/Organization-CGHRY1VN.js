import{r as m,j as e,f as C}from"./index-D4YMmJ8P.js";function B(){const[S,x]=m.useState(null),[A,k]=m.useState(null),[v,D]=m.useState(null),[f,O]=m.useState([]),[w,p]=m.useState("loading"),[z,y]=m.useState("");async function h(t,l){let r=null;for(const c of t)try{const a=await C.get(c,l);if((a==null?void 0:a.data)!==void 0)return a.data}catch(a){r=a}throw r||Object.assign(new Error("Not Found"),{code:404})}async function I(t,l,r){var a;let c=null;for(const u of t)try{const i=await C.patch(u,l,r);return(i==null?void 0:i.data)??!0}catch(i){const d=(a=i==null?void 0:i.response)==null?void 0:a.status;d!==404&&d!==405&&(c=i)}throw c||Object.assign(new Error("No PATCH endpoint matched"),{code:404})}function _(t=[]){const l=r=>t.includes(r);return{savings:l("savings.view"),loans:l("loans.view"),collections:l("collections.view"),accounting:l("accounting.view"),sms:l("sms.send")||l("sms.view"),esignatures:l("esign.view")||l("esignatures.view"),payroll:l("payroll.view"),investors:l("investors.view"),assets:l("assets.view"),collateral:l("collateral.view"),reports:l("reports.view")}}const b=async()=>{var t,l,r,c;p("loading"),y("");try{const a=await h(["/tenants/me","/tenant/me","/account/tenant","/account/organization","/org/tenant","/org/me","/org"],{}).catch(()=>({}));x(a);const u=(a==null?void 0:a.id)||(a==null?void 0:a.tenantId)||null;u&&localStorage.setItem("tenantId",u);const i=(N={})=>u?{...N,headers:{...N.headers||{},"x-tenant-id":u}}:N,d=await h(["/tenants/me/entitlements","/tenant/me/entitlements","/account/tenant/entitlements","/account/organization/entitlements","/org/entitlements"],i()).catch(()=>({}));let o={};d!=null&&d.modules&&typeof d.modules=="object"?o=d:Array.isArray(d)?o={modules:_(d)}:o=d||{},k(o);const n=await h(["/tenants/me/limits","/tenant/me/limits","/account/tenant/limits","/account/organization/limits","/org/limits"],i()).catch(()=>({})),P=n&&typeof n=="object"&&n.limits?n.limits:n||{};D(P||{}),!(o&&o.modules&&Object.keys(o.modules).length>0)&&Array.isArray(n==null?void 0:n.entitlements)&&k({modules:_(n.entitlements),planCode:(((t=n==null?void 0:n.plan)==null?void 0:t.code)||((l=n==null?void 0:n.plan)==null?void 0:l.name)||(a==null?void 0:a.planCode)||(a==null?void 0:a.plan_code)||"basic").toString().toLowerCase(),status:(a==null?void 0:a.status)||"trial"});const g=await h(["/tenants/me/invoices","/tenant/me/invoices","/account/tenant/invoices","/account/organization/invoices","/org/invoices"],i()).catch(()=>[]),T=Array.isArray(g)?g:Array.isArray(g==null?void 0:g.invoices)?g.invoices:[];O(T),p("ready")}catch(a){p("error"),y(((c=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:c.error)||a.message||"Unknown error")}};if(m.useEffect(()=>{b()},[]),w==="loading")return e.jsx("div",{className:"p-4 text-sm text-slate-500 dark:text-slate-400",children:"Loadingâ€¦"});if(w==="error")return e.jsxs("div",{className:"p-4 text-sm text-rose-600 dark:text-rose-400",children:["Error: ",z,e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:b,className:"h-9 px-3 rounded ms-btn",children:"Retry"})})]});const s=S||{},j=A||{},E=s.planCode||s.plan_code||j.planCode||j.plan_code||"basic",L=async()=>{var t,l;try{const r=(s==null?void 0:s.id)||(s==null?void 0:s.tenantId)||localStorage.getItem("tenantId")||null,c=(a={})=>r?{...a,headers:{...a.headers||{},"x-tenant-id":r}}:a;await I(["/tenants/me","/tenant/me","/account/tenant","/account/organization","/org/tenant","/org"],{planCode:s.planCode||s.plan_code||E,trialEndsAt:s.trialEndsAt||s.trial_ends_at||null,autoDisableOverdue:typeof s.autoDisableOverdue<"u"?s.autoDisableOverdue:s.auto_disable_overdue??!1,graceDays:typeof s.graceDays<"u"?s.graceDays:s.grace_days??7,billingEmail:s.billingEmail||s.billing_email||""},c()),await b()}catch(r){p("error"),y(((l=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:l.error)||r.message||"Save failed")}};return e.jsxs("div",{className:"ms-card p-4 space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Plan"}),e.jsxs("select",{value:E,onChange:t=>x({...s,planCode:t.target.value,plan_code:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Trial ends"}),e.jsx("input",{type:"date",value:s.trialEndsAt||s.trial_ends_at||"",onChange:t=>x({...s,trialEndsAt:t.target.value,trial_ends_at:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!(s.autoDisableOverdue??s.auto_disable_overdue),onChange:t=>x({...s,autoDisableOverdue:t.target.checked,auto_disable_overdue:t.target.checked}),className:"h-4 w-4"}),e.jsx("span",{children:"Auto suspend overdue"})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Grace days"}),e.jsx("input",{type:"number",value:s.graceDays??s.grace_days??7,onChange:t=>x({...s,graceDays:Number(t.target.value||0),grace_days:Number(t.target.value||0)}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",min:0,max:90})]}),e.jsxs("label",{className:"md:col-span-2",children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Billing email"}),e.jsx("input",{type:"email",value:s.billingEmail||s.billing_email||"",onChange:t=>x({...s,billingEmail:t.target.value,billing_email:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:L,className:"h-9 px-3 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:b,className:"h-9 px-3 rounded ms-btn",children:"Refresh"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Entitlements"}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(j.modules||{}).length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No entitlements available."}):Object.entries(j.modules||{}).map(([t,l])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${l?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300"}`,children:l?"enabled":"disabled"})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Limits"}),!v||Object.keys(v).length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No limits configured."}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(v).map(([t,l])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 dark:text-slate-200",children:l===null?"Unlimited":String(l)})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Invoices"}),f.length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No invoices yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4",children:"Number"}),e.jsx("th",{className:"py-2 pr-4",children:"Amount"}),e.jsx("th",{className:"py-2 pr-4",children:"Due date"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"})]})}),e.jsx("tbody",{className:"align-top",children:f.map(t=>e.jsxs("tr",{className:"border-top border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"py-2 pr-4",children:t.number||t.id}),e.jsx("td",{className:"py-2 pr-4",children:Number((t.amount_cents??t.amountCents??0)/100).toLocaleString(void 0,{style:"currency",currency:t.currency||"USD"})}),e.jsx("td",{className:"py-2 pr-4",children:t.due_date||t.dueDate?String(t.due_date||t.dueDate).slice(0,10):"-"}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${(t.status||"open")==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":(t.status||"open")==="past_due"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300"}`,children:t.status||"open"})})]},t.id||t.number))})]})})]})]})}export{B as default};
