import{r as s,b as l,j as e}from"./index-D890cGFw.js";function F(){const[g,d]=s.useState(()=>new URLSearchParams(window.location.search));return s.useEffect(()=>{const o=()=>d(new URLSearchParams(window.location.search));return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]),g}function z(){const d=F().get("id"),[o,m]=s.useState(!0),[i,x]=s.useState(null),[p,j]=s.useState([]),[f,w]=s.useState(null),[b,r]=s.useState(""),n=s.useMemo(()=>d||l.getTenantId()||"me",[d]);s.useEffect(()=>{let t=!0;async function $(){m(!0),r("");try{const u=n==="me"?await l.getFirst(["/tenants/me","/org/me"]):await l.getFirst([`/tenants/${n}`,`/org/${n}`]);if(!t)return;x(u);const h=await l.getFirst([`/admin/tenants/${n}/invoices`,`/tenants/${n}/invoices`,`/orgs/${n}/invoices`,`/organizations/${n}/invoices`].filter(Boolean)).catch(()=>({invoices:[]}));if(!t)return;j((h==null?void 0:h.invoices)||[]);const C=await l.getFirst(["/org/limits","/orgs/limits","/organizations/limits"]).catch(()=>null);if(!t)return;w(C||null)}catch(u){if(!t)return;r(u.normalizedMessage||"Failed to load subscription.")}finally{t&&m(!1)}}return $(),()=>{t=!1}},[n]);const[y,v]=s.useState(!1),[a,c]=s.useState({planCode:"",seats:"",billingEmail:""});s.useEffect(()=>{i&&c({planCode:i.planCode||"",seats:i.seats??"",billingEmail:i.billingEmail||""})},[i]);async function S(){if(!(!i||n==="me")){v(!0),r("");try{const t=await l.patchFirst([`/tenants/${i.id}`,`/org/${i.id}`,`/organizations/${i.id}`],{planCode:a.planCode||void 0,seats:a.seats===""?null:Number(a.seats),billingEmail:a.billingEmail||void 0});x((t==null?void 0:t.tenant)||i)}catch(t){r(t.normalizedMessage||"Save failed.")}finally{v(!1)}}}async function E(){if(i){r("");try{await l.postFirst([`/admin/tenants/${i.id}/invoices/sync`,`/billing/tenants/${i.id}/invoices/sync`,`/tenants/${i.id}/invoices/sync`],{});const t=await l.getFirst([`/admin/tenants/${i.id}/invoices`,`/tenants/${i.id}/invoices`,`/orgs/${i.id}/invoices`,`/organizations/${i.id}/invoices`]);j((t==null?void 0:t.invoices)||[])}catch(t){r(t.normalizedMessage||"Sync failed.")}}}return e.jsxs("div",{style:{padding:16},children:[e.jsx("h1",{children:"Subscription"}),o?e.jsx("p",{children:"Loading…"}):null,b?e.jsx("p",{style:{color:"crimson"},children:b}):null,i&&e.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8,marginBottom:16},children:[e.jsx("h2",{style:{marginTop:0},children:i.name||"Tenant"}),e.jsxs("p",{children:[e.jsx("b",{children:"Status:"})," ",i.status||"unknown"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Plan:"})," ",i.planCode||"basic"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Seats:"})," ",i.seats??"—"]}),typeof i.trialDaysLeft=="number"&&e.jsxs("p",{children:[e.jsx("b",{children:"Trial Days Left:"})," ",i.trialDaysLeft]}),e.jsxs("p",{children:[e.jsx("b",{children:"Billing Email:"})," ",i.billingEmail||"—"]}),n!=="me"&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("h3",{children:"Edit"}),e.jsxs("div",{style:{display:"grid",gap:8,maxWidth:420},children:[e.jsxs("label",{children:["Plan Code",e.jsx("input",{value:a.planCode,onChange:t=>c({...a,planCode:t.target.value}),placeholder:"basic | pro | enterprise",style:{width:"100%"}})]}),e.jsxs("label",{children:["Seats",e.jsx("input",{type:"number",value:a.seats,onChange:t=>c({...a,seats:t.target.value}),placeholder:"e.g. 10",style:{width:"100%"}})]}),e.jsxs("label",{children:["Billing Email",e.jsx("input",{value:a.billingEmail,onChange:t=>c({...a,billingEmail:t.target.value}),placeholder:"billing@example.com",style:{width:"100%"}})]}),e.jsx("div",{children:e.jsx("button",{onClick:S,disabled:y,children:y?"Saving…":"Save"})})]})]})]}),e.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8,marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("h2",{style:{margin:0},children:"Invoices"}),e.jsx("button",{onClick:E,children:"Sync"})]}),p.length===0?e.jsx("p",{style:{opacity:.7},children:"No invoices."}):e.jsxs("table",{width:"100%",cellPadding:8,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{align:"left",children:"Number"}),e.jsx("th",{align:"left",children:"Date"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"right",children:"Amount"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.number||t.id}),e.jsx("td",{children:t.date||t.issuedAt||t.createdAt}),e.jsx("td",{children:t.status||"—"}),e.jsx("td",{align:"right",children:t.totalFormatted||t.total||t.amount||"—"})]},t.id||t.number))})]})]}),f&&e.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8},children:[e.jsx("h2",{style:{marginTop:0},children:"Plan Limits"}),e.jsx("pre",{style:{background:"#f8f8f8",padding:12,borderRadius:6,overflowX:"auto"},children:JSON.stringify(f,null,2)})]})]})}export{z as default};
