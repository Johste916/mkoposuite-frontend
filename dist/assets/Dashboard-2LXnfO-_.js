import{r,b as j,j as e,L as H}from"./index-6M8fKSo2.js";import{c as b}from"./createLucideIcon-BVyiFefs.js";import{D as fe}from"./download-Bvml_QSK.js";import{C as Z}from"./circle-plus-BxcetuMC.js";import{U as Oe}from"./users-DwU7A6d6.js";import{R as W,B as X,C as V,X as Y,Y as G,T as J,L as Q,a as R}from"./BarChart-byPannJ2.js";import{U as Fe}from"./user-plus-Bxr5RRxa.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],Ne=b("chart-no-axes-column",Ue);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ve=b("clipboard-list",qe);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ee=b("credit-card",Ke);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],v=b("dollar-sign",ze);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],we=b("info",He);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],We=b("message-square",Ze);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],Ve=b("thumbs-down",Xe);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ke=b("triangle-alert",Ye),Ae="ms_dash_filters_v1",Ce="ms_dash_auto_refresh_v1",cs=()=>{const[a,P]=r.useState(null),[_,O]=r.useState([]),[w,Se]=r.useState([]),[k,se]=r.useState(""),[A,te]=r.useState(""),[C,ae]=r.useState(""),[f,ne]=r.useState(0),[N,re]=r.useState([]),[Ge,le]=r.useState(!1),[oe,De]=r.useState([]),[S,Te]=r.useState(0),[u,L]=r.useState(1),D=10,[F,Re]=r.useState(""),[U,_e]=r.useState(""),[ie,ce]=r.useState({}),[M,$]=r.useState({}),[de,B]=r.useState({}),[x,Le]=r.useState(null),[xe,Je]=r.useState([]),[me,Qe]=r.useState([]),[he,es]=r.useState([]),[ge,ss]=r.useState([]),[pe,Me]=r.useState(!0),[$e,ue]=r.useState([]),h=(s,t="info")=>{const n=Math.random().toString(36).slice(2);ue(i=>[...i,{id:n,msg:s,type:t}]),setTimeout(()=>ue(i=>i.filter(l=>l.id!==n)),3500)},c=s=>{const t=Number(s);return Number.isFinite(t)?t:0},m=s=>{const t=c(s);return isNaN(t)?"TZS —":`TZS ${t.toLocaleString()}`},Be=s=>{var t;return((t=_.find(n=>String(n.id)===String(s)))==null?void 0:t.name)||(s?`Branch #${s}`:"All branches")};r.useEffect(()=>{try{const s=localStorage.getItem(Ae);if(s){const t=JSON.parse(s);se(t.branchId||""),te(t.officerId||""),ae(t.timeRange||"")}}catch{}try{const s=localStorage.getItem(Ce);s&&ne(Number(s)||0)}catch{}},[]),r.useEffect(()=>{const s={branchId:k,officerId:A,timeRange:C};localStorage.setItem(Ae,JSON.stringify(s))},[k,A,C]),r.useEffect(()=>{localStorage.setItem(Ce,String(f||0))},[f]);const ye=r.useCallback(async s=>{try{const[t,n]=await Promise.all([j.get("/branches",{signal:s}),j.get("/users",{params:{role:"loan_officer"},signal:s})]);O(Array.isArray(t.data)?t.data:[]),Se(Array.isArray(n.data)?n.data:[])}catch(t){(t==null?void 0:t.name)!=="CanceledError"&&(console.error("Filter fetch error:",(t==null?void 0:t.message)||t),h("Failed to load filters","error"))}},[]),q=r.useCallback(async s=>{try{const t=await j.get("/dashboard/summary",{params:{branchId:k,officerId:A,timeRange:C},signal:s});P(t.data||{})}catch(t){(t==null?void 0:t.name)!=="CanceledError"&&(console.error("Dashboard summary error:",(t==null?void 0:t.message)||t),h("Failed to load summary","error"))}},[k,A,C]),T=r.useCallback(async s=>{le(!0);try{const t=await j.get("/dashboard/communications",{signal:s}).catch(()=>null);t!=null&&t.data&&Array.isArray(t.data)?re(t.data):re(Array.isArray(a==null?void 0:a.generalCommunications)?a.generalCommunications:[])}finally{le(!1)}},[a]),y=r.useCallback(async(s={},t)=>{var n,i;try{const l=await j.get("/dashboard/activity",{params:{page:s.page??u,pageSize:D,dateFrom:F||void 0,dateTo:U||void 0},signal:t});De(((n=l.data)==null?void 0:n.items)||[]),Te(((i=l.data)==null?void 0:i.total)||0)}catch(l){(l==null?void 0:l.name)!=="CanceledError"&&(console.error("Activity fetch error:",(l==null?void 0:l.message)||l),h("Failed to load activity","error"))}},[u,F,U]),K=r.useCallback(async s=>{try{const t=await j.get("/dashboard/monthly-trends",{signal:s});Le(t.data||{})}catch(t){(t==null?void 0:t.name)!=="CanceledError"&&(console.error("Monthly trends error:",(t==null?void 0:t.message)||t),h("Failed to load trends","error"))}},[]);r.useEffect(()=>{const s=new AbortController;return(async()=>{try{await ye(s.signal)}catch{}})(),()=>s.abort()},[ye]);const I=r.useCallback(async s=>{await Promise.all([q(s),y({},s),K(s)])},[q,y,K]);r.useEffect(()=>{const s=new AbortController;return(async()=>{try{await I(s.signal)}catch(t){(t==null?void 0:t.name)!=="CanceledError"&&(console.error("Dashboard fetch error:",(t==null?void 0:t.message)||t),h("Failed to load dashboard data","error"))}finally{Me(!1)}})(),()=>s.abort()},[I]),r.useEffect(()=>{if(!a)return;const s=new AbortController;return T(s.signal).catch(t=>{(t==null?void 0:t.name)!=="CanceledError"&&(console.error("Comms fetch error:",(t==null?void 0:t.message)||t),h("Failed to load communications","error"))}),()=>s.abort()},[a,T]),r.useEffect(()=>{if(!f||f<=0)return;const s=setInterval(()=>{const t=new AbortController;Promise.all([I(t.signal),T(t.signal)]).catch(()=>{}).finally(()=>t.abort())},f*6e4);return()=>clearInterval(s)},[f,I,T]);const Ie=async s=>{const t=`c-${s}`;B(n=>({...n,[t]:!0}));try{const n=(ie[s]||"").trim();if(!n)return;await j.post(`/dashboard/activity/${s}/comment`,{comment:n}),ce(i=>({...i,[s]:""})),await y(),h("Reply posted","success")}catch(n){console.error("Add comment error:",(n==null?void 0:n.message)||n),h("Failed to post reply","error")}finally{B(n=>({...n,[t]:!1}))}},Ee=async s=>{const t=`a-${s}`;B(n=>({...n,[t]:!0}));try{const n=M[s]||{};if(!n.assigneeId)return;await j.post(`/dashboard/activity/${s}/assign`,{assigneeId:n.assigneeId,dueDate:n.dueDate||null,note:n.note||""}),$(i=>({...i,[s]:{assigneeId:"",dueDate:"",note:""}})),await y(),h("Task assigned","success")}catch(n){console.error("Assign task error:",(n==null?void 0:n.message)||n),h("Failed to assign task","error")}finally{B(n=>({...n,[t]:!1}))}},z=({label:s,value:t,max:n})=>{const i=c(t),l=c(n),E=l>0?Math.round(i/l*100):0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s}),e.jsx("span",{children:i.toLocaleString()})]}),e.jsx("div",{className:"h-2 w-full bg-gray-100 rounded",children:e.jsx("div",{className:"h-2 rounded",style:{width:`${E}%`,backgroundColor:"currentColor"}})})]})},je=({className:s})=>e.jsx("div",{className:`animate-pulse bg-gray-100 rounded ${s}`}),Pe=()=>{const s=N.flatMap(t=>(t.attachments||[]).map(n=>n.fileUrl)).filter(Boolean);s.length!==0&&(s.forEach((t,n)=>{setTimeout(()=>window.open(t,"_blank","noopener,noreferrer"),n*150)}),h(`Opening ${s.length} attachment${s.length>1?"s":""}…`,"info"))},p=a==null?void 0:a.dashboardMessage;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold text-slate-800 tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Quick snapshot of borrowers, loans, repayments and savings."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:k,onChange:s=>se(s.target.value),className:"border rounded-lg px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"All Branches"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:A,onChange:s=>te(s.target.value),className:"border rounded-lg px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"All Loan Officers"}),w.map(s=>e.jsx("option",{value:s.id,children:s.name||s.email},s.id))]}),e.jsxs("select",{value:C,onChange:s=>ae(s.target.value),className:"border rounded-lg px-3 py-2 bg-white",children:[e.jsx("option",{value:"",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"quarter",children:"This Quarter"}),e.jsx("option",{value:"semiAnnual",children:"Semi-Annual"}),e.jsx("option",{value:"annual",children:"Annual"})]}),e.jsxs("select",{value:f,onChange:s=>ne(Number(s.target.value)),className:"border rounded-lg px-3 py-2 bg-white",children:[e.jsx("option",{value:0,children:"No Auto-Refresh"}),e.jsx("option",{value:1,children:"Every 1 min"}),e.jsx("option",{value:5,children:"Every 5 mins"}),e.jsx("option",{value:15,children:"Every 15 mins"})]}),e.jsx("button",{className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50",onClick:()=>{const s=new AbortController;Promise.all([q(s.signal),y({page:1},s.signal),K(s.signal),T(s.signal)]).then(()=>{L(1),h("Dashboard refreshed","success")}).catch(()=>h("Refresh failed","error")).finally(()=>s.abort())},children:"Refresh"})]})]})}),e.jsx("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:$e.map(s=>e.jsx("div",{className:`px-3 py-2 rounded shadow text-sm text-white ${s.type==="error"?"bg-red-600":s.type==="success"?"bg-emerald-600":"bg-slate-800"}`,children:s.msg},s.id))}),(a==null?void 0:a.importantNotice)&&e.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 text-amber-900 p-4",children:e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(we,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Important Notice"}),e.jsx("p",{className:"text-sm",children:a.importantNotice})]})]})}),a!=null&&a.companyMessage?e.jsx("div",{className:"rounded-xl border-l-4 border-blue-500 bg-blue-50 text-blue-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("p",{className:"text-sm font-medium",children:a.companyMessage})]})}):pe?e.jsx(je,{className:"h-12"}):null,p&&e.jsx("div",{className:"bg-white border rounded-xl shadow-sm p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[p.title&&e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:p.title}),p.text&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:p.text}),Array.isArray(p.attachments)&&p.attachments.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-[11px] text-gray-500 mb-1",children:"Attachments"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:p.attachments.map(s=>e.jsx("a",{href:s.fileUrl,target:"_blank",rel:"noreferrer",className:"text-xs text-blue-600 underline",title:s.fileName,children:s.fileName||"Attachment"},`${s.id}-${s.fileUrl}`))})]})]}),Array.isArray(p.attachments)&&p.attachments.length>0&&e.jsxs("button",{onClick:()=>{p.attachments.forEach((s,t)=>{s.fileUrl&&setTimeout(()=>window.open(s.fileUrl,"_blank","noopener,noreferrer"),t*150)})},className:"text-xs flex items-center gap-1 border rounded px-2 py-1 h-8",title:"Open all attachments",children:[e.jsx(fe,{className:"w-3 h-3"})," Open all"]})]})}),((N==null?void 0:N.length)??0)>0&&e.jsxs("div",{className:"bg-white border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b bg-gray-50",children:[e.jsx("div",{className:"text-xs font-medium text-gray-600",children:"General Communications"}),N.some(s=>Array.isArray(s.attachments)&&s.attachments.length>0)&&e.jsxs("button",{onClick:Pe,className:"text-xs flex items-center gap-1 border rounded px-2 py-1",title:"Open all attachments",children:[e.jsx(fe,{className:"w-3 h-3"})," Download all"]})]}),e.jsxs("div",{className:"relative h-10",children:[e.jsx("style",{children:"@keyframes ms-marquee{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}"}),e.jsx("div",{className:"absolute whitespace-nowrap will-change-transform text-sm text-gray-700 flex items-center gap-8 px-3",style:{animation:"ms-marquee 18s linear infinite"},children:N.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-2",children:[s.type&&e.jsx("span",{className:"text-[11px] px-1.5 py-0.5 border rounded bg-gray-50",children:s.type}),s.priority&&e.jsx("span",{className:"text-[11px] px-1.5 py-0.5 border rounded bg-gray-50",children:s.priority}),s.audienceRole&&e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 border rounded bg-gray-50",children:["role: ",s.audienceRole]}),typeof s.audienceBranchId<"u"&&s.audienceBranchId!==null&&e.jsx("span",{className:"text-[11px] px-1.5 py-0.5 border rounded bg-gray-50",children:Be(s.audienceBranchId)}),e.jsx("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-blue-500"}),s.text]},s.id||s.text))})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(H,{to:"/loans/add",className:"flex items-center gap-2 px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 shadow-sm",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Loan"]}),e.jsxs(H,{to:"/borrowers/add",className:"flex items-center gap-2 px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 shadow-sm",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Borrower"]}),e.jsxs(H,{to:"/repayments/new",className:"flex items-center gap-2 px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 shadow-sm",children:[e.jsx(Z,{className:"w-4 h-4"})," Record Repayment"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-6",children:[e.jsx("main",{className:"space-y-6",children:pe?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((s,t)=>e.jsx(je,{className:"h-24"},t))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx(d,{tone:"indigo",title:"Total Borrowers",value:c(a==null?void 0:a.totalBorrowers).toLocaleString(),icon:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx(d,{tone:"sky",title:"Total Loans",value:c(a==null?void 0:a.totalLoans).toLocaleString(),icon:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(d,{tone:"blue",title:"Total Disbursed",value:m(a==null?void 0:a.totalDisbursed),icon:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(d,{tone:"emerald",title:"Total Paid",value:m(a==null?void 0:a.totalPaid),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"emerald",title:"Total Repaid",value:m(a==null?void 0:a.totalRepaid),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"indigo",title:"Expected Repayments",value:m(a==null?void 0:a.totalExpectedRepayments),icon:e.jsx(ve,{className:"w-5 h-5"})}),e.jsx(d,{tone:"cyan",title:"Total Deposits",value:m(a==null?void 0:a.totalDeposits),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"amber",title:"Total Withdrawals",value:m(a==null?void 0:a.totalWithdrawals),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"blue",title:"Net Savings",value:m(a==null?void 0:a.netSavings),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"rose",title:"Defaulted Loan",value:m(a==null?void 0:a.defaultedLoan),icon:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx(d,{tone:"rose",title:"Defaulted Interest",value:m(a==null?void 0:a.defaultedInterest),icon:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx(d,{tone:"violet",title:"Outstanding Loan",value:m(a==null?void 0:a.outstandingLoan),icon:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(d,{tone:"violet",title:"Outstanding Interest",value:m(a==null?void 0:a.outstandingInterest),icon:e.jsx(v,{className:"w-5 h-5"})}),e.jsx(d,{tone:"slate",title:"Written Off",value:m(a==null?void 0:a.writtenOff),icon:e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx(d,{tone:"indigo",title:"PAR (Portfolio at Risk)",value:`${c(a==null?void 0:a.parPercent)}%`,icon:e.jsx(Ne,{className:"w-5 h-5"})})]}),x&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Monthly Trends",x.month||x.year?` — ${x.month||""} ${x.year||""}`:""]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(W,{width:"100%",height:260,children:e.jsxs(X,{data:[{name:"Loans",value:c(x.monthlyLoans)},{name:"Deposits",value:c(x.monthlyDeposits)},{name:"Repayments",value:c(x.monthlyRepayments)}],children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(Y,{dataKey:"name"}),e.jsx(G,{}),e.jsx(J,{}),e.jsx(Q,{}),e.jsx(R,{dataKey:"value"})]})})}),(()=>{const s=[c(x.monthlyLoans),c(x.monthlyDeposits),c(x.monthlyRepayments)],t=Math.max(...s);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"text-indigo-600",children:e.jsx(z,{label:"Loans (count)",value:c(x.monthlyLoans),max:t})}),e.jsx("div",{className:"text-emerald-600",children:e.jsx(z,{label:"Deposits (TZS)",value:c(x.monthlyDeposits),max:t})}),e.jsx("div",{className:"text-blue-600",children:e.jsx(z,{label:"Repayments (TZS)",value:c(x.monthlyRepayments),max:t})})]})})()]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4 overflow-x-auto",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Top Borrowers"}),xe.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-1 pr-4",children:"Name"}),e.jsx("th",{className:"py-1 pr-4",children:"Outstanding"})]})}),e.jsx("tbody",{children:xe.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-1 pr-4",children:s.name}),e.jsx("td",{className:"py-1 pr-4",children:m(s.outstanding)})]},s.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4 overflow-x-auto",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Upcoming Repayments"}),me.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-1 pr-4",children:"Borrower"}),e.jsx("th",{className:"py-1 pr-4",children:"Due Date"}),e.jsx("th",{className:"py-1 pr-4",children:"Amount"})]})}),e.jsx("tbody",{children:me.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-1 pr-4",children:s.borrower}),e.jsx("td",{className:"py-1 pr-4",children:s.dueDate}),e.jsx("td",{className:"py-1 pr-4",children:m(s.amount)})]},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Branch Performance"}),he.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available."}):e.jsx(W,{width:"100%",height:260,children:e.jsxs(X,{data:he,children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(Y,{dataKey:"branch"}),e.jsx(G,{}),e.jsx(J,{}),e.jsx(Q,{}),e.jsx(R,{dataKey:"disbursed"}),e.jsx(R,{dataKey:"repayments"})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Officer Performance"}),ge.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available."}):e.jsx(W,{width:"100%",height:260,children:e.jsxs(X,{data:ge,children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(Y,{dataKey:"officer"}),e.jsx(G,{}),e.jsx(J,{}),e.jsx(Q,{}),e.jsx(R,{dataKey:"loans"}),e.jsx(R,{dataKey:"collections"})]})})]})]})]})}),e.jsx("aside",{className:"lg:sticky lg:top-4 self-start",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h2",{className:"font-semibold text-gray-800",children:"Recent Activity"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:F,onChange:s=>Re(s.target.value)}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:U,onChange:s=>_e(s.target.value)}),e.jsx("button",{className:"col-span-2 border rounded px-2 py-1 text-sm",onClick:()=>{L(1),y({page:1})},children:"Search by date"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-6 pointer-events-none bg-gradient-to-b from-white to-transparent"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-6 pointer-events-none bg-gradient-to-t from-white to-transparent"}),e.jsx("div",{className:"max-h-[520px] overflow-y-auto pr-1 space-y-3",children:oe.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No activity."}):oe.map(s=>{var t,n,i,l,E;return e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[s.type," • ",s.entityType," #",s.entityId]}),e.jsx("p",{className:"text-xs text-gray-600",children:s.message}),e.jsxs("p",{className:"text-[11px] text-gray-400 mt-1",children:["by ",((t=s.createdBy)==null?void 0:t.name)||((n=s.createdBy)==null?void 0:n.email)," • ",new Date(s.createdAt).toLocaleString()]}),Array.isArray(s.comments)&&s.comments.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:s.comments.map(o=>{var g,be;return e.jsxs("div",{className:"bg-gray-50 border rounded p-2",children:[e.jsx("p",{className:"text-xs text-gray-800",children:o.comment}),e.jsxs("p",{className:"text-[11px] text-gray-400 mt-0.5",children:["— ",((g=o.createdBy)==null?void 0:g.name)||((be=o.createdBy)==null?void 0:be.email)," • ",new Date(o.createdAt).toLocaleString()]})]},o.id)})}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{value:ie[s.id]||"",onChange:o=>ce(g=>({...g,[s.id]:o.target.value})),placeholder:"Reply…",className:"flex-1 border rounded px-2 py-1 text-xs"}),e.jsxs("button",{onClick:()=>Ie(s.id),disabled:de[`c-${s.id}`],className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(We,{className:"w-3 h-3"})," Reply"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2",children:[e.jsxs("select",{value:((i=M[s.id])==null?void 0:i.assigneeId)||"",onChange:o=>$(g=>({...g,[s.id]:{...g[s.id]||{},assigneeId:o.target.value}})),className:"col-span-2 border rounded px-2 py-1 text-xs",children:[e.jsx("option",{value:"",children:"Assign to…"}),w.map(o=>e.jsx("option",{value:o.id,children:o.name||o.email},o.id))]}),e.jsx("input",{type:"date",value:((l=M[s.id])==null?void 0:l.dueDate)||"",onChange:o=>$(g=>({...g,[s.id]:{...g[s.id]||{},dueDate:o.target.value}})),className:"border rounded px-2 py-1 text-xs"}),e.jsxs("button",{onClick:()=>Ee(s.id),disabled:de[`a-${s.id}`],className:"px-2 py-1 text-xs border rounded bg-white hover:bg-gray-50 disabled:opacity-50 flex items-center gap-1 justify-center",children:[e.jsx(Fe,{className:"w-3 h-3"})," Assign"]}),e.jsx("input",{value:((E=M[s.id])==null?void 0:E.note)||"",onChange:o=>$(g=>({...g,[s.id]:{...g[s.id]||{},note:o.target.value}})),placeholder:"Note…",className:"col-span-4 border rounded px-2 py-1 text-xs"})]})]},s.id)})})]}),S>D&&e.jsxs("div",{className:"flex justify-between items-center mt-3 text-xs",children:[e.jsxs("span",{children:[Math.min(u*D,S)," of ",S]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const s=Math.max(u-1,1);L(s),y({page:s})},disabled:u===1,className:"px-2 py-1 border rounded disabled:opacity-50",children:"Prev"}),e.jsx("button",{onClick:()=>{const s=u*D<S?u+1:u;s!==u&&(L(s),y({page:s}))},disabled:u*D>=S,className:"px-2 py-1 border rounded disabled:opacity-50",children:"Next"})]})]})]})})]})]})},d=({title:a,value:P,icon:_,tone:O="indigo"})=>{const w={indigo:{ring:"ring-indigo-100",icon:"text-indigo-600 bg-indigo-50"},sky:{ring:"ring-sky-100",icon:"text-sky-600 bg-sky-50"},blue:{ring:"ring-blue-100",icon:"text-blue-600 bg-blue-50"},emerald:{ring:"ring-emerald-100",icon:"text-emerald-600 bg-emerald-50"},cyan:{ring:"ring-cyan-100",icon:"text-cyan-600 bg-cyan-50"},amber:{ring:"ring-amber-100",icon:"text-amber-600 bg-amber-50"},violet:{ring:"ring-violet-100",icon:"text-violet-600 bg-violet-50"},rose:{ring:"ring-rose-100",icon:"text-rose-600 bg-rose-50"},slate:{ring:"ring-slate-100",icon:"text-slate-600 bg-slate-50"}}[O]||{ring:"ring-slate-100",icon:"text-slate-600 bg-slate-50"};return e.jsx("div",{className:`bg-white rounded-2xl shadow-sm border p-4 ring-1 ${w.ring}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${w.icon}`,children:_}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-medium text-gray-500",children:a}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:P??"—"})]})]})})};export{cs as default};
