import{u as ue,r as l,g as f,j as e,L as W}from"./index-BVWWaTks.js";import{C as je}from"./circle-plus-CjAK22iv.js";import{U as Ne,B as fe}from"./upload-BRLKxKEJ.js";import{S as ye,F as be,C as ve,a as we}from"./search-jTJ6V1lu.js";import{P as Se,I as Ce}from"./phone-BQXhh3pI.js";import{X as Ae}from"./x-DBX9sqoi.js";import{F as ke}from"./file-up-BimPcBUC.js";import"./createLucideIcon-Cwi7q87I.js";const D=10,Re=()=>{const a=ue(),[t,h]=l.useState([]),[x,N]=l.useState(0),[p,L]=l.useState(""),[k,ee]=l.useState(""),[T,se]=l.useState(""),[B,ae]=l.useState(""),[P,te]=l.useState(""),[g,re]=l.useState("createdAt"),[u,K]=l.useState("desc"),[j,y]=l.useState(1),[le,ne]=l.useState([]),[ie,ce]=l.useState([]),[M,R]=l.useState(!0),[F,oe]=l.useState(null),[U,_]=l.useState(!1),[b,z]=l.useState("overview"),[de,V]=l.useState(!1),[I,$]=l.useState({overview:null,loans:[],savings:[],documents:[]}),[xe,Q]=l.useState([]),O=(s,r="info")=>{const n=Math.random().toString(36).slice(2);Q(o=>[...o,{id:n,msg:s,type:r}]),setTimeout(()=>Q(o=>o.filter(d=>d.id!==n)),3500)};l.useEffect(()=>{const s=setTimeout(()=>ee(p.trim()),300);return()=>clearTimeout(s)},[p]),l.useEffect(()=>{const s=new AbortController;return Promise.all([f.get("/branches",{signal:s.signal}).catch(()=>({data:[]})),f.get("/users",{params:{role:"loan_officer"},signal:s.signal}).catch(()=>({data:[]}))]).then(([r,n])=>{var o,d;ne(Array.isArray(r.data)?r.data:((o=r.data)==null?void 0:o.data)||[]),ce(Array.isArray(n.data)?n.data:((d=n.data)==null?void 0:d.data)||[])}).catch(()=>O("Failed to load filters","error")),()=>s.abort()},[]);const Y=l.useCallback(async s=>{var r,n,o,d;R(!0);try{const c=await f.get("/borrowers",{signal:s,params:{q:k||void 0,branchId:T||void 0,officerId:B||void 0,status:P||void 0,page:j,pageSize:D,sort:g,dir:u}});let i=[],m=0;Array.isArray(c.data)?(i=c.data,m=c.data.length):(i=((r=c.data)==null?void 0:r.items)||((n=c.data)==null?void 0:n.rows)||((o=c.data)==null?void 0:o.data)||[],m=Number(((d=c.data)==null?void 0:d.total)??i.length??0)),h(i),N(m)}catch{O("Failed to load borrowers","error"),h([]),N(0)}finally{R(!1)}},[k,T,B,P,j,g,u]);l.useEffect(()=>{const s=new AbortController;return Y(s.signal),()=>s.abort()},[Y]);const Z=s=>{oe(s),z("overview"),_(!0)},q=l.useCallback(async(s,r,n)=>{var o,d,c;V(!0);try{if(s==="overview"){const i=await f.get(`/borrowers/${r}`,{signal:n});$(m=>({...m,overview:i.data||null}))}else if(s==="loans"){const i=await f.get(`/borrowers/${r}/loans`,{signal:n});$(m=>{var w;return{...m,loans:Array.isArray(i.data)?i.data:((w=i.data)==null?void 0:w.items)||[]}})}else if(s==="savings"){const i=await f.get(`/borrowers/${r}/savings`,{signal:n}),m=Array.isArray((o=i.data)==null?void 0:o.transactions)?i.data.transactions:Array.isArray(i.data)?i.data:((d=i.data)==null?void 0:d.items)||[];$(w=>({...w,savings:m}))}else if(s==="documents"){const i=await f.get(`/borrowers/${r}/kyc`,{signal:n}),m=Array.isArray((c=i.data)==null?void 0:c.items)?i.data.items:Array.isArray(i.data)?i.data:[];$(w=>({...w,documents:m}))}}catch{O("Failed to load borrower details","error")}finally{V(!1)}},[]);l.useEffect(()=>{if(!U||!F)return;const s=new AbortController;return q(b,F,s.signal),()=>s.abort()},[U,b,F,q]);const v=s=>{g===s?K(r=>r==="asc"?"desc":"asc"):(re(s),K("asc"))},G=s=>`TZS ${Number(s||0).toLocaleString()}`,me=l.useMemo(()=>x===0?0:(j-1)*D+1,[j,x]),he=l.useMemo(()=>Math.min(j*D,x),[j,x]),X=s=>s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||"â€”",H=s=>{var r,n;return s.branchName||((r=s.Branch)==null?void 0:r.name)||((n=s.branch)==null?void 0:n.name)||"â€”"},pe=s=>{var r,n;return s.officerName||((r=s.officer)==null?void 0:r.name)||((n=s.loanOfficer)==null?void 0:n.name)||"â€”"},ge=s=>{var d,c;const r=(s||"").trim();if(!r)return"U";const n=r.split(/\s+/).filter(Boolean);return((((d=n[0])==null?void 0:d[0])||"")+(((c=n[1])==null?void 0:c[0])||"")).toUpperCase()||r[0].toUpperCase()},J=s=>{const r="text-[11px] px-2 py-0.5 rounded border";switch(s){case"active":return`${r} bg-emerald-50 border-emerald-300 text-emerald-700`;case"pending_kyc":return`${r} bg-yellow-50 border-yellow-300 text-yellow-700`;case"blacklisted":return`${r} bg-red-50 border-red-300 text-red-700`;default:return`${r} bg-gray-50 border-gray-300 text-gray-700`}};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:xe.map(s=>e.jsx("div",{className:`px-3 py-2 rounded shadow text-sm text-white ${s.type==="error"?"bg-red-600":s.type==="success"?"bg-emerald-600":"bg-slate-800"}`,children:s.msg},s.id))}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:"ðŸ‘¥ Borrowers"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a("/borrowers/add"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 shadow-sm",children:[e.jsx(je,{className:"w-4 h-4"})," Add Borrower"]}),e.jsxs("button",{onClick:()=>O("CSV import coming soon","info"),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-white hover:bg-gray-50 shadow-sm",children:[e.jsx(Ne,{className:"w-4 h-4"})," Import CSV"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 md:p-4 mb-4 border",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{value:p,onChange:s=>{L(s.target.value),y(1)},placeholder:"Search by name, phone, national IDâ€¦",className:"w-full border rounded-lg pl-9 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:T,onChange:s=>{se(s.target.value),y(1)},className:"border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"All Branches"}),le.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:B,onChange:s=>{ae(s.target.value),y(1)},className:"border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"All Officers"}),ie.map(s=>e.jsx("option",{value:s.id,children:s.name||s.email},s.id))]}),e.jsxs("select",{value:P,onChange:s=>{te(s.target.value),y(1)},className:"border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending_kyc",children:"Pending KYC"}),e.jsx("option",{value:"blacklisted",children:"Blacklisted"})]}),e.jsxs("div",{className:"hidden md:flex items-center text-gray-500 text-sm px-2",children:[e.jsx(be,{className:"w-4 h-4 mr-1"})," Filters"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow border",children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full text-sm hidden md:table",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx(S,{label:"Name",sortKey:"name",sort:g,dir:u,onSort:v}),e.jsx(S,{label:"Phone",sortKey:"phone",sort:g,dir:u,onSort:v}),e.jsx(S,{label:"Branch",sortKey:"branchName",sort:g,dir:u,onSort:v}),e.jsx(S,{label:"Officer",sortKey:"officerName",sort:g,dir:u,onSort:v}),e.jsx(S,{label:"Outstanding",sortKey:"outstanding",sort:g,dir:u,onSort:v}),e.jsx(S,{label:"Status",sortKey:"status",sort:g,dir:u,onSort:v}),e.jsx("th",{className:"px-3 py-2 text-right pr-4",children:"Actions"})]})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500",children:"Loadingâ€¦"})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500",children:"No borrowers."})}):t.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:X(s)}),e.jsx("td",{className:"px-4 py-2",children:s.phone||"â€”"}),e.jsx("td",{className:"px-4 py-2",children:H(s)}),e.jsx("td",{className:"px-4 py-2",children:pe(s)}),e.jsx("td",{className:"px-4 py-2",children:G(s.outstanding)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:J(s.status),children:s.status||"â€”"})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>Z(s.id),className:"text-indigo-600 hover:text-indigo-800 hover:underline",children:"View"}),e.jsx(W,{to:`/loans/applications?borrowerId=${encodeURIComponent(s.id)}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:"New Loan"})]})})]},s.id))})]}),e.jsx("div",{className:"md:hidden grid grid-cols-1 gap-3 p-3",children:M?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loadingâ€¦"}):t.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No borrowers."}):t.map(s=>{const r=X(s);return e.jsxs("div",{className:"bg-white border rounded-2xl shadow-sm p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-blue-600 text-white flex items-center justify-center text-sm font-semibold shadow-sm",children:ge(r)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-gray-900",children:r}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.id]})]})]}),e.jsx("span",{className:J(s.status),children:s.status||"â€”"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.phone||"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"truncate",children:H(s)})]}),e.jsxs("div",{className:"col-span-2 text-gray-700",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding"}),e.jsx("div",{className:"text-sm font-medium",children:G(s.outstanding)})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Z(s.id),className:"px-3 py-2 text-sm rounded-lg border hover:bg-gray-50",children:"View"}),e.jsx(W,{to:`/loans/applications?borrowerId=${encodeURIComponent(s.id)}`,className:"px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700",children:"New Loan"})]})]},s.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t text-sm bg-gray-50 rounded-b-xl",children:[e.jsxs("div",{className:"text-gray-600",children:[me,"â€“",he," of ",x]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(s=>Math.max(1,s-1)),disabled:j===1,className:"p-1.5 border rounded-lg disabled:opacity-50 bg-white","aria-label":"Previous page",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(s=>s*D<x?s+1:s),disabled:j*D>=x,className:"p-1.5 border rounded-lg disabled:opacity-50 bg-white","aria-label":"Next page",children:e.jsx(we,{className:"w-4 h-4"})})]})]})]}),U&&e.jsxs(De,{onClose:()=>_(!1),title:"Borrower Details",children:[e.jsx("div",{className:"flex gap-2 border-b mb-3",children:["overview","loans","savings","documents"].map(s=>e.jsx("button",{onClick:()=>z(s),className:`px-3 py-2 text-sm border-b-2 -mb-px ${b===s?"border-indigo-600 text-indigo-700":"border-transparent text-gray-600"}`,children:s[0].toUpperCase()+s.slice(1)},s))}),e.jsx("div",{children:de?e.jsx("div",{className:"text-gray-500 text-sm",children:"Loadingâ€¦"}):b==="overview"?e.jsx(Le,{data:I.overview}):b==="loans"?e.jsx(Ie,{items:I.loans}):b==="savings"?e.jsx($e,{items:I.savings}):e.jsx(Oe,{items:I.documents})})]})]})},S=({label:a,sortKey:t,sort:h,dir:x,onSort:N})=>{const p=h===t;return e.jsx("th",{className:"px-3 py-2 cursor-pointer select-none",onClick:()=>N(t),title:"Sort",children:e.jsxs("span",{className:`inline-flex items-center gap-1 ${p?"text-indigo-700":""}`,children:[a,p?x==="asc"?"â–²":"â–¼":""]})})},De=({title:a,onClose:t,children:h})=>e.jsxs("div",{className:"fixed inset-0 z-[60]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full sm:w-[620px] bg-white shadow-2xl p-4 overflow-y-auto rounded-l-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:a}),e.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-gray-100","aria-label":"Close drawer",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),h]})]}),Le=({data:a})=>{var N,p,L,k;if(!a)return e.jsx("p",{className:"text-gray-500 text-sm",children:"No overview data."});const t=a.name||`${a.firstName||""} ${a.lastName||""}`.trim()||"â€”",h=a.branchName||((N=a.Branch)==null?void 0:N.name)||((p=a.branch)==null?void 0:p.name)||"â€”",x=a.officerName||((L=a.officer)==null?void 0:L.name)||((k=a.loanOfficer)==null?void 0:k.name)||"â€”";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(C,{label:"Full Name",value:t}),e.jsx(C,{label:"Phone",value:a.phone||"â€”"}),e.jsx(C,{label:"Branch",value:h}),e.jsx(C,{label:"Loan Officer",value:x}),e.jsx(C,{label:"Status",value:a.status||"â€”"}),e.jsx(C,{label:"National ID",value:a.nationalId||"â€”"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(E,{label:"Outstanding Loan",value:A(a.outstandingLoan)}),e.jsx(E,{label:"Outstanding Interest",value:A(a.outstandingInterest)}),e.jsx(E,{label:"Net Savings",value:A(a.netSavings)})]})]})},Ie=({items:a})=>!Array.isArray(a)||a.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No loans."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Loan #"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Product"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Disbursed"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Outstanding"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:t.id}),e.jsx("td",{className:"px-3 py-2",children:t.product||"â€”"}),e.jsx("td",{className:"px-3 py-2",children:A(t.disbursed)}),e.jsx("td",{className:"px-3 py-2",children:A(t.outstanding)}),e.jsx("td",{className:"px-3 py-2",children:t.status||"â€”"})]},t.id))})]})}),$e=({items:a})=>!Array.isArray(a)||a.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No savings accounts."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Notes"})]})}),e.jsx("tbody",{children:a.map((t,h)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:t.date?new Date(t.date).toLocaleDateString():"â€”"}),e.jsx("td",{className:"px-3 py-2 capitalize",children:t.type||"â€”"}),e.jsx("td",{className:"px-3 py-2",children:A(t.amount)}),e.jsx("td",{className:"px-3 py-2",children:t.notes||"â€”"})]},t.id||h))})]})}),Oe=({items:a})=>e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("button",{onClick:()=>alert("KYC upload coming soon"),className:"inline-flex items-center gap-2 px-3 py-2 border rounded-lg bg-white hover:bg-gray-50",children:[e.jsx(ke,{className:"w-4 h-4"})," Upload Document"]})}),!Array.isArray(a)||a.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No documents."}):e.jsx("ul",{className:"space-y-2",children:a.map(t=>e.jsxs("li",{className:"border rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:t.fileName||t.name||"Document"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.type||"KYC"," â€¢ ",t.createdAt?new Date(t.createdAt).toLocaleString():""]})]})]}),t.url&&e.jsx("a",{className:"text-indigo-600 hover:text-indigo-800 underline text-sm",href:t.url,target:"_blank",rel:"noreferrer",children:"Open"})]},t.id))})]}),C=({label:a,value:t})=>e.jsxs("div",{className:"border rounded-xl p-4 bg-white shadow-sm",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:a}),e.jsx("p",{className:"text-base font-semibold text-gray-900 mt-1",children:t})]}),E=({label:a,value:t})=>e.jsxs("div",{className:"rounded-2xl p-4 border bg-gray-50",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:a}),e.jsx("p",{className:"text-xl font-semibold text-gray-900 mt-1",children:t})]}),A=a=>`TZS ${Number(a||0).toLocaleString()}`;export{Re as default};
