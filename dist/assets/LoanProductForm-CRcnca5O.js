import{u as S,i as D,r as h,g as b,j as t,L as P}from"./index-LbmMX0zK.js";const k=(...c)=>c.filter(Boolean).join(" "),l=c=>{if(c===""||c===null||c===void 0)return null;const m=Number(c);return Number.isFinite(m)?m:null},o={"data-gramm":"false","data-gramm_editor":"false","data-enable-grammarly":"false","data-ms-editor":"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1};function B(){const c=S(),{id:m}=D(),p=!!m,[g,v]=h.useState(!1),[N,R]=h.useState(p),[x,T]=h.useState({}),[a,j]=h.useState({name:"",code:"",status:"active",interestMethod:"flat",interestRate:"",minPrincipal:"",maxPrincipal:"",minTermMonths:"",maxTermMonths:"",penaltyRate:"",description:""});h.useEffect(()=>{p&&(async()=>{try{const{data:e}=await b.get(`/loan-products/${m}`);j({name:e.name||"",code:e.code||"",status:e.status||"active",interestMethod:e.interestMethod||"flat",interestRate:e.interestRate===0||e.interestRate?String(e.interestRate):"",minPrincipal:e.minPrincipal===0||e.minPrincipal?String(e.minPrincipal):"",maxPrincipal:e.maxPrincipal===0||e.maxPrincipal?String(e.maxPrincipal):"",minTermMonths:e.minTermMonths===0||e.minTermMonths?String(e.minTermMonths):"",maxTermMonths:e.maxTermMonths===0||e.maxTermMonths?String(e.maxTermMonths):"",penaltyRate:e.penaltyRate===0||e.penaltyRate?String(e.penaltyRate):"",description:e.description||""})}catch{alert("Failed to load product"),c("/loans/products",{replace:!0})}finally{R(!1)}})()},[p,m,c]);const n=(e,d)=>j(u=>({...u,[e]:d})),s=e=>{e.stopPropagation()},C=()=>{const e={},d=l(a.interestRate),u=l(a.minPrincipal),f=l(a.maxPrincipal),y=l(a.minTermMonths),M=l(a.maxTermMonths);return String(a.name).trim()||(e.name="Name is required"),String(a.code).trim()||(e.code="Code is required"),(d===null||d<0)&&(e.interestRate="Interest rate must be 0 or more"),u!==null&&f!==null&&f<u&&(e.maxPrincipal="Max must be ≥ Min"),y!==null&&M!==null&&M<y&&(e.maxTermMonths="Max must be ≥ Min"),T(e),Object.keys(e).length===0},w=async e=>{if(e.preventDefault(),!C())return;v(!0);const d={name:a.name.trim(),code:a.code.trim().toUpperCase(),status:a.status,interestMethod:a.interestMethod,interestRate:l(a.interestRate)??0,minPrincipal:l(a.minPrincipal),maxPrincipal:l(a.maxPrincipal),minTermMonths:l(a.minTermMonths),maxTermMonths:l(a.maxTermMonths),penaltyRate:l(a.penaltyRate),description:a.description||""};try{p?await b.put(`/loan-products/${m}`,d):await b.post("/loan-products",d),c("/loans/products")}catch{alert("Failed to save product")}finally{v(!1)}},r=({label:e,children:d,error:u})=>t.jsxs("label",{className:"block",children:[t.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 mb-1",children:e}),d,u&&t.jsx("div",{className:"mt-1 text-xs text-rose-600",children:u})]}),i="w-full input border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 text-sm";return t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("h2",{className:"text-2xl font-bold",children:p?"Edit Loan Product":"Create Loan Product"})}),t.jsx(P,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700",children:"Back to list"})]}),N?t.jsx("div",{className:"card p-4",children:"Loading…"}):t.jsxs("form",{onSubmit:w,className:"card p-4 space-y-4",children:[t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[t.jsx(r,{label:"Name",error:x.name,children:t.jsx("input",{...o,className:i,value:a.name,onKeyDown:s,onChange:e=>n("name",e.target.value),placeholder:"e.g. Business Working Capital",required:!0})}),t.jsx(r,{label:"Code",error:x.code,children:t.jsx("input",{...o,className:i,value:a.code,onKeyDown:s,onChange:e=>n("code",e.target.value),onBlur:e=>n("code",e.target.value.toUpperCase()),placeholder:"e.g. BWC",required:!0})}),t.jsx(r,{label:"Status",children:t.jsxs("select",{...o,className:i,value:a.status,onKeyDown:s,onChange:e=>n("status",e.target.value),children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx(r,{label:"Interest Method",children:t.jsxs("select",{...o,className:i,value:a.interestMethod,onKeyDown:s,onChange:e=>n("interestMethod",e.target.value),children:[t.jsx("option",{value:"flat",children:"Flat"}),t.jsx("option",{value:"reducing",children:"Reducing"})]})}),t.jsx(r,{label:"Interest Rate (%)",error:x.interestRate,children:t.jsx("input",{...o,type:"number",step:"0.0001",className:i,value:a.interestRate,onKeyDown:s,onChange:e=>n("interestRate",e.target.value),placeholder:"e.g. 3",inputMode:"decimal"})}),t.jsx(r,{label:"Penalty Rate (%)",children:t.jsx("input",{...o,type:"number",step:"0.0001",className:i,value:a.penaltyRate,onKeyDown:s,onChange:e=>n("penaltyRate",e.target.value),placeholder:"e.g. 1.5",inputMode:"decimal"})}),t.jsx(r,{label:"Min Principal",children:t.jsx("input",{...o,type:"number",className:i,value:a.minPrincipal,onKeyDown:s,onChange:e=>n("minPrincipal",e.target.value),placeholder:"e.g. 100000",inputMode:"numeric"})}),t.jsx(r,{label:"Max Principal",error:x.maxPrincipal,children:t.jsx("input",{...o,type:"number",className:i,value:a.maxPrincipal,onKeyDown:s,onChange:e=>n("maxPrincipal",e.target.value),placeholder:"e.g. 10000000",inputMode:"numeric"})}),t.jsx(r,{label:"Min Term (months)",children:t.jsx("input",{...o,type:"number",className:i,value:a.minTermMonths,onKeyDown:s,onChange:e=>n("minTermMonths",e.target.value),placeholder:"e.g. 3",inputMode:"numeric"})}),t.jsx(r,{label:"Max Term (months)",error:x.maxTermMonths,children:t.jsx("input",{...o,type:"number",className:i,value:a.maxTermMonths,onKeyDown:s,onChange:e=>n("maxTermMonths",e.target.value),placeholder:"e.g. 36",inputMode:"numeric"})}),t.jsx("div",{className:"sm:col-span-2",children:t.jsx(r,{label:"Internal Notes / Description",children:t.jsx("textarea",{...o,rows:3,className:i,value:a.description||"",onKeyDown:s,onChange:e=>n("description",e.target.value),placeholder:"Optional details visible to staff only."})})})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[t.jsx(P,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700 text-sm hover:bg-slate-50 dark:hover:bg-slate-800",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:!!g,className:k("px-4 py-2 rounded text-white text-sm",g?"bg-indigo-400":"bg-indigo-600 hover:bg-indigo-700"),children:g?"Saving…":p?"Update Product":"Create Product"})]})]})]})}export{B as default};
