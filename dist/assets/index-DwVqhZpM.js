import{f as g}from"./index-DFzTBWzb.js";const T={MODE:"production",VITE_API_BASE_URL:"https://mkoposuite-backend-42w2.onrender.com/api"},p=typeof import.meta<"u"&&T||{},A=typeof window<"u"&&window.__API_BASE_URL__||"",N=String(p.VITE_API_BASE_URL||p.VITE_API_BASE||A||""),O=N.replace(/\/+$/,""),R=typeof window<"u"?window.location.origin:"http://localhost:10000",v=O||R,_=v.replace(/\/+$/,""),w=/\/api(?:\/v\d+)?$/i.test(_)?_:`${_}/api`,D=String(p.VITE_API_WITH_CREDENTIALS??"0")==="1",b=Number(p.VITE_API_TIMEOUT??3e4)||3e4,I=Number(p.VITE_API_RETRIES??0)||0,P=String(p.VITE_SEND_TZ_HEADERS??"1")!=="0",n=g.create({baseURL:w,withCredentials:D,timeout:b,headers:{Accept:"application/json"}}),S=["access_token","accessToken","token","authToken","jwt"],C=/\/api/i.test(w);function i(t){if(!t)return"/";if(/^https?:\/\//i.test(t))return t;let e=String(t).trim();const[a,r=""]=e.split(/(?=[?#])/);let s=a;return s.startsWith("/")||(s=`/${s}`),C&&s.startsWith("/api/")&&(s=s.slice(4)),s=s.replace(/\/{2,}/g,"/"),`${s}${r}`}function $(t){const a=i(t).replace(/^\/api\//,"/"),r=a.startsWith("/api/")?a:`/api${a}`;return Array.from(new Set([a,r]))}function k(t){return typeof FormData<"u"&&t instanceof FormData}function B(){var t;try{if((t=globalThis==null?void 0:globalThis.crypto)!=null&&t.randomUUID)return crypto.randomUUID()}catch{}return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}let u=null;n.interceptors.request.use(t=>{var r,s,d;t.url&&!/^https?:\/\//i.test(t.url)&&(t.url=i(t.url));let e=null;for(const o of S)try{const c=typeof localStorage<"u"?localStorage.getItem(o):null;if(c){e=String(c).replace(/^Bearer\s+/i,"");break}}catch{}e&&(t.headers.Authorization=`Bearer ${e}`);try{if(typeof window<"u"&&!u){const c=new URL(window.location.href).searchParams.get("tenantId");c&&(u=c)}}catch{}let a=u||typeof localStorage<"u"&&(localStorage.getItem("activeTenantId")||localStorage.getItem("x-tenant-id"));if(!a&&typeof localStorage<"u")try{const o=JSON.parse(localStorage.getItem("user")||"{}");a=(o==null?void 0:o.tenantId)||((r=o==null?void 0:o.tenant)==null?void 0:r.id)||(o==null?void 0:o.orgId)||(o==null?void 0:o.companyId)||null}catch{}a&&(t.headers["x-tenant-id"]=a);try{const o=typeof localStorage<"u"?localStorage.getItem("activeBranchId"):null;o&&(t.headers["x-branch-id"]=o)}catch{}if(P){try{const o=Intl.DateTimeFormat().resolvedOptions().timeZone;o&&(t.headers["x-timezone"]=o)}catch{}try{t.headers["x-tz-offset"]=String(new Date().getTimezoneOffset())}catch{}}return k(t.data)?t.headers&&"Content-Type"in t.headers&&delete t.headers["Content-Type"]:((s=t.headers)["x-request-id"]||(s["x-request-id"]=B()),(d=t.headers)["Content-Type"]||(d["Content-Type"]="application/json")),t});let y=!1;n.interceptors.response.use(t=>t,async t=>{var d,o,c,l,m;const e=(d=t==null?void 0:t.response)==null?void 0:d.status,a=(t==null?void 0:t.config)||{};if(t.normalizedMessage=e?((c=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:c.error)||((m=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:m.message)||(t==null?void 0:t.message)||`Request failed (${e})`:(t==null?void 0:t.message)==="Network Error"?"Network error: server unreachable.":(t==null?void 0:t.code)==="ECONNABORTED"?"Request timeout. Please try again.":(t==null?void 0:t.message)||"Request failed.",e===401){try{[...S,"user","tenant","tenantId","tenantName","activeTenantId","activeBranchId","x-tenant-id"].forEach(h=>{try{typeof localStorage<"u"&&localStorage.removeItem(h),typeof sessionStorage<"u"&&sessionStorage.removeItem(h)}catch{}}),delete n.defaults.headers.common.Authorization,delete n.defaults.headers.common["x-tenant-id"],delete n.defaults.headers.common["x-branch-id"]}catch{}return!y&&typeof window<"u"&&(y=!0,/\/login$/.test(window.location.pathname)||window.location.replace("/login")),Promise.reject(t)}const r=e&&[429,502,503,504].includes(e),s=(a.method||"get").toLowerCase()==="get";if(a.__retryCount=a.__retryCount||0,I>0&&s&&r&&a.__retryCount<I){a.__retryCount+=1;const h=Math.min(1e3*2**(a.__retryCount-1),4e3);return await new Promise(E=>setTimeout(E,h)),n.request(a)}return p.MODE!=="production"&&console.error("API error:",t.normalizedMessage,(t==null?void 0:t.response)||t),Promise.reject(t)});n.getJSON=async(t,e)=>(await n.get(i(t),e)).data;n.postJSON=async(t,e,a)=>(await n.post(i(t),e,a)).data;n.putJSON=async(t,e,a)=>(await n.put(i(t),e,a)).data;n.patchJSON=async(t,e,a)=>(await n.patch(i(t),e,a)).data;n.deleteJSON=async(t,e)=>(await n.delete(i(t),e)).data;n.postForm=async(t,e,a)=>(await n.post(i(t),e,a)).data;n.putForm=async(t,e,a)=>(await n.put(i(t),e,a)).data;n.patchForm=async(t,e,a)=>(await n.patch(i(t),e,a)).data;async function f(t,e,a,r){const s=Array.isArray(e)?e:[e],d=Array.from(new Set(s.flatMap(c=>$(c))));let o;for(const c of d)try{const l=i(c);return(t==="get"||t==="delete"?await n[t](l,r):await n[t](l,a,r)).data}catch(l){o=l}throw o||new Error("No endpoint succeeded")}n.getFirst=(t,e)=>f("get",t,void 0,e);n.postFirst=(t,e,a)=>f("post",t,e,a);n.putFirst=(t,e,a)=>f("put",t,e,a);n.patchFirst=(t,e,a)=>f("patch",t,e,a);n.deleteFirst=(t,e)=>f("delete",t,void 0,e);n.setTenantId=t=>{u=t||null};n.clearTenantId=()=>{u=null};n.getTenantId=()=>u||(typeof localStorage<"u"?localStorage.getItem("activeTenantId"):null)||null;n.path=i;n.withAbort=()=>{const t=new AbortController;return{signal:t.signal,cancel:()=>t.abort()}};["get","post","put","patch","delete"].forEach(t=>{n[`_${t}`]=(e,...a)=>n[t](i(e),...a)});export{n as a};
