import{r as n,j as e,h as m}from"./index-CM-KCFgk.js";function f(){const[p,j]=n.useState([]),[d,r]=n.useState({employeeId:"",title:"",startDate:"",endDate:"",file:null}),[y,g]=n.useState([]),[h,o]=n.useState(""),u=async()=>{var t,s,a,i,c;o("");try{const[{data:l},{data:x}]=await Promise.all([m.get("/hr/employees",{params:{limit:500}}),m.get("/hr/contracts")]);g((l==null?void 0:l.items)||[]),j((x==null?void 0:x.items)||[])}catch(l){o((a=(s=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:s.message)!=null&&a.includes("Required table is missing")?"Required table is missing. Run DB migrations (sequelize).":((c=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:c.message)||l.message)}};n.useEffect(()=>{u()},[]);const N=async()=>{var t,s;try{const a=new FormData;Object.entries(d).forEach(([i,c])=>a.append(i,c)),await m.post("/hr/contracts",a,{headers:{"Content-Type":"multipart/form-data"}}),r({employeeId:"",title:"",startDate:"",endDate:"",file:null}),await u()}catch(a){o(((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Contracts"}),h&&e.jsx("div",{className:"text-sm text-red-600",children:h}),e.jsxs("div",{className:"bg-white border rounded-xl p-3 grid gap-2 md:grid-cols-6 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Employee"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:d.employeeId,onChange:t=>r(s=>({...s,employeeId:t.target.value})),children:[e.jsx("option",{value:"",children:"Select"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.firstName," ",t.lastName]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Title"}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:d.title,onChange:t=>r(s=>({...s,title:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Start"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:d.startDate,onChange:t=>r(s=>({...s,startDate:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"End"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:d.endDate,onChange:t=>r(s=>({...s,endDate:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"PDF"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:t=>r(s=>{var a;return{...s,file:((a=t.target.files)==null?void 0:a[0])||null}})})]}),e.jsx("button",{onClick:N,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Upload"})]}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Employee"}),e.jsx("th",{className:"py-2 px-3",children:"Title"}),e.jsx("th",{className:"py-2 px-3",children:"Start→End"}),e.jsx("th",{className:"py-2 px-3",children:"Status"}),e.jsx("th",{className:"py-2 px-3",children:"File"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-3 text-gray-500",children:"No contracts."})}):p.map(t=>{var s;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:((s=t.employee)==null?void 0:s.name)||t.employeeName}),e.jsx("td",{className:"py-2 px-3",children:t.title}),e.jsxs("td",{className:"py-2 px-3",children:[t.startDate," → ",t.endDate]}),e.jsx("td",{className:"py-2 px-3",children:t.status||(new Date(t.endDate)>=new Date?"active":"expired")}),e.jsx("td",{className:"py-2 px-3",children:t.fileUrl?e.jsx("a",{href:t.fileUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 underline",children:"Open"}):"—"})]},t.id)})})]})})]})}export{f as default};
