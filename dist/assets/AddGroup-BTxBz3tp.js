import{r as o,j as s,g as D}from"./index-Bhy8wnkc.js";function i(e){const t=(e.startsWith("/")?e:`/${e}`).replace(/^\/api\//,"/"),n=t.startsWith("/api/")?t:`/api${t}`;return Array.from(new Set([t,n]))}async function E(e=[],r={}){let t;for(const n of e)try{const l=await D.get(n,r);return l==null?void 0:l.data}catch(l){t=l}throw t||new Error("No endpoint succeeded")}async function C(e=[],r={},t={}){let n;for(const l of e)try{const c=await D.post(l,r,t);return c==null?void 0:c.data}catch(c){n=c}throw n||new Error("No endpoint succeeded")}function G(e){return(Array.isArray(e)?e:(e==null?void 0:e.items)||(e==null?void 0:e.rows)||(e==null?void 0:e.data)||[]).map(t=>({id:t.id??t._id??t.branchId??t.code??String(t.name||"branch"),name:t.name??t.title??t.label??String(t.code||"—")}))}function B(e){return(Array.isArray(e)?e:(e==null?void 0:e.items)||(e==null?void 0:e.rows)||(e==null?void 0:e.data)||[]).map(t=>({id:t.id??t._id??t.userId??String(t.email||t.phone||"user"),name:t.name||[t.firstName,t.lastName].filter(Boolean).join(" ").trim()||t.username||t.email||t.phone||"—",roles:(t.roles||t.Roles||[]).map(n=>(n.name||n.code||"").toString().toLowerCase()),title:(t.title||t.jobTitle||"").toString().toLowerCase()}))}function M(e){const r=[...e.roles||[],e.title||""].join(" ");return/loan.*officer|credit.*officer|field.*officer/i.test(r)}const k=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],T=()=>{const[e,r]=o.useState({name:"",branchId:"",meetingDay:"",officerId:"",notes:""}),[t,n]=o.useState([]),[l,c]=o.useState([]),[p,x]=o.useState(!0),[b,y]=o.useState(!0),[j,v]=o.useState(!1),[N,g]=o.useState(""),f=a=>r(d=>({...d,[a.target.name]:a.target.value}));o.useEffect(()=>{const a=new AbortController;return(async()=>{try{x(!0);const d=await E([...i("branches"),...i("org/branches")],{signal:a.signal});n(G(d))}catch{n([])}finally{x(!1)}})(),()=>a.abort()},[]),o.useEffect(()=>{const a=new AbortController;return(async()=>{try{y(!0);const d=await E([...i("users?role=loan_officer"),...i("admin/staff?role=loan_officer"),...i("users"),...i("admin/staff")],{signal:a.signal}),u=B(d),h=u.filter(M);c(h.length?h:u)}catch{c([])}finally{y(!1)}})(),()=>a.abort()},[]);const S=o.useMemo(()=>t.map(a=>({value:String(a.id),label:a.name||String(a.id)})),[t]),I=o.useMemo(()=>l.map(a=>({value:String(a.id),label:a.name||String(a.id)})),[l]),L=async a=>{var d,u,h,A;a.preventDefault(),v(!0),g("");try{const m={name:e.name.trim(),branchId:((d=e.branchId)==null?void 0:d.trim())||null,meetingDay:e.meetingDay?String(e.meetingDay).toLowerCase():null,officerId:((u=e.officerId)==null?void 0:u.trim())||null,notes:e.notes||null};await C([...i("borrowers/groups"),...i("groups"),...i("borrower-groups")],m),g("✅ Group created."),r({name:"",branchId:"",meetingDay:"",officerId:"",notes:""})}catch(m){const O=((A=(h=m==null?void 0:m.response)==null?void 0:h.data)==null?void 0:A.error)||(m==null?void 0:m.message)||"Failed to create group.";g(`❌ ${O}`)}finally{v(!1)}};return s.jsxs("div",{className:"p-4 max-w-2xl",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Add Group"}),s.jsxs("form",{onSubmit:L,className:"space-y-4 bg-white p-4 rounded-xl border shadow",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Name"}),s.jsx("input",{name:"name",value:e.name,onChange:f,required:!0,className:"w-full border rounded-lg px-3 py-2",placeholder:"Group name"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Branch"}),s.jsxs("select",{name:"branchId",value:e.branchId,onChange:f,className:"w-full border rounded-lg px-3 py-2 bg-white",disabled:p||!S.length,children:[s.jsx("option",{value:"",children:p?"Loading…":"(Select branch)"}),S.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Loan Officer"}),s.jsxs("select",{name:"officerId",value:e.officerId,onChange:f,className:"w-full border rounded-lg px-3 py-2 bg-white",disabled:b||!I.length,children:[s.jsx("option",{value:"",children:b?"Loading…":"(None yet)"}),I.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Meeting Day"}),s.jsxs("select",{name:"meetingDay",value:e.meetingDay,onChange:f,className:"w-full border rounded-lg px-3 py-2 bg-white",children:[s.jsx("option",{value:"",children:"(None)"}),k.map(a=>s.jsx("option",{value:a,children:a[0].toUpperCase()+a.slice(1)},a))]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Notes"}),s.jsx("textarea",{name:"notes",value:e.notes,onChange:f,className:"w-full border rounded-lg px-3 py-2",rows:3,placeholder:"Optional notes about this group"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"submit",disabled:j,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60",children:j?"Saving…":"Create Group"}),N&&s.jsx("div",{className:"text-sm",children:N})]})]})]})};export{T as default};
