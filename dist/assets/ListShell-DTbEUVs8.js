import{r as l,b as R,j as e}from"./index-yEiZmsAc.js";function F({url:i,params:c={},initialPage:u=1,initialLimit:y=20}){const[d,m]=l.useState(u),[r,C]=l.useState(y),[j,M]=l.useState(c.q||""),[E,S]=l.useState(!0),[k,p]=l.useState(""),[b,x]=l.useState([]),[A,h]=l.useState(0),[L,g]=l.useState(null),t=l.useMemo(()=>({...c,page:d,limit:r,q:j||void 0}),[c,d,r,j]),n=l.useMemo(()=>R.path(i||"/"),[i]),f=async a=>{var v,q,P;S(!0),p("");try{const s=await R.get(n,{params:t,signal:a}),o=s==null?void 0:s.data;Array.isArray(o)?(x(o),h(o.length),g(null)):o&&Array.isArray(o.data)?(x(o.data),h(((v=o.pagination)==null?void 0:v.total)??o.data.length??0),g(o.summary??null)):(x([]),h(0),g(null))}catch(s){(s==null?void 0:s.name)!=="CanceledError"&&(s==null?void 0:s.message)!=="canceled"&&p(((P=(q=s==null?void 0:s.response)==null?void 0:q.data)==null?void 0:P.error)||s.message||"Request failed")}finally{(!a||!a.aborted)&&S(!1)}};return l.useEffect(()=>{const a=new AbortController;return f(a.signal),()=>a.abort()},[n,JSON.stringify(t)]),{rows:b,total:A,page:d,setPage:m,limit:r,setLimit:C,q:j,setQ:M,loading:E,error:k,summary:L,refresh:()=>f()}}function B({page:i,setPage:c,limit:u,setLimit:y,total:d}){const m=Math.max(1,Math.ceil((d||0)/(u||20)));return e.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows:"}),e.jsx("select",{className:"border rounded px-2 py-1",value:u,onChange:r=>{c(1),y(parseInt(r.target.value,10))},children:[10,20,50,100].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c(Math.max(1,i-1)),disabled:i<=1,children:"Prev"}),e.jsxs("span",{children:["Page ",i," / ",m]}),e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c(Math.min(m,i+1)),disabled:i>=m,children:"Next"})]})]})}function J({title:i,q:c,setQ:u,columns:y=[],rows:d=[],loading:m,error:r,page:C,setPage:j,limit:M,setLimit:E,total:S,toolbar:k,renderActions:p,renderRowActions:b}){const x=!!(p||b),A=l.useMemo(()=>(Array.isArray(d)?d:[]).filter(Boolean),[d]),h=Array.isArray(y)?y.filter(Boolean):[],L=(t,n,f,N)=>{const a=n==null?void 0:n[t.key];if(typeof t.render=="function"){try{const v=t.render({row:n,value:a,column:t,rowIndex:f,colIndex:N});if(typeof v<"u")return v}catch{}try{return t.render(a,n)}catch{}try{return t.render(n)}catch{}}return a===null||typeof a>"u"||a===""?"—":String(a)},g=t=>typeof b=="function"?b(t):typeof p=="function"?p(t):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:i}),typeof c<"u"&&typeof u=="function"&&e.jsx("input",{value:c,onChange:t=>u(t.target.value),placeholder:"Search…",className:"px-3 py-2 border rounded w-full sm:w-60 dark:bg-gray-700"})]}),k?e.jsx("div",{className:"mb-3",children:k}):null,r&&e.jsxs("div",{className:"text-red-500 text-sm mb-3",children:["Error: ",String(r)]}),m?e.jsx("div",{className:"py-10 text-center text-sm opacity-70",children:"Loading…"}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b dark:border-gray-700",children:[h.map(t=>e.jsx("th",{className:"px-3 py-2",children:t.title??t.key??""},t.key||t.title)),x&&e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:h.length+(x?1:0),className:"px-3 py-10 text-center opacity-70",children:"No data"})}):A.map((t,n)=>e.jsxs("tr",{className:"border-b last:border-0 dark:border-gray-700",children:[h.map((f,N)=>e.jsx("td",{className:"px-3 py-2",children:L(f,t,n,N)},f.key||N)),x&&e.jsx("td",{className:"px-3 py-2",children:g(t)})]},(t==null?void 0:t.id)??n))})]})}),e.jsx(B,{page:C,setPage:j,limit:M,setLimit:E,total:S})]})}export{J as L,F as u};
