import{r as n,g as j,j as e}from"./index-C7g4An2R.js";const y=(l,i)=>l?["admin","director","super_admin","system_admin"].includes((l.role||"").toLowerCase())?!0:Array.isArray(l.permissions)&&l.permissions.includes(i):!1;function B(){const[l,i]=n.useState(null),[a,o]=n.useState("overview");return n.useEffect(()=>{(async()=>{try{const{data:x}=await j.get("/auth/me");i(x)}catch{}})()},[]),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Branches"}),e.jsxs("div",{className:"flex gap-1 rounded-lg border bg-white overflow-hidden",children:[e.jsx(N,{label:"Overview",id:"overview",tab:a,setTab:o}),y(l,"branches:manage")&&e.jsx(N,{label:"Add",id:"add",tab:a,setTab:o}),y(l,"branches:assign")&&e.jsx(N,{label:"Assign",id:"assign",tab:a,setTab:o}),e.jsx(N,{label:"Reports",id:"reports",tab:a,setTab:o})]})]}),a==="overview"&&e.jsx(S,{}),a==="add"&&y(l,"branches:manage")&&e.jsx(A,{}),a==="assign"&&y(l,"branches:assign")&&e.jsx(C,{}),a==="reports"&&e.jsx(k,{})]}):e.jsx("div",{className:"p-4",children:"Loading…"})}function N({label:l,id:i,tab:a,setTab:o}){const x=a===i;return e.jsx("button",{onClick:()=>o(i),className:`px-3 py-1.5 text-sm ${x?"bg-slate-100":"bg-white hover:bg-slate-50"}`,children:l})}function S(){const[l,i]=n.useState([]),[a,o]=n.useState(""),[x,g]=n.useState(""),h=async()=>{var d,m;g("");try{const{data:r}=await j.get("/branches",{params:{q:a}}),p=Array.isArray(r==null?void 0:r.items)?r.items:Array.isArray(r)?r:[];i(p)}catch(r){g(((m=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:m.error)||r.message)}};return n.useEffect(()=>{h()},[]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Search"}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm",value:a,onChange:d=>o(d.target.value)})]}),e.jsx("button",{onClick:h,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Apply"})]}),x&&e.jsx("div",{className:"text-sm text-red-600",children:x}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Name"}),e.jsx("th",{className:"py-2 px-3",children:"Code"}),e.jsx("th",{className:"py-2 px-3",children:"Manager"}),e.jsx("th",{className:"py-2 px-3",children:"Phone"}),e.jsx("th",{className:"py-2 px-3",children:"Address"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-3 text-gray-500",children:"No branches yet."})}):l.map(d=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:d.name}),e.jsx("td",{className:"py-2 px-3",children:d.code||"—"}),e.jsx("td",{className:"py-2 px-3",children:d.managerName||d.manager_id||"—"}),e.jsx("td",{className:"py-2 px-3",children:d.phone||"—"}),e.jsx("td",{className:"py-2 px-3",children:d.address||"—"})]},d.id))})]})})]})}function A(){const[l,i]=n.useState({name:"",code:"",phone:"",address:""}),[a,o]=n.useState(!1),[x,g]=n.useState(""),[h,d]=n.useState(""),m=async()=>{var r,p;o(!0),d(""),g("");try{await j.post("/branches",l),g("Branch created."),i({name:"",code:"",phone:"",address:""})}catch(u){d(((p=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:p.error)||u.message)}finally{o(!1)}};return e.jsxs("div",{className:"bg-white border rounded-xl p-3 grid gap-2 md:grid-cols-4 items-end",children:[["name","code","phone","address"].map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:r}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:l[r],onChange:p=>i(u=>({...u,[r]:p.target.value}))})]},r)),e.jsx("button",{onClick:m,disabled:a,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:a?"Saving…":"Create"}),x&&e.jsx("div",{className:"text-sm text-emerald-700",children:x}),h&&e.jsx("div",{className:"text-sm text-red-600",children:h})]})}function C(){const[l,i]=n.useState([]),[a,o]=n.useState([]),[x,g]=n.useState(""),[h,d]=n.useState([]),[m,r]=n.useState(""),[p,u]=n.useState("");n.useEffect(()=>{(async()=>{try{const[{data:s},{data:t}]=await Promise.all([j.get("/branches"),j.get("/users",{params:{limit:1e3}})]),b=Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s)?s:[],w=Array.isArray(t==null?void 0:t.items)?t.items:Array.isArray(t==null?void 0:t.rows)?t.rows:Array.isArray(t)?t:[];i(b),o(w)}catch{}})()},[]);const f=s=>{d(t=>t.includes(s)?t.filter(b=>b!==s):[...t,s])},c=async()=>{var s,t;r(""),u("");try{await j.post(`/branches/${x}/assign-staff`,{userIds:h}),r("Assigned successfully.")}catch(b){u(((t=(s=b==null?void 0:b.response)==null?void 0:s.data)==null?void 0:t.error)||b.message)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm min-w-[220px]",value:x,onChange:s=>g(s.target.value),children:[e.jsx("option",{value:"",children:"Select branch"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("button",{onClick:c,disabled:!x||h.length===0,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:["Assign ",h.length?`(${h.length})`:""]}),m&&e.jsx("div",{className:"text-sm text-emerald-700",children:m}),p&&e.jsx("div",{className:"text-sm text-red-600",children:p})]}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Assign"}),e.jsx("th",{className:"py-2 px-3",children:"Name"}),e.jsx("th",{className:"py-2 px-3",children:"Email"}),e.jsx("th",{className:"py-2 px-3",children:"Role"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3 text-gray-500",children:"No users."})}):a.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:()=>f(s.id)})}),e.jsx("td",{className:"py-2 px-3",children:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()}),e.jsx("td",{className:"py-2 px-3",children:s.email}),e.jsx("td",{className:"py-2 px-3",children:s.role||(s.Roles||[]).map(t=>t.name).join(", ")||"—"})]},s.id))})]})})]})}function k(){const[l,i]=n.useState([]),[a,o]=n.useState(""),[x,g]=n.useState(""),[h,d]=n.useState(""),[m,r]=n.useState(null),[p,u]=n.useState("");n.useEffect(()=>{(async()=>{try{const{data:c}=await j.get("/branches"),s=Array.isArray(c==null?void 0:c.items)?c.items:Array.isArray(c)?c:[];i(s)}catch{}})()},[]);const f=async()=>{var c,s;u(""),r(null);try{const{data:t}=await j.get(`/branches/${a}/report`,{params:{from:x,to:h}});r((t==null?void 0:t.kpis)||t||null)}catch(t){u(((s=(c=t==null?void 0:t.response)==null?void 0:c.data)==null?void 0:s.error)||t.message)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm min-w-[220px]",value:a,onChange:c=>o(c.target.value),children:[e.jsx("option",{value:"",children:"Select"}),l.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"From"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:x,onChange:c=>g(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"To"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:h,onChange:c=>d(c.target.value)})]}),e.jsx("button",{onClick:f,disabled:!a,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Run"})]}),p&&e.jsx("div",{className:"text-sm text-red-600",children:p}),m&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(v,{title:"Staff",value:m.staffCount,tone:"indigo"}),e.jsx(v,{title:"Expenses",value:`TZS ${Number(m.expenses||0).toLocaleString()}`,tone:"amber"}),e.jsx(v,{title:"Loans Out",value:`TZS ${Number(m.loansOut||m.disbursed||0).toLocaleString()}`,tone:"emerald"}),e.jsx(v,{title:"Collections",value:`TZS ${Number(m.collections||m.collected||0).toLocaleString()}`,tone:"blue"})]})]})}function v({title:l,value:i,tone:a="indigo"}){const o={indigo:"text-indigo-600 bg-indigo-50",amber:"text-amber-600 bg-amber-50",emerald:"text-emerald-600 bg-emerald-50",blue:"text-blue-600 bg-blue-50"}[a]||"text-slate-600 bg-slate-50";return e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:`px-2 py-1 rounded ${o}`,children:l}),e.jsx("div",{className:"font-semibold",children:i??"—"})]})}export{B as default};
