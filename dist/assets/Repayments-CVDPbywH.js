import{r as o,a as i,j as e}from"./index-Dk5Cvq3D.js";import{E as f}from"./jspdf.es.min-B0Mf4MrB.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{C as g}from"./index-BIZUPYVK.js";import{f as m}from"./format-CBpsKyOP.js";const E=()=>{const[p,x]=o.useState([]),[l,h]=o.useState("all"),[u,b]=o.useState([]),c="https://mkoposuite-backend-42w2.onrender.com/api";o.useEffect(()=>{j(),N()},[]);const j=async()=>{try{const a=await i.get(`${c}/repayments`);x(a.data)}catch(a){console.error("Error fetching repayments:",a)}},N=async()=>{try{const a=await i.get(`${c}/loans`);b(a.data)}catch(a){console.error("Error fetching loans:",a)}},n=p.filter(a=>l==="all"?!0:a.loanId===parseInt(l)),y=()=>{const a=new f;a.text("Repayment Report",14,16),a.autoTable({startY:20,head:[["Borrower","Loan Amount","Installment","Due Date","Total","Balance","Status"]],body:n.map(t=>{var s,r,d;return[((r=(s=t.Loan)==null?void 0:s.Borrower)==null?void 0:r.name)||"N/A",(d=t.Loan)==null?void 0:d.amount,t.installmentNumber,t.dueDate?m(new Date(t.dueDate),"yyyy-MM-dd"):"-",t.total,t.balance,t.status]})}),a.save("repayments.pdf")};return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Loan Repayments"}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[e.jsxs("select",{value:l,onChange:a=>h(a.target.value),className:"border px-4 py-2 rounded",children:[e.jsx("option",{value:"all",children:"All Loans"}),u.map(a=>{var t;return e.jsx("option",{value:a.id,children:((t=a.Borrower)==null?void 0:t.name)||"Loan "+a.id},a.id)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{data:n,filename:"repayments.csv",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Export CSV"}),e.jsx("button",{onClick:y,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Export PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded shadow border",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Borrower"}),e.jsx("th",{className:"p-2 border",children:"Loan Amount"}),e.jsx("th",{className:"p-2 border",children:"Installment"}),e.jsx("th",{className:"p-2 border",children:"Due Date"}),e.jsx("th",{className:"p-2 border",children:"Total"}),e.jsx("th",{className:"p-2 border",children:"Balance"}),e.jsx("th",{className:"p-2 border",children:"Status"})]})}),e.jsxs("tbody",{children:[n.map(a=>{var t,s,r;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-2 border",children:((s=(t=a.Loan)==null?void 0:t.Borrower)==null?void 0:s.name)||"N/A"}),e.jsxs("td",{className:"px-2 border",children:["TZS ",Number((r=a.Loan)==null?void 0:r.amount).toLocaleString()]}),e.jsx("td",{className:"px-2 border",children:a.installmentNumber}),e.jsx("td",{className:"px-2 border",children:a.dueDate?m(new Date(a.dueDate),"yyyy-MM-dd"):"-"}),e.jsxs("td",{className:"px-2 border",children:["TZS ",Number(a.total).toLocaleString()]}),e.jsxs("td",{className:"px-2 border",children:["TZS ",Number(a.balance).toLocaleString()]}),e.jsx("td",{className:"px-2 border capitalize",children:a.status})]},a.id)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center p-4",children:"No repayments found."})})]})]})})]})};export{E as default};
