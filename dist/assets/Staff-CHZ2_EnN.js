import{r as u,j as e,c as y}from"./index-Dk5Cvq3D.js";const k=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function U(){const[l,N]=u.useState([]),[b,w]=u.useState([]),[g,x]=u.useState([]),[t,o]=u.useState(""),[n,c]=u.useState(!1),[s,i]=u.useState(""),[a,h]=u.useState(!1),f=async()=>{var r,m;c(!0),i("");try{const[d,p,j]=await Promise.all([y.get("/users"),y.get("/branches"),y.get("/roles")]);N(d.data||[]),w(p.data||[]),x(j.data||[])}catch(d){i(((m=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:m.error)||d.message||"Failed to load staff")}finally{c(!1)}};u.useEffect(()=>{f()},[]);const I=async r=>{var m,d;h(!0),i("");try{await y.post("/users",r),await f()}catch(p){i(((d=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:d.error)||p.message||"Failed to create staff")}finally{h(!1)}},C=async(r,m)=>{var d,p;h(!0),i("");try{await y.put(`/users/${r}`,m),await f()}catch(j){i(((p=(d=j==null?void 0:j.response)==null?void 0:d.data)==null?void 0:p.error)||j.message||"Failed to update staff")}finally{h(!1)}},S=async r=>{var m,d;if(confirm("Delete this staff?")){h(!0),i("");try{await y.delete(`/users/${r}`),await f()}catch(p){i(((d=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:d.error)||p.message||"Failed to delete staff")}finally{h(!1)}}},v=u.useMemo(()=>{const r=t.toLowerCase().trim();return r?l.filter(m=>[m.name,m.email,m.phone].some(d=>(d||"").toLowerCase().includes(r))):l},[t,l]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Staff"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Add staff, set branch access, roles, 2FA, and credentials."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:t,onChange:r=>o(r.target.value),placeholder:"Search staff…",className:"rounded border px-3 py-2 text-sm"}),e.jsx(A,{branches:b,roles:g,onCreate:I,busy:a})]})]}),s&&e.jsx("div",{className:"text-sm text-rose-600",children:s}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:n?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):v.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No staff found."}):e.jsx("div",{className:"space-y-2",children:v.map(r=>e.jsx(F,{user:r,roles:g,branches:b,onSave:C,onDelete:S,busy:a},r.id||k()))})})]})}function F({user:l,roles:N,branches:b,onSave:w,onDelete:g,busy:x}){const[t,o]=u.useState(!1),[n,c]=u.useState({name:l.name||"",email:l.email||"",phone:l.phone||"",roleId:l.roleId||null,branchIds:l.branchIds||[],twoFA:!!l.twoFA,username:l.username||"",password:""});u.useEffect(()=>{c({name:l.name||"",email:l.email||"",phone:l.phone||"",roleId:l.roleId||null,branchIds:l.branchIds||[],twoFA:!!l.twoFA,username:l.username||"",password:""})},[l]);const s=a=>{c(h=>({...h,branchIds:h.branchIds.includes(a)?h.branchIds.filter(f=>f!==a):[...h.branchIds,a]}))},i=async()=>{const a={...n};a.password||delete a.password,await w(l.id,a),o(!1)};return e.jsxs("div",{className:"p-3 border rounded-lg grid grid-cols-1 md:grid-cols-7 gap-2",children:[e.jsx("input",{disabled:!t,className:"rounded border px-3 py-2 text-sm",placeholder:"Full name",value:n.name,onChange:a=>c({...n,name:a.target.value})}),e.jsx("input",{disabled:!t,className:"rounded border px-3 py-2 text-sm",placeholder:"Email",value:n.email,onChange:a=>c({...n,email:a.target.value})}),e.jsx("input",{disabled:!t,className:"rounded border px-3 py-2 text-sm",placeholder:"Phone",value:n.phone,onChange:a=>c({...n,phone:a.target.value})}),e.jsxs("select",{disabled:!t,className:"rounded border px-3 py-2 text-sm",value:n.roleId||"",onChange:a=>c({...n,roleId:a.target.value?Number(a.target.value):null}),children:[e.jsx("option",{value:"",children:"Select role…"}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:"Branches"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(a=>e.jsxs("label",{className:`px-2 py-1 rounded border ${n.branchIds.includes(a.id)?"bg-blue-50 border-blue-300":"bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",disabled:!t,className:"mr-1",checked:n.branchIds.includes(a.id),onChange:()=>s(a.id)}),a.name]},a.id))})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",disabled:!t,checked:!!n.twoFA,onChange:a=>c({...n,twoFA:a.target.checked})}),"Two-Factor"]}),e.jsx("div",{className:"flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",disabled:!t,className:"rounded border px-3 py-2 text-sm",placeholder:"Username",value:n.username,onChange:a=>c({...n,username:a.target.value})}),e.jsx("input",{type:"password",disabled:!t,className:"rounded border px-3 py-2 text-sm",placeholder:"New password (optional)",value:n.password,onChange:a=>c({...n,password:a.target.value})}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",onClick:i,disabled:x,children:"Save"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:()=>{c({...n,password:""}),o(!1)},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:()=>o(!0),children:"Edit"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-rose-50 text-rose-700",onClick:()=>g(l.id),disabled:x,children:"Delete"})]})})]})}function A({branches:l,roles:N,onCreate:b,busy:w}){const[g,x]=u.useState(!1),[t,o]=u.useState({name:"",email:"",phone:"",roleId:"",branchIds:[],twoFA:!1,username:"",password:""}),n=s=>{o(i=>({...i,branchIds:i.branchIds.includes(s)?i.branchIds.filter(a=>a!==s):[...i.branchIds,s]}))},c=async()=>{const s={...t,roleId:t.roleId?Number(t.roleId):null};await b(s),x(!1),o({name:"",email:"",phone:"",roleId:"",branchIds:[],twoFA:!1,username:"",password:""})};return g?e.jsxs("div",{className:"border rounded-xl p-3 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Full name",value:t.name,onChange:s=>o({...t,name:s.target.value})}),e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Email",value:t.email,onChange:s=>o({...t,email:s.target.value})}),e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Phone",value:t.phone,onChange:s=>o({...t,phone:s.target.value})}),e.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:t.roleId,onChange:s=>o({...t,roleId:s.target.value}),children:[e.jsx("option",{value:"",children:"Select role…"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Username",value:t.username,onChange:s=>o({...t,username:s.target.value})}),e.jsx("input",{type:"password",className:"rounded border px-3 py-2 text-sm",placeholder:"Password",value:t.password,onChange:s=>o({...t,password:s.target.value})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Branch access"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(s=>e.jsxs("label",{className:`px-2 py-1 rounded border ${t.branchIds.includes(s.id)?"bg-blue-50 border-blue-300":"bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:t.branchIds.includes(s.id),onChange:()=>n(s.id)}),s.name]},s.id))})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("label",{className:"text-sm flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.twoFA,onChange:s=>o({...t,twoFA:s.target.checked})}),"Two-Factor"]}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:()=>x(!1),children:"Close"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",onClick:c,disabled:w,children:"Create"})]})]})]}):e.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",onClick:()=>x(!0),children:"Add Staff"})}export{U as default};
