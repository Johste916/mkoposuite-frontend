import{u as D,r as i,j as t,L as F,c as l}from"./index-fTOlqp5w.js";function k(){const b=D(),[j,g]=i.useState([]),[f,v]=i.useState([]),[y,N]=i.useState([]),[d,w]=i.useState([]),[M,m]=i.useState(!1),[p,S]=i.useState(""),[r,o]=i.useState({productId:"",amount:"",interestRate:"",termMonths:"",interestMethod:"flat",borrowerId:"",branchId:"",startDate:"",endDate:""}),u=async()=>{m(!0);try{const e=await l.get("/loans");g((e.data||[]).filter(s=>s.status==="pending"))}catch{alert("Failed to load applications")}finally{m(!1)}},I=async()=>{try{const e=await l.get("/borrowers");v(e.data||[])}catch{}},A=async()=>{try{const e=await l.get("/branches");N(e.data||[])}catch{}},C=async()=>{try{const e=await l.get("/loan-products");w(Array.isArray(e.data)?e.data:e.data.items||[])}catch{}};i.useEffect(()=>{u(),I(),A(),C()},[]);const a=i.useMemo(()=>d.find(e=>String(e.id)===String(r.productId)),[d,r.productId]),R=()=>{if(!r.borrowerId)return alert("Select a borrower"),!1;const e=Number(r.amount||0),s=Number(r.termMonths||0);if(e<=0)return alert("Enter amount"),!1;if(s<=0)return alert("Enter term months"),!1;if(a){if(a.minPrincipal&&e<Number(a.minPrincipal))return alert(`Amount must be at least ${a.minPrincipal}`),!1;if(a.maxPrincipal&&e>Number(a.maxPrincipal))return alert(`Amount must not exceed ${a.maxPrincipal}`),!1;if(a.minTermMonths&&s<Number(a.minTermMonths))return alert(`Term must be at least ${a.minTermMonths} months`),!1;if(a.maxTermMonths&&s>Number(a.maxTermMonths))return alert(`Term must not exceed ${a.maxTermMonths} months`),!1}else if(!r.interestRate)return alert("Enter interest rate or select a product"),!1;return!0},B=async e=>{if(e.preventDefault(),!!R())try{await l.post("/loans",r),h(),u(),alert("Application submitted.")}catch{alert("Failed to submit application")}},T=async e=>{try{await l.patch(`/loans/${e}/approve`),u()}catch{alert("Failed to approve")}},L=async e=>{try{await l.patch(`/loans/${e}/reject`),u()}catch{alert("Failed to reject")}},h=()=>{o({productId:"",amount:"",interestRate:"",termMonths:"",interestMethod:"flat",borrowerId:"",branchId:"",startDate:"",endDate:""})},x=j.filter(e=>{var s;return(((s=e.Borrower)==null?void 0:s.name)||"").toLowerCase().includes(p.toLowerCase())});return t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Loan Applications"}),t.jsx(F,{className:"text-blue-600 underline text-sm",to:"/loans",children:"Back to Loans"})]}),t.jsxs("form",{onSubmit:B,className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded shadow",children:[t.jsxs("select",{value:r.productId,onChange:e=>{const s=e.target.value,n=d.find(c=>String(c.id)===String(s));o(c=>({...c,productId:s,interestMethod:c.interestMethod||(n==null?void 0:n.interestMethod)||"flat",interestRate:c.interestRate||(n==null?void 0:n.interestRate)||(n==null?void 0:n.defaultInterestRate)||""}))},className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"",children:"Select Product (optional)"}),d.map(e=>t.jsxs("option",{value:e.id,children:[e.name," ",e.code?`(${e.code})`:""]},e.id))]}),t.jsx("input",{type:"number",placeholder:"Amount",value:r.amount,min:(a==null?void 0:a.minPrincipal)??0,max:(a==null?void 0:a.maxPrincipal)??void 0,onChange:e=>o({...r,amount:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsx("input",{type:"number",placeholder:"Term (Months)",value:r.termMonths,min:(a==null?void 0:a.minTermMonths)??1,max:(a==null?void 0:a.maxTermMonths)??void 0,onChange:e=>o({...r,termMonths:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),!r.productId&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",placeholder:"Interest Rate (%)",value:r.interestRate,onChange:e=>o({...r,interestRate:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsxs("select",{value:r.interestMethod,onChange:e=>o({...r,interestMethod:e.target.value}),className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"flat",children:"Flat"}),t.jsx("option",{value:"reducing",children:"Reducing Balance"})]})]}),t.jsxs("select",{value:r.borrowerId,onChange:e=>o({...r,borrowerId:e.target.value}),required:!0,className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"",children:"Select Borrower"}),f.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{value:r.branchId,onChange:e=>o({...r,branchId:e.target.value}),className:"border px-4 py-2 rounded",children:[t.jsx("option",{value:"",children:"Select Branch"}),y.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx("input",{type:"date",value:r.startDate,onChange:e=>o({...r,startDate:e.target.value}),required:!0,className:"border px-4 py-2 rounded"}),t.jsx("input",{type:"date",value:r.endDate,onChange:e=>o({...r,endDate:e.target.value}),className:"border px-4 py-2 rounded"}),t.jsxs("div",{className:"col-span-full flex gap-2",children:[t.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",children:"Submit Application"}),t.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 rounded border",children:"Reset"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-semibold",children:"Pending Applications"}),t.jsx("input",{value:p,onChange:e=>S(e.target.value),placeholder:"Search borrower...",className:"border px-3 py-2 rounded"})]}),t.jsx("div",{className:"overflow-x-auto",children:M?t.jsx("p",{children:"Loading applications..."}):x.length===0?t.jsx("p",{children:"No pending applications."}):t.jsxs("table",{className:"min-w-full bg-white rounded shadow border text-sm",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"border px-2 py-1",children:"Borrower"}),t.jsx("th",{className:"border px-2 py-1",children:"Amount"}),t.jsx("th",{className:"border px-2 py-1",children:"Rate"}),t.jsx("th",{className:"border px-2 py-1",children:"Term"}),t.jsx("th",{className:"border px-2 py-1",children:"Branch"}),t.jsx("th",{className:"border px-2 py-1",children:"Actions"})]})}),t.jsx("tbody",{children:x.map(e=>{var s,n;return t.jsxs("tr",{children:[t.jsx("td",{className:"border px-2",children:((s=e.Borrower)==null?void 0:s.name)||"N/A"}),t.jsx("td",{className:"border px-2",children:e.amount}),t.jsx("td",{className:"border px-2",children:e.interestRate}),t.jsx("td",{className:"border px-2",children:e.termMonths}),t.jsx("td",{className:"border px-2",children:((n=e.branch)==null?void 0:n.name)||"â€”"}),t.jsxs("td",{className:"border px-2 space-x-2",children:[t.jsx("button",{onClick:()=>b(`/loans/${e.id}`),className:"text-indigo-600 hover:underline",children:"View"}),t.jsx("button",{onClick:()=>T(e.id),className:"text-green-600 hover:underline",children:"Approve"}),t.jsx("button",{onClick:()=>L(e.id),className:"text-red-600 hover:underline",children:"Reject"})]})]},e.id)})})]})})]})}export{k as default};
