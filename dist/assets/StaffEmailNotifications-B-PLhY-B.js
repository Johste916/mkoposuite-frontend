import{r,j as t,c as b}from"./index-Dk5Cvq3D.js";import{u as S}from"./useSettingsResource-Cr50XNdV.js";import{S as d}from"./settings-C_Lp1tdW.js";const k=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function E(){const[p,h]=r.useState([]),[c,f]=r.useState(""),{data:o,setData:i,loading:g,saving:m,error:u,success:x,save:y}=S(d.get,e=>d.put("staff-email-notifications",e),{rules:[]}),v=async()=>{var e,s;try{const a=await b.get("/users");h(a.data||[])}catch(a){f(((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.error)||a.message||"Failed to load staff")}};r.useEffect(()=>{d.get("staff-email-notifications").then(e=>{e&&e.rules&&i(e)}).catch(()=>{}),v()},[]);const j=()=>i(e=>({...e,rules:[...e.rules||[],{id:k(),name:"Daily Report",frequency:"daily",recipients:[],active:!0}]})),l=(e,s)=>i(a=>({...a,rules:a.rules.map(n=>n.id===e?{...n,...s}:n)})),N=e=>i(s=>({...s,rules:s.rules.filter(a=>a.id!==e)}));return g?t.jsx("div",{className:"p-4 text-sm text-slate-500",children:"Loading…"}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Staff Email Notifications"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Who receives daily/weekly/monthly reports."})]}),(c||u)&&t.jsx("div",{className:"text-sm text-rose-600",children:c||u}),x&&t.jsx("div",{className:"text-sm text-emerald-600",children:x}),t.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[t.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:j,children:"Add Notification"}),(o.rules||[]).length===0?t.jsx("div",{className:"text-sm text-slate-500",children:"No notification rules yet."}):t.jsx("div",{className:"space-y-3",children:o.rules.map(e=>t.jsxs("div",{className:"p-3 border rounded-lg grid grid-cols-1 md:grid-cols-5 gap-2",children:[t.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Rule name",value:e.name||"",onChange:s=>l(e.id,{name:s.target.value})}),t.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:e.frequency||"daily",onChange:s=>l(e.id,{frequency:s.target.value}),children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"})]}),t.jsx("select",{multiple:!0,className:"rounded border px-3 py-2 text-sm",value:e.recipients||[],onChange:s=>l(e.id,{recipients:[...s.target.selectedOptions].map(a=>a.value)}),children:p.map(s=>t.jsxs("option",{value:String(s.id),children:[s.name," (",s.email||s.phone||s.username,")"]},s.id))}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:!!e.active,onChange:s=>l(e.id,{active:s.target.checked})}),"Active"]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:"px-3 py-1.5 rounded bg-rose-50 text-rose-700",onClick:()=>N(e.id),children:"Delete"})})]},e.id))})]}),t.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm",disabled:m,onClick:()=>y(),children:m?"Saving…":"Save"})]})}export{E as default};
