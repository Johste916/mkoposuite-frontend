import{r as m,j as e}from"./index-YOBwJX5V.js";import{A as h}from"./admin-D4okHQef.js";function A({title:c,category:o,channel:x="email"}){const[p,t]=m.useState([]),[n,r]=m.useState(!0),[f,u]=m.useState(!1),[b,i]=m.useState("");async function g(){var l,d;r(!0),i("");try{const s=await h.listTemplates(x,{category:o});t(Array.isArray(s)?s:[])}catch(s){i(((d=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:d.error)||s.message)}finally{r(!1)}}m.useEffect(()=>{g()},[o,x]);async function N(){var l,d;u(!0),i("");try{const s=await h.createTemplate({channel:x,category:o,name:"",code:"",subject:"",body:"",active:!0});t(a=>[s,...a])}catch(s){i(((d=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:d.error)||s.message)}finally{u(!1)}}async function y(l){var d,s;u(!0),i("");try{const a={...l,channel:x,category:o},j=l.id?await h.updateTemplate(l.id,a):await h.createTemplate(a);t(C=>C.map(v=>v.id===j.id?j:v))}catch(a){i(((s=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:s.error)||a.message)}finally{u(!1)}}async function w(l){var d,s;if(window.confirm("Delete this template?")){u(!0),i("");try{await h.deleteTemplate(l),t(a=>a.filter(j=>j.id!==l))}catch(a){i(((s=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:s.error)||a.message)}finally{u(!1)}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border dark:border-slate-800 rounded-2xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:c}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Channel: ",x," • Category: ",o]})]}),e.jsx("button",{onClick:N,disabled:f,className:"px-3 py-2 text-sm rounded bg-blue-600 text-white",children:"+ Add Template"})]}),b&&e.jsx("div",{className:"text-sm text-rose-600",children:b}),n?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):p.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No templates found."}):e.jsx("div",{className:"grid gap-3",children:p.map(l=>e.jsx(k,{row:l,onSave:y,onDelete:w,saving:f},l.id||Math.random()))})]})}function k({row:c,onSave:o,onDelete:x,saving:p}){const[t,n]=m.useState(c);return m.useEffect(()=>n(c),[c]),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Name"}),e.jsx("input",{className:"w-full px-2 py-1 rounded border",value:t.name??"",onChange:r=>n({...t,name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Code"}),e.jsx("input",{className:"w-full px-2 py-1 rounded border",value:t.code??"",onChange:r=>n({...t,code:r.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Subject (email only)"}),e.jsx("input",{className:"w-full px-2 py-1 rounded border",value:t.subject??"",onChange:r=>n({...t,subject:r.target.value})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Body"}),e.jsx("textarea",{rows:6,className:"w-full px-2 py-1 rounded border font-mono",value:t.body??"",onChange:r=>n({...t,body:r.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t.active,onChange:r=>n({...t,active:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"mt-3 text-right",children:[e.jsx("button",{onClick:()=>o(t),disabled:p,className:"px-2 py-1 text-xs rounded bg-emerald-600 text-white mr-2",children:"Save"}),c.id&&e.jsx("button",{onClick:()=>x(c.id),disabled:p,className:"px-2 py-1 text-xs rounded bg-rose-600 text-white",children:"Delete"})]})]})}export{A as T};
