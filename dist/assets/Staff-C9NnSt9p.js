import{r as n,j as s,F as I}from"./index-BRummDuu.js";import{A as m}from"./acl-BueQXFft.js";import{S}from"./settings-G2Wirp4v.js";import"./index-Bh-79F3G.js";function R(){const[o,h]=n.useState([]),[j,g]=n.useState([]),[N,b]=n.useState([]),[i,f]=n.useState(""),[y,p]=n.useState(!0),[x,d]=n.useState(""),[t,l]=n.useState({name:"",email:"",phone:"",username:"",password:"",roleId:"",branchIds:[],twoFactor:!1}),u=n.useMemo(()=>{const e=i.trim().toLowerCase();return e?o.filter(a=>[a.name,a.email,a.username].some(r=>String(r||"").toLowerCase().includes(e))):o},[o,i]);n.useEffect(()=>{(async()=>{var e,a;try{p(!0),d("");const[r,c]=await Promise.all([m.listRoles().catch(()=>[]),S.listBranches().catch(()=>[])]);g(r||[]),b(Array.isArray(c)?c:c.items||[]);const C=await m.listUsers();h(C||[])}catch(r){d(((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.error)||"Failed to load staff")}finally{p(!1)}})()},[]);const w=async()=>{var e,a;try{d("");const r={name:t.name,email:t.email,phone:t.phone,username:t.username,password:t.password,roleId:t.roleId||null,branchIds:t.branchIds,twoFactor:!!t.twoFactor},c=await m.createUser(r);h([c,...o]),l({...t,name:"",email:"",phone:"",username:"",password:""})}catch(r){d(((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.error)||"Failed to create user")}},v=e=>{l(a=>{const r=a.branchIds.includes(e);return{...a,branchIds:r?a.branchIds.filter(c=>c!==e):[...a.branchIds,e]}})};return y?s.jsx("div",{className:"p-4 text-sm text-slate-500",children:"Loading…"}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Staff"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Add staff, set branch access, roles, 2FA, and credentials."})]}),x&&s.jsx("div",{className:"text-sm text-rose-600",children:x}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 grid grid-cols-1 md:grid-cols-6 gap-2",children:[s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Full name",value:t.name,onChange:e=>l(a=>({...a,name:e.target.value}))}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Email",value:t.email,onChange:e=>l(a=>({...a,email:e.target.value}))}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Phone",value:t.phone,onChange:e=>l(a=>({...a,phone:e.target.value}))}),s.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:t.roleId,onChange:e=>l(a=>({...a,roleId:e.target.value})),children:[s.jsx("option",{value:"",children:"Select role…"}),j.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Username",value:t.username,onChange:e=>l(a=>({...a,username:e.target.value}))}),s.jsx("input",{type:"password",className:"rounded border px-3 py-2 text-sm",placeholder:"Password",value:t.password,onChange:e=>l(a=>({...a,password:e.target.value}))}),s.jsxs("div",{className:"md:col-span-6",children:[s.jsx("div",{className:"text-xs mb-2",children:"Branch access"}),s.jsx("div",{className:"flex flex-wrap gap-3",children:N.map(e=>s.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:t.branchIds.includes(e.id),onChange:()=>v(e.id)}),e.name]},e.id))})]}),s.jsxs("label",{className:"inline-flex items-center gap-2 text-sm md:col-span-3",children:[s.jsx("input",{type:"checkbox",checked:!!t.twoFactor,onChange:e=>l(a=>({...a,twoFactor:e.target.checked}))}),"Two-Factor"]}),s.jsxs("div",{className:"md:col-span-3 flex justify-end gap-2",children:[s.jsx("button",{className:"px-3 py-2 rounded border",onClick:()=>l({name:"",email:"",phone:"",username:"",password:"",roleId:"",branchIds:[],twoFactor:!1}),children:"Close"}),s.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",onClick:w,children:"Create"})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[s.jsxs("div",{className:"relative mb-3",children:[s.jsx(I,{className:"absolute left-3 top-3 text-slate-400"}),s.jsx("input",{value:i,onChange:e=>f(e.target.value),placeholder:"Search staff…",className:"w-full pl-9 pr-3 py-2 text-sm rounded border"})]}),u.length===0?s.jsx("div",{className:"text-sm text-slate-500",children:"No staff found."}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"text-left text-slate-500",children:s.jsxs("tr",{children:[s.jsx("th",{className:"py-2 pr-4",children:"Name"}),s.jsx("th",{className:"py-2 pr-4",children:"Email"}),s.jsx("th",{className:"py-2 pr-4",children:"Role(s)"}),s.jsx("th",{className:"py-2 pr-4",children:"Branch"}),s.jsx("th",{className:"py-2 pr-4",children:"Created"})]})}),s.jsx("tbody",{children:u.map(e=>{var a;return s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"py-2 pr-4",children:e.name}),s.jsx("td",{className:"py-2 pr-4",children:e.email}),s.jsx("td",{className:"py-2 pr-4",children:Array.isArray(e.Roles)&&e.Roles.length?e.Roles.map(r=>r.name).join(", "):e.role||"—"}),s.jsx("td",{className:"py-2 pr-4",children:((a=e.Branch)==null?void 0:a.name)??"—"}),s.jsx("td",{className:"py-2 pr-4",children:new Date(e.createdAt).toLocaleDateString()})]},e.id)})})]})})]})]})}export{R as default};
