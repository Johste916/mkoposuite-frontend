import{r as l,j as e,h as x}from"./index-L976ZryY.js";const t={page:"w-full px-4 md:px-6 lg:px-10 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",card:"rounded-2xl border-2 border-slate-300 bg-white shadow",th:"bg-slate-100 text-left text-[12px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-2 border-slate-200",td:"px-3 py-2 border-2 border-slate-200 text-sm",field:"h-11 w-full rounded-lg border-2 border-slate-300 bg-white text-sm px-3 outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600",textarea:"w-full rounded-lg border-2 border-slate-300 bg-white text-sm px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600",btn:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50 font-semibold",btnPrimary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-3 py-2 font-semibold hover:bg-indigo-700 disabled:opacity-60",btnDanger:"inline-flex items-center rounded-lg bg-rose-600 text-white px-3 py-2 font-semibold hover:bg-rose-700 disabled:opacity-60",badge:"inline-flex items-center rounded-full bg-slate-100 text-slate-700 px-2 py-[2px] text-xs border border-slate-300",muted:"text-slate-500"};function Q({message:h}){return h?e.jsx("div",{className:"rounded-lg border-2 border-rose-300 bg-rose-50 text-rose-800 text-sm px-3 py-2",children:h}):null}const V=()=>{const[h,F]=l.useState([]),[I,C]=l.useState(!1),[M,j]=l.useState(""),[P,f]=l.useState(!1),[p,$]=l.useState(null),[D,N]=l.useState(""),[k,y]=l.useState(""),[O,w]=l.useState(!1),[R,v]=l.useState(null),[u,b]=l.useState([]),[z,L]=l.useState(""),[S,d]=l.useState(!1),g=async()=>{var s,a;j("");try{C(!0);const r=await x.get("/roles"),o=Array.isArray(r.data)?r.data:[];F(o)}catch(r){console.error("Error fetching roles:",r),j(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to load roles")}finally{C(!1)}};l.useEffect(()=>{g()},[]);const B=()=>{$(null),N(""),y(""),f(!0)},U=s=>{$(s.id),N(s.name||""),y(s.description||""),f(!0)},W=async()=>{var r,o;const s=D.trim(),a=k.trim();if(!s)return alert("Please enter a role name");try{d(!0),p?await x.put(`/roles/${p}`,{name:s,description:a}):await x.post("/roles",{name:s,description:a}),f(!1),await g()}catch(i){console.error("Save role error:",i),alert(((o=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:o.error)||"Error saving role")}finally{d(!1)}},q=async s=>{var a,r,o,i,E,A;if(j(""),!!window.confirm("Delete this role?"))try{d(!0),await x.delete(`/roles/${s}`),await g()}catch(n){if(((a=n==null?void 0:n.response)==null?void 0:a.status)===409){const J=((o=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:o.error)||"Role is attached to users";L(J);try{const m=await x.get(`/roles/${s}/assignments`,{params:{activeOnly:1}}),K=Array.isArray((i=m==null?void 0:m.data)==null?void 0:i.items)?m.data.items:[];b(K)}catch(m){console.warn("Failed to load assignments:",m),b([])}v(s),w(!0)}else console.error("Delete role error:",n),alert(((A=(E=n==null?void 0:n.response)==null?void 0:E.data)==null?void 0:A.error)||"Error deleting role")}finally{d(!1)}},G=async()=>{var s,a;if(R)try{d(!0),await x.delete(`/roles/${R}`,{params:{force:1}}),w(!1),v(null),b([]),await g()}catch(r){console.error("Force delete failed:",r),alert(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.error)||"Force delete failed")}finally{d(!1)}},c=(u==null?void 0:u.length)||0,H=l.useMemo(()=>{if(!c)return"No active users are currently assigned.";const s=u.slice(0,6);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:c})," active user",c>1?"s are":" is"," assigned to this role:"]}),e.jsx("ul",{className:"pl-4 list-disc space-y-1",children:s.map(a=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:a.name||a.email||a.id})," ",e.jsxs("span",{className:t.muted,children:[a.email?`· ${a.email}`:""," ",a.role?`· role: ${a.role}`:""," ",a.branchId?`· branch: ${a.branchId}`:""]})]},a.id))}),c>s.length&&e.jsxs("div",{className:t.muted,children:["…and ",c-s.length," more."]})]})},[u,c]);return e.jsxs("div",{className:t.page,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:t.h1,children:"Roles"}),e.jsx("button",{onClick:B,className:t.btnPrimary,children:"+ Add Role"})]}),e.jsx(Q,{message:M}),e.jsx("div",{className:`${t.card} overflow-x-auto mt-3`,children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:t.th,children:"Role Name"}),e.jsx("th",{className:t.th,children:"Description"}),e.jsx("th",{className:`${t.th} text-right`,children:"Actions"})]})}),e.jsx("tbody",{children:I?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:`${t.td} text-center py-8 ${t.muted}`,children:"Loading…"})}):h.length?h.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsxs("td",{className:t.td,children:[e.jsx("span",{className:"font-medium",children:s.name})," ",s.isSystem?e.jsx("span",{className:t.badge,children:"system"}):null]}),e.jsx("td",{className:`${t.td} ${t.muted}`,children:s.description||"—"}),e.jsx("td",{className:`${t.td} text-right`,children:e.jsxs("div",{className:"inline-flex gap-2",children:[e.jsx("button",{onClick:()=>U(s),className:t.btn,children:"Edit"}),e.jsx("button",{onClick:()=>q(s.id),className:t.btnDanger,disabled:S,children:"Delete"})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:`${t.td} text-center py-8 ${t.muted}`,children:"No roles found"})})})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex justify-center items-center z-50",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border-2 border-slate-300 bg-white p-5 shadow space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold tracking-tight",children:p?"Edit Role":"New Role"}),e.jsx("label",{className:"text-xs font-semibold text-slate-600",children:"Role name"}),e.jsx("input",{value:D,onChange:s=>N(s.target.value),className:t.field,placeholder:"Role name (e.g., Admin, Accountant)"}),e.jsx("label",{className:"text-xs font-semibold text-slate-600",children:"Description (optional)"}),e.jsx("textarea",{value:k,onChange:s=>y(s.target.value),rows:3,className:t.textarea,placeholder:"What permissions or purpose does this role have?"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[e.jsx("button",{onClick:()=>f(!1),className:t.btn,children:"Cancel"}),e.jsx("button",{onClick:W,className:t.btnPrimary,disabled:S,children:p?"Update":"Save"})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex justify-center items-center z-50",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl border-2 border-slate-300 bg-white p-5 shadow space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold tracking-tight",children:"Can’t delete yet"}),e.jsx("div",{className:t.muted,children:z}),e.jsx("div",{children:H}),e.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[e.jsx("button",{onClick:()=>{w(!1),v(null),b([])},className:t.btn,children:"Close"}),e.jsx("button",{onClick:G,className:t.btnDanger,disabled:S,children:"Force delete"})]})]})})]})};export{V as default};
