const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CQ4uLf8X.js","assets/index-B-WhzGsb.js","assets/index-BQ1PHwRx.css"])))=>i.map(i=>d[i]);
import{_ as $,r as O,j as p}from"./index-B-WhzGsb.js";const r=(e,a="TZS")=>`‎${a} ${Number(e||0).toLocaleString()}`,z=e=>e?new Date(e).toLocaleDateString():"—",B=e=>e?new Date(e).toLocaleString():"",v=e=>{if(!e)return"";const a=new Date(e);return Number.isNaN(a.getTime())?String(e).slice(0,10):a.toISOString().slice(0,10)};function M(e){return e?Array.isArray(e)?e:Array.isArray(e.schedule)?e.schedule:Array.isArray(e.rows)?e.rows:Array.isArray(e.data)?e.data:null:null}function T(e=[],a=0){let t=Number(a||0),s=0,i=0,u=0,b=0;for(const d of e){const l=Number(d.fee??d.fees??0),o=Number(d.penalty??0),c=Number(d.interest??0),f=Number(d.principal??0);if(t<=0)break;const g=Math.min(t,l);if(b+=g,t-=g,t<=0)break;const P=Math.min(t,o);if(u+=P,t-=P,t<=0)break;const S=Math.min(t,c);if(i+=S,t-=S,t<=0)break;const m=Math.min(t,f);s+=m,t-=m}return{paidPrincipal:s,paidInterest:i,paidPenalty:u,paidFees:b}}const j=e=>{const a=Number((e==null?void 0:e.principal)||0),t=Number((e==null?void 0:e.interest)||0),s=Number((e==null?void 0:e.penalty)||0),i=Number((e==null?void 0:e.fee)??(e==null?void 0:e.fees)??0),u=(e==null?void 0:e.total)!=null?Number(e.total):a+t+s+i;if((e==null?void 0:e.balance)!=null&&!Number.isNaN(Number(e.balance)))return Number(e.balance);if((e==null?void 0:e.paidPrincipal)!=null||(e==null?void 0:e.paidInterest)!=null||(e==null?void 0:e.paidPenalty)!=null||(e==null?void 0:e.paidFees)!=null||(e==null?void 0:e.paidFee)!=null){const d=Number(e.paidPrincipal||0),l=Number(e.paidInterest||0),o=Number(e.paidPenalty||0),c=Number(e.paidFees||0)+Number(e.paidFee||0);return Math.max(u-(d+l+o+c),0)}return u},F=["#","Due Date","Principal","Interest","Total P&I","Penalty","Fees","Paid Principal","Paid Interest","Outstanding","Status"];function y(e=[]){const a=[];for(let s=0;s<e.length;s++){const i=e[s],u=Number(i.principal||0),b=Number(i.interest||0),d=Number(i.penalty||0),l=Number(i.fee??i.fees??0),o=i.paidPrincipal!=null?Number(i.paidPrincipal):null,c=i.paidInterest!=null?Number(i.paidInterest):null,f=j(i),g=f<=1e-6?"Settled":"Pending";a.push({idx:i.installment??i.period??s+1,dueDateISO:v(i.dueDate??i.date??""),principal:u,interest:b,penalty:d,fees:l,pi:u+b,paidP:o,paidI:c,outstanding:f,status:g})}return a}function E(e=[],a=[]){const t=Array.isArray(e)?e:[],s=I=>t.reduce((n,x)=>n+Number((x==null?void 0:x[I])||0),0),i=s("principal"),u=s("interest"),b=s("penalty"),d=s("fee")+s("fees"),l=s("total")||i+u+b+d,o=(Array.isArray(a)?a:[]).reduce((I,n)=>I+Number(n.amount||0),0),c=s("paidPrincipal")||0,f=s("paidInterest")||0,g=s("paidPenalty")||0,P=s("paidFees")+s("paidFee")||0,m=c+f+g+P>0?{paidPrincipal:c,paidInterest:f,paidPenalty:g,paidFees:P}:T(t,o),h=Math.max(l-o,0),N=t.find(I=>j(I)>0)||null,D=N?{idx:N.installment??N.period??t.indexOf(N)+1,date:N.dueDate||N.date||null,amount:Number(N.total??0)}:null;return{scheduledPrincipal:i,scheduledInterest:u,scheduledPenalty:b,scheduledFees:d,scheduledTotal:l,totalPaid:o,outstanding:h,outstandingTotal:h,nextDue:D,...m}}function R({loan:e,schedule:a=[],currency:t="TZS",method:s="",company:i={}}){var m;if(!a.length)return;const u=[["Company",i.name||""],["Address",i.address||""],["Phone",i.phone||""],["Email",i.email||""],["Website",i.website||""],[],["Loan ID",(e==null?void 0:e.id)??""],["Borrower",((m=e==null?void 0:e.Borrower)==null?void 0:m.name)||(e==null?void 0:e.borrowerName)||""],["Status",(e==null?void 0:e.status)||""],["Currency",t],["Interest Method",s||(e==null?void 0:e.interestMethod)||""],["Disbursed",v((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")],["Generated At",new Date().toLocaleString()],[]],b=F.slice(0,-1).concat("Settled"),d=y(a).map(h=>[h.idx,h.dueDateISO,h.principal,h.interest,h.pi,h.penalty,h.fees,h.paidP??"",h.paidI??"",h.outstanding,h.outstanding<=1e-6?"YES":"NO"]),l=E(a,[]),o=[[],["Totals","",l.scheduledPrincipal,l.scheduledInterest,l.scheduledPrincipal+l.scheduledInterest,l.scheduledPenalty,l.scheduledFees,l.paidPrincipal,l.paidInterest,l.outstanding,""],["Total Paid","","","","","","","","",l.totalPaid,""]],f=[...u,b,...d,...o].map(h=>h.map(N=>`"${String(N??"").replace(/"/g,'""')}"`).join(",")).join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(g),S=document.createElement("a");S.href=P,S.download=`loan_${(e==null?void 0:e.id)??"schedule"}.csv`,S.click(),URL.revokeObjectURL(P)}async function U({loan:e,schedule:a=[],currency:t="TZS",method:s="",company:i={}}){var D,I;if(!a.length)return;let u,b;try{u=(await $(async()=>{const{default:n}=await import("./jspdf.es.min-CQ4uLf8X.js").then(x=>x.j);return{default:n}},__vite__mapDeps([0,1,2]))).default,b=(await $(async()=>{const{default:n}=await import("./jspdf.plugin.autotable-CfO62xhj.js");return{default:n}},[])).default}catch{return L({loan:e,schedule:a,currency:t,method:s,company:i})}const d=new u({unit:"pt",format:"a4"}),l=d.internal.pageSize.getWidth(),o=40;let c=40;if(i.logoUrl)try{const n=await fetch(i.logoUrl).then(k=>k.blob()),x=new FileReader,_=new Promise(k=>{x.onload=()=>k(x.result)});x.readAsDataURL(n);const A=await _;d.addImage(A,"PNG",o,c,120,40)}catch{}d.setFontSize(14),d.text(i.name||"Company",o,c+65),d.setFontSize(10),[i.address,[i.phone,i.email].filter(Boolean).join("  •  "),i.website].filter(Boolean).forEach((n,x)=>d.text(String(n),o,c+80+x*14)),d.setFontSize(16),d.text("Loan Repayment Schedule",l-40,50,{align:"right"}),d.setFontSize(10),[`Loan ID: ${(e==null?void 0:e.id)??""}`,`Borrower: ${((D=e==null?void 0:e.Borrower)==null?void 0:D.name)||(e==null?void 0:e.borrowerName)||""}`,`Status: ${(e==null?void 0:e.status)||""}`,`Currency: ${t}`,`Interest Method: ${s||(e==null?void 0:e.interestMethod)||""}`,`Disbursed: ${v((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")}`,`Generated: ${new Date().toLocaleString()}`].forEach((n,x)=>d.text(n,l-40,68+x*14,{align:"right"}));const g=[{header:"#",dataKey:"idx"},{header:"Due Date",dataKey:"dueDate"},{header:"Principal",dataKey:"principal"},{header:"Interest",dataKey:"interest"},{header:"Total P&I",dataKey:"pi"},{header:"Penalty",dataKey:"penalty"},{header:"Fees",dataKey:"fees"},{header:"Paid Principal",dataKey:"paidP"},{header:"Paid Interest",dataKey:"paidI"},{header:"Outstanding",dataKey:"outstanding"},{header:"Settled",dataKey:"settled"}],P=1e-6,S=y(a).map(n=>({idx:n.idx,dueDate:n.dueDateISO,principal:r(n.principal,t),interest:r(n.interest,t),pi:r(n.pi,t),penalty:r(n.penalty,t),fees:r(n.fees,t),paidP:n.paidP==null?"—":r(n.paidP,t),paidI:n.paidI==null?"—":r(n.paidI,t),outstanding:r(n.outstanding,t),settled:n.outstanding<=P?"YES":"NO"}));b(d,{head:[g.map(n=>n.header)],body:S.map(n=>g.map(x=>n[x.dataKey])),startY:140,styles:{fontSize:9},headStyles:{fillColor:[243,244,246],textColor:20},alternateRowStyles:{fillColor:[250,250,250]},margin:{left:40,right:40},didDrawPage:()=>{const n=`Page ${d.internal.getNumberOfPages()}`;d.setFontSize(9),d.text(n,l-40,d.internal.pageSize.getHeight()-20,{align:"right"})}});const m=E(a,[]);let h=((I=d.lastAutoTable)==null?void 0:I.finalY)||140;h+=16,d.setFontSize(11),d.text("Summary",40,h),h+=8,d.setFontSize(10),[["Principal (Sched.)",r(m.scheduledPrincipal,t)],["Interest (Sched.)",r(m.scheduledInterest,t)],["Total P&I (Sched.)",r(m.scheduledPrincipal+m.scheduledInterest,t)],["Penalty (Sched.)",r(m.scheduledPenalty,t)],["Fees (Sched.)",r(m.scheduledFees,t)],["Total Payable",r(m.scheduledTotal,t)],["Paid Principal",r(m.paidPrincipal,t)],["Paid Interest",r(m.paidInterest,t)],["Total Paid",r(m.totalPaid,t)],["Outstanding",r(m.outstanding,t)]].forEach((n,x)=>{d.text(n[0],40,h+16+x*14),d.text(n[1],l-40,h+16+x*14,{align:"right"})}),d.save(`loan_${(e==null?void 0:e.id)??"schedule"}.pdf`)}function L({loan:e,schedule:a=[],currency:t,method:s,company:i}){var o;const u=y(a).map(c=>`
      <tr>
        <td>${c.idx}</td>
        <td>${c.dueDateISO}</td>
        <td>${r(c.principal,t)}</td>
        <td>${r(c.interest,t)}</td>
        <td>${r(c.pi,t)}</td>
        <td>${r(c.penalty,t)}</td>
        <td>${r(c.fees,t)}</td>
        <td>${c.paidP==null?"—":r(c.paidP,t)}</td>
        <td>${c.paidI==null?"—":r(c.paidI,t)}</td>
        <td>${r(c.outstanding,t)}</td>
        <td>${c.outstanding<=1e-6?"YES":"NO"}</td>
      </tr>`).join(""),b=i!=null&&i.logoUrl?`<img src="${i.logoUrl}" style="height:48px;object-fit:contain;margin-right:12px;" />`:"",d=`
    <html>
      <head>
        <meta charset="utf-8" />
        <title>Loan ${(e==null?void 0:e.id)??""} Schedule</title>
        <style>
          body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial; color:#111827; }
          .container { max-width: 1024px; margin: 24px auto; }
          .header { display:flex; align-items:center; justify-content:space-between; }
          .company { display:flex; align-items:center; }
          .company h1 { margin:0; font-size:18px; }
          .muted { color:#6B7280; font-size:12px; }
          table { width:100%; border-collapse: collapse; margin-top: 16px; }
          th, td { border: 1px solid #E5E7EB; padding: 6px 8px; font-size: 12px; }
          thead { background:#F3F4F6; }
          .summary { margin-top:16px; display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:8px; }
          .card { border:1px solid #E5E7EB; padding:8px 10px; border-radius:8px; }
          @media print { .no-print { display:none; } }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <div class="company">
              ${b}
              <div>
                <h1>${(i==null?void 0:i.name)||""}</h1>
                <div class="muted">
                  ${[i==null?void 0:i.address,i==null?void 0:i.phone,i==null?void 0:i.email,i==null?void 0:i.website].filter(Boolean).join(" • ")}
                </div>
              </div>
            </div>
            <div>
              <div style="font-weight:600;">Loan Repayment Schedule</div>
              <div class="muted">Generated: ${new Date().toLocaleString()}</div>
            </div>
          </div>

          <div style="margin-top:12px;font-size:12px;">
            <div><b>Loan ID:</b> ${(e==null?void 0:e.id)??""}</div>
            <div><b>Borrower:</b> ${((o=e==null?void 0:e.Borrower)==null?void 0:o.name)||(e==null?void 0:e.borrowerName)||""}</div>
            <div><b>Status:</b> ${(e==null?void 0:e.status)||""}</div>
            <div><b>Currency:</b> ${(e==null?void 0:e.currency)||t} &nbsp; • &nbsp; <b>Interest Method:</b> ${s||(e==null?void 0:e.interestMethod)||""}</div>
            <div><b>Disbursed:</b> ${v((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")}</div>
          </div>

          <table>
            <thead>
              <tr>${F.map(c=>`<th>${c}</th>`).join("")}<th>Settled</th></tr>
            </thead>
            <tbody>${u}</tbody>
          </table>

          <div class="no-print" style="margin-top:16px;">
            <button onclick="window.print()" style="padding:8px 12px;border:1px solid #E5E7EB;border-radius:8px;background:white;cursor:pointer;">Print / Save as PDF</button>
          </div>
        </div>
      </body>
    </html>
  `,l=window.open("","_blank","noopener,noreferrer,width=1024,height=768");l&&(l.document.open(),l.document.write(d),l.document.close())}const C=(e=[],a="TZS")=>(Array.isArray(e)?e:[]).map((t,s)=>{const i=Number(t.principal||0),u=Number(t.interest||0),b=Number(t.penalty||0),d=Number(t.fee??t.fees??0),l=i+u,o=j(t);return{idx:t.installment??t.period??s+1,dueDate:v(t.dueDate??t.date??""),principal:r(i,a),interest:r(u,a),pi:r(l,a),penalty:r(b,a),fees:r(d,a),paidP:t.paidPrincipal!=null?r(Number(t.paidPrincipal),a):"—",paidI:t.paidInterest!=null?r(Number(t.paidInterest),a):"—",outstanding:r(o,a),settled:o<=1e-6?"YES":"NO"}}),K=(e=[])=>(Array.isArray(e)?e:[]).map((a,t)=>{const s=Number(a.principal||0),i=Number(a.interest||0),u=Number(a.penalty||0),b=Number(a.fee??a.fees??0),d=s+i,l=j(a);return{idx:a.installment??a.period??t+1,dueDate:v(a.dueDate??a.date??""),principal:s,interest:i,pi:d,penalty:u,fees:b,paidP:a.paidPrincipal!=null?Number(a.paidPrincipal):"",paidI:a.paidInterest!=null?Number(a.paidInterest):"",outstanding:l,settled:l<=1e-6?"YES":"NO"}});function Y({schedule:e=[],currency:a="TZS"}){const t=O.useMemo(()=>y(e||[]),[e,a]);return t.length?p.jsx("div",{className:"overflow-x-auto bg-white dark:bg-slate-900",children:p.jsxs("table",{className:"min-w-full text-base",children:[p.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 sticky top-0 z-10",children:p.jsxs("tr",{className:"text-left dark:text-slate-200",children:[p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"#"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"Due Date"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Principal"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Interest"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Total P&I"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Penalty"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Fees"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Paid Principal"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Paid Interest"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700 text-right",children:"Outstanding"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 dark:border-slate-700",children:"Status"})]})}),p.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:t.map((s,i)=>p.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800 dark:text-slate-100",children:[p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.idx}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.dueDateISO}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.principal,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.interest,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.pi,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.penalty,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.fees,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:s.paidP==null?"—":r(s.paidP,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:s.paidI==null?"—":r(s.paidI,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:r(s.outstanding,a)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.status==="Settled"?p.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:ring-emerald-900",children:"Settled"}):p.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:ring-amber-900",children:"Pending"})})]},i))})]})}):p.jsx("div",{className:"text-sm text-gray-600 dark:text-slate-300",children:"No schedule available."})}export{Y as S,K as a,F as b,E as c,z as d,R as e,r as f,U as g,B as h,v as i,M as n,C as r};
