import{j as t,k as ze,u as He,m as Ve,l as qe,r as x,h as T,L as ye}from"./index-p3hQqlDS.js";import{F as Ze,S as Ge}from"./search-CZPJu5yh.js";import{C as Ye}from"./chevron-down-COxTznQ4.js";import"./createLucideIcon-DBicDY_H.js";const v=(s,o="TZS")=>s==null||s===""?"—":`‎${o} ${Number(s||0).toLocaleString()}`,we=s=>s==null||s===""?"—":Number(s).toLocaleString(),Ke=s=>s==null||s===""?"—":`${Number(s)}%`,ve=s=>{var d;if(!s)return"—";const o=typeof s=="string"||typeof s=="number"?new Date(s):s;return!isNaN((d=o==null?void 0:o.getTime)==null?void 0:d.call(o))?o.toLocaleDateString():"—"},$e=(s,o="TZS",u)=>{if(s==null||s==="")return"—";try{return new Intl.NumberFormat(u,{style:"currency",currency:o,maximumFractionDigits:0}).format(Number(s||0))}catch{return`‎${o} ${Number(s||0).toLocaleString()}`}},M=(s="")=>String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");function Qe(s,o){const{rows:u,headers:d,filename:p}=Array.isArray(s)?{rows:s,headers:U(s),filename:o||"export.csv"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||U((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.csv"},g=S=>String(S??"").replace(/"/g,'""'),m=d.join(","),b=u.map(S=>d.map(Z=>`"${g(S[Z])}"`).join(",")).join(`
`),y=`${m}
${b}`;Se(new Blob([y],{type:"text/csv;charset=utf-8"}),p)}function Je(s,o){const{rows:u,headers:d,filename:p,title:g}=Array.isArray(s)?{rows:s,headers:U(s),filename:o||"export.xls"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||U((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.xls",title:(s==null?void 0:s.title)||"Export"},m=`<h1>${M(g||"")}</h1><table border="1"><thead><tr>${d.map(y=>`<th>${M(y)}</th>`).join("")}</tr></thead><tbody>`+u.map(y=>`<tr>${d.map(S=>`<td>${M(String(y[S]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",b=new Blob([`\uFEFF${m}`],{type:"application/vnd.ms-excel"});Se(b,p)}function We(s){const{rows:o,headers:u,title:d}=Array.isArray(s)?{rows:s,headers:U(s),title:"Export"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||U((s==null?void 0:s.rows)||[]),title:(s==null?void 0:s.title)||"Export"},p=`
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; padding: 16px; }
      h1 { font-size: 16px; margin: 0 0 12px 0; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap; }
      thead { background: #f3f4f6; }
    </style>
  `,g=`<h1>${M(d)}</h1><table><thead><tr>${u.map(b=>`<th>${M(b)}</th>`).join("")}</tr></thead><tbody>`+o.map(b=>`<tr>${u.map(y=>`<td>${M(String(b[y]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",m=window.open("","_blank");m&&(m.document.write(`<html><head><title>${M(d)}</title>${p}</head><body>${g}</body></html>`),m.document.close(),m.focus(),m.print())}function Xe(s,o){return Qe(s,o)}function et(s,o){return Je(s,o)}function tt(s,o){return We(s)}function U(s=[]){return s[0]?Object.keys(s[0]):[]}function Se(s,o){const u=URL.createObjectURL(s),d=document.createElement("a");d.href=u,d.download=o||"export",document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(u)}function st({page:s=1,pageSize:o=25,total:u=0,onPageChange:d,onPageSizeChange:p}){const g=Math.max(1,Math.ceil(u/o));return t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-2 py-3",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",t.jsx("span",{className:"font-medium",children:s})," of"," ",t.jsx("span",{className:"font-medium",children:g})," •"," ",t.jsx("span",{className:"font-medium",children:u})," rows"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:o,onChange:m=>p==null?void 0:p(Number(m.target.value)),"aria-label":"Rows per page",children:[10,25,50,100].map(m=>t.jsxs("option",{value:m,children:[m," / page"]},m))}),t.jsxs("div",{className:"inline-flex rounded border overflow-hidden",children:[t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50",onClick:()=>d==null?void 0:d(Math.max(1,s-1)),disabled:s<=1,"aria-label":"Previous page",children:"‹ Prev"}),t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 border-l",onClick:()=>d==null?void 0:d(Math.min(g,s+1)),disabled:s>=g,"aria-label":"Next page",children:"Next ›"})]})]})]})}function nt({open:s,title:o="Are you sure?",description:u="",confirmText:d="Confirm",cancelText:p="Cancel",destructive:g=!1,onConfirm:m,onClose:b}){return s?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"mt-1 w-8 h-8 rounded-full flex items-center justify-center text-white "+(g?"bg-rose-600":"bg-indigo-600"),children:"!"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold",children:o}),u&&t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:u})]}),t.jsx("button",{className:"text-gray-500 hover:text-gray-700","aria-label":"Close",onClick:b,children:"✕"})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded border",onClick:b,children:p}),t.jsx("button",{className:"px-4 py-2 rounded text-white "+(g?"bg-rose-600 hover:bg-rose-700":"bg-indigo-600 hover:bg-indigo-700"),onClick:()=>{m==null||m(),b==null||b()},children:d})]})]})}):null}const at=["pending","approved","rejected","disbursed","active","closed"],rt=["pending","approved","rejected","disbursed","closed"],te={pending:"Pending Approval",approved:"Approved Loans",rejected:"Rejected Loans",disbursed:"Disbursed Loans",active:"Active Loans",closed:"Closed Loans",due:"Due Loans",missed:"Missed Repayments",arrears:"Loans in Arrears","no-repayments":"No Repayments","past-maturity":"Past Maturity Loans","principal-outstanding":"Principal Outstanding","1-month-late":"1 Month Late","3-months-late":"3 Months Late"},n={page:"w-full px-4 md:px-6 lg:px-10 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",sub:"text-sm text-slate-700",card:"rounded-2xl border-2 border-slate-300 bg-white shadow",th:"bg-slate-100 text-left text-[12px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-2 border-slate-200 select-none",td:"px-3 py-2 border-2 border-slate-200 text-sm align-top",btn:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50 font-semibold",btnGhost:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50",btnPrimary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-3 py-2 font-semibold hover:bg-indigo-700",fieldBase:"h-11 w-full rounded-lg border-2 border-slate-300 bg-white text-sm outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600 transition",fieldIcon:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"},q=({className:s="",leadingIcon:o=null,...u})=>t.jsxs("div",{className:`relative ${s}`,children:[o,t.jsx("input",{...u,className:`${n.fieldBase} ${o?"pl-10":""}`})]}),se=({className:s="",children:o,...u})=>t.jsxs("div",{className:`relative ${s}`,children:[t.jsx("select",{...u,className:`${n.fieldBase} pr-9 appearance-none bg-none ms-select`,style:{backgroundImage:"none"},children:o}),t.jsx(Ye,{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-600"})]});function ut(){var be,Ne,je,ge;const{status:s}=ze(),o=He(),{success:u,error:d}=Ve(),[p,g]=qe(),[m,b]=x.useState([]),[y,S]=x.useState(0),[Z,ne]=x.useState(!1),[Ae,ae]=x.useState([]),[G,re]=x.useState([]),[P,oe]=x.useState(p.get("q")||""),[A,ie]=x.useState(p.get("productId")||""),[L,le]=x.useState(p.get("officerId")||""),[C,ce]=x.useState(p.get("startDate")||""),[I,de]=x.useState(p.get("endDate")||""),[D,ue]=x.useState(p.get("minAmt")||""),[R,me]=x.useState(p.get("maxAmt")||""),Le=Number(p.get("page")||1),he=Number(p.get("pageSize")||25),[F,Y]=x.useState(Math.max(1,Le)),[O,Ce]=x.useState([10,25,50,100].includes(he)?he:25),[Ie,w]=x.useState(null),[E,B]=x.useState({open:!1,loan:null,officerId:""}),[_,Q]=x.useState({open:!1,title:"",description:"",destructive:!1,onConfirm:null}),De=te[s]||"Loans",K=["disbursed","active"].includes(String(s||"").toLowerCase());x.useEffect(()=>{(async()=>{var e,i;try{const r=await T.get("/loan-products"),a=Array.isArray(r.data)?r.data:((e=r.data)==null?void 0:e.items)||[];ae(a)}catch{ae([])}try{const r=await T.get("/users",{params:{role:"loan_officer",pageSize:500}}),a=Array.isArray(r.data)?r.data:((i=r.data)==null?void 0:i.items)||[];re(a)}catch{re([])}})()},[]);const J=async(e={})=>{var i,r;ne(!0);try{const a={page:F,pageSize:O};at.includes(String(s))?rt.includes(String(s))?a.status=String(s):a.scope=String(s):s&&(a.scope=s),P.trim()&&(a.q=P.trim()),A&&(a.productId=A),L&&(a.officerId=L),C&&(a.startDate=C),I&&(a.endDate=I),D&&(a.minAmount=D),R&&(a.maxAmount=R);const l=await T.get("/loans",{params:a}),h=Array.isArray(l.data)?l.data:Array.isArray((i=l.data)==null?void 0:i.items)?l.data.items:[];let f=((r=l.data)==null?void 0:r.total)??h.length,N=h;String(s).toLowerCase()==="active"&&(N=h.filter(j=>String(j.status||j.state||"").toLowerCase()==="disbursed"),f=N.length),b(N),S(f)}catch(a){console.error(a),b([]),S(0),d("Failed to load loans.")}finally{ne(!1)}if(!e.skipSyncUrl){const a=new URLSearchParams;P&&a.set("q",P),A&&a.set("productId",A),L&&a.set("officerId",L),C&&a.set("startDate",C),I&&a.set("endDate",I),D&&a.set("minAmt",D),R&&a.set("maxAmt",R),a.set("page",String(F)),a.set("pageSize",String(O)),g(a)}};x.useEffect(()=>{J({skipSyncUrl:!0}),w(null)},[s,F,O]);const k=x.useMemo(()=>{const e=C?new Date(C):null,i=I?new Date(I):null;return m.filter(r=>{if(e||i){const h=r.releaseDate||r.startDate||r.disbursementDate||r.createdAt||null,f=h?new Date(h):null;if(e&&(!f||f<e)||i&&(!f||f>i))return!1}if(A&&String(r.productId)!==String(A)||L&&String(r.officerId||r.loanOfficerId)!==String(L))return!1;const a=Number(r.amount??r.principal??0);if(D&&!(a>=Number(D))||R&&!(a<=Number(R)))return!1;const l=P.trim().toLowerCase();if(l){const h=r.Borrower||r.borrower||{},f=r.Product||r.product||{};if(![h.name,h.phone,r.borrowerName,r.borrowerPhone,f.name,r.productName,r.loanNumber,r.id].filter(Boolean).join(" ").toLowerCase().includes(l))return!1}return!0})},[m,P,A,L,C,I,D,R]),xe=x.useMemo(()=>{if(y>m.length)return k;const e=(F-1)*O;return k.slice(e,e+O)},[k,F,O,m.length,y]),z=x.useMemo(()=>{let e=0,i=0,r=0,a=0,l=0;return k.forEach(h=>{const f=Number(h.outstandingPrincipal||0),N=Number(h.outstandingInterest||0),j=Number(h.outstandingFees||0),c=Number(h.outstandingPenalty||0),$=h.outstanding!=null?Number(h.outstanding):f+N+j+c;e+=f,i+=N,r+=j,a+=c,l+=$}),{p:e,i,f:r,pen:a,t:l}},[k]),W=()=>k.map(e=>{const i=e.Borrower||e.borrower||{},r=e.Product||e.product||{},a=e.officer||{},l=e.currency||"TZS",h=e.releaseDate||e.startDate||e.disbursementDate||e.createdAt||null,f=e.outstandingPrincipal??null,N=e.outstandingInterest??null,j=e.outstandingFees??null,c=e.outstandingPenalty??null,$=e.outstanding!=null?e.outstanding:[f,N,j,c].every(V=>V==null)?null:Number(f||0)+Number(N||0)+Number(j||0)+Number(c||0),H=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,ee=e.termMonths??e.durationMonths??null;return{Date:ve(h),"Borrower Name":i.name||e.borrowerName||"","Phone Number":i.phone||e.borrowerPhone||"","Loan Product":r.name||e.productName||"","Principal Amount":`${l} ${Number(e.amount??e.principal??0)}`,"Interest Amount":`${l} ${Number(e.interestAmount??0)}`,"Outstanding Principal":`${l} ${Number(f??0)}`,"Outstanding Interest":`${l} ${Number(N??0)}`,"Outstanding Fees":`${l} ${Number(j??0)}`,"Outstanding Penalty":`${l} ${Number(c??0)}`,"Total Outstanding":`${l} ${Number($??0)}`,"Interest Rate/Year (%)":H??"","Loan Duration (Months)":ee??"","Loan Officer":e.officerName||a.name||"",Status:e.status||""}}),Re=()=>Xe(W(),(te[s]||"loans").toLowerCase().replace(/\s+/g,"-")),ke=()=>et(W(),(te[s]||"loans").toLowerCase().replace(/\s+/g,"-")),Pe=()=>tt(W()),Oe=e=>o(`/loans/${e}`),Ee=e=>o(`/loans/${e}?edit=1`),Me=e=>Q({open:!0,destructive:!1,title:"Re-disburse this loan?",description:"You will be taken to the disbursement screen to create a new disbursement tied to this loan.",onConfirm:()=>o(`/loans/${e}/disburse`)}),Fe=e=>o(`/repayments/new?loanId=${e}`),Te=e=>Q({open:!0,destructive:!1,title:"Reschedule repayments?",description:"Open the schedule tool to recompute the repayment plan for this loan.",onConfirm:()=>o(`/loans/schedule?loanId=${e}`)}),Ue=async e=>{try{const i=await T.get(`/loans/${e.id}/schedule`),r=Array.isArray(i.data)?i.data:[],a=[{label:"#",value:(c,$)=>$+1},{label:"Due Date",value:c=>c.dueDate?new Date(c.dueDate).toISOString().slice(0,10):""},{label:"Principal",value:c=>c.principal??0},{label:"Interest",value:c=>c.interest??0},{label:"Penalty",value:c=>c.penalty??0},{label:"Total",value:c=>c.total??Number(c.principal||0)+Number(c.interest||0)+Number(c.penalty||0)},{label:"Balance",value:c=>c.balance??""}],l=a.map(c=>`"${c.label.replace(/"/g,'""')}"`).join(","),h=r.map((c,$)=>a.map(H=>`"${String(H.value(c,$)??"").replace(/"/g,'""')}"`).join(",")).join(`
`),f=`${l}
${h}`,N=new Blob([f],{type:"text/csv;charset=utf-8"}),j=document.createElement("a");j.href=URL.createObjectURL(N),j.download=`loan_${e.id}_schedule.csv`,j.click(),u("Schedule downloaded.")}catch(i){console.error(i),d("Couldn't download schedule.")}},Be=e=>B({open:!0,loan:e,officerId:(e==null?void 0:e.loanOfficerId)||(e==null?void 0:e.officerId)||""}),_e=async()=>{const{loan:e,officerId:i}=E;if(!(!e||!i))try{await T.patch(`/loans/${e.id}/assign-officer`,{userId:i}).catch(()=>T.patch(`/loans/${e.id}`,{loanOfficerId:i})),b(r=>r.map(a=>{var l;return a.id===e.id?{...a,loanOfficerId:i,officerId:i,officerName:((l=G.find(h=>String(h.id)===String(i)))==null?void 0:l.name)||a.officerName}:a})),B({open:!1,loan:null,officerId:""}),u("Loan officer assigned.")}catch(r){console.error(r),d("Failed to assign officer.")}},fe=15+(K?1:0),X=x.useRef(null);x.useEffect(()=>{const e=i=>{X.current&&(X.current.contains(i.target)||w(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const pe=()=>{oe(""),ie(""),le(""),ce(""),de(""),ue(""),me(""),Y(1),g(new URLSearchParams),setTimeout(()=>J({skipSyncUrl:!0}),0)};return t.jsxs("div",{className:n.page,children:[t.jsx("style",{children:`
        select.ms-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: none !important; }
        select.ms-select::-ms-expand { display: none; }
      `}),t.jsxs("div",{className:"mb-5 flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:n.h1,children:De}),t.jsxs("div",{className:n.sub,children:["Total: ",we(y)," ",t.jsx("span",{className:"mx-2 text-slate-400",children:"•"}),t.jsx(ye,{to:"/loans",className:"text-indigo-700 underline font-semibold",children:"All Loans"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:Re,className:n.btnGhost,children:"Export CSV"}),t.jsx("button",{onClick:ke,className:n.btnGhost,children:"Export Excel"}),t.jsx("button",{onClick:Pe,className:n.btnGhost,children:"Export PDF"})]})]}),t.jsxs("div",{className:`${n.card} p-4 mb-6`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 text-slate-800 font-semibold",children:[t.jsx(Ze,{className:"w-4 h-4"})," Filters"]}),t.jsx("button",{onClick:pe,className:"text-sm underline decoration-slate-300 hover:decoration-slate-600",children:"Clear all"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-3",children:[t.jsx(q,{className:"lg:col-span-2",leadingIcon:t.jsx(Ge,{className:n.fieldIcon}),placeholder:"Search borrower / phone / product / loan #",value:P,onChange:e=>oe(e.target.value)}),t.jsxs(se,{value:A,onChange:e=>ie(e.target.value),children:[t.jsx("option",{value:"",children:"Product: All"}),Ae.map(e=>t.jsxs("option",{value:e.id,children:[e.name,e.code?` (${e.code})`:""]},e.id))]}),t.jsxs(se,{value:L,onChange:e=>le(e.target.value),children:[t.jsx("option",{value:"",children:"Officer: All"}),G.map(e=>t.jsx("option",{value:e.id,children:e.name||e.email},e.id))]}),t.jsx(q,{type:"date",value:C,onChange:e=>ce(e.target.value)}),t.jsx(q,{type:"date",value:I,onChange:e=>de(e.target.value)}),t.jsx(q,{type:"number",placeholder:"Min Amount",value:D,onChange:e=>ue(e.target.value)}),t.jsx(q,{type:"number",placeholder:"Max Amount",value:R,onChange:e=>me(e.target.value)})]}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsx("button",{onClick:()=>{Y(1),J()},className:n.btnPrimary,children:"Apply Filters"}),t.jsx("button",{onClick:pe,className:n.btn,children:"Reset"})]})]}),t.jsx("div",{className:`${n.card} overflow-x-auto`,children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:n.th,children:"Date"}),t.jsx("th",{className:n.th,children:"Borrower Name"}),t.jsx("th",{className:n.th,children:"Phone Number"}),t.jsx("th",{className:n.th,children:"Loan Product"}),t.jsx("th",{className:`${n.th} text-right`,children:"Principal Amount"}),t.jsx("th",{className:`${n.th} text-right`,children:"Interest Amount"}),t.jsx("th",{className:`${n.th} text-right`,children:"Outstanding Principal"}),t.jsx("th",{className:`${n.th} text-right`,children:"Outstanding Interest"}),t.jsx("th",{className:`${n.th} text-right`,children:"Outstanding Fees"}),t.jsx("th",{className:`${n.th} text-right`,children:"Outstanding Penalty"}),t.jsx("th",{className:`${n.th} text-right`,children:"Total Outstanding"}),t.jsx("th",{className:`${n.th} text-right`,children:"Interest Rate/Year (%)"}),t.jsx("th",{className:`${n.th} text-right`,children:"Loan Duration (Months)"}),t.jsx("th",{className:n.th,children:"Loan Officer"}),t.jsx("th",{className:n.th,children:"Status"}),K&&t.jsx("th",{className:`${n.th}`,children:"Action"})]})}),t.jsx("tbody",{ref:X,children:Z?t.jsx("tr",{children:t.jsx("td",{colSpan:fe,className:`${n.td} text-center py-10 text-slate-600`,children:"Loading…"})}):xe.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:fe,className:`${n.td} text-center py-10 text-slate-600`,children:"No loans found."})}):xe.map(e=>{const i=e.Borrower||e.borrower||{},r=e.Product||e.product||{},a=e.officer||{},l=e.currency||"TZS",h=e.releaseDate||e.startDate||e.createdAt||e.disbursementDate||null,f=e.outstandingPrincipal??null,N=e.outstandingInterest??null,j=e.outstandingFees??null,c=e.outstandingPenalty??null,$=e.outstanding!=null?e.outstanding:[f,N,j,c].every(V=>V==null)?null:Number(f||0)+Number(N||0)+Number(j||0)+Number(c||0),H=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,ee=e.termMonths??e.durationMonths??null;return t.jsxs("tr",{className:"hover:bg-slate-50",children:[t.jsx("td",{className:n.td,children:ve(h)}),t.jsx("td",{className:n.td,children:i.id?t.jsx(ye,{to:`/borrowers/${i.id}`,className:"text-indigo-700 hover:underline font-semibold",children:i.name||e.borrowerName||"—"}):i.name||e.borrowerName||"—"}),t.jsx("td",{className:n.td,children:i.phone||e.borrowerPhone||"—"}),t.jsx("td",{className:n.td,children:r.name||e.productName||"—"}),t.jsx("td",{className:`${n.td} text-right`,children:$e(e.amount??e.principal,l)}),t.jsx("td",{className:`${n.td} text-right`,children:$e(e.interestAmount,l)}),t.jsx("td",{className:`${n.td} text-right`,children:v(f,l)}),t.jsx("td",{className:`${n.td} text-right`,children:v(N,l)}),t.jsx("td",{className:`${n.td} text-right`,children:v(j,l)}),t.jsx("td",{className:`${n.td} text-right`,children:v(c,l)}),t.jsx("td",{className:`${n.td} text-right`,children:v($,l)}),t.jsx("td",{className:`${n.td} text-right`,children:Ke(H)}),t.jsx("td",{className:`${n.td} text-right`,children:we(ee)}),t.jsx("td",{className:n.td,children:e.officerName||a.name||"—"}),t.jsx("td",{className:n.td,children:e.status||"—"}),K&&t.jsx("td",{className:`${n.td} whitespace-nowrap`,children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"px-2 py-1 rounded border-2 border-slate-300 hover:bg-slate-50 font-medium",onClick:()=>w(V=>V===e.id?null:e.id),children:"Actions ▾"}),Ie===e.id&&t.jsxs("div",{className:"absolute right-0 mt-1 w-56 bg-white border-2 border-slate-300 rounded-lg shadow-lg z-10 overflow-hidden",children:[t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Oe(e.id)},children:"View (details & repayments)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Ee(e.id)},children:"Edit"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Fe(e.id)},children:"Record Repayment"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:async()=>{w(null),await Ue(e)},children:"Download Schedule (CSV)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Te(e.id)},children:"Reschedule Repayments"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Me(e.id)},children:"Re-disburse"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{w(null),Be(e)},children:"Assign Loan Officer"})]})]})})]},e.id)})}),!Z&&k.length>0&&t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-slate-100",children:[t.jsx("td",{className:`${n.td} font-semibold text-right`,colSpan:6,children:"Totals:"}),t.jsx("td",{className:`${n.td} font-semibold text-right`,children:v(z.p)}),t.jsx("td",{className:`${n.td} font-semibold text-right`,children:v(z.i)}),t.jsx("td",{className:`${n.td} font-semibold text-right`,children:v(z.f)}),t.jsx("td",{className:`${n.td} font-semibold text-right`,children:v(z.pen)}),t.jsx("td",{className:`${n.td} font-semibold text-right`,children:v(z.t)}),t.jsx("td",{className:n.td,colSpan:4+(K?1:0)})]})})]})}),t.jsx(st,{page:F,pageSize:O,total:y||k.length,onPageChange:e=>Y(e),onPageSizeChange:e=>{Ce(e),Y(1)}}),E.open&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-300 shadow-xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-lg font-bold",children:"Assign Loan Officer"}),t.jsx("button",{onClick:()=>B({open:!1,loan:null,officerId:""}),className:"px-2 py-1 rounded hover:bg-slate-50","aria-label":"Close",children:"✕"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"text-sm",children:["Loan:"," ",t.jsx("span",{className:"font-semibold",children:((Ne=(be=E.loan)==null?void 0:be.Borrower)==null?void 0:Ne.name)||((je=E.loan)==null?void 0:je.borrowerName)||`#${(ge=E.loan)==null?void 0:ge.id}`})]}),t.jsxs(se,{value:E.officerId,onChange:e=>B(i=>({...i,officerId:e.target.value})),children:[t.jsx("option",{value:"",children:"Select officer…"}),G.map(e=>t.jsx("option",{value:e.id,children:e.name||e.fullName||e.email||`User ${e.id}`},e.id))]}),!G.length&&t.jsx("p",{className:"text-xs text-amber-700",children:"No officers found. Ensure users with role “loan_officer” exist."})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>B({open:!1,loan:null,officerId:""}),className:n.btn,children:"Cancel"}),t.jsx("button",{onClick:_e,disabled:!E.officerId,className:n.btnPrimary+" disabled:opacity-60",children:"Assign"})]})]})}),t.jsx(nt,{open:_.open,title:_.title,description:_.description,destructive:_.destructive,onConfirm:_.onConfirm,onClose:()=>Q(e=>({...e,open:!1}))})]})}export{ut as default};
