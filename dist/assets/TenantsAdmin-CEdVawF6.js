import{r as l,j as e,g as x}from"./index-CYBEjh8Z.js";function $({tenant:n,onClose:u,onSaved:f}){const[i,r]=l.useState({planCode:"",seats:"",billingEmail:"",status:""}),[h,g]=l.useState(!1),[c,d]=l.useState("");l.useEffect(()=>{n&&r({planCode:n.planCode||"",seats:n.seats??"",billingEmail:n.billingEmail||"",status:n.status||""})},[n]);async function j(){if(n){g(!0),d("");try{const a=await x.patchFirst([`/tenants/${n.id}`,`/org/${n.id}`,`/organizations/${n.id}`],{planCode:i.planCode||void 0,seats:i.seats===""?null:Number(i.seats),billingEmail:i.billingEmail||void 0,status:i.status||void 0});f((a==null?void 0:a.tenant)||{...n,...i}),u()}catch(a){d(a.normalizedMessage||"Failed to save.")}finally{g(!1)}}}return n?e.jsxs("div",{style:{position:"fixed",right:0,top:0,bottom:0,width:380,background:"#fff",borderLeft:"1px solid #ddd",padding:16,boxShadow:"-6px 0 16px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"Manage Tenant"}),e.jsx("button",{onClick:u,children:"✕"})]}),e.jsx("p",{children:e.jsx("b",{children:n.name})}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("label",{children:["Plan",e.jsx("input",{value:i.planCode,onChange:a=>r({...i,planCode:a.target.value})})]}),e.jsxs("label",{children:["Seats",e.jsx("input",{type:"number",value:i.seats,onChange:a=>r({...i,seats:a.target.value})})]}),e.jsxs("label",{children:["Billing Email",e.jsx("input",{value:i.billingEmail,onChange:a=>r({...i,billingEmail:a.target.value})})]}),e.jsxs("label",{children:["Status",e.jsx("input",{value:i.status,onChange:a=>r({...i,status:a.target.value})})]}),c?e.jsx("p",{style:{color:"crimson"},children:c}):null,e.jsx("div",{children:e.jsx("button",{onClick:j,disabled:h,children:h?"Saving…":"Save"})})]})]}):null}function F(){const[n,u]=l.useState([]),[f,i]=l.useState({}),[r,h]=l.useState(!0),[g,c]=l.useState(""),[d,j]=l.useState(""),[a,p]=l.useState(null),[m,y]=l.useState(null),v=l.useMemo(()=>{const s=d.trim().toLowerCase();return s?n.filter(t=>String(t.name||"").toLowerCase().includes(s)||String(t.id).includes(s)):n},[d,n]);async function C(){h(!0),c("");try{const s=await x.getFirst(["/tenants","/admin/tenants"]),t=Array.isArray(s)?s:s.items||s.tenants||[];u(t);const o=await x.getFirst(["/tenants/stats","/admin/tenants/stats","/system/tenants/stats","/orgs/stats","/organizations/stats"]).catch(()=>({items:[]})),b={};(o.items||[]).forEach(S=>{b[S.id]=S}),i(b)}catch(s){c(s.normalizedMessage||"Failed to load tenants.")}finally{h(!1)}}l.useEffect(()=>{C()},[]);async function w(s){y(s),c("");try{await x.postFirst([`/admin/tenants/${s}/invoices/sync`,`/billing/tenants/${s}/invoices/sync`,`/tenants/${s}/invoices/sync`],{}),alert("Sync requested.")}catch(t){c(t.normalizedMessage||"Sync failed.")}finally{y(null)}}async function E(s){try{const t=await x.getFirst([`/admin/tenants/${s}/invoices`,`/tenants/${s}/invoices`,`/orgs/${s}/invoices`,`/organizations/${s}/invoices`]),o=Array.isArray(t)?t:t.invoices||t.items||[];alert(`Invoices for ${s}

`+JSON.stringify(o,null,2))}catch(t){c(t.normalizedMessage||"Failed to fetch invoices.")}}return e.jsxs("div",{style:{padding:16},children:[e.jsx("h1",{children:"Tenants (Admin)"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Search by name or ID…",value:d,onChange:s=>j(s.target.value),style:{minWidth:280}}),e.jsx("a",{href:"/impersonate-tenant",style:{alignSelf:"center"},children:"Impersonate Tenant →"})]}),g?e.jsx("p",{style:{color:"crimson"},children:g}):null,r?e.jsx("p",{children:"Loading…"}):null,e.jsxs("table",{width:"100%",cellPadding:8,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{align:"left",children:"ID"}),e.jsx("th",{align:"left",children:"Name"}),e.jsx("th",{align:"left",children:"Plan"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Seats"}),e.jsx("th",{align:"left",children:"Staff"}),e.jsx("th",{align:"left",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(s=>{const t=f[s.id]||{};return e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.planCode||"—"}),e.jsx("td",{children:s.status||"—"}),e.jsx("td",{children:s.seats??t.seats??"—"}),e.jsx("td",{children:t.staffCount??"—"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("a",{href:`/subscription?id=${encodeURIComponent(s.id)}`,children:"Subscription"}),e.jsx("button",{onClick:()=>p(s),children:"Manage"}),e.jsx("button",{onClick:()=>E(s.id),children:"Invoices"}),e.jsx("button",{onClick:()=>w(s.id),disabled:m===s.id,children:m===s.id?"Syncing…":"Sync Invoices"})]})})]},s.id)})})]}),v.length===0&&!r&&e.jsx("p",{style:{opacity:.7},children:"No tenants."}),a?e.jsx($,{tenant:a,onClose:()=>p(null),onSaved:s=>{u(t=>t.map(o=>o.id===s.id?{...o,...s}:o))}}):null]})}export{F as default};
