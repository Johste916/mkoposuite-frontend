import{r as l,j as e,b as x}from"./index-6M8fKSo2.js";const N=c=>Number(c||0).toLocaleString();function v(){const[c,d]=l.useState([]),[o,m]=l.useState(!1),[i,j]=l.useState(""),[p,u]=l.useState(""),h=async()=>{m(!0);try{const{data:t}=await x.get("/repayments",{params:{status:"pending",...i?{dateFrom:i}:{},...p?{dateTo:p}:{},page:1,pageSize:200}}),a=Array.isArray(t)?t:(t==null?void 0:t.items)||[];d(a)}catch{d([])}finally{m(!1)}};l.useEffect(()=>{h()},[]);const f=async t=>{var a,r;if(confirm("Approve this repayment?"))try{await x.post(`/repayments/${t}/approve`),d(s=>s.filter(n=>n.id!==t))}catch(s){alert(((r=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:r.error)||"Approve failed (ensure backend route exists)")}},g=async t=>{var r,s;const a=prompt("Reason for rejection?");if(a!==null)try{await x.post(`/repayments/${t}/reject`,{reason:a}),d(n=>n.filter(y=>y.id!==t))}catch(n){alert(((s=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:s.error)||"Reject failed (ensure backend route exists)")}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Approve Repayments"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Review repayments awaiting approval."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:i,onChange:t=>j(t.target.value),className:"border rounded px-2 py-1 text-sm",placeholder:"From"}),e.jsx("span",{className:"text-sm self-center",children:"to"}),e.jsx("input",{type:"date",value:p,onChange:t=>u(t.target.value),className:"border rounded px-2 py-1 text-sm",placeholder:"To"}),e.jsx("button",{className:"px-3 py-2 rounded border hover:bg-gray-50 text-sm",onClick:h,disabled:o,children:o?"Loading…":"Refresh"})]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl mt-4",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"p-3 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-left",children:"Loan Ref"}),e.jsx("th",{className:"p-3 text-left",children:"Borrower"}),e.jsx("th",{className:"p-3 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-left",children:"Method"}),e.jsx("th",{className:"p-3 text-left",children:"Reference"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[c.length===0&&!o&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-4 text-gray-500",children:"Nothing pending."})}),o&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-4",children:"Loading…"})}),c.map(t=>{var a,r,s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:(t.date||t.paymentDate||t.paidAt||"").slice(0,10)}),e.jsx("td",{className:"p-3",children:((a=t.Loan)==null?void 0:a.reference)||t.loanReference||`L-${t.loanId}`}),e.jsx("td",{className:"p-3",children:((s=(r=t.Loan)==null?void 0:r.Borrower)==null?void 0:s.name)||t.borrowerName||"—"}),e.jsxs("td",{className:"p-3",children:[t.currency||"TZS"," ",N(t.amount??t.amountPaid??0)]}),e.jsx("td",{className:"p-3",children:t.method||"—"}),e.jsx("td",{className:"p-3",children:t.reference||t.ref||"—"}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-green-600 text-white hover:bg-green-700",onClick:()=>f(t.id),children:"Approve"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-red-600 text-white hover:bg-red-700",onClick:()=>g(t.id),children:"Reject"})]})})]},t.id)})]})]})})]})})}export{v as default};
