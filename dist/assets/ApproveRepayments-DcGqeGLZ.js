import{r as i,j as e}from"./index-DzNpvMXd.js";import{a as N,b as y,r as u}from"./repayments-ByRlRBb-.js";const g=c=>Number(c||0).toLocaleString();function R(){const[c,l]=i.useState([]),[o,m]=i.useState(!1),[p,d]=i.useState(""),x=async()=>{var s,r;m(!0),d("");try{const{data:t}=await N.get("/repayments",{params:{status:"pending",pageSize:200}});l(Array.isArray(t==null?void 0:t.items)?t.items:Array.isArray(t)?t:[])}catch(t){d(((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.error)||"Load failed"),l([])}finally{m(!1)}};i.useEffect(()=>{x()},[]);const h=async s=>{var r,t;try{await y(s),l(a=>a.filter(n=>n.id!==s))}catch(a){d(((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.error)||"Approve failed")}},j=async s=>{var t,a;const r=prompt("Reason for rejection (optional):")||"";try{await u(s,r),l(n=>n.filter(f=>f.id!==s))}catch(n){d(((a=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:a.error)||"Reject failed")}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Approve Repayments"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review manually posted or auto-captured repayments."})]}),e.jsx("button",{className:"px-3 py-2 rounded border",onClick:x,children:o?"Refreshing…":"Refresh"})]}),!!p&&e.jsx("div",{className:"mt-3 text-sm",children:p}),e.jsx("div",{className:"overflow-x-auto border rounded-xl mt-3",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"text-left p-2",children:"Date"}),e.jsx("th",{className:"text-left p-2",children:"Loan"}),e.jsx("th",{className:"text-left p-2",children:"Borrower"}),e.jsx("th",{className:"text-left p-2",children:"Amount"}),e.jsx("th",{className:"text-left p-2",children:"Method"}),e.jsx("th",{className:"text-left p-2",children:"Reference"}),e.jsx("th",{className:"text-right p-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[c.length===0&&!o&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-500",colSpan:7,children:"No pending items."})}),c.map(s=>{var r,t,a,n;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.date||s.paymentDate||((r=s.createdAt)==null?void 0:r.slice(0,10))}),e.jsx("td",{className:"p-2",children:((t=s.Loan)==null?void 0:t.reference)||`L-${s.loanId}`}),e.jsx("td",{className:"p-2",children:((n=(a=s.Loan)==null?void 0:a.Borrower)==null?void 0:n.name)||"—"}),e.jsxs("td",{className:"p-2",children:[s.currency||"TZS"," ",g(s.amount??s.amountPaid??0)]}),e.jsx("td",{className:"p-2",children:s.method||"—"}),e.jsx("td",{className:"p-2",children:s.reference||s.ref||"—"}),e.jsx("td",{className:"p-2 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"px-2 py-1 rounded border",onClick:()=>h(s.id),children:"Approve"}),e.jsx("button",{className:"px-2 py-1 rounded border",onClick:()=>j(s.id),children:"Reject"})]})})]},s.id)}),o&&e.jsx("tr",{children:e.jsx("td",{className:"p-3",colSpan:7,children:"Loading…"})})]})]})})]})})}export{R as default};
