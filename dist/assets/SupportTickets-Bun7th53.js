import{r as i,j as t,g as m}from"./index-DQxdAjNY.js";const k=["OPEN","RESOLVED","CANCELED"];function v({t:s,onUpdateStatus:j,onAddComment:h}){const[d,o]=i.useState("");return t.jsxs("tr",{children:[t.jsx("td",{children:s.id}),t.jsx("td",{children:s.subject||s.title||"(no subject)"}),t.jsx("td",{children:s.requesterEmail||s.requester||s.createdBy||"—"}),t.jsx("td",{children:s.status}),t.jsxs("td",{children:[t.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:k.map(a=>t.jsx("button",{onClick:()=>j(s,a),disabled:s.status===a,children:a},a))}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:6},children:[t.jsx("input",{value:d,onChange:a=>o(a.target.value),placeholder:"Add internal note / comment",style:{width:220}}),t.jsx("button",{onClick:()=>{d.trim()&&h(s,d.trim()).then(()=>o(""))},children:"Comment"})]})]})]})}function T(){const[s,j]=i.useState("OPEN"),[h,d]=i.useState([]),[o,a]=i.useState(!0),[g,c]=i.useState(""),[y,f]=i.useState(!1),[n,x]=i.useState({subject:"",message:""}),u=i.useMemo(()=>({list:["/support/tickets","/admin/support/tickets","/tickets?type=support","/tickets"],create:["/support/tickets","/admin/support/tickets","/tickets"],update:e=>[`/support/tickets/${e}`,`/admin/support/tickets/${e}`,`/tickets/${e}`],comment:e=>[`/support/tickets/${e}/comments`,`/admin/support/tickets/${e}/comments`,`/tickets/${e}/comments`]}),[]);async function p(){a(!0),c("");try{const e=await m.getFirst(u.list),l=Array.isArray(e)?e:e.items||e.tickets||[];d(l.filter(r=>(r.status||"OPEN").toUpperCase()===s))}catch(e){c(e.normalizedMessage||"Failed to load tickets.")}finally{a(!1)}}i.useEffect(()=>{p()},[s]);async function b(){if(!(!n.subject.trim()||!n.message.trim())){f(!0),c("");try{await m.postFirst(u.create,{subject:n.subject.trim(),message:n.message.trim(),origin:"admin_console"}),x({subject:"",message:""}),await p()}catch(e){c(e.normalizedMessage||"Failed to create ticket.")}finally{f(!1)}}}async function S(e,l){try{await m.patchFirst(u.update(e.id),{status:l}),await p()}catch{try{await m.postFirst(u.update(e.id).map(r=>`${r}/event`),{type:"status",status:l}),await p()}catch(r){c(r.normalizedMessage||"Failed to update status.")}}}async function C(e,l){try{await m.postFirst(u.comment(e.id),{text:l}),await p()}catch(r){c(r.normalizedMessage||"Failed to add comment.")}}return t.jsxs("div",{style:{padding:16},children:[t.jsx("h1",{children:"Support Tickets"}),t.jsx("div",{style:{display:"flex",gap:8,marginBottom:12},children:k.map(e=>t.jsx("button",{onClick:()=>j(e),style:{background:s===e?"#333":"#eee",color:s===e?"#fff":"#000"},children:e},e))}),t.jsxs("div",{className:"card",style:{border:"1px solid #ddd",padding:16,borderRadius:8,marginBottom:16},children:[t.jsx("h3",{style:{marginTop:0},children:"Create Ticket"}),t.jsxs("div",{style:{display:"grid",gap:8,maxWidth:560},children:[t.jsx("input",{placeholder:"Subject",value:n.subject,onChange:e=>x({...n,subject:e.target.value})}),t.jsx("textarea",{placeholder:"Describe the issue…",rows:4,value:n.message,onChange:e=>x({...n,message:e.target.value})}),t.jsx("div",{children:t.jsx("button",{onClick:b,disabled:y,children:y?"Submitting…":"Submit Ticket"})})]})]}),g?t.jsx("p",{style:{color:"crimson"},children:g}):null,o?t.jsx("p",{children:"Loading…"}):null,t.jsxs("table",{width:"100%",cellPadding:8,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{align:"left",children:"ID"}),t.jsx("th",{align:"left",children:"Subject"}),t.jsx("th",{align:"left",children:"Requester"}),t.jsx("th",{align:"left",children:"Status"}),t.jsx("th",{align:"left",children:"Actions"})]})}),t.jsx("tbody",{children:h.map(e=>t.jsx(v,{t:e,onUpdateStatus:S,onAddComment:C},e.id))})]}),h.length===0&&!o&&t.jsxs("p",{style:{opacity:.7},children:['No tickets in "',s,'"']})]})}export{T as default};
