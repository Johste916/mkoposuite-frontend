import{u as M,k as P,r as s,f as I,j as t}from"./index-GPeVFkMM.js";const q=["OPERATING","ADMIN","MARKETING","OTHER"];function V(){const v=M(),[i]=P(),[d,w]=s.useState(()=>new Date().toISOString().slice(0,10)),[u,C]=s.useState(i.get("type")||"OPERATING"),[m,R]=s.useState(i.get("vendor")||""),[p,T]=s.useState(i.get("ref")||""),[c,N]=s.useState(i.get("amount")||""),[x,B]=s.useState(""),[h,j]=s.useState(String(localStorage.getItem("activeBranchId")||"")),[f,S]=s.useState([]),[g,y]=s.useState(!1),[E,A]=s.useState("");s.useEffect(()=>{let e=!1;return(async()=>{try{const l=await I._get("/branches");if(e)return;const r=Array.isArray(l==null?void 0:l.data)?l.data:[];S(r),!h&&r.length&&j(String(r[0].id))}catch{S([])}})(),()=>{e=!0}},[]);const b=s.useMemo(()=>{const e=Number(c);return!!(d&&u&&Number.isFinite(e)&&e>0&&!g)},[d,u,c,g]),D=()=>{const e=Number(c);Number.isFinite(e)&&N(e.toFixed(2))},O=async e=>{var l,r;if(e.preventDefault(),A(""),!!b){y(!0);try{const a={date:d,type:u,vendor:(m==null?void 0:m.trim())||null,reference:(p==null?void 0:p.trim())||null,amount:String(c).trim(),note:(x==null?void 0:x.trim())||null,branchId:h||null};await I._post("/expenses",a),v("/expenses")}catch(a){A(((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.error)||(a==null?void 0:a.normalizedMessage)||(a==null?void 0:a.message)||"Failed to save expense.")}finally{y(!1)}}},F="bg-white dark:bg-slate-800 rounded-xl shadow p-4",n="block text-sm font-medium mb-1",o="w-full px-3 py-2 border rounded-md dark:bg-slate-700 dark:border-slate-600",k=o;return t.jsxs("div",{className:F,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Add Expense"}),t.jsx("p",{className:"text-xs opacity-70",children:"Create a new operating/admin/marketing expense."})]}),E?t.jsxs("div",{className:"mb-3 text-sm text-rose-600 dark:text-rose-300",children:["Error: ",String(E)]}):null,t.jsxs("form",{onSubmit:O,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Date"}),t.jsx("input",{type:"date",className:o,value:d,onChange:e=>w(e.target.value),required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Type"}),t.jsx("select",{className:k,value:u,onChange:e=>C(e.target.value),required:!0,children:q.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Vendor (optional)"}),t.jsx("input",{type:"text",className:o,value:m,onChange:e=>R(e.target.value),placeholder:"e.g. Office Supplies Ltd"})]}),t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Reference (optional)"}),t.jsx("input",{type:"text",className:o,value:p,onChange:e=>T(e.target.value),placeholder:"e.g. INV-001"})]}),t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Amount"}),t.jsx("input",{type:"number",step:"0.01",min:"0",className:o,value:c,onChange:e=>N(e.target.value),onBlur:D,placeholder:"0.00",required:!0})]}),f.length>0?t.jsxs("div",{children:[t.jsx("label",{className:n,children:"Branch"}),t.jsx("select",{className:k,value:h,onChange:e=>j(e.target.value),children:f.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))})]}):null,t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:n,children:"Note (optional)"}),t.jsx("textarea",{className:"w-full px-3 py-2 border rounded-md h-28 resize-y dark:bg-slate-700 dark:border-slate-600",value:x,onChange:e=>B(e.target.value),placeholder:"Add details…"})]}),t.jsxs("div",{className:"md:col-span-2 flex items-center gap-2 pt-2",children:[t.jsx("button",{type:"submit",disabled:!b,className:`px-4 py-2 rounded text-white ${b?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:g?"Saving…":"Save Expense"}),t.jsx("button",{type:"button",className:"px-4 py-2 rounded border dark:border-slate-600",onClick:()=>v("/expenses"),children:"Cancel"})]})]})]})}export{V as default};
