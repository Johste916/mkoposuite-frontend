import{r as i,j as e,b as w}from"./index-MSOOl8cj.js";function T(){const[E,d]=i.useState(null),[S,k]=i.useState(null),[g,C]=i.useState(null),[y,O]=i.useState([]),[b,m]=i.useState("loading"),[A,j]=i.useState("");async function x(t,a){let n=null;for(const c of t)try{const s=await w.get(c,a);if((s==null?void 0:s.data)!==void 0)return s.data}catch(s){n=s;continue}throw n||Object.assign(new Error("Not Found"),{code:404})}function D(t=[]){const a=n=>t.includes(n);return{savings:a("savings.view"),loans:a("loans.view"),collections:a("collections.view"),accounting:a("accounting.view"),sms:a("sms.send")||a("sms.view"),esignatures:a("esign.view")||a("esignatures.view"),payroll:a("payroll.view"),investors:a("investors.view"),assets:a("assets.view"),collateral:a("collateral.view"),reports:a("reports.view")}}const u=async()=>{var t,a,n,c;m("loading"),j("");try{const s=await x(["/tenants/me","/tenant/me","/account/tenant","/account/organization"],{});d(s);const h=(s==null?void 0:s.id)||(s==null?void 0:s.tenantId)||null;h&&localStorage.setItem("tenantId",h);const v=(N={})=>h?{...N,headers:{...N.headers||{},"x-tenant-id":h}}:N,p=await x(["/tenants/me/entitlements","/tenant/me/entitlements","/account/tenant/entitlements","/account/organization/entitlements","/org/entitlements"],v()).catch(()=>({}));k(p||{});const r=await x(["/tenants/me/limits","/tenant/me/limits","/account/tenant/limits","/account/organization/limits","/org/limits"],v()).catch(()=>({})),z=r&&typeof r=="object"&&r.limits?r.limits:r||{};C(z||{}),!(p&&p.modules&&Object.keys(p.modules).length>0)&&Array.isArray(r==null?void 0:r.entitlements)&&k({modules:D(r.entitlements),planCode:(((t=r==null?void 0:r.plan)==null?void 0:t.code)||((a=r==null?void 0:r.plan)==null?void 0:a.name)||(s==null?void 0:s.planCode)||"basic").toString().toLowerCase(),status:(s==null?void 0:s.status)||"trial"});const o=await x(["/tenants/me/invoices","/tenant/me/invoices","/account/tenant/invoices","/account/organization/invoices","/org/invoices"],v()).catch(()=>[]),L=Array.isArray(o)?o:Array.isArray(o==null?void 0:o.invoices)?o.invoices:[];O(L),m("ready")}catch(s){(s==null?void 0:s.code)===404?m("unavailable"):(m("error"),j(((c=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:c.error)||s.message||"Unknown error"))}};if(i.useEffect(()=>{u()},[]),b==="loading")return e.jsx("div",{className:"p-4 text-sm text-slate-500 dark:text-slate-400",children:"Loading…"});if(b==="unavailable")return e.jsxs("div",{className:"ms-card p-4 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Organization"}),e.jsx("div",{className:"rounded border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/40 p-3",children:e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:["Organization settings aren’t available on this server (the ",e.jsx("code",{children:"/tenants/me"})," API is not implemented). If you don’t need this module you can ignore this page."]})})]});if(b==="error")return e.jsxs("div",{className:"p-4 text-sm text-rose-600 dark:text-rose-400",children:["Error: ",A,e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:u,className:"h-9 px-3 rounded ms-btn",children:"Retry"})})]});const l=E||{},f=S||{},I=async()=>{var t,a;try{const n=(l==null?void 0:l.id)||(l==null?void 0:l.tenantId)||localStorage.getItem("tenantId")||null,c=(s={})=>n?{...s,headers:{...s.headers||{},"x-tenant-id":n}}:s;await w.patch("/tenants/me",{planCode:l.planCode,trialEndsAt:l.trialEndsAt,autoDisableOverdue:l.autoDisableOverdue,graceDays:l.graceDays,billingEmail:l.billingEmail},c()),await u()}catch(n){m("error"),j(((a=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:a.error)||n.message||"Save failed")}};return e.jsxs("div",{className:"ms-card p-4 space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Plan"}),e.jsxs("select",{value:l.planCode||"basic",onChange:t=>d({...l,planCode:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"premium",children:"Premium"})]})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Trial ends"}),e.jsx("input",{type:"date",value:l.trialEndsAt||"",onChange:t=>d({...l,trialEndsAt:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!l.autoDisableOverdue,onChange:t=>d({...l,autoDisableOverdue:t.target.checked}),className:"h-4 w-4"}),e.jsx("span",{children:"Auto suspend overdue"})]}),e.jsxs("label",{children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Grace days"}),e.jsx("input",{type:"number",value:l.graceDays??7,onChange:t=>d({...l,graceDays:Number(t.target.value||0)}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",min:0,max:90})]}),e.jsxs("label",{className:"md:col-span-2",children:[e.jsx("div",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Billing email"}),e.jsx("input",{type:"email",value:l.billingEmail||"",onChange:t=>d({...l,billingEmail:t.target.value}),className:"border rounded px-2 py-2 w-full bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:I,className:"h-9 px-3 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Save"}),e.jsx("button",{onClick:u,className:"h-9 px-3 rounded ms-btn",children:"Refresh"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Entitlements"}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(f.modules||{}).length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No entitlements available."}):Object.entries(f.modules||{}).map(([t,a])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${a?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300"}`,children:a?"enabled":"disabled"})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Limits"}),!g||Object.keys(g).length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No limits configured."}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:Object.entries(g).map(([t,a])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-44 capitalize text-slate-700 dark:text-slate-200",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 dark:text-slate-200",children:a===null?"Unlimited":String(a)})]},t))})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-3",children:[e.jsx("h3",{className:"font-semibold mb-2 text-slate-900 dark:text-slate-100",children:"Invoices"}),y.length===0?e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No invoices yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4",children:"Number"}),e.jsx("th",{className:"py-2 pr-4",children:"Amount"}),e.jsx("th",{className:"py-2 pr-4",children:"Due date"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"})]})}),e.jsx("tbody",{className:"align-top",children:y.map(t=>e.jsxs("tr",{className:"border-top border-slate-100 dark:border-slate-800",children:[e.jsx("td",{className:"py-2 pr-4",children:t.number||t.id}),e.jsx("td",{className:"py-2 pr-4",children:Number((t.amount_cents??t.amountCents??0)/100).toLocaleString(void 0,{style:"currency",currency:t.currency||"USD"})}),e.jsx("td",{className:"py-2 pr-4",children:t.due_date||t.dueDate?String(t.due_date||t.dueDate).slice(0,10):"-"}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${(t.status||"open")==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":(t.status||"open")==="past_due"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300"}`,children:t.status||"open"})})]},t.id))})]})})]})]})}export{T as default};
