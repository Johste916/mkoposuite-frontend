import{r as a,j as e,f as r}from"./index-CPepfGRk.js";function k(){sessionStorage.getItem("support_original_token")||(sessionStorage.setItem("support_original_token",localStorage.getItem("token")||""),sessionStorage.setItem("support_original_user",localStorage.getItem("user")||""),sessionStorage.setItem("support_original_tenant",localStorage.getItem("activeTenantId")||""))}function j(){const i=sessionStorage.getItem("support_original_token"),d=sessionStorage.getItem("support_original_user"),o=sessionStorage.getItem("support_original_tenant");i!==null&&localStorage.setItem("token",i),d!==null&&localStorage.setItem("user",d),o!==null&&localStorage.setItem("activeTenantId",o),sessionStorage.removeItem("support_original_token"),sessionStorage.removeItem("support_original_user"),sessionStorage.removeItem("support_original_tenant")}function w(){const[i,d]=a.useState(""),[o,y]=a.useState([]),[g,u]=a.useState(!0),[p,l]=a.useState(""),[m,h]=a.useState(!1),f=a.useMemo(()=>{const t=i.trim().toLowerCase();return t?o.filter(s=>String(s.name||"").toLowerCase().includes(t)||String(s.id).includes(t)):o},[i,o]);async function I(){u(!0),l("");try{const t=await r.getFirst(["/tenants","/admin/tenants"]),s=Array.isArray(t)?t:t.items||t.tenants||[];y(s)}catch(t){l(t.normalizedMessage||"Failed to load tenants.")}finally{u(!1)}}a.useEffect(()=>{I()},[]);async function _(t){var s,x,S;k(),h(!0),l("");try{const n=await r.postFirst([`/admin/tenants/${t.id}/impersonate`,"/admin/impersonate","/auth/impersonate","/support/impersonate"],{tenantId:t.id});if(n!=null&&n.token&&localStorage.setItem("token",n.token),n!=null&&n.user){localStorage.setItem("user",JSON.stringify(n.user));const c=((s=n.user)==null?void 0:s.tenantId)||((S=(x=n.user)==null?void 0:x.tenant)==null?void 0:S.id)||t.id;c&&localStorage.setItem("activeTenantId",c),r.setTenantId(c)}else localStorage.setItem("activeTenantId",t.id),r.setTenantId(t.id);window.location.href="/"}catch(n){l(n.normalizedMessage||"Impersonation failed."),j()}finally{h(!1)}}async function v(){l("");try{await r.postFirst(["/admin/impersonate/stop","/auth/impersonate/stop","/support/impersonate/stop"],{}).catch(()=>{})}finally{j(),r.clearTenantId(),window.location.href="/"}}return e.jsxs("div",{style:{padding:16},children:[e.jsx("h1",{children:"Impersonate Tenant"}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("input",{placeholder:"Search by name or ID…",value:i,onChange:t=>d(t.target.value),style:{minWidth:280}}),e.jsx("button",{onClick:I,children:"Refresh"}),e.jsx("button",{onClick:v,title:"Revert to your original session",children:"Revert"})]}),p?e.jsx("p",{style:{color:"crimson"},children:p}):null,g?e.jsx("p",{children:"Loading…"}):null,e.jsxs("table",{width:"100%",cellPadding:8,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{align:"left",children:"ID"}),e.jsx("th",{align:"left",children:"Name"}),e.jsx("th",{align:"left",children:"Plan"}),e.jsx("th",{align:"left",children:"Status"}),e.jsx("th",{align:"left",children:"Seats"}),e.jsx("th",{align:"left",children:"Actions"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.planCode||t.plan||"—"}),e.jsx("td",{children:t.status||"—"}),e.jsx("td",{children:t.seats??"—"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("a",{href:`/subscription?id=${encodeURIComponent(t.id)}`,children:"Subscription"}),e.jsx("button",{onClick:()=>_(t),disabled:m,children:m?"Starting…":"Impersonate"})]})})]},t.id))})]}),f.length===0&&!g&&e.jsx("p",{style:{opacity:.7},children:"No tenants."})]})}export{w as default};
