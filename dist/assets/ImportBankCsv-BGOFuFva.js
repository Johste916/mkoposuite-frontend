import{r as l,j as s}from"./index-BWN1fagU.js";import{l as g,w as f}from"./banking-DiIsjiBX.js";function y(d){const c=d.split(/\r?\n/).filter(Boolean);if(!c.length)return[];const a=c[0].split(",").map(i=>i.trim());return c.slice(1).map(i=>{const r=i.split(",").map(n=>n.trim()),t={};return a.forEach((n,o)=>t[n]=r[o]),t.amount!=null&&(t.amount=Number(t.amount)),t.occurredAt&&(t.occurredAt=new Date(t.occurredAt).toISOString()),t})}function v(){const[d,c]=l.useState([]),[a,i]=l.useState(""),[r,t]=l.useState([]),[n,o]=l.useState(null),[p,x]=l.useState(null);l.useEffect(()=>{g().then(c).catch(e=>x((e==null?void 0:e.normalizedMessage)||String(e)))},[]);const h=async e=>{x(null),o(null),t([]);const m=await e.text();t(y(m))},j=async()=>{if(!(!a||!r.length))try{const e=await f(a,r);o({created:Array.isArray(e)?e.length:0})}catch(e){x((e==null?void 0:e.normalizedMessage)||String(e))}};return s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Import Bank CSV"}),s.jsx("div",{className:"text-xs text-gray-500",children:"/api/banks/:id/transactions"})]}),s.jsxs("div",{className:"flex flex-wrap gap-3 items-end",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm",children:"Bank"}),s.jsxs("select",{className:"border px-2 py-1 rounded",value:a,onChange:e=>i(e.target.value),children:[s.jsx("option",{value:"",children:"-- select --"}),d.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{className:"bg-gray-100 px-3 py-1 rounded cursor-pointer",children:["Select CSV",s.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>e.target.files&&h(e.target.files[0])})]}),s.jsx("button",{className:"bg-black text-white px-3 py-1 rounded",onClick:j,disabled:!a||!r.length,children:"Import"})]}),p&&s.jsx("div",{className:"text-red-600 text-sm",children:p}),n&&s.jsxs("div",{className:"text-green-700 text-sm",children:["Imported: ",n.created??0," rows"]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Expected columns (min):"," ",s.jsx("code",{children:"occurredAt,amount,type,reference,description,status,currency"})]}),s.jsx("div",{className:"max-h-72 overflow-auto border rounded",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsx("tr",{children:r[0]&&Object.keys(r[0]).map(e=>s.jsx("th",{className:"border px-2 py-1 text-left",children:e},e))})}),s.jsxs("tbody",{children:[r.map((e,m)=>s.jsx("tr",{children:Object.keys(r[0]||{}).map(u=>s.jsx("td",{className:"border px-2 py-1",children:String(e[u]??"")},u))},m)),!r.length&&s.jsx("tr",{children:s.jsx("td",{className:"px-2 py-2 text-sm text-gray-500",children:"No CSV loaded"})})]})]})})]})}export{v as default};
