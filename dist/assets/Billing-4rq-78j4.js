import{r as c,j as e,g as n}from"./index-B6fIVZFR.js";function P(){const[v,x]=c.useState(!0),[h,u]=c.useState(!1),[p,d]=c.useState(""),[g,o]=c.useState(""),[l,m]=c.useState({plan:"free",currency:"USD",status:"active",billingEmail:"",invoiceEmails:[],invoiceNotes:"",autoRenew:!1,paymentProvider:"",paymentMethod:"",nextInvoiceDate:""}),[b,N]=c.useState([]),y=async()=>{try{const{data:a}=await n.get("/account/billing");return{settings:(a==null?void 0:a.settings)||a}}catch{}try{const a=await n.get("/billing/overview"),s=await n.get("/billing/invoices").catch(()=>({data:[]}));return{settings:a.data||{},invoices:s.data||[]}}catch{}return{settings:(await n.get("/billing")).data||{}}},j=async t=>{try{return await n.put("/account/billing",t)}catch{}try{return await n.put("/billing/overview",t)}catch{}try{return await n.put("/billing",t)}catch{}try{return await n.post("/billing/overview",t)}catch{}throw new Error("No billing endpoint available")},w=async()=>{x(!0),d(""),o("");try{const t=await y(),a=(t==null?void 0:t.settings)||{};m({plan:a.plan||"free",currency:a.currency||"USD",status:a.status||"active",billingEmail:a.billingEmail||"",invoiceEmails:Array.isArray(a.invoiceEmails)?a.invoiceEmails:[],invoiceNotes:a.invoiceNotes||"",autoRenew:!!a.autoRenew,paymentProvider:a.paymentProvider||"",paymentMethod:a.paymentMethod||"",nextInvoiceDate:a.nextInvoiceDate||""}),N(Array.isArray(t==null?void 0:t.invoices)?t.invoices:[])}catch{d("Failed to load billing settings")}finally{x(!1)}};c.useEffect(()=>{w()},[]);const f=async()=>{var t,a;u(!0),d(""),o("");try{const s={...l,invoiceEmails:l.invoiceEmails.filter(Boolean)},{data:i}=await j(s);o((i==null?void 0:i.message)||"Saved.");const E=(i==null?void 0:i.settings)||i||{};m(S=>({...S,...E}))}catch(s){d(((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||(s==null?void 0:s.message)||"Failed to save")}finally{u(!1)}},r=(t,a)=>m(s=>({...s,[t]:a})),k=t=>r("invoiceEmails",t.split(",").map(a=>a.trim()).filter(Boolean));return v?e.jsx("div",{className:"p-4 text-sm text-slate-500 dark:text-slate-400",children:"Loading…"}):e.jsxs("div",{className:"max-w-4xl space-y-6",children:[e.jsxs("div",{className:"ms-card p-4",children:[e.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Billing"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Manage your plan, invoices, and payment methods."}),g&&e.jsx("div",{className:"mt-3 text-sm text-emerald-600 dark:text-emerald-400",children:g}),p&&e.jsx("div",{className:"mt-3 text-sm text-rose-600 dark:text-rose-400",children:p}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Plan"}),e.jsxs("select",{className:"w-full border rounded px-2 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.plan,onChange:t=>r("plan",t.target.value),children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Currency"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.currency,onChange:t=>r("currency",t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Billing Email"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.billingEmail,onChange:t=>r("billingEmail",t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Invoice Emails (comma separated)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.invoiceEmails.join(", "),onChange:t=>k(t.target.value)})]}),e.jsxs("label",{className:"text-sm sm:col-span-2",children:[e.jsx("div",{className:"mb-1",children:"Invoice Notes"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",rows:3,value:l.invoiceNotes,onChange:t=>r("invoiceNotes",t.target.value)})]}),e.jsxs("label",{className:"text-sm flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:l.autoRenew,onChange:t=>r("autoRenew",t.target.checked)}),"Auto Renew"]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Payment Provider"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.paymentProvider,onChange:t=>r("paymentProvider",t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Payment Method (masked)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.paymentMethod,onChange:t=>r("paymentMethod",t.target.value)})]}),e.jsxs("label",{className:"text-sm",children:[e.jsx("div",{className:"mb-1",children:"Next Invoice Date (ISO)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700 dark:text-slate-200",value:l.nextInvoiceDate||"",onChange:t=>r("nextInvoiceDate",t.target.value)})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:f,disabled:h,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:h?"Saving…":"Save Changes"})})]}),b.length>0&&e.jsxs("div",{className:"ms-card p-4",children:[e.jsx("h2",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Invoices"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-slate-600 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 pr-4",children:"Date"}),e.jsx("th",{className:"text-left py-2 pr-4",children:"Number"}),e.jsx("th",{className:"text-left py-2 pr-4",children:"Amount"}),e.jsx("th",{className:"text-left py-2 pr-4",children:"Status"}),e.jsx("th",{className:"text-left py-2",children:"PDF"})]})}),e.jsx("tbody",{className:"text-slate-800 dark:text-slate-200",children:b.map(t=>e.jsxs("tr",{className:"border-t border-slate-200 dark:border-slate-800",children:[e.jsx("td",{className:"py-2 pr-4",children:t.date||t.createdAt||""}),e.jsx("td",{className:"py-2 pr-4",children:t.number||t.invoiceNo||t.id}),e.jsx("td",{className:"py-2 pr-4",children:t.amountFormatted||t.amount}),e.jsx("td",{className:"py-2 pr-4",children:t.status}),e.jsx("td",{className:"py-2",children:t.pdfUrl?e.jsx("a",{href:t.pdfUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 dark:text-blue-300 underline",children:"Download"}):"—"})]},t.id))})]})})]})]})}export{P as default};
