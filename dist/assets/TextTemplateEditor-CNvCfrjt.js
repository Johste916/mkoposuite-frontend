import{r as u,j as e}from"./index-2ZVrRahO.js";function D({title:r="Templates",loader:b,creator:N,updater:v,remover:x,fields:l={}}){const[o,i]=u.useState([]),[f,c]=u.useState(""),[g,y]=u.useState(!1),[h,p]=u.useState({name:"",subject:"",text:"",channel:l.fixedChannel||""});async function j(){var a,s,n;c("");try{const t=await b();i(Array.isArray(t)?t:t?[t]:[])}catch(t){console.warn(`${r}: failed to load`,(a=t==null?void 0:t.response)==null?void 0:a.status,(s=t==null?void 0:t.response)==null?void 0:s.data),i([]),((n=t==null?void 0:t.response)==null?void 0:n.status)===401&&c("You are not authorized. Please sign in again.")}}u.useEffect(()=>{j()},[]);async function w(){var t,d;c("");const{name:a,subject:s,text:n}=h;if(!a.trim()||!n.trim()){c("name and text are required");return}y(!0);try{const m={name:a.trim(),...l.showSubject?{subject:s.trim()}:{},text:n.trim(),body:n.trim(),...l.fixedChannel?{channel:l.fixedChannel}:{}};await N(m),p(k=>({...k,name:"",subject:"",text:""})),await j()}catch(m){c(((d=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:d.error)||m.message||"Create failed")}finally{y(!1)}}async function S(a,s){var n,t;c("");try{const d={...s,...s.text?{body:s.text}:{}};await v(a,d),await j()}catch(d){c(((t=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:t.error)||d.message||"Save failed")}}async function C(a){var s,n;if(confirm("Delete this item?")){c("");try{await x(a),await j()}catch(t){c(((n=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:n.error)||t.message||"Delete failed")}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:r}),f&&e.jsx("div",{className:"text-sm text-rose-600",children:f}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Name"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:h.name,onChange:a=>p(s=>({...s,name:a.target.value})),placeholder:"Welcome template"})]}),l.showSubject&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Subject"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:h.subject,onChange:a=>p(s=>({...s,subject:a.target.value})),placeholder:"Welcome to MkopoSuite"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs mb-1",children:"Text"}),e.jsx("textarea",{className:"w-full min-h-[120px] border rounded px-2 py-1 text-sm",value:h.text,onChange:a=>p(s=>({...s,text:a.target.value})),placeholder:"Hello {{name}}, …"})]}),e.jsx("div",{children:e.jsx("button",{onClick:w,disabled:g,className:"px-3 py-2 border rounded bg-white disabled:opacity-60",children:g?"Saving…":"Add"})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),l.showSubject&&e.jsx("th",{className:"p-2 text-left",children:"Subject"}),e.jsx("th",{className:"p-2 text-left",children:"Preview"}),e.jsx("th",{className:"p-2 w-[1%]"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-slate-500",colSpan:l.showSubject?4:3,children:"No items"})}):o.map(a=>e.jsx(E,{row:a,showSubject:!!l.showSubject,onSave:S,onDelete:C},a.id||a._id||a.name))})]})})]})}function E({row:r,showSubject:b,onSave:N,onDelete:v}){const[x,l]=u.useState({name:r.name||"",subject:r.subject||"",text:r.text||r.body||""});return e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full border rounded px-2 py-1",value:x.name,onChange:o=>l(i=>({...i,name:o.target.value}))})}),b&&e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full border rounded px-2 py-1",value:x.subject,onChange:o=>l(i=>({...i,subject:o.target.value}))})}),e.jsx("td",{className:"p-2",children:e.jsx("textarea",{className:"w-full min-h-[90px] border rounded px-2 py-1",value:x.text,onChange:o=>l(i=>({...i,text:o.target.value}))})}),e.jsxs("td",{className:"p-2 text-right space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>N(r.id||r._id,x),children:"Save"}),e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>v(r.id||r._id),children:"Delete"})]})]})}export{D as T};
