import{i as gt,u as vt,r as y,j as a,L as R,h as I}from"./index-L976ZryY.js";const N=(n,d=0)=>Number.isFinite(Number(n))?Number(n):d,j=n=>`TZS ${N(n).toLocaleString()}`,ft="+255";function F(n,d=ft){const t=String(n||"").trim();return t?t.startsWith("+")?t:t.startsWith("00")?`+${t.slice(2)}`:/^0\d{6,}$/.test(t)?`${d}${t.slice(1)}`:/^\d+$/.test(t)?`+${t}`:t:""}const i=(...n)=>{for(const d of n.flat()){if(d===0)return 0;if(d===!1||d==null)continue;const t=typeof d=="string"?d.trim():d;if(Array.isArray(t)){if(t.filter(Boolean).length)return t}else if(t!==""&&t!=="null"&&t!=="undefined")return t}return""},je=n=>{const d=i(n);return d===""||Array.isArray(d)&&d.length===0},J=n=>n?new Date(n).toLocaleDateString():"â€”",G=n=>{try{const d=new Date(n);if(Number.isNaN(d.getTime()))return"";const t=d.getFullYear(),v=String(d.getMonth()+1).padStart(2,"0"),f=String(d.getDate()).padStart(2,"0");return`${t}-${v}-${f}`}catch{return""}},_=async(n=[],d={})=>{let t;for(const v of n)try{const f=await I.get(v,d);return f==null?void 0:f.data}catch(f){t=f}throw t||new Error(`All endpoints failed: ${n.join(", ")}`)},T=n=>n?{headers:{"X-Tenant-Id":n},params:{tenantId:n}}:{},A="inline-flex items-center gap-1 text-indigo-700 font-bold underline decoration-2 underline-offset-4 hover:text-indigo-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 rounded",b=n=>{const d="px-2 py-0.5 text-[11px] font-bold uppercase rounded-full border-2 ring-1 ring-inset shadow-sm";switch(String(n||"").toLowerCase()){case"pending":case"pending_kyc":return`${d} bg-amber-100 border-amber-300 ring-amber-200 text-amber-900`;case"approved":return`${d} bg-emerald-100 border-emerald-300 ring-emerald-200 text-emerald-900`;case"rejected":return`${d} bg-rose-100 border-rose-300 ring-rose-200 text-rose-900`;case"active":return`${d} bg-blue-100 border-blue-300 ring-blue-200 text-blue-900`;case"disabled":return`${d} bg-slate-100 border-slate-300 ring-slate-200 text-slate-900`;case"blacklisted":return`${d} bg-red-100 border-red-300 ring-red-200 text-red-900`;case"closed":return`${d} bg-gray-100 border-gray-300 ring-gray-200 text-gray-900`;default:return`${d} bg-gray-100 border-gray-300 ring-gray-200 text-gray-900`}},Y=({title:n,children:d,className:t=""})=>a.jsxs("section",{className:`rounded-2xl border-2 border-slate-400 bg-white shadow-lg p-4 md:p-5 ${t}`,children:[n&&a.jsx("h2",{className:"mb-3 text-lg md:text-xl font-extrabold text-slate-900",children:n}),d]}),ae=({label:n,children:d})=>a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wider text-slate-900",children:n}),a.jsx("div",{className:"mt-1 text-[15px] text-slate-900 break-words",children:je(d)?"â€”":d})]}),ee=({items:n,cols:d=3})=>{const t=d===2?"lg:grid-cols-2":d===4?"lg:grid-cols-4":"lg:grid-cols-3";return a.jsx("div",{className:`grid gap-4 sm:grid-cols-2 ${t}`,children:n.map((v,f)=>a.jsx(ae,{label:v.label,children:je(v.value)?"â€”":v.value},f))})},ue=({text:n})=>a.jsx("div",{className:"p-6 text-sm rounded-2xl border-2 border-dashed border-slate-400 text-slate-900 bg-white",children:n}),me=({head:n=[],rows:d=[]})=>a.jsx("div",{className:"overflow-x-auto rounded-xl border-2 border-slate-400 bg-white",children:a.jsxs("table",{className:"min-w-full table-fixed text-[15px]",children:[a.jsx("thead",{className:"bg-slate-100 text-slate-900",children:a.jsx("tr",{className:"text-left",children:n.map((t,v)=>a.jsx("th",{className:`px-3 py-2 font-bold border border-slate-400 ${v===n.length-1?"text-right":""}`,children:t},v))})}),a.jsx("tbody",{children:d.map((t,v)=>a.jsx("tr",{className:v%2?"bg-slate-50":"bg-white",children:t.map((f,u)=>a.jsx("td",{className:`px-3 py-2 align-top border border-slate-300 break-words ${u===n.length-1?"text-right":""}`,children:f},u))},v))})]})}),jt=()=>{const{id:n}=gt(),d=vt(),[t,v]=y.useState(null),[f,u]=y.useState([]),[D,we]=y.useState([]),[k,pe]=y.useState([]),[L,Ie]=y.useState([]),[se,ne]=y.useState([]),[z,De]=y.useState("all"),[K,Se]=y.useState("loans"),[V,re]=y.useState({loans:null,savings:null}),[ie,Ce]=y.useState(!1),[m,oe]=y.useState(!1),[s,le]=y.useState(null),[xe,he]=y.useState(!1),[ge,$e]=y.useState([]),[ve,Ae]=y.useState([]),Ee=e=>i(e==null?void 0:e.name,[e==null?void 0:e.firstName,e==null?void 0:e.lastName].filter(Boolean).join(" "),e==null?void 0:e.fullName,e==null?void 0:e.customerName,e==null?void 0:e.businessName)||"â€”",fe=e=>{var r,o,c,g;return{id:e==null?void 0:e.id,name:i(e==null?void 0:e.name,e==null?void 0:e.fullName),phone:i(e==null?void 0:e.phone,e==null?void 0:e.msisdn,e==null?void 0:e.mobile,e==null?void 0:e.primaryPhone),email:i(e==null?void 0:e.email,e==null?void 0:e.mail),addressLine:i(e==null?void 0:e.addressLine,[e==null?void 0:e.street,e==null?void 0:e.houseNumber,e==null?void 0:e.ward,e==null?void 0:e.district,e==null?void 0:e.city].filter(Boolean).join(", "),[e==null?void 0:e.address,e==null?void 0:e.town,e==null?void 0:e.region,e==null?void 0:e.country].filter(Boolean).join(", ")),gender:i(e==null?void 0:e.gender,e==null?void 0:e.sex),birthDate:i(e==null?void 0:e.birthDate,e==null?void 0:e.dateOfBirth,e==null?void 0:e.dob),employmentStatus:i(e==null?void 0:e.employmentStatus,e==null?void 0:e.employment,e==null?void 0:e.employmentType),occupation:i(e==null?void 0:e.occupation,e==null?void 0:e.businessType,e==null?void 0:e.jobTitle,e==null?void 0:e.sector),idType:i(e==null?void 0:e.idType,e==null?void 0:e.identificationType),nationalId:i(e==null?void 0:e.nationalId,e==null?void 0:e.nid,e==null?void 0:e.idNumber),idIssuedDate:i(e==null?void 0:e.idIssuedDate,e==null?void 0:e.idIssueDate,e==null?void 0:e.idDateIssued),idExpiryDate:i(e==null?void 0:e.idExpiryDate,e==null?void 0:e.idExpireDate,e==null?void 0:e.idDateExpiry),nextKinName:i(e==null?void 0:e.nextKinName,e==null?void 0:e.nextOfKinName,e==null?void 0:e.kinName,e==null?void 0:e.emergencyContactName),nextKinPhone:i(e==null?void 0:e.nextKinPhone,e==null?void 0:e.nextOfKinPhone,e==null?void 0:e.kinPhone,e==null?void 0:e.emergencyContactPhone),nextOfKinRelationship:i(e==null?void 0:e.nextOfKinRelationship,e==null?void 0:e.kinRelationship,e==null?void 0:e.relationship),branchId:(e==null?void 0:e.branchId)??((r=e==null?void 0:e.Branch)==null?void 0:r.id)??((o=e==null?void 0:e.branch)==null?void 0:o.id)??(e==null?void 0:e.branch_id)??"",officerId:(e==null?void 0:e.officerId)??(e==null?void 0:e.loanOfficerId)??((c=e==null?void 0:e.officer)==null?void 0:c.id)??((g=e==null?void 0:e.loanOfficer)==null?void 0:g.id)??(e==null?void 0:e.officer_id)??"",status:(e==null?void 0:e.status)??"active",maritalStatus:i(e==null?void 0:e.maritalStatus,e==null?void 0:e.marriageStatus),educationLevel:i(e==null?void 0:e.educationLevel,e==null?void 0:e.education,e==null?void 0:e.educationStatus),customerNumber:i(e==null?void 0:e.customerNumber,e==null?void 0:e.accountNumber,e==null?void 0:e.clientNumber),tin:i(e==null?void 0:e.tin,e==null?void 0:e.TIN,e==null?void 0:e.taxId),nationality:i(e==null?void 0:e.nationality,e==null?void 0:e.country),groupId:i(e==null?void 0:e.groupId,e==null?void 0:e.group,e==null?void 0:e.groupCode),loanType:i(e==null?void 0:e.loanType,e==null?void 0:e.productType,"individual"),regDate:i(e==null?void 0:e.regDate,e==null?void 0:e.registrationDate)}},de=async()=>{re({loans:null,savings:null});try{const e=await _([`/borrowers/${n}`]);v(e),le(fe(e));const r=T(e==null?void 0:e.tenantId),[o,c,g,w]=await Promise.all([_([`/loans?borrowerId=${n}`,`/borrowers/${n}/loans`,`/loans/borrower/${n}`],r).catch(()=>(re(B=>({...B,loans:"Couldnâ€™t load loans."})),[])),_([`/repayments?borrowerId=${n}`,`/borrowers/${n}/repayments`,`/repayments/borrower/${n}`],r).catch(()=>[]),_([`/borrowers/${n}/comments`,`/comments/borrower/${n}`],r).catch(()=>[]),_([`/borrowers/${n}/savings`,`/savings/borrower/${n}`],r).catch(()=>(re(B=>({...B,savings:"Couldnâ€™t load savings."})),{}))]);u(Array.isArray(o)?o:(o==null?void 0:o.items)||[]),we(Array.isArray(c)?c:(c==null?void 0:c.items)||[]),pe(Array.isArray(g)?g:(g==null?void 0:g.items)||[]);const l=Array.isArray(w==null?void 0:w.transactions)?w.transactions:Array.isArray(w)?w:[];Ie(l),ne(l)}catch(e){console.error("Fetch borrower bundle failed:",(e==null?void 0:e.message)||e)}},Te=async e=>{try{const r=T(e),[o,c]=await Promise.all([_(["/branches","/org/branches","/branch"],r).catch(()=>[]),_(["/users?role=officer","/officers","/users/loan-officers"],r).catch(()=>[])]),g=Array.isArray(o==null?void 0:o.items)?o.items:Array.isArray(o)?o:[],w=Array.isArray(c==null?void 0:c.items)?c.items:Array.isArray(c)?c:[];$e(g.map(l=>({id:l.id??l._id??l.code??l.uuid,name:l.name??l.title??l.code??"â€”"}))),Ae((Array.isArray(w)?w:[]).map(l=>({id:i(l.id,l._id,l.userId),name:i(l.name,[l.firstName,l.lastName].filter(Boolean).join(" "),l.email)||"â€”"})))}catch(r){console.warn("Option list fetch failed",(r==null?void 0:r.message)||r)}};y.useEffect(()=>{de()},[n]),y.useEffect(()=>{(t==null?void 0:t.tenantId)!==void 0&&Te(t==null?void 0:t.tenantId)},[t==null?void 0:t.tenantId]),y.useEffect(()=>{const e=()=>de();return window.addEventListener("loan:updated",e),window.addEventListener("borrower:updated",e),()=>{window.removeEventListener("loan:updated",e),window.removeEventListener("borrower:updated",e)}},[n]),y.useEffect(()=>{ne(z==="all"?L:L.filter(e=>e.type===z))},[z,L]);const ke=async e=>{const r=String(e||"").trim();if(r)try{await I.post(`/borrowers/${n}/comments`,{content:r},T(t==null?void 0:t.tenantId)),pe(o=>[{content:r,createdAt:new Date().toISOString()},...o])}catch(o){console.error("Error adding comment",o)}},p=(e,r)=>le(o=>({...o,[e]:r})),ce=e=>e===""||e===void 0?null:e,h=e=>typeof e=="string"?e.trim():e,Q=e=>e?G(e):null,U=e=>F(e||""),Le=async()=>{var e,r,o,c,g,w;if(s!=null&&s.id){he(!0);try{const l={name:h(s.name),phone:U(h(s.phone||"")),email:h(s.email),addressLine:h(s.addressLine),address:h(s.addressLine),status:h(s.status),nationalId:h(s.nationalId),branchId:s.branchId===void 0?void 0:ce(s.branchId),officerId:s.officerId===void 0?void 0:ce(s.officerId),loanOfficerId:s.officerId===void 0?void 0:ce(s.officerId),idType:h(s.idType),idIssuedDate:Q(s.idIssuedDate),idExpiryDate:Q(s.idExpiryDate),nextKinName:h(s.nextKinName),nextKinPhone:U(s.nextKinPhone),nextOfKinRelationship:h(s.nextOfKinRelationship),employmentStatus:h(s.employmentStatus),occupation:h(s.occupation),birthDate:Q(s.birthDate),gender:h(s.gender),maritalStatus:h(s.maritalStatus),educationLevel:h(s.educationLevel),customerNumber:h(s.customerNumber),tin:h(s.tin),nationality:h(s.nationality),groupId:h(s.groupId),loanType:h(s.loanType),regDate:Q(s.regDate),idNumber:h(s.nationalId),msisdn:U(h(s.phone||"")),mobile:U(h(s.phone||"")),primaryPhone:U(h(s.phone||""))},B={branch_id:l.branchId,officer_id:l.officerId,loan_officer_id:l.officerId,address_line:l.addressLine,id_type:l.idType,id_issued_date:l.idIssuedDate,id_expiry_date:l.idExpiryDate,national_id:l.nationalId,id_number:l.idNumber,next_of_kin_name:l.nextKinName,next_of_kin_phone:l.nextKinPhone,next_of_kin_relationship:l.nextOfKinRelationship,employment_status:l.employmentStatus,birth_date:l.birthDate,marital_status:l.maritalStatus,education_level:l.educationLevel,customer_number:l.customerNumber,loan_type:l.loanType,group_id:l.groupId,reg_date:l.regDate},E=Object.fromEntries(Object.entries({...l,...B}).filter(([,S])=>S!==void 0)),O=(t==null?void 0:t.branchId)??((e=t==null?void 0:t.Branch)==null?void 0:e.id)??((r=t==null?void 0:t.branch)==null?void 0:r.id)??(t==null?void 0:t.branch_id)??null,M=Object.prototype.hasOwnProperty.call(s,"branchId"),W=M?l.branchId:O,P=T(t==null?void 0:t.tenantId);if(O!=null&&M&&(W==null||String(W)!==String(O))){try{await I.delete(`/borrowers/${s.id}/branch`,P)}catch{}try{await I.delete(`/borrowers/${s.id}/branch/${O}`,P)}catch{}}const x=M&&O!=null&&W==null?(()=>{const S={...E};return delete S.branchId,delete S.branch_id,S})():E;await(async()=>{var S,H,ye,Ne;try{await I.patch(`/borrowers/${s.id}`,x,P)}catch($){if(((S=$==null?void 0:$.response)==null?void 0:S.status)===409&&((ye=(H=$==null?void 0:$.response)==null?void 0:H.data)!=null&&ye.unassignUrl)){try{await I.delete($.response.data.unassignUrl,P)}catch{}await I.patch(`/borrowers/${s.id}`,x,P)}else if(((Ne=$==null?void 0:$.response)==null?void 0:Ne.status)!==409)await I.put(`/borrowers/${s.id}`,x,P);else throw $}})(),await de(),oe(!1),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:s.id}}))}catch(l){console.error(l),alert(((c=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:c.error)||((w=(g=l==null?void 0:l.response)==null?void 0:g.data)==null?void 0:w.message)||"Couldnâ€™t update borrower.")}finally{he(!1)}}},Pe=async()=>{if(window.confirm("Disable this borrower?"))try{await I.post(`/borrowers/${n}/disable`,{},T(t==null?void 0:t.tenantId)),v(e=>({...e,status:"disabled"})),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:n}}))}catch{try{await I.patch(`/borrowers/${n}`,{status:"disabled"},T(t==null?void 0:t.tenantId)),v(e=>({...e,status:"disabled"})),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:n}}))}catch{alert("Could not disable borrower.")}}},Oe=async()=>{if(window.confirm("Blacklist this borrower?"))try{await I.post(`/borrowers/${n}/blacklist`,{},T(t==null?void 0:t.tenantId)),v(e=>({...e,status:"blacklisted"})),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:n}}))}catch{try{await I.patch(`/borrowers/${n}`,{status:"blacklisted"},T(t==null?void 0:t.tenantId)),v(e=>({...e,status:"blacklisted"})),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:n}}))}catch{alert("Could not blacklist borrower.")}}},_e=async()=>{if(window.confirm("Delete this borrower? This cannot be undone."))try{await I.delete(`/borrowers/${n}`,T(t==null?void 0:t.tenantId)),d("/borrowers"),window.dispatchEvent(new CustomEvent("borrower:updated",{detail:{id:n}}))}catch{alert("Could not delete borrower.")}},X=y.useMemo(()=>{const e=new Map;D.forEach(o=>{var g;const c=o.loanId??((g=o.loan)==null?void 0:g.id);c&&(e.has(c)||e.set(c,[]),e.get(c).push(o))});const r=new Date;return(f||[]).map(o=>{const c=e.get(o.id)||[],g=c.reduce((x,C)=>x+N(C.amountPaid??C.paidAmount??C.amount??0),0),w=o.outstanding??o.outstandingTotal??o.outstandingAmount??null,l=w!=null?N(w):Math.max(0,N(o.amount)-g),E=c.filter(x=>x.dueDate&&new Date(x.dueDate)>=r).sort((x,C)=>new Date(x.dueDate)-new Date(C.dueDate))[0]||null,O=(E==null?void 0:E.dueDate)||o.nextDueDate||o.nextInstallmentDate||null,M=E?N((E.amount??0)-(E.amountPaid??0)):o.nextDueAmount??o.nextInstallmentAmount??null,W=c.filter(x=>{const C=x.dueDate?new Date(x.dueDate):null,S=String(x.status||"").toLowerCase(),H=N(x.amountPaid??x.paidAmount)>=N(x.amount);return C&&C<r&&!H&&(S==="overdue"||S==="due"||S==="")}).length,P=c.filter(x=>N(x.amountPaid??x.paidAmount)>0).map(x=>x.date||x.createdAt).sort((x,C)=>new Date(C)-new Date(x))[0];return{...o,paidTotal:g,outstanding:l,nextDueDate:O,nextDueAmount:M,missedInstallments:W,lastPaymentDate:P}})},[f,D]),Ke=y.useMemo(()=>{const e=new Date;return D.filter(r=>{const o=r.dueDate?new Date(r.dueDate):null,c=String(r.status||"").toLowerCase(),g=N(r.amountPaid??r.paidAmount)>=N(r.amount);return o&&o<e&&!g&&(c==="overdue"||c==="due"||c==="")}).length},[D]);if(!t||!s)return a.jsx("div",{className:"w-full px-6 py-6 min-h-screen bg-white text-slate-900",children:"Loading..."});const Z=Ee(t),q=t!=null&&t.tenantId?`?tenantId=${encodeURIComponent(t.tenantId)}`:"";ie||k.slice(0,3);const Be=i(t.addressLine,[t.street,t.houseNumber,t.ward,t.district,t.city].filter(Boolean).join(", "),[t.address,t.town,t.region,t.country].filter(Boolean).join(", "),t.location),Re=i(t.businessName,t.tradeName,t.shopName),Fe=i(t.occupation,t.businessType,t.jobTitle,t.sector),Ue=i(t.employmentStatus,t.employment,t.employmentType),Me=i(t.nationalId,t.nid,t.idNumber),We=i(t.idType,t.identificationType),Ge=i(t.idIssuedDate,t.idIssueDate,t.idDateIssued),Ye=i(t.idExpiryDate,t.idExpireDate,t.idDateExpiry),ze=i(t.maritalStatus,t.marriageStatus),Ve=i(t.educationLevel,t.education,t.educationStatus),Qe=i(t.customerNumber,t.accountNumber,t.clientNumber),Xe=i(t.tin,t.TIN,t.taxId),Ze=i(t.nationality,t.country),qe=i(t.birthDate,t.dateOfBirth,t.dob),He=i(t.nextKinName,t.nextOfKinName,t.kinName,t.emergencyContactName),Je=i(t.nextKinPhone,t.nextOfKinPhone,t.kinPhone,t.emergencyContactPhone),be=i(t.nextOfKinRelationship,t.kinRelationship,t.relationship),et=i(t.regDate,t.registrationDate,t.createdAt),tt=[{v:"",t:"â€”"},{v:"male",t:"Male"},{v:"female",t:"Female"},{v:"other",t:"Other"}],at=[{v:"active",t:"Active"},{v:"pending_kyc",t:"Pending KYC"},{v:"inactive",t:"Inactive"},{v:"blacklisted",t:"Blacklisted"},{v:"disabled",t:"Disabled"}],st=[{v:"",t:"â€”"},{v:"employed",t:"Employed"},{v:"self_employed",t:"Self-employed"},{v:"unemployed",t:"Unemployed"},{v:"student",t:"Student"},{v:"retired",t:"Retired"}],nt=[{v:"",t:"â€”"},{v:"national_id",t:"National ID"},{v:"passport",t:"Passport"},{v:"driver_license",t:"Driverâ€™s License"},{v:"voter_id",t:"Voter ID"}],rt=e=>{var o,c;const r=String(e).trim().split(/\s+/).filter(Boolean);return((((o=r[0])==null?void 0:o[0])||"")+(((c=r[1])==null?void 0:c[0])||"")).toUpperCase()||"U"},it=e=>{var r,o;return i(e==null?void 0:e.branchName,(r=e==null?void 0:e.Branch)==null?void 0:r.name,(o=e==null?void 0:e.branch)==null?void 0:o.name,e==null?void 0:e.branch)||"â€”"},ot=e=>{var r,o;return i(e==null?void 0:e.officerName,(r=e==null?void 0:e.officer)==null?void 0:r.name,(o=e==null?void 0:e.loanOfficer)==null?void 0:o.name,e==null?void 0:e.loanOfficer)||"â€”"},lt=e=>e?`tel:${e}`:void 0,dt=e=>e?`sms:${e}`:void 0,ct=e=>e?`https://wa.me/${String(e).replace(/[^\d]/g,"")}`:void 0,ut=e=>e?`mailto:${e}`:void 0,mt=L.reduce((e,r)=>r.type==="deposit"?e+N(r.amount):e,0),pt=L.reduce((e,r)=>r.type==="withdrawal"?e+N(r.amount):e,0),xt=L.reduce((e,r)=>r.type==="charge"?e+N(r.amount):e,0),ht=L.reduce((e,r)=>r.type==="interest"?e+N(r.amount):e,0);return a.jsxs("div",{className:"w-full px-4 md:px-6 py-6 min-h-screen bg-white text-slate-900",children:[a.jsxs("div",{className:"flex items-center justify-between mb-5",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx(R,{to:`/borrowers${q}`,className:A,children:"Borrowers"})," ",a.jsx("span",{className:"text-slate-700",children:"/"})," ",a.jsx("span",{className:"font-extrabold tracking-tight",children:Z})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[m?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{oe(!1),le(fe(t))},className:"text-slate-900 border-2 border-slate-400 hover:bg-slate-50 px-3 py-1.5 rounded-lg font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400",children:"Cancel"}),a.jsx("button",{onClick:Le,disabled:xe,className:"bg-indigo-600 disabled:opacity-60 text-white px-3 py-1.5 rounded-lg font-semibold hover:bg-indigo-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 shadow-sm",children:xe?"Saving...":"Save"})]}):a.jsx("button",{onClick:()=>oe(!0),className:"text-slate-900 border-2 border-slate-400 hover:bg-slate-50 px-3 py-1.5 rounded-lg font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400",children:"Update info"}),!m&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:Pe,className:"text-slate-900 border-2 border-slate-400 hover:bg-slate-50 px-3 py-1.5 rounded-lg font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400",children:"Disable"}),a.jsx("button",{onClick:Oe,className:"bg-rose-600 text-white px-3 py-1.5 rounded-lg font-semibold hover:bg-rose-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-400 shadow-sm",children:"Blacklist"}),a.jsx("button",{onClick:_e,className:"bg-red-600 text-white px-3 py-1.5 rounded-lg font-semibold hover:bg-red-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-400 shadow-sm",children:"Delete"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[a.jsxs(Y,{children:[a.jsxs("div",{className:"flex gap-5",children:[a.jsxs("div",{className:"relative shrink-0",children:[t.photoUrl?a.jsx("img",{src:t.photoUrl,alt:Z,className:"w-24 h-24 rounded-2xl object-cover border-2 border-slate-400"}):a.jsx("div",{className:"w-24 h-24 rounded-2xl bg-gradient-to-br from-indigo-500 to-blue-600 text-white flex items-center justify-center text-2xl font-extrabold",children:rt(Z)}),a.jsx("span",{className:`absolute -bottom-2 left-2 ${b(t.status)}`,children:t.status||"â€”"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[m?a.jsx("input",{value:s.name??"",onChange:e=>p("name",e.target.value),className:"text-3xl font-extrabold tracking-tight border-2 border-slate-400 rounded-lg px-2 py-1",placeholder:"Full name"}):a.jsx("h1",{className:"text-3xl font-extrabold tracking-tight truncate",children:Z}),a.jsxs("span",{className:"text-xs text-slate-700",children:["ID: ",t.id]}),a.jsxs("span",{className:"text-xs text-slate-700",children:["Tenant: ",t.tenantId||"â€”"]})]}),a.jsxs("div",{className:"mt-3 grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsx(ae,{label:"Phone",children:m?a.jsx("input",{value:s.phone??"",onChange:e=>p("phone",e.target.value),className:"w-full text-sm border-2 border-slate-400 rounded-lg px-3 py-2",placeholder:"e.g., +2557xxxxxxx"}):a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("span",{children:F(i(t.phone,t.msisdn,t.mobile,t.primaryPhone))||"â€”"}),i(t.phone,t.msisdn,t.mobile,t.primaryPhone)&&a.jsxs(a.Fragment,{children:[a.jsx("a",{className:A,href:lt(F(t.phone||t.msisdn||t.mobile||t.primaryPhone)),children:"Call"}),a.jsx("a",{className:A,href:dt(F(t.phone||t.msisdn||t.mobile||t.primaryPhone)),children:"SMS"}),a.jsx("a",{className:A,href:ct(F(t.phone||t.msisdn||t.mobile||t.primaryPhone)),target:"_blank",rel:"noreferrer",children:"WhatsApp"})]})]})}),a.jsx(ae,{label:"Email",children:m?a.jsx("input",{value:s.email??"",onChange:e=>p("email",e.target.value),className:"w-full text-sm border-2 border-slate-400 rounded-lg px-3 py-2",placeholder:"e.g., user@email.com"}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:i(t.email,t.mail)||"â€”"}),i(t.email,t.mail)&&a.jsx("a",{className:A,href:ut(t.email||t.mail),children:"Email"})]})}),a.jsx(ae,{label:"Address",children:m?a.jsx("input",{value:s.addressLine??"",onChange:e=>p("addressLine",e.target.value),className:"w-full text-sm border-2 border-slate-400 rounded-lg px-3 py-2",placeholder:"Street, ward, district, city"}):Be||"â€”"})]})]})]}),a.jsx("hr",{className:"my-4 border-2 border-slate-300"}),a.jsxs("div",{className:"grid gap-5",children:[a.jsx(ee,{cols:3,items:[{label:"Gender",value:m?a.jsx("select",{value:s.gender??"",onChange:e=>p("gender",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:tt.map(e=>a.jsx("option",{value:e.v,children:e.t},e.v))}):i(t.gender,t.sex)},{label:"Birth Date",value:m?a.jsx("input",{type:"date",value:s.birthDate?G(s.birthDate):"",onChange:e=>p("birthDate",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):J(qe)},{label:"Business / Occupation",value:m?a.jsx("input",{value:s.occupation??"",onChange:e=>p("occupation",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):i(Fe,Re)},{label:"Employment Status",value:m?a.jsx("select",{value:s.employmentStatus??"",onChange:e=>p("employmentStatus",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:st.map(e=>a.jsx("option",{value:e.v,children:e.t},e.v))}):Ue},{label:"Customer No.",value:m?a.jsx("input",{value:s.customerNumber??"",onChange:e=>p("customerNumber",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):Qe},{label:"Nationality",value:m?a.jsx("input",{value:s.nationality??"",onChange:e=>p("nationality",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):Ze},{label:"Marital Status",value:m?a.jsx("input",{value:s.maritalStatus??"",onChange:e=>p("maritalStatus",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):ze},{label:"Education Level",value:m?a.jsx("input",{value:s.educationLevel??"",onChange:e=>p("educationLevel",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):Ve},{label:"Status",value:m?a.jsx("select",{value:s.status??"active",onChange:e=>p("status",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:at.map(e=>a.jsx("option",{value:e.v,children:e.t},e.v))}):a.jsx("span",{className:b(t.status),children:t.status||"â€”"})}]}),a.jsxs("div",{className:"grid gap-5 lg:grid-cols-2",children:[a.jsx(Y,{title:"ID Document",children:a.jsx(ee,{cols:2,items:[{label:"ID Type",value:m?a.jsx("select",{value:s.idType??"",onChange:e=>p("idType",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:nt.map(e=>a.jsx("option",{value:e.v,children:e.t},e.v))}):We},{label:"ID Number",value:m?a.jsx("input",{value:s.nationalId??"",onChange:e=>p("nationalId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):Me||t.idNumber},{label:"Issued On",value:m?a.jsx("input",{type:"date",value:s.idIssuedDate?G(s.idIssuedDate):"",onChange:e=>p("idIssuedDate",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):J(Ge)},{label:"Expiry Date",value:m?a.jsx("input",{type:"date",value:s.idExpiryDate?G(s.idExpiryDate):"",onChange:e=>p("idExpiryDate",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):J(Ye)},{label:"TIN",value:m?a.jsx("input",{value:s.tin??"",onChange:e=>p("tin",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):Xe}]})}),a.jsx(Y,{title:"Assignment & Registration",children:a.jsx(ee,{cols:2,items:[{label:"Branch",value:m?ge.length?a.jsxs("select",{value:s.branchId??"",onChange:e=>p("branchId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:[a.jsx("option",{value:"",children:"â€”"}),ge.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}):a.jsx("input",{value:s.branchId??"",onChange:e=>p("branchId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",placeholder:"Branch ID"}):it(t)},{label:"Loan Officer",value:m?ve.length?a.jsxs("select",{value:s.officerId??"",onChange:e=>p("officerId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",children:[a.jsx("option",{value:"",children:"â€”"}),ve.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}):a.jsx("input",{value:s.officerId??"",onChange:e=>p("officerId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1",placeholder:"Officer ID"}):ot(t)},{label:"Loan Type",value:m?a.jsx("input",{value:s.loanType??"",onChange:e=>p("loanType",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):i(t.loanType,t.productType,"individual")},{label:"Group ID",value:m?a.jsx("input",{value:s.groupId??"",onChange:e=>p("groupId",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):i(t.groupId,t.group,t.groupCode)},{label:"Registration Date",value:m?a.jsx("input",{type:"date",value:s.regDate?G(s.regDate):"",onChange:e=>p("regDate",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):J(et)}]})})]}),a.jsx(Y,{title:"Next of Kin",children:a.jsx(ee,{cols:3,items:[{label:"Full Name",value:m?a.jsx("input",{value:s.nextKinName??"",onChange:e=>p("nextKinName",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):He},{label:"Phone",value:m?a.jsx("input",{value:s.nextKinPhone??"",onChange:e=>p("nextKinPhone",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):F(Je)},{label:"Relationship",value:m?a.jsx("input",{value:s.nextOfKinRelationship??"",onChange:e=>p("nextOfKinRelationship",e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1"}):be}]})})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{k:"PAR %",v:Number.isFinite(Number(t.parPercent))?`${Number(t.parPercent).toFixed(2)}%`:"0%"},{k:"Overdue Amount",v:j(i(t.overdueAmount,t.pastDueAmount,0))},{k:"Missed Repayments",v:Ke},{k:"Net Savings",v:j(i(t.netSavings,t.savingsNet,0))}].map((e,r)=>a.jsxs("div",{className:"rounded-2xl p-4 border-2 bg-white border-slate-400 shadow-sm",children:[a.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wider text-slate-900",children:e.k}),a.jsx("div",{className:"mt-1 text-2xl font-extrabold text-slate-900 tabular-nums",children:e.v})]},r))}),a.jsxs("div",{className:"rounded-2xl border-2 bg-white border-slate-400 shadow-lg",children:[a.jsx("div",{className:"flex flex-wrap gap-2 border-b-2 px-2 pt-2 border-slate-400 bg-white rounded-t-2xl",children:[{key:"loans",label:"Loans",count:X.length},{key:"repayments",label:"Repayments",count:D.length},{key:"savings",label:"Savings",count:se.length},{key:"documents",label:"Documents"},{key:"activity",label:"Activity"}].map(e=>{const r=K===e.key;return a.jsxs("button",{onClick:()=>Se(e.key),className:`px-3 py-1.5 text-sm rounded-full border-2 transition font-semibold ${r?"bg-indigo-600 text-white border-indigo-600 shadow-sm":"bg-white text-slate-900 hover:bg-slate-50 border-slate-400"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400`,children:[e.label,typeof e.count=="number"&&a.jsx("span",{className:`ml-2 inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full text-xs px-1.5 ${r?"bg-white/20 text-white":"bg-slate-100 text-slate-900"}`,children:e.count})]},e.key)})}),a.jsxs("div",{className:"p-4 md:p-5",children:[K==="loans"&&a.jsxs(a.Fragment,{children:[V.loans&&a.jsx("div",{className:"mb-3 text-sm text-rose-700 font-semibold",children:V.loans}),X.length===0?a.jsx(ue,{text:a.jsxs(a.Fragment,{children:["No loans for this borrower.",a.jsx(R,{to:`/loans/applications?borrowerId=${encodeURIComponent(t.id)}${t!=null&&t.tenantId?`&tenantId=${encodeURIComponent(t.tenantId)}`:""}`,className:`ml-1 ${A}`,children:"Create loan"})]})}):a.jsx(me,{head:["Loan","Reference","Status","Amount","Outstanding","Next Due"],rows:X.map(e=>[a.jsx(R,{to:`/loans/${encodeURIComponent(e.id)}${t!=null&&t.tenantId?`?tenantId=${encodeURIComponent(t.tenantId)}`:""}`,className:A,children:e.id}),e.reference||`L-${e.id}`,a.jsx("span",{className:b(e.status),children:String(e.status||"â€”")}),a.jsx("div",{className:"text-right tabular-nums",children:j(e.amount)}),a.jsx("div",{className:"text-right tabular-nums",children:e.outstanding==null?"â€”":j(e.outstanding)}),e.nextDueDate?a.jsxs("div",{className:"text-right",children:[new Date(e.nextDueDate).toLocaleDateString(),e.nextDueAmount?a.jsx("span",{className:"ml-1 font-bold",children:j(e.nextDueAmount)}):null]}):"â€”"])})]}),K==="repayments"&&a.jsx(a.Fragment,{children:D.length===0?a.jsx(ue,{text:"No repayments recorded for this borrower."}):a.jsx(me,{head:["Due Date","Amount Due","Paid","Balance","Status","Loan"],rows:D.map(e=>{const r=e.dueDate||e.date||e.createdAt||null,o=N(e.amount),c=N(e.amountPaid??e.paidAmount),g=Math.max(0,o-c);return[r?new Date(r).toLocaleDateString():"â€”",a.jsx("div",{className:"text-right tabular-nums",children:j(o)}),a.jsx("div",{className:"text-right tabular-nums",children:j(c)}),a.jsx("div",{className:"text-right tabular-nums",children:j(g)}),a.jsx("span",{className:b(e.status),children:e.status||"â€”"}),e.loanId?a.jsx(R,{to:`/loans/${encodeURIComponent(e.loanId)}${t!=null&&t.tenantId?`?tenantId=${encodeURIComponent(t.tenantId)}`:""}`,className:A,children:e.loanId}):"â€”"]})})}),K==="savings"&&a.jsxs(a.Fragment,{children:[V.savings&&a.jsx("div",{className:"mb-3 text-sm text-rose-700 font-semibold",children:V.savings}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 my-3 text-sm",children:[a.jsx(te,{label:"Deposits",value:j(mt)}),a.jsx(te,{label:"Withdrawals",value:j(pt)}),a.jsx(te,{label:"Interest",value:j(ht)}),a.jsx(te,{label:"Charges",value:j(xt)})]}),a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-900",children:"Filter:"}),a.jsxs("select",{value:z,onChange:e=>De(e.target.value),className:"text-sm border-2 border-slate-400 rounded-lg px-2 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400",children:[a.jsx("option",{value:"all",children:"All"}),a.jsx("option",{value:"deposit",children:"Deposits"}),a.jsx("option",{value:"withdrawal",children:"Withdrawals"}),a.jsx("option",{value:"interest",children:"Interest"}),a.jsx("option",{value:"charge",children:"Charges"})]})]}),a.jsx(R,{to:`/savings${q}${q?"&":"?"}borrowerId=${encodeURIComponent(t.id)}`,className:`${A} text-sm`,children:"View savings accounts"})]}),se.length===0?a.jsx(ue,{text:"No savings transactions for this borrower."}):a.jsx(me,{head:["Date","Type","Amount","Notes"],rows:se.map(e=>[e.date?new Date(e.date).toLocaleDateString():"â€”",a.jsx("span",{className:"capitalize",children:e.type}),a.jsx("div",{className:"text-right tabular-nums",children:j(e.amount)}),e.notes||"â€”"])})]}),K==="documents"&&a.jsx("div",{className:"text-sm",children:a.jsx(R,{to:`/borrowers/${encodeURIComponent(t.id)}/documents${q}`,className:A,children:"Manage KYC documents"})}),K==="activity"&&a.jsx(yt,{loans:X,repayments:D,savings:L,comments:k})]})]})]}),a.jsx("aside",{className:"lg:col-span-1 space-y-6",children:a.jsxs(Y,{title:"Notes",children:[a.jsx("input",{onKeyDown:e=>{e.key==="Enter"&&(ke(e.currentTarget.value),e.currentTarget.value="")},placeholder:"Add a note and press Enterâ€¦",className:"w-full text-sm mb-3 border-2 border-slate-400 rounded-lg px-3 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400"}),k.length===0?a.jsx("div",{className:"text-xs text-slate-900",children:"No notes yet."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-2",children:(ie?k:k.slice(0,3)).map((e,r)=>a.jsxs("li",{className:"p-2 text-xs rounded-lg border-2 border-slate-400 bg-white",children:[a.jsx("div",{className:"text-slate-900 break-words",children:e.content}),a.jsx("div",{className:"text-[10px] text-slate-700 mt-1",children:e.createdAt?new Date(e.createdAt).toLocaleString():""})]},`${r}-${e.createdAt}`))}),k.length>3&&a.jsx("button",{onClick:()=>Ce(e=>!e),className:"mt-3 w-full text-xs px-3 py-1.5 rounded-lg border-2 border-slate-400 text-slate-900 hover:bg-slate-50 font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400",children:ie?"Show less":`Show all (${k.length})`})]})]})})]})]})},te=({label:n,value:d})=>a.jsxs("div",{className:"p-3 rounded-xl text-sm bg-slate-50 text-slate-900 border-2 border-slate-200 shadow-sm",children:[n,": ",a.jsx("strong",{children:d})]}),yt=({loans:n,repayments:d,savings:t,comments:v})=>{const f=[];return n.forEach(u=>f.push({type:"loan",date:u.createdAt||u.disbursedAt||u.updatedAt||new Date().toISOString(),text:`Loan ${u.id} â€¢ ${String(u.status||"").toUpperCase()} â€¢ Outstanding ${j(u.outstanding??0)}`})),d.forEach(u=>f.push({type:"repayment",date:u.date||u.createdAt||new Date().toISOString(),text:`Repayment â€¢ ${j(u.amountPaid??u.paidAmount??u.amount)} â€¢ Loan ${u.loanId||"â€”"}`})),t.forEach(u=>f.push({type:"savings",date:u.date||u.createdAt||new Date().toISOString(),text:`${u.type} â€¢ ${j(u.amount)}`})),v.forEach(u=>f.push({type:"comment",date:u.createdAt||new Date().toISOString(),text:`Note: ${u.content}`})),f.sort((u,D)=>new Date(D.date)-new Date(u.date)),a.jsxs("div",{children:[a.jsx("h4",{className:"font-extrabold text-slate-900 mb-2",children:"ðŸ“œ Activity Timeline"}),a.jsx("ul",{className:"space-y-2 text-sm",children:f.map((u,D)=>a.jsxs("li",{className:"border-l-4 pl-3 border-slate-400 text-slate-900",children:[a.jsx("span",{className:"text-slate-700",children:u.date?new Date(u.date).toLocaleDateString():"â€”"})," â€“"," ",u.text]},D))})]})};export{jt as default};
