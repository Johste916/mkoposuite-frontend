import{u as C,i as S,r as p,g,j as t,L as f}from"./index-C40kITj2.js";const k=(...a)=>a.filter(Boolean).join(" "),l=a=>{if(a===""||a===null||a===void 0||String(a).trim()===".")return null;const c=Number(a);return Number.isFinite(c)?c:null};function F(){const a=C(),{id:c}=S(),d=!!c,[h,b]=p.useState(!1),[y,P]=p.useState(d),[u,N]=p.useState({}),[n,v]=p.useState({name:"",code:"",status:"active",interestMethod:"flat",interestRate:"",minPrincipal:"",maxPrincipal:"",minTermMonths:"",maxTermMonths:"",penaltyRate:"",description:""}),i=p.useCallback((e,o)=>v(m=>({...m,[e]:o})),[]);p.useEffect(()=>{d&&(async()=>{try{const{data:e}=await g.get(`/loan-products/${c}`);v({name:(e==null?void 0:e.name)??"",code:(e==null?void 0:e.code)??"",status:(e==null?void 0:e.status)??"active",interestMethod:(e==null?void 0:e.interestMethod)??"flat",interestRate:(e==null?void 0:e.interestRate)===0||e!=null&&e.interestRate?String(e.interestRate):"",minPrincipal:(e==null?void 0:e.minPrincipal)===0||e!=null&&e.minPrincipal?String(e.minPrincipal):"",maxPrincipal:(e==null?void 0:e.maxPrincipal)===0||e!=null&&e.maxPrincipal?String(e.maxPrincipal):"",minTermMonths:(e==null?void 0:e.minTermMonths)===0||e!=null&&e.minTermMonths?String(e.minTermMonths):"",maxTermMonths:(e==null?void 0:e.maxTermMonths)===0||e!=null&&e.maxTermMonths?String(e.maxTermMonths):"",penaltyRate:(e==null?void 0:e.penaltyRate)===0||e!=null&&e.penaltyRate?String(e.penaltyRate):"",description:(e==null?void 0:e.description)??""})}catch{alert("Failed to load product"),a("/loans/products",{replace:!0})}finally{P(!1)}})()},[d,c,a]);const R=()=>{const e={},o=l(n.interestRate),m=l(n.minPrincipal),x=l(n.maxPrincipal),j=l(n.minTermMonths),M=l(n.maxTermMonths);return String(n.name).trim()||(e.name="Name is required"),String(n.code).trim()||(e.code="Code is required"),(o===null||o<0)&&(e.interestRate="Interest rate must be 0 or more"),m!==null&&x!==null&&x<m&&(e.maxPrincipal="Max must be ≥ Min"),j!==null&&M!==null&&M<j&&(e.maxTermMonths="Max must be ≥ Min"),N(e),Object.keys(e).length===0},T=async e=>{if(e.preventDefault(),!R())return;b(!0);const o={name:n.name.trim(),code:n.code.trim().toUpperCase(),status:n.status,interestMethod:n.interestMethod,interestRate:l(n.interestRate)??0,minPrincipal:l(n.minPrincipal),maxPrincipal:l(n.maxPrincipal),minTermMonths:l(n.minTermMonths),maxTermMonths:l(n.maxTermMonths),penaltyRate:l(n.penaltyRate),description:n.description||""};try{d?await g.put(`/loan-products/${c}`,o):await g.post("/loan-products",o),a("/loans/products")}catch{alert("Failed to save product")}finally{b(!1)}};function s({id:e,label:o,error:m,children:x}){return t.jsxs("div",{children:[t.jsx("label",{htmlFor:e,className:"text-xs font-medium text-slate-600 dark:text-slate-300 mb-1 block",children:o}),x,m&&t.jsx("div",{className:"mt-1 text-xs text-rose-600",children:m})]})}const r="w-full input border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded px-3 py-2 text-sm";return t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("h2",{className:"text-2xl font-bold",children:d?"Edit Loan Product":"Create Loan Product"})}),t.jsx(f,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700",children:"Back to list"})]}),y?t.jsx("div",{className:"card p-4",children:"Loading…"}):t.jsxs("form",{onSubmit:T,className:"card p-4 space-y-4",children:[t.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[t.jsx(s,{id:"lp-name",label:"Name",error:u.name,children:t.jsx("input",{id:"lp-name",name:"name",className:r,value:n.name,onChange:e=>i("name",e.target.value),placeholder:"e.g. Business Working Capital",required:!0})}),t.jsx(s,{id:"lp-code",label:"Code",error:u.code,children:t.jsx("input",{id:"lp-code",name:"code",className:r,value:n.code,onChange:e=>i("code",e.target.value),onBlur:e=>i("code",e.target.value.toUpperCase()),placeholder:"e.g. BWC",required:!0})}),t.jsx(s,{id:"lp-status",label:"Status",children:t.jsxs("select",{id:"lp-status",name:"status",className:r,value:n.status,onChange:e=>i("status",e.target.value),children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})}),t.jsx(s,{id:"lp-method",label:"Interest Method",children:t.jsxs("select",{id:"lp-method",name:"interestMethod",className:r,value:n.interestMethod,onChange:e=>i("interestMethod",e.target.value),children:[t.jsx("option",{value:"flat",children:"Flat"}),t.jsx("option",{value:"reducing",children:"Reducing"})]})}),t.jsx(s,{id:"lp-rate",label:"Interest Rate (%)",error:u.interestRate,children:t.jsx("input",{id:"lp-rate",name:"interestRate",type:"number",step:"0.0001",className:r,value:n.interestRate,onChange:e=>i("interestRate",e.target.value),placeholder:"e.g. 3 or 3.5",inputMode:"decimal"})}),t.jsx(s,{id:"lp-penalty",label:"Penalty Rate (%)",children:t.jsx("input",{id:"lp-penalty",name:"penaltyRate",type:"number",step:"0.0001",className:r,value:n.penaltyRate,onChange:e=>i("penaltyRate",e.target.value),placeholder:"e.g. 1.5",inputMode:"decimal"})}),t.jsx(s,{id:"lp-minp",label:"Min Principal",children:t.jsx("input",{id:"lp-minp",name:"minPrincipal",type:"number",className:r,value:n.minPrincipal,onChange:e=>i("minPrincipal",e.target.value),placeholder:"e.g. 100000",inputMode:"numeric"})}),t.jsx(s,{id:"lp-maxp",label:"Max Principal",error:u.maxPrincipal,children:t.jsx("input",{id:"lp-maxp",name:"maxPrincipal",type:"number",className:r,value:n.maxPrincipal,onChange:e=>i("maxPrincipal",e.target.value),placeholder:"e.g. 10000000",inputMode:"numeric"})}),t.jsx(s,{id:"lp-mint",label:"Min Term (months)",children:t.jsx("input",{id:"lp-mint",name:"minTermMonths",type:"number",className:r,value:n.minTermMonths,onChange:e=>i("minTermMonths",e.target.value),placeholder:"e.g. 3",inputMode:"numeric"})}),t.jsx(s,{id:"lp-maxt",label:"Max Term (months)",error:u.maxTermMonths,children:t.jsx("input",{id:"lp-maxt",name:"maxTermMonths",type:"number",className:r,value:n.maxTermMonths,onChange:e=>i("maxTermMonths",e.target.value),placeholder:"e.g. 36",inputMode:"numeric"})}),t.jsx("div",{className:"sm:col-span-2",children:t.jsx(s,{id:"lp-desc",label:"Internal Notes / Description",children:t.jsx("textarea",{id:"lp-desc",name:"description",rows:3,className:r,value:n.description||"",onChange:e=>i("description",e.target.value),placeholder:"Optional details visible to staff only."})})})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[t.jsx(f,{to:"/loans/products",className:"px-4 py-2 rounded border border-slate-200 dark:border-slate-700 text-sm hover:bg-slate-50 dark:hover:bg-slate-800",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:!!h,className:k("px-4 py-2 rounded text-white text-sm",h?"bg-indigo-400":"bg-indigo-600 hover:bg-indigo-700"),children:h?"Saving…":d?"Update Product":"Create Product"})]})]})]})}export{F as default};
