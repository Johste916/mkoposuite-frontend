import{r as c,j as t}from"./index-Bg9psR-u.js";import{S as d}from"./settings-CbMoKuRU.js";import"./index-wA3dTDSs.js";const N=[{value:"inapp",label:"In-app"},{value:"email",label:"Email"},{value:"sms",label:"SMS"}],g=[{value:"notice",label:"Notice"},{value:"maintenance",label:"Maintenance"},{value:"policy",label:"Policy"}],w=[{value:"low",label:"Low"},{value:"normal",label:"Normal"},{value:"high",label:"High"},{value:"critical",label:"Critical"}];function S(){const[x,m]=c.useState([]),[h,r]=c.useState(""),[p,u]=c.useState(!1),[s,n]=c.useState({title:"",text:"",channel:"inapp",type:"notice",priority:"normal",isActive:!0,showInTicker:!0,showOnDashboard:!1,startAt:"",endAt:""});async function o(){var e,a,i;r("");try{const l=await d.listComms(),y=Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l)?l:[];m(y)}catch(l){console.warn("Failed to list communications, treating as empty.",(e=l==null?void 0:l.response)==null?void 0:e.status,(a=l==null?void 0:l.response)==null?void 0:a.data),m([]),((i=l==null?void 0:l.response)==null?void 0:i.status)===401&&r("You are not authorized. Please sign in again.")}}c.useEffect(()=>{o()},[]);const b=e=>e?new Date(e).toISOString():null;async function v(){var e,a;if(r(""),!s.title.trim()||!s.text.trim()){r("title and text are required");return}u(!0);try{await d.createComm({title:s.title.trim(),text:s.text.trim(),channel:s.channel,type:s.type,priority:s.priority,isActive:!!s.isActive,showInTicker:!!s.showInTicker,showOnDashboard:!!s.showOnDashboard,startAt:b(s.startAt),endAt:b(s.endAt)}),n(i=>({...i,title:"",text:""})),await o()}catch(i){r(((a=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:a.error)||i.message||"Failed to create communication")}finally{u(!1)}}async function j(e){var a,i;if(confirm("Delete this communication?")){r("");try{await d.deleteComm(e),await o()}catch(l){r(((i=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:i.error)||l.message||"Delete failed")}}}return t.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Communications"}),h&&t.jsx("div",{className:"text-sm text-rose-600",children:h}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Title"}),t.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:s.title,onChange:e=>n(a=>({...a,title:e.target.value})),placeholder:"Important Notice"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Channel"}),t.jsx("select",{className:"w-full border rounded px-2 py-1 text-sm",value:s.channel,onChange:e=>n(a=>({...a,channel:e.target.value})),children:N.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Type"}),t.jsx("select",{className:"w-full border rounded px-2 py-1 text-sm",value:s.type,onChange:e=>n(a=>({...a,type:e.target.value})),children:g.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Priority"}),t.jsx("select",{className:"w-full border rounded px-2 py-1 text-sm",value:s.priority,onChange:e=>n(a=>({...a,priority:e.target.value})),children:w.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-xs mb-1",children:"Body"}),t.jsx("textarea",{className:"w-full min-h-[120px] border rounded px-2 py-1 text-sm",value:s.text,onChange:e=>n(a=>({...a,text:e.target.value})),placeholder:"REMINDER: Submit weekly PAR review by Friday 4:00 PM."})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"text-xs flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:s.isActive,onChange:e=>n(a=>({...a,isActive:e.target.checked}))}),"Active"]}),t.jsxs("label",{className:"text-xs flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:s.showInTicker,onChange:e=>n(a=>({...a,showInTicker:e.target.checked}))}),"Show in ticker (bottom line)"]}),t.jsxs("label",{className:"text-xs flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:s.showOnDashboard,onChange:e=>n(a=>({...a,showOnDashboard:e.target.checked}))}),"Show on dashboard (curated card)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Start at"}),t.jsx("input",{type:"datetime-local",className:"w-full border rounded px-2 py-1 text-sm",value:s.startAt,onChange:e=>n(a=>({...a,startAt:e.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"End at"}),t.jsx("input",{type:"datetime-local",className:"w-full border rounded px-2 py-1 text-sm",value:s.endAt,onChange:e=>n(a=>({...a,endAt:e.target.value}))})]}),t.jsx("div",{children:t.jsx("button",{onClick:v,disabled:p,className:"px-3 py-2 border rounded bg-white disabled:opacity-60",children:p?"Saving…":"Add"})})]}),t.jsx("div",{className:"overflow-x-auto border rounded-xl",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b",children:[t.jsx("th",{className:"p-2 text-left",children:"Title"}),t.jsx("th",{className:"p-2 text-left",children:"Type"}),t.jsx("th",{className:"p-2 text-left",children:"Priority"}),t.jsx("th",{className:"p-2 text-left",children:"Channel"}),t.jsx("th",{className:"p-2 text-left",children:"Preview"}),t.jsx("th",{className:"p-2"})]})}),t.jsx("tbody",{children:x.length===0?t.jsx("tr",{children:t.jsx("td",{className:"p-3 text-slate-500",colSpan:6,children:"No communications"})}):x.map(e=>t.jsxs("tr",{className:"border-b align-top",children:[t.jsx("td",{className:"p-2",children:e.title}),t.jsx("td",{className:"p-2",children:e.type||"notice"}),t.jsx("td",{className:"p-2",children:e.priority||"normal"}),t.jsx("td",{className:"p-2",children:e.channel||"inapp"}),t.jsxs("td",{className:"p-2 max-w-[520px]",children:[t.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap",children:e.text||e.body||""}),t.jsxs("div",{className:"text-[11px] text-slate-500 mt-1",children:[e.isActive?"Active":"Inactive"," ·"," ",e.showInTicker?"Ticker":"—"," ",e.showOnDashboard?"· Dashboard":"",e.startAt?` · from ${new Date(e.startAt).toLocaleString()}`:"",e.endAt?` · until ${new Date(e.endAt).toLocaleString()}`:""]})]}),t.jsx("td",{className:"p-2 text-right",children:t.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>j(e.id||e._id),children:"Delete"})})]},e.id||e._id||e.title))})]})})]})}export{S as default};
