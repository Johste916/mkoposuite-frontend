import{r as i,j as e,g as b}from"./index-CGp3nliO.js";const j=(d="")=>/.+@.+\..+/.test(d),s={page:"w-full px-4 md:px-6 lg:px-10 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",sub:"text-sm text-slate-700",card:"rounded-2xl border-2 border-slate-300 bg-white shadow",th:"bg-slate-100 text-left text-[12px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-2 border-slate-200",td:"px-3 py-2 border-2 border-slate-200 text-sm",field:"h-11 w-full rounded-lg border-2 border-slate-300 bg-white text-sm px-3 outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600",btn:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50 font-semibold",btnPrimary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-3 py-2 font-semibold hover:bg-indigo-700"},U=()=>{const[d,m]=i.useState([]),[n,c]=i.useState(""),[f,N]=i.useState(!1),[k,v]=i.useState(!1),[x,w]=i.useState(!1),[a,h]=i.useState({name:"",email:"",id:null}),p=i.useRef(),u=async(t="")=>{var r;N(!0);try{const l=await b.get("/users",{params:{q:t,limit:100}}),o=Array.isArray(l.data)?l.data:((r=l.data)==null?void 0:r.items)||[];m(o)}catch(l){console.error("Error fetching users:",l)}finally{N(!1)}};i.useEffect(()=>{u()},[]),i.useEffect(()=>(clearTimeout(p.current),p.current=setTimeout(()=>u(n),300),()=>clearTimeout(p.current)),[n]);const y=(t={name:"",email:"",id:null})=>{h(t),v(!0)},g=()=>{x||(h({name:"",email:"",id:null}),v(!1))},E=async()=>{var t,r;if(!a.name.trim()||!j(a.email))return alert("Please provide a valid name and email.");w(!0);try{a.id?(await b.put(`/users/${a.id}`,{name:a.name.trim(),email:a.email.trim()}),alert("User updated")):(await b.post("/users",{name:a.name.trim(),email:a.email.trim()}),alert("User created")),g(),u(n)}catch(l){console.error("Submit error:",l),alert(((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.error)||"Error saving user")}finally{w(!1)}},S=async t=>{var r,l;if(window.confirm("Delete this user?"))try{await b.delete(`/users/${t}`),alert("User deleted"),u(n)}catch(o){console.error("Delete error:",o),alert(((l=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:l.error)||"Error deleting user")}};return e.jsxs("div",{className:s.page,children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:s.h1,children:"Users"}),e.jsx("p",{className:s.sub,children:"Create, edit, and search users."})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Search"}),e.jsx("input",{className:`${s.field} w-64 h-10`,placeholder:"name or email…",value:n,onChange:t=>c(t.target.value)})]}),e.jsx("button",{className:s.btnPrimary,onClick:()=>y(),children:"+ New User"})]})]}),e.jsx("div",{className:`${s.card} overflow-x-auto`,children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsx("tr",{children:["#","Name","Email","Actions"].map((t,r)=>e.jsx("th",{className:`${s.th} ${r===3?"text-right":""}`,children:t},t))})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:`${s.td} text-center py-8 text-slate-600`,children:"Loading…"})}):d.length?d.map((t,r)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:s.td,children:r+1}),e.jsx("td",{className:s.td,children:t.name||`${t.firstName||""} ${t.lastName||""}`.trim()}),e.jsx("td",{className:s.td,children:t.email}),e.jsx("td",{className:`${s.td} text-right`,children:e.jsxs("div",{className:"inline-flex gap-2",children:[e.jsx("button",{className:s.btn,onClick:()=>y(t),children:"Edit"}),e.jsx("button",{className:s.btnDanger,onClick:()=>S(t.id),children:"Delete"})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:`${s.td} text-center py-8 text-slate-600`,children:"No users found"})})})]})}),k&&e.jsx($,{title:a.id?"Edit User":"Add New User",onClose:g,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Full name"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>h({...a,name:t.target.value}),className:s.field})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:t=>h({...a,email:t.target.value}),className:`${s.field} ${a.email&&!j(a.email)?"!border-rose-400":""}`}),a.email&&!j(a.email)&&e.jsx("div",{className:"text-[12px] text-rose-600 mt-1",children:"Please enter a valid email."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:s.btn,onClick:g,disabled:x,children:"Cancel"}),e.jsx("button",{className:`${s.btnPrimary} disabled:opacity-50`,onClick:E,disabled:x,children:x?"Saving…":a.id?"Update":"Create"})]})]})})]})};function $({title:d,onClose:m,children:n}){return i.useEffect(()=>{const c=f=>{f.key==="Escape"&&m()};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[m]),e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:m,children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border-2 border-slate-300 bg-white p-5 shadow",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold tracking-tight mb-3",children:d}),n]})})}export{U as default};
