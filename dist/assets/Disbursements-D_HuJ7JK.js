import{r,b as v,j as e}from"./index-DQ2zHQaz.js";import{g as B}from"./auth-CO9T0zV9.js";import{C as E}from"./index-BzGo000p.js";import{f as R}from"./format-CBpsKyOP.js";const U=()=>{const h=B(),[i,w]=r.useState([]),[S,m]=r.useState(!0),[u,y]=r.useState(!1),[n,k]=r.useState("all"),[d,C]=r.useState(""),[b,L]=r.useState(null),[c,o]=r.useState(1),x=10,j=Math.ceil(i.length/x),f=c*x,D=f-x,A=i.slice(D,f),M=["Manager","Director","Admin"].includes(h),P=["Accountant","Admin"].includes(h);r.useEffect(()=>{p()},[n]);const p=async()=>{try{m(!0);let s=(await v.get("/loans/disbursements")).data;n!=="all"&&(s=s.filter(a=>a.status===n)),d&&(s=s.filter(a=>{var l,N;return(N=(l=a.borrower)==null?void 0:l.name)==null?void 0:N.toLowerCase().includes(d.toLowerCase())})),w(s)}catch(t){console.error("Fetch error:",t),L("Failed to load loans")}finally{m(!1)}},g=async(t,s)=>{try{y(!0),await v.put(`/loans/${t}/status`,{status:s}),p()}catch(a){console.error("Status update error:",a),alert("Failed to update loan status")}finally{y(!1)}},F=[{label:"Borrower",key:"borrower.name"},{label:"Amount",key:"amount"},{label:"Currency",key:"currency"},{label:"Status",key:"status"},{label:"Start Date",key:"startDate"},{label:"Term (months)",key:"termMonths"},{label:"Repayment Method",key:"interestMethod"},{label:"Branch",key:"branch.name"},{label:"Initiated By",key:"initiator.name"}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Loan Disbursements"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:"Search borrower...",className:"border p-2 rounded",value:d,onChange:t=>{C(t.target.value),o(1),p()}}),e.jsxs("select",{className:"border p-2 rounded",value:n,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"disbursed",children:"Disbursed"})]}),e.jsx(E,{data:i,headers:F,filename:"loan-disbursements.csv",className:"bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm",children:"Export CSV"})]})]}),S?e.jsx("p",{children:"Loading..."}):b?e.jsx("p",{className:"text-red-500",children:b}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white shadow rounded",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Borrower"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Currency"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Start Date"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Term"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Method"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Branch"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Initiator"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:A.map(t=>{var s,a,l;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:((s=t.borrower)==null?void 0:s.name)||"Unknown"}),e.jsx("td",{className:"px-4 py-2",children:t.amount.toLocaleString()}),e.jsx("td",{className:"px-4 py-2",children:t.currency}),e.jsx("td",{className:"px-4 py-2 capitalize",children:t.status}),e.jsx("td",{className:"px-4 py-2",children:t.startDate?R(new Date(t.startDate),"yyyy-MM-dd"):"-"}),e.jsx("td",{className:"px-4 py-2",children:t.termMonths||"-"}),e.jsx("td",{className:"px-4 py-2 capitalize",children:t.interestMethod}),e.jsx("td",{className:"px-4 py-2",children:((a=t.branch)==null?void 0:a.name)||"-"}),e.jsx("td",{className:"px-4 py-2",children:((l=t.initiator)==null?void 0:l.name)||"-"}),e.jsxs("td",{className:"px-4 py-2 space-x-2",children:[t.status==="pending"&&M&&e.jsx("button",{onClick:()=>g(t.id,"approved"),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",disabled:u,children:"Approve"}),t.status==="approved"&&P&&e.jsx("button",{onClick:()=>g(t.id,"disbursed"),className:"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700",disabled:u,children:"Disburse"}),!["pending","approved"].includes(t.status)&&e.jsx("span",{className:"text-gray-500",children:"Done"})]})]},t.id)})})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{disabled:c===1,onClick:()=>o(t=>t-1),className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",c," of ",j]}),e.jsx("button",{disabled:c===j,onClick:()=>o(t=>t+1),className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]})};export{U as default};
