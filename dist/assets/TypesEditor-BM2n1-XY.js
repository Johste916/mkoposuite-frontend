import{r as n,j as e}from"./index-DX7Us0v_.js";import{A as h}from"./admin-hswYJX3b.js";function R({title:c,category:i}){const[u,o]=n.useState([]),[l,m]=n.useState(""),[x,y]=n.useState(!0),[j,p]=n.useState(!1),[b,d]=n.useState("");async function v(){var s,r;y(!0),d("");try{const t=await h.listTypes(i);o(Array.isArray(t)?t:[])}catch(t){d(((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.error)||t.message||"Failed to load.")}finally{y(!1)}}n.useEffect(()=>{v()},[i]);const N=n.useMemo(()=>{const s=l.trim().toLowerCase();return s?u.filter(r=>Object.values(r).some(t=>String(t??"").toLowerCase().includes(s))):u},[u,l]);async function w(){var s,r;p(!0),d("");try{const t=await h.createType({category:i,name:"",code:""});o(a=>[t,...a])}catch(t){d(((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.error)||t.message)}finally{p(!1)}}async function C(s){var r,t;p(!0),d("");try{const a={...s,category:i},f=s.id?await h.updateType(s.id,a):await h.createType(a);o(k=>k.map(g=>g.id===f.id?f:g))}catch(a){d(((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.error)||a.message)}finally{p(!1)}}async function S(s){var r,t;if(window.confirm("Delete this item?")){p(!0),d("");try{await h.deleteType(s),o(a=>a.filter(f=>f.id!==s))}catch(a){d(((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.error)||a.message)}finally{p(!1)}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border dark:border-slate-800 rounded-2xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:c}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Category: ",i]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{placeholder:"Search…",className:"px-3 py-2 text-sm rounded border",value:l,onChange:s=>m(s.target.value)}),e.jsx("button",{onClick:w,disabled:j,className:"px-3 py-2 text-sm rounded bg-blue-600 text-white",children:"+ Add"})]})]}),b&&e.jsx("div",{className:"text-sm text-rose-600",children:b}),x?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):N.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No items found."}):e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Code"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Active"}),e.jsx("th",{className:"px-3 py-2 w-36"})]})}),e.jsx("tbody",{children:N.map((s,r)=>e.jsx(A,{row:s,onSave:C,onDelete:S,saving:j},s.id??`tmp-${r}`))})]})})]})}function A({row:c,onSave:i,onDelete:u,saving:o}){const[l,m]=n.useState(c);return n.useEffect(()=>m(c),[c]),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{className:"w-full px-2 py-1 rounded border",value:l.name??"",onChange:x=>m({...l,name:x.target.value})})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{className:"w-full px-2 py-1 rounded border",value:l.code??"",onChange:x=>m({...l,code:x.target.value})})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"checkbox",checked:!!l.active,onChange:x=>m({...l,active:x.target.checked})})}),e.jsxs("td",{className:"px-3 py-2 text-right",children:[e.jsx("button",{onClick:()=>i(l),disabled:o,className:"px-2 py-1 text-xs rounded bg-emerald-600 text-white mr-2",children:"Save"}),c.id&&e.jsx("button",{onClick:()=>u(c.id),disabled:o,className:"px-2 py-1 text-xs rounded bg-rose-600 text-white",children:"Delete"})]})]})}export{R as T};
