import{j as t,h as Te,u as Fe,i as Ue,k as Be,r as m,f as T,L as fe}from"./index-DwQaGI98.js";const w=(s,o="TZS")=>s==null||s===""?"—":`‎${o} ${Number(s||0).toLocaleString()}`,be=s=>s==null||s===""?"—":Number(s).toLocaleString(),_e=s=>s==null||s===""?"—":`${Number(s)}%`,je=s=>{var c;if(!s)return"—";const o=typeof s=="string"||typeof s=="number"?new Date(s):s;return!isNaN((c=o==null?void 0:o.getTime)==null?void 0:c.call(o))?o.toLocaleDateString():"—"},ye=(s,o="TZS",p)=>{if(s==null||s==="")return"—";try{return new Intl.NumberFormat(p,{style:"currency",currency:o,maximumFractionDigits:0}).format(Number(s||0))}catch{return`‎${o} ${Number(s||0).toLocaleString()}`}},E=(s="")=>String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");function ze(s,o){const{rows:p,headers:c,filename:h}=Array.isArray(s)?{rows:s,headers:F(s),filename:o||"export.csv"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.csv"},y=S=>String(S??"").replace(/"/g,'""'),d=c.join(","),f=p.map(S=>c.map(Z=>`"${y(S[Z])}"`).join(",")).join(`
`),g=`${d}
${f}`;ge(new Blob([g],{type:"text/csv;charset=utf-8"}),h)}function Ve(s,o){const{rows:p,headers:c,filename:h,title:y}=Array.isArray(s)?{rows:s,headers:F(s),filename:o||"export.xls"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),filename:(s==null?void 0:s.filename)||"export.xls",title:(s==null?void 0:s.title)||"Export"},d=`<h1>${E(y||"")}</h1><table border="1"><thead><tr>${c.map(g=>`<th>${E(g)}</th>`).join("")}</tr></thead><tbody>`+p.map(g=>`<tr>${c.map(S=>`<td>${E(String(g[S]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",f=new Blob([`\uFEFF${d}`],{type:"application/vnd.ms-excel"});ge(f,h)}function qe(s){const{rows:o,headers:p,title:c}=Array.isArray(s)?{rows:s,headers:F(s),title:"Export"}:{rows:(s==null?void 0:s.rows)||[],headers:(s==null?void 0:s.headers)||F((s==null?void 0:s.rows)||[]),title:(s==null?void 0:s.title)||"Export"},h=`
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; padding: 16px; }
      h1 { font-size: 16px; margin: 0 0 12px 0; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap; }
      thead { background: #f3f4f6; }
    </style>
  `,y=`<h1>${E(c)}</h1><table><thead><tr>${p.map(f=>`<th>${E(f)}</th>`).join("")}</tr></thead><tbody>`+o.map(f=>`<tr>${p.map(g=>`<td>${E(String(f[g]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",d=window.open("","_blank");d&&(d.document.write(`<html><head><title>${E(c)}</title>${h}</head><body>${y}</body></html>`),d.document.close(),d.focus(),d.print())}function Ze(s,o){return ze(s,o)}function He(s,o){return Ve(s,o)}function Ye(s,o){return qe(s)}function F(s=[]){return s[0]?Object.keys(s[0]):[]}function ge(s,o){const p=URL.createObjectURL(s),c=document.createElement("a");c.href=p,c.download=o||"export",document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(p)}function Je({page:s=1,pageSize:o=25,total:p=0,onPageChange:c,onPageSizeChange:h}){const y=Math.max(1,Math.ceil(p/o));return t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-2 py-3",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",t.jsx("span",{className:"font-medium",children:s})," of"," ",t.jsx("span",{className:"font-medium",children:y})," •"," ",t.jsx("span",{className:"font-medium",children:p})," rows"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:o,onChange:d=>h==null?void 0:h(Number(d.target.value)),"aria-label":"Rows per page",children:[10,25,50,100].map(d=>t.jsxs("option",{value:d,children:[d," / page"]},d))}),t.jsxs("div",{className:"inline-flex rounded border overflow-hidden",children:[t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50",onClick:()=>c==null?void 0:c(Math.max(1,s-1)),disabled:s<=1,"aria-label":"Previous page",children:"‹ Prev"}),t.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 border-l",onClick:()=>c==null?void 0:c(Math.min(y,s+1)),disabled:s>=y,"aria-label":"Next page",children:"Next ›"})]})]})]})}function Ke({open:s,title:o="Are you sure?",description:p="",confirmText:c="Confirm",cancelText:h="Cancel",destructive:y=!1,onConfirm:d,onClose:f}){return s?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"mt-1 w-8 h-8 rounded-full flex items-center justify-center text-white "+(y?"bg-rose-600":"bg-indigo-600"),children:"!"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold",children:o}),p&&t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:p})]}),t.jsx("button",{className:"text-gray-500 hover:text-gray-700","aria-label":"Close",onClick:f,children:"✕"})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded border",onClick:f,children:h}),t.jsx("button",{className:"px-4 py-2 rounded text-white "+(y?"bg-rose-600 hover:bg-rose-700":"bg-indigo-600 hover:bg-indigo-700"),onClick:()=>{d==null||d(),f==null||f()},children:c})]})]})}):null}const Qe=["pending","approved","rejected","disbursed","active","closed"],Ge=["pending","approved","rejected","disbursed","closed"],X={pending:"Pending Approval",approved:"Approved Loans",rejected:"Rejected Loans",disbursed:"Disbursed Loans",active:"Active Loans",closed:"Closed Loans",due:"Due Loans",missed:"Missed Repayments",arrears:"Loans in Arrears","no-repayments":"No Repayments","past-maturity":"Past Maturity Loans","principal-outstanding":"Principal Outstanding","1-month-late":"1 Month Late","3-months-late":"3 Months Late"};function Xe(){var me,xe,pe,he;const{status:s}=Te(),o=Fe(),{success:p,error:c}=Ue(),[h,y]=Be(),[d,f]=m.useState([]),[g,S]=m.useState(0),[Z,ee]=m.useState(!1),[Ne,te]=m.useState([]),[H,se]=m.useState([]),[P,ne]=m.useState(h.get("q")||""),[A,re]=m.useState(h.get("productId")||""),[L,ae]=m.useState(h.get("officerId")||""),[$,oe]=m.useState(h.get("startDate")||""),[D,ie]=m.useState(h.get("endDate")||""),[I,le]=m.useState(h.get("minAmt")||""),[R,ce]=m.useState(h.get("maxAmt")||""),we=Number(h.get("page")||1),de=Number(h.get("pageSize")||25),[M,Y]=m.useState(Math.max(1,we)),[k,ve]=m.useState([10,25,50,100].includes(de)?de:25),[Se,N]=m.useState(null),[O,U]=m.useState({open:!1,loan:null,officerId:""}),[B,J]=m.useState({open:!1,title:"",description:"",destructive:!1,onConfirm:null}),Ae=X[s]||"Loans",_=["disbursed","active"].includes(String(s||"").toLowerCase());m.useEffect(()=>{(async()=>{var e,a;try{const r=await T.get("/loan-products"),n=Array.isArray(r.data)?r.data:((e=r.data)==null?void 0:e.items)||[];te(n)}catch{te([])}try{const r=await T.get("/users",{params:{role:"loan_officer",pageSize:500}}),n=Array.isArray(r.data)?r.data:((a=r.data)==null?void 0:a.items)||[];se(n)}catch{se([])}})()},[]);const K=async(e={})=>{var a,r;ee(!0);try{const n={page:M,pageSize:k};Qe.includes(String(s))?Ge.includes(String(s))?n.status=String(s):n.scope=String(s):s&&(n.scope=s),P.trim()&&(n.q=P.trim()),A&&(n.productId=A),L&&(n.officerId=L),$&&(n.startDate=$),D&&(n.endDate=D),I&&(n.minAmount=I),R&&(n.maxAmount=R);const i=await T.get("/loans",{params:n}),u=Array.isArray(i.data)?i.data:Array.isArray((a=i.data)==null?void 0:a.items)?i.data.items:[];let x=((r=i.data)==null?void 0:r.total)??u.length,b=u;String(s).toLowerCase()==="active"&&(b=u.filter(j=>String(j.status||j.state||"").toLowerCase()==="disbursed"),x=b.length),f(b),S(x)}catch(n){console.error(n),f([]),S(0),c("Failed to load loans.")}finally{ee(!1)}if(!e.skipSyncUrl){const n=new URLSearchParams;P&&n.set("q",P),A&&n.set("productId",A),L&&n.set("officerId",L),$&&n.set("startDate",$),D&&n.set("endDate",D),I&&n.set("minAmt",I),R&&n.set("maxAmt",R),n.set("page",String(M)),n.set("pageSize",String(k)),y(n)}};m.useEffect(()=>{K({skipSyncUrl:!0}),N(null)},[s,M,k]);const C=m.useMemo(()=>{const e=$?new Date($):null,a=D?new Date(D):null;return d.filter(r=>{if(e||a){const u=r.releaseDate||r.startDate||r.disbursementDate||r.createdAt||null,x=u?new Date(u):null;if(e&&(!x||x<e)||a&&(!x||x>a))return!1}if(A&&String(r.productId)!==String(A)||L&&String(r.officerId||r.loanOfficerId)!==String(L))return!1;const n=Number(r.amount??r.principal??0);if(I&&!(n>=Number(I))||R&&!(n<=Number(R)))return!1;const i=P.trim().toLowerCase();if(i){const u=r.Borrower||r.borrower||{},x=r.Product||r.product||{};if(![u.name,u.phone,r.borrowerName,r.borrowerPhone,x.name,r.productName,r.loanNumber,r.id].filter(Boolean).join(" ").toLowerCase().includes(i))return!1}return!0})},[d,P,A,L,$,D,I,R]),ue=m.useMemo(()=>{if(g>d.length)return C;const e=(M-1)*k;return C.slice(e,e+k)},[C,M,k,d.length,g]),z=m.useMemo(()=>{let e=0,a=0,r=0,n=0,i=0;return C.forEach(u=>{const x=Number(u.outstandingPrincipal||0),b=Number(u.outstandingInterest||0),j=Number(u.outstandingFees||0),l=Number(u.outstandingPenalty||0),v=u.outstanding!=null?Number(u.outstanding):x+b+j+l;e+=x,a+=b,r+=j,n+=l,i+=v}),{p:e,i:a,f:r,pen:n,t:i}},[C]),Q=()=>C.map(e=>{const a=e.Borrower||e.borrower||{},r=e.Product||e.product||{},n=e.officer||{},i=e.currency||"TZS",u=e.releaseDate||e.startDate||e.disbursementDate||e.createdAt||null,x=e.outstandingPrincipal??null,b=e.outstandingInterest??null,j=e.outstandingFees??null,l=e.outstandingPenalty??null,v=e.outstanding!=null?e.outstanding:[x,b,j,l].every(q=>q==null)?null:Number(x||0)+Number(b||0)+Number(j||0)+Number(l||0),V=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,W=e.termMonths??e.durationMonths??null;return{Date:je(u),"Borrower Name":a.name||e.borrowerName||"","Phone Number":a.phone||e.borrowerPhone||"","Loan Product":r.name||e.productName||"","Principal Amount":`${i} ${Number(e.amount??e.principal??0)}`,"Interest Amount":`${i} ${Number(e.interestAmount??0)}`,"Outstanding Principal":`${i} ${Number(x??0)}`,"Outstanding Interest":`${i} ${Number(b??0)}`,"Outstanding Fees":`${i} ${Number(j??0)}`,"Outstanding Penalty":`${i} ${Number(l??0)}`,"Total Outstanding":`${i} ${Number(v??0)}`,"Interest Rate/Year (%)":V??"","Loan Duration (Months)":W??"","Loan Officer":e.officerName||n.name||"",Status:e.status||""}}),Le=()=>Ze(Q(),(X[s]||"loans").toLowerCase().replace(/\s+/g,"-")),$e=()=>He(Q(),(X[s]||"loans").toLowerCase().replace(/\s+/g,"-")),De=()=>Ye(Q()),Ie=e=>o(`/loans/${e}`),Re=e=>o(`/loans/${e}?edit=1`),Ce=e=>J({open:!0,destructive:!1,title:"Re-disburse this loan?",description:"You will be taken to the disbursement screen to create a new disbursement tied to this loan.",onConfirm:()=>o(`/loans/${e}/disburse`)}),Pe=e=>o(`/repayments/new?loanId=${e}`),ke=e=>J({open:!0,destructive:!1,title:"Reschedule repayments?",description:"Open the schedule tool to recompute the repayment plan for this loan.",onConfirm:()=>o(`/loans/schedule?loanId=${e}`)}),Oe=async e=>{try{const a=await T.get(`/loans/${e.id}/schedule`),r=Array.isArray(a.data)?a.data:[],n=[{label:"#",value:(l,v)=>v+1},{label:"Due Date",value:l=>l.dueDate?new Date(l.dueDate).toISOString().slice(0,10):""},{label:"Principal",value:l=>l.principal??0},{label:"Interest",value:l=>l.interest??0},{label:"Penalty",value:l=>l.penalty??0},{label:"Total",value:l=>l.total??Number(l.principal||0)+Number(l.interest||0)+Number(l.penalty||0)},{label:"Balance",value:l=>l.balance??""}],i=n.map(l=>`"${l.label.replace(/"/g,'""')}"`).join(","),u=r.map((l,v)=>n.map(V=>`"${String(V.value(l,v)??"").replace(/"/g,'""')}"`).join(",")).join(`
`),x=`${i}
${u}`,b=new Blob([x],{type:"text/csv;charset=utf-8"}),j=document.createElement("a");j.href=URL.createObjectURL(b),j.download=`loan_${e.id}_schedule.csv`,j.click(),p("Schedule downloaded.")}catch(a){console.error(a),c("Couldn't download schedule.")}},Ee=e=>U({open:!0,loan:e,officerId:(e==null?void 0:e.loanOfficerId)||(e==null?void 0:e.officerId)||""}),Me=async()=>{const{loan:e,officerId:a}=O;if(!(!e||!a))try{await T.patch(`/loans/${e.id}/assign-officer`,{userId:a}).catch(()=>T.patch(`/loans/${e.id}`,{loanOfficerId:a})),f(r=>r.map(n=>{var i;return n.id===e.id?{...n,loanOfficerId:a,officerId:a,officerName:((i=H.find(u=>String(u.id)===String(a)))==null?void 0:i.name)||n.officerName}:n})),U({open:!1,loan:null,officerId:""}),p("Loan officer assigned.")}catch(r){console.error(r),c("Failed to assign officer.")}},G=m.useRef(null);return m.useEffect(()=>{const e=a=>{G.current&&(G.current.contains(a.target)||N(null))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:Ae}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",be(g)," ",t.jsx("span",{className:"mx-2 text-gray-400",children:"•"}),t.jsx(fe,{to:"/loans",className:"text-indigo-600 underline",children:"All Loans"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{onClick:Le,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export CSV"}),t.jsx("button",{onClick:$e,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export Excel"}),t.jsx("button",{onClick:De,className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Export PDF"})]})]}),t.jsxs("div",{className:"bg-white rounded shadow border p-3",children:[t.jsxs("div",{className:"grid md:grid-cols-3 lg:grid-cols-6 gap-3",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Search (borrower / phone / product / loan #)"}),t.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"e.g. Jane, 0712…, Business Loan",value:P,onChange:e=>ne(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Product"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:A,onChange:e=>re(e.target.value),children:[t.jsx("option",{value:"",children:"All"}),Ne.map(e=>t.jsxs("option",{value:e.id,children:[e.name,e.code?` (${e.code})`:""]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Loan Officer"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:L,onChange:e=>ae(e.target.value),children:[t.jsx("option",{value:"",children:"All"}),H.map(e=>t.jsx("option",{value:e.id,children:e.name||e.email},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"From Date"}),t.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:$,onChange:e=>oe(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"To Date"}),t.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:D,onChange:e=>ie(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Min Amount"}),t.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:I,onChange:e=>le(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Max Amount"}),t.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:R,onChange:e=>ce(e.target.value)})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsx("button",{onClick:()=>{Y(1),K()},className:"px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Apply Filters"}),t.jsx("button",{onClick:()=>{ne(""),re(""),ae(""),oe(""),ie(""),le(""),ce(""),Y(1),y(new URLSearchParams),setTimeout(()=>K({skipSyncUrl:!0}),0)},className:"px-3 py-2 rounded border hover:bg-gray-50",children:"Reset"})]})]}),t.jsx("div",{className:"bg-white rounded shadow border overflow-x-auto",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50 text-gray-700",children:t.jsxs("tr",{className:"[&>th]:px-2 [&>th]:py-2 [&>th]:border",children:[t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Borrower Name"}),t.jsx("th",{children:"Phone Number"}),t.jsx("th",{children:"Loan Product"}),t.jsx("th",{children:"Principal Amount"}),t.jsx("th",{children:"Interest Amount"}),t.jsx("th",{children:"Outstanding Principal"}),t.jsx("th",{children:"Outstanding Interest"}),t.jsx("th",{children:"Outstanding Fees"}),t.jsx("th",{children:"Outstanding Penalty"}),t.jsx("th",{children:"Total Outstanding"}),t.jsx("th",{children:"Interest Rate/Year (%)"}),t.jsx("th",{children:"Loan Duration (Months)"}),t.jsx("th",{children:"Loan Officer"}),t.jsx("th",{children:"Status"}),_&&t.jsx("th",{children:"Action"})]})}),t.jsx("tbody",{ref:G,children:Z?t.jsx("tr",{children:t.jsx("td",{colSpan:15+(_?1:0),className:"p-6 text-center text-gray-500",children:"Loading…"})}):ue.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:15+(_?1:0),className:"p-6 text-center text-gray-500",children:"No loans found."})}):ue.map(e=>{const a=e.Borrower||e.borrower||{},r=e.Product||e.product||{},n=e.officer||{},i=e.currency||"TZS",u=e.releaseDate||e.startDate||e.createdAt||e.disbursementDate||null,x=e.outstandingPrincipal??null,b=e.outstandingInterest??null,j=e.outstandingFees??null,l=e.outstandingPenalty??null,v=e.outstanding!=null?e.outstanding:[x,b,j,l].every(q=>q==null)?null:Number(x||0)+Number(b||0)+Number(j||0)+Number(l||0),V=e.interestRateAnnual!=null?e.interestRateAnnual:e.interestRate!=null?e.interestRate:null,W=e.termMonths??e.durationMonths??null;return t.jsxs("tr",{className:"[&>td]:px-2 [&>td]:py-2 [&>td]:border hover:bg-gray-50",children:[t.jsx("td",{children:je(u)}),t.jsx("td",{children:a.id?t.jsx(fe,{to:`/borrowers/${a.id}`,className:"text-indigo-700 hover:underline",children:a.name||e.borrowerName||"—"}):a.name||e.borrowerName||"—"}),t.jsx("td",{children:a.phone||e.borrowerPhone||"—"}),t.jsx("td",{children:r.name||e.productName||"—"}),t.jsx("td",{children:ye(e.amount??e.principal,i)}),t.jsx("td",{children:ye(e.interestAmount,i)}),t.jsx("td",{children:w(x,i)}),t.jsx("td",{children:w(b,i)}),t.jsx("td",{children:w(j,i)}),t.jsx("td",{children:w(l,i)}),t.jsx("td",{children:w(v,i)}),t.jsx("td",{children:_e(V)}),t.jsx("td",{children:be(W)}),t.jsx("td",{children:e.officerName||n.name||"—"}),t.jsx("td",{children:e.status||"—"}),_&&t.jsx("td",{className:"whitespace-nowrap",children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"px-2 py-1 rounded border hover:bg-gray-50",onClick:()=>N(q=>q===e.id?null:e.id),children:"Actions ▾"}),Se===e.id&&t.jsxs("div",{className:"absolute right-0 mt-1 w-56 bg-white border rounded shadow-lg z-10",children:[t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),Ie(e.id)},children:"View (details & repayments)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),Re(e.id)},children:"Edit"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),Pe(e.id)},children:"Record Repayment"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:async()=>{N(null),await Oe(e)},children:"Download Schedule (CSV)"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),ke(e.id)},children:"Reschedule Repayments"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),Ce(e.id)},children:"Re-disburse"}),t.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-gray-50",onClick:()=>{N(null),Ee(e)},children:"Assign Loan Officer"})]})]})})]},e.id)})}),!Z&&C.length>0&&t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-50 font-semibold [&>td]:px-2 [&>td]:py-2 [&>td]:border",children:[t.jsx("td",{colSpan:6,className:"text-right",children:"Totals:"}),t.jsx("td",{children:w(z.p)}),t.jsx("td",{children:w(z.i)}),t.jsx("td",{children:w(z.f)}),t.jsx("td",{children:w(z.pen)}),t.jsx("td",{children:w(z.t)}),t.jsx("td",{colSpan:4+(_?1:0)})]})})]})}),t.jsx(Je,{page:M,pageSize:k,total:g||C.length,onPageChange:e=>Y(e),onPageSizeChange:e=>{ve(e),Y(1)}}),O.open&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-lg font-semibold",children:"Assign Loan Officer"}),t.jsx("button",{onClick:()=>U({open:!1,loan:null,officerId:""}),className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:"✕"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Loan:"," ",t.jsx("span",{className:"font-medium",children:((xe=(me=O.loan)==null?void 0:me.Borrower)==null?void 0:xe.name)||((pe=O.loan)==null?void 0:pe.borrowerName)||`#${(he=O.loan)==null?void 0:he.id}`})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Officer"}),t.jsxs("select",{className:"w-full border rounded px-3 py-2",value:O.officerId,onChange:e=>U(a=>({...a,officerId:e.target.value})),children:[t.jsx("option",{value:"",children:"Select officer…"}),H.map(e=>t.jsx("option",{value:e.id,children:e.name||e.fullName||e.email||`User ${e.id}`},e.id))]}),!H.length&&t.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No officers found. Ensure users with role “loan_officer” exist."})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>U({open:!1,loan:null,officerId:""}),className:"px-3 py-2 rounded border",children:"Cancel"}),t.jsx("button",{onClick:Me,disabled:!O.officerId,className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60",children:"Assign"})]})]})}),t.jsx(Ke,{open:B.open,title:B.title,description:B.description,destructive:B.destructive,onConfirm:B.onConfirm,onClose:()=>J(e=>({...e,open:!1}))})]})}export{Xe as default};
