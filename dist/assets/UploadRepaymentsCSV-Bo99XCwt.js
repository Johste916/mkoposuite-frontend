import{r as l,j as e,b as N}from"./index-6M8fKSo2.js";function S(){const[d,c]=l.useState(null),[i,b]=l.useState(!0),[p,u]=l.useState(!1),[m,r]=l.useState(null),[x,o]=l.useState(""),y=t=>{var s;c(((s=t.target.files)==null?void 0:s[0])||null),r(null),o("")},f=async t=>{var s,n,h;if((s=t==null?void 0:t.preventDefault)==null||s.call(t),!d)return alert("Select a CSV file first.");u(!0),o(""),r(null);try{const a=new FormData;a.append("file",d),a.append("dryRun",String(!!i));const{data:v}=await N.post("/repayments/upload-csv",a,{headers:{"Content-Type":"multipart/form-data"}});r(v||{ok:!0})}catch(a){o(((h=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:h.error)||"Upload failed")}finally{u(!1)}},j=`loanRef,amount,date,method,reference,notes
L-10001,150000,2025-08-01,mobile_money,MPESA-ABC123,August part-payment
L-10002,80000,2025-08-02,bank,DRN-89231,Branch cash deposit
`,g=()=>{const t=new Blob([j],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download="repayments_sample.csv",n.click(),URL.revokeObjectURL(s)};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Upload Repayments (CSV)"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Upload repayments in bulk. Columns supported: ",e.jsx("code",{children:"loanRef"})," (or ",e.jsx("code",{children:"loanId"}),"),",e.jsx("code",{children:"amount"}),", ",e.jsx("code",{children:"date"})," (YYYY-MM-DD), ",e.jsx("code",{children:"method"}),", ",e.jsx("code",{children:"reference"}),", ",e.jsx("code",{children:"notes"}),"."]})]}),e.jsx("button",{onClick:g,className:"px-3 py-2 rounded border hover:bg-gray-50 text-sm",children:"Download Sample CSV"})]}),e.jsxs("form",{onSubmit:f,className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",onChange:y}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:t=>b(t.target.checked)}),"Dry run (validate only)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:!d||p,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:p?"Uploadingâ€¦":"Upload"}),e.jsx("button",{type:"button",className:"px-3 py-2 rounded border hover:bg-gray-50",onClick:()=>{c(null),r(null),o("")},children:"Reset"})]})]}),x&&e.jsx("div",{className:"mt-4 p-3 rounded bg-red-50 text-red-700 text-sm border border-red-200",children:x}),m&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold",children:"Result"}),e.jsx("pre",{className:"mt-2 p-3 text-sm bg-gray-50 dark:bg-gray-900 rounded border overflow-auto",children:JSON.stringify(m,null,2)})]})]})})}export{S as default};
