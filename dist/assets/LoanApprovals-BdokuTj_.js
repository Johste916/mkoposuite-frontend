import{j as t}from"./index-_x_s48EO.js";import{u as v}from"./useSettingsResource-CVHe-rNP.js";import{S as p}from"./settings-4dZm6S1f.js";import"./index-cmtW-csE.js";const b=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function k(){const{data:n,setData:o,loading:u,saving:d,error:i,success:m,save:x}=v(p.getLoanApprovals,p.saveLoanApprovals,{workflows:[]}),h=()=>o(a=>({...a,workflows:[...a.workflows||[],{id:b(),name:"Default flow",mode:"straight",productIds:[],branchIds:[],approverRoles:["manager"],minAmount:null,maxAmount:null,active:!0}]})),s=(a,e)=>o(r=>({...r,workflows:(r.workflows||[]).map(l=>l.id===a?{...l,...e}:l)})),g=a=>o(e=>({...e,workflows:(e.workflows||[]).filter(r=>r.id!==a)})),c=a=>a.split(",").map(e=>e.trim()).filter(Boolean).map(e=>Number(e)).filter(e=>!Number.isNaN(e));return u?t.jsx("div",{className:"p-4 text-sm text-slate-500",children:"Loading…"}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Manage Loan Status and Approvals"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Define approval flows per product/branch and amount ranges."})]}),i&&t.jsx("div",{className:"text-sm text-rose-600",children:i}),m&&t.jsx("div",{className:"text-sm text-emerald-600",children:m}),t.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[t.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:h,children:"Add Workflow"}),(n.workflows||[]).length===0?t.jsx("div",{className:"text-sm text-slate-500",children:"No workflows yet."}):t.jsx("div",{className:"space-y-3",children:n.workflows.map(a=>t.jsxs("div",{className:"p-3 border rounded-lg grid grid-cols-1 md:grid-cols-7 gap-2",children:[t.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Name",value:a.name||"",onChange:e=>s(a.id,{name:e.target.value})}),t.jsxs("select",{className:"rounded border px-3 py-2 text-sm",value:a.mode||"straight",onChange:e=>s(a.id,{mode:e.target.value}),children:[t.jsx("option",{value:"straight",children:"Straight (auto)"}),t.jsx("option",{value:"approval",children:"Requires approval"})]}),t.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Product IDs (comma)",value:(a.productIds||[]).join(","),onChange:e=>s(a.id,{productIds:c(e.target.value)})}),t.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Branch IDs (comma)",value:(a.branchIds||[]).join(","),onChange:e=>s(a.id,{branchIds:c(e.target.value)})}),t.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"Approver roles (comma)",value:(a.approverRoles||[]).join(","),onChange:e=>s(a.id,{approverRoles:e.target.value.split(",").map(r=>r.trim()).filter(Boolean)})}),t.jsx("input",{type:"number",className:"rounded border px-3 py-2 text-sm",placeholder:"Min amount",value:a.minAmount??"",onChange:e=>s(a.id,{minAmount:e.target.value===""?null:Number(e.target.value)})}),t.jsx("input",{type:"number",className:"rounded border px-3 py-2 text-sm",placeholder:"Max amount",value:a.maxAmount??"",onChange:e=>s(a.id,{maxAmount:e.target.value===""?null:Number(e.target.value)})}),t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:!!a.active,onChange:e=>s(a.id,{active:e.target.checked})}),"Active"]}),t.jsx("div",{className:"md:col-span-7 flex items-center gap-2",children:t.jsx("button",{className:"px-3 py-1.5 rounded bg-rose-50 text-rose-700",onClick:()=>g(a.id),children:"Delete"})})]},a.id))})]}),t.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm",disabled:d,onClick:()=>x(),children:d?"Saving…":"Save"})]})}export{k as default};
