import{r as n,h as C,j as e,L as z}from"./index-CM-KCFgk.js";import{D as $}from"./download-dYR87vqd.js";import{R as J}from"./refresh-cw-B2J9gkQa.js";import{F as K,S as X}from"./search-MZzeLNz6.js";import{C as ee}from"./chevron-down-THrM9YTJ.js";import{C as te}from"./calendar-DWeJN5ja.js";import"./createLucideIcon-0iXvqnlf.js";const s={page:"w-full px-4 md:px-6 lg:px-8 py-6 bg-[var(--bg)] text-[var(--fg)]",h1:"text-2xl md:text-3xl font-extrabold tracking-tight",sub:"text-sm text-[var(--muted)]",card:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",tableWrap:"overflow-x-auto rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",th:"sticky top-0 z-10 bg-[var(--table-head-bg)] text-left text-[12px] md:text-[13px] uppercase tracking-wide font-semibold px-3 py-2 border border-[var(--border)] text-[var(--fg)]/95",td:"px-3 py-2 border border-[var(--border)] text-sm text-[var(--fg)] align-top",btn:"inline-flex items-center gap-2 rounded-lg px-3 py-2 font-semibold border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)] hover:bg-[var(--chip-soft)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)] disabled:opacity-60",primary:"inline-flex items-center gap-2 rounded-lg px-3 py-2 font-semibold bg-[var(--primary)] text-[var(--primary-contrast)] hover:brightness-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)] disabled:opacity-60",input:"h-10 w-full rounded-lg text-sm outline-none border-2 bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)] placeholder:text-[var(--input-placeholder)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]"},q="h-10 w-full rounded-lg text-sm outline-none border-2 bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)] placeholder:text-[var(--input-placeholder)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]",k=({className:a="",children:l,...i})=>e.jsxs("div",{className:`relative ${a}`,children:[e.jsx("select",{...i,className:`${q} pr-9 appearance-none bg-none ms-select`,children:l}),e.jsx(ee,{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--muted)]","aria-hidden":"true"})]}),U=({className:a="",...l})=>e.jsxs("div",{className:`relative ${a}`,children:[e.jsx("input",{type:"date",...l,className:`${q} pr-9 appearance-none bg-none ms-date`}),e.jsx(te,{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--muted)]","aria-hidden":"true"})]}),F=a=>Array.isArray(a)?a:Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a==null?void 0:a.rows)?a.rows:Array.isArray(a==null?void 0:a.results)?a.results:[];function de(){const[a,l]=n.useState(!0),[i,B]=n.useState([]),[m,V]=n.useState(0),[u,P]=n.useState(""),[p,M]=n.useState(""),[x,L]=n.useState(""),[b,D]=n.useState(""),[h,O]=n.useState(""),[g,R]=n.useState(""),[v,I]=n.useState(""),[W,Y]=n.useState([]),[Z,Q]=n.useState([]),[f,j]=n.useState(1),[d,G]=n.useState(25),T=n.useCallback(async()=>{const[t,o]=await Promise.all([C.get("/loan-products").catch(()=>({data:[]})),C.get("/users?role=loan_officer").catch(()=>({data:[]}))]);Y(F(t.data)),Q(F(o.data))},[]),y=n.useCallback(async()=>{var t,o,S;l(!0);try{const r=await C.get("/loans/disbursed",{params:{page:f,pageSize:d,q:u||void 0,productId:p||void 0,officerId:x||void 0,dateFrom:b||void 0,dateTo:h||void 0,minAmount:g||void 0,maxAmount:v||void 0}}),N=F(((t=r==null?void 0:r.data)==null?void 0:t.items)||(r==null?void 0:r.data)),w=Number(((o=r==null?void 0:r.data)==null?void 0:o.total)??((S=r==null?void 0:r.data)==null?void 0:S.totalCount)??N.length)||0;B(N),V(w)}finally{l(!1)}},[f,d,u,p,x,b,h,g,v]);n.useEffect(()=>{T().catch(()=>{})},[T]),n.useEffect(()=>{y().catch(()=>{})},[y]);const E=()=>{P(""),M(""),L(""),D(""),O(""),R(""),I(""),j(1)},A=async t=>{const o=await C.get("/loans/disbursed/export",{params:{format:t,q:u,productId:p,officerId:x,dateFrom:b,dateTo:h,minAmount:g,maxAmount:v},responseType:"blob"}),S=t==="pdf"?"application/pdf":t==="xlsx"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"text/csv",r=new Blob([o.data],{type:S}),N=URL.createObjectURL(r),w=document.createElement("a");w.href=N,w.download=`disbursed_loans.${t==="pdf"?"pdf":t}`,w.click(),URL.revokeObjectURL(N)},H=u||p||x||b||h||g||v;return e.jsxs("div",{className:s.page,children:[e.jsx("style",{children:`
        select.ms-select{ -webkit-appearance:none; -moz-appearance:none; appearance:none; background-image:none!important; }
        select.ms-select::-ms-expand{ display:none; }
        input.ms-date[type="date"]{ -webkit-appearance:none; appearance:none; background-image:none!important; }
        input.ms-date[type="date"]::-webkit-calendar-picker-indicator{ opacity:0; display:none; }
      `}),e.jsxs("div",{className:"mb-5 flex flex-col md:flex-row md:items-end md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:s.h1,children:"Disbursed Loans"}),e.jsxs("p",{className:s.sub,children:[m.toLocaleString()," total"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:s.btn,onClick:()=>A("csv"),children:[e.jsx($,{className:"w-4 h-4"})," CSV"]}),e.jsxs("button",{className:s.btn,onClick:()=>A("xlsx"),children:[e.jsx($,{className:"w-4 h-4"})," Excel"]}),e.jsxs("button",{className:s.btn,onClick:()=>A("pdf"),children:[e.jsx($,{className:"w-4 h-4"})," PDF"]}),e.jsxs("button",{className:s.btn,onClick:()=>y(),children:[e.jsx(J,{className:"w-4 h-4"})," Refresh"]})]})]}),e.jsxs("section",{className:`${s.card} p-4 md:p-5 mb-5`,"aria-label":"Filters",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(K,{className:"w-4 h-4 text-[var(--muted)]","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-semibold",children:"Filters"}),H&&e.jsx("button",{className:"ml-auto text-sm underline decoration-2 underline-offset-2 hover:opacity-90",onClick:E,children:"Clear all"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-3",children:[e.jsx("div",{className:"col-span-12 lg:col-span-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--muted)]","aria-hidden":"true"}),e.jsx("input",{className:`${s.input} pl-8`,placeholder:"Search borrower / phone / product / loan #",value:u,onChange:t=>P(t.target.value),"aria-label":"Search"})]})}),e.jsx("div",{className:"col-span-12 sm:col-span-4 lg:col-span-2",children:e.jsxs(k,{value:p,onChange:t=>M(t.target.value),"aria-label":"Product",children:[e.jsx("option",{value:"",children:"Product: All"}),W.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"col-span-12 sm:col-span-4 lg:col-span-2",children:e.jsxs(k,{value:x,onChange:t=>L(t.target.value),"aria-label":"Officer",children:[e.jsx("option",{value:"",children:"Officer: All"}),Z.map(t=>e.jsx("option",{value:t.id,children:t.name||t.email},t.id))]})}),e.jsx("div",{className:"col-span-6 sm:col-span-2",children:e.jsx(U,{value:b,onChange:t=>D(t.target.value),"aria-label":"Start date"})}),e.jsx("div",{className:"col-span-6 sm:col-span-2",children:e.jsx(U,{value:h,onChange:t=>O(t.target.value),"aria-label":"End date"})}),e.jsx("div",{className:"col-span-6 sm:col-span-2",children:e.jsx("input",{className:s.input,placeholder:"Min Amount",type:"number",min:"0",step:"0.01",value:g,onChange:t=>R(t.target.value),"aria-label":"Minimum amount"})}),e.jsx("div",{className:"col-span-6 sm:col-span-2",children:e.jsx("input",{className:s.input,placeholder:"Max Amount",type:"number",min:"0",step:"0.01",value:v,onChange:t=>I(t.target.value),"aria-label":"Maximum amount"})}),e.jsxs("div",{className:"col-span-12 flex gap-2 pt-1",children:[e.jsx("button",{className:s.primary,onClick:()=>{j(1),y()},children:"Apply Filters"}),e.jsx("button",{className:s.btn,onClick:E,children:"Reset"})]})]})]}),e.jsx("section",{className:s.tableWrap,"aria-label":"Results table",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsx("tr",{children:["Date","Borrower","Phone","Loan Product","Principal","Interest","Outstanding Principal","Outstanding Interest","Outstanding Fees","Outstanding Penalty","Total Outstanding","Interest/Year %","Duration (months)","Loan Officer","Status","Action"].map(t=>e.jsx("th",{className:s.th,children:t},t))})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:`${s.td} text-[var(--muted)]`,children:"Loading…"})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:16,className:`${s.td} text-[var(--muted)]`,children:"No disbursed loans found."})}):i.map((t,o)=>e.jsxs("tr",{className:`transition-colors ${o%2===0?"bg-[var(--table-row-even)]":"bg-[var(--table-row-odd)]"} hover:bg-[var(--chip-soft)]`,children:[e.jsx("td",{className:s.td,children:t.date||t.disbursedAt||"—"}),e.jsx("td",{className:s.td,children:t.borrowerId?e.jsx(z,{className:"underline decoration-2 underline-offset-2 hover:opacity-90",to:`/borrowers/${t.borrowerId}`,children:t.borrowerName}):t.borrowerName||"—"}),e.jsx("td",{className:s.td,children:t.borrowerPhone||"—"}),e.jsx("td",{className:s.td,children:t.productName||"—"}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.principal)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.interestAmount)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.outstandingPrincipal)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.outstandingInterest)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.outstandingFees)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:c(t.outstandingPenalty)}),e.jsx("td",{className:`${s.td} text-right font-semibold tabular-nums`,children:c(t.totalOutstanding)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:_(t.interestRateYear)}),e.jsx("td",{className:`${s.td} text-right tabular-nums`,children:_(t.durationMonths)}),e.jsx("td",{className:s.td,children:t.officerName||"—"}),e.jsx("td",{className:s.td,children:(t.status||"—").replaceAll("_"," ")}),e.jsx("td",{className:s.td,children:e.jsx(z,{className:`${s.btn} h-9`,to:`/loans/${t.id}`,children:"View"})})]},t.id))})]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm text-[var(--muted)]",children:["Page ",f," of ",Math.max(1,Math.ceil((m||0)/d))," • ",m.toLocaleString()," total"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{value:d,onChange:t=>{G(Number(t.target.value)),j(1)},className:"w-[140px]","aria-label":"Rows per page",children:[10,25,50,100].map(t=>e.jsxs("option",{value:t,children:[t," / page"]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:s.btn,onClick:()=>j(t=>Math.max(1,t-1)),disabled:f<=1,children:"Prev"}),e.jsx("button",{className:s.btn,onClick:()=>j(t=>Math.min(Math.max(1,Math.ceil((m||0)/d)),t+1)),disabled:f>=Math.max(1,Math.ceil((m||0)/d)),children:"Next"})]})]})]})]})}function _(a){const l=Number(a);return Number.isFinite(l)?l:"—"}const se=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function c(a,l="TZS"){const i=Number(a||0);return!Number.isFinite(i)||i<=0?"—":`${l} ${se.format(i)}`}export{de as default};
