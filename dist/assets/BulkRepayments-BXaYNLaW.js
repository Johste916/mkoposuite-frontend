import{r as d,j as e,b as y}from"./index-6M8fKSo2.js";const f=()=>new Date().toISOString().slice(0,10),m=()=>({loanId:"",amount:"",date:f(),method:"cash",reference:"",notes:""});function k(){const[o,r]=d.useState([m()]),[u,h]=d.useState(!1),[p,c]=d.useState(null),[x,i]=d.useState(""),n=(a,l,s)=>r(t=>t.map((b,v)=>v===a?{...b,[l]:s}:b)),j=()=>r(a=>[...a,m()]),g=a=>r(l=>l.filter((s,t)=>t!==a)),N=async()=>{var l,s;const a=o.map(t=>({loanId:t.loanId?Number(t.loanId):void 0,amount:Number(t.amount||0),date:t.date,method:t.method,reference:t.reference||void 0,notes:t.notes||void 0})).filter(t=>t.loanId&&t.amount>0&&t.date);if(!a.length)return alert("Fill at least one valid row.");h(!0),i(""),c(null);try{const{data:t}=await y.post("/repayments/bulk",{items:a});c(t||{ok:!0})}catch(t){i(((s=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:s.error)||"Bulk posting failed")}finally{h(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Add Bulk Repayments"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Enter multiple repayments and submit in a single batch."}),e.jsx("div",{className:"overflow-x-auto border rounded-xl mt-4",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"p-3 text-left",children:"Loan ID"}),e.jsx("th",{className:"p-3 text-left",children:"Date"}),e.jsx("th",{className:"p-3 text-left",children:"Amount"}),e.jsx("th",{className:"p-3 text-left",children:"Method"}),e.jsx("th",{className:"p-3 text-left",children:"Reference"}),e.jsx("th",{className:"p-3 text-left",children:"Notes"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[o.map((a,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-28",value:a.loanId,onChange:s=>n(l,"loanId",s.target.value),placeholder:"123"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"date",className:"border rounded px-2 py-1",value:a.date,onChange:s=>n(l,"date",s.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",min:"0.01",step:"0.01",className:"border rounded px-2 py-1 w-28",value:a.amount,onChange:s=>n(l,"amount",s.target.value),placeholder:"0.00"})}),e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"border rounded px-2 py-1",value:a.method,onChange:s=>n(l,"method",s.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"adjustment",children:"Adjustment"})]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1",value:a.reference,onChange:s=>n(l,"reference",s.target.value),placeholder:"MPESA-… / Bank txn"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"border rounded px-2 py-1 w-64",value:a.notes,onChange:s=>n(l,"notes",s.target.value),placeholder:"optional"})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 rounded border hover:bg-gray-50",onClick:()=>g(l),disabled:o.length===1,children:"Remove"})})]},l)),e.jsx("tr",{className:"border-t",children:e.jsx("td",{colSpan:7,className:"p-3",children:e.jsx("button",{className:"px-3 py-1.5 rounded border hover:bg-gray-50",onClick:j,children:"+ Add Row"})})})]})]})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:N,disabled:u,className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:u?"Submitting…":"Submit Bulk"}),e.jsx("button",{className:"px-3 py-2 rounded border hover:bg-gray-50",onClick:()=>{r([m()]),c(null),i("")},children:"Reset"})]}),x&&e.jsx("div",{className:"mt-4 p-3 rounded bg-red-50 text-red-700 text-sm border border-red-200",children:x}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold",children:"Result"}),e.jsx("pre",{className:"mt-2 p-3 text-sm bg-gray-50 dark:bg-gray-900 rounded border overflow-auto",children:JSON.stringify(p,null,2)})]})]})})}export{k as default};
