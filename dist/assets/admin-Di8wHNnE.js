import{r as j,j as e}from"./index-BVbJtkKt.js";import{a as p}from"./index-DbICIDaE.js";function D({title:t="Templates",loader:n,creator:c,updater:g,remover:u,fields:r={}}){const[m,x]=j.useState([]),[f,i]=j.useState(""),[v,w]=j.useState(!1),[b,y]=j.useState({name:"",subject:"",text:"",channel:r.fixedChannel||""});async function N(){var s,l,d;i("");try{const a=await n();x(Array.isArray(a)?a:a?[a]:[])}catch(a){console.warn(`${t}: failed to load`,(s=a==null?void 0:a.response)==null?void 0:s.status,(l=a==null?void 0:a.response)==null?void 0:l.data),x([]),((d=a==null?void 0:a.response)==null?void 0:d.status)===401&&i("You are not authorized. Please sign in again.")}}j.useEffect(()=>{N()},[]);async function S(){var a,o;i("");const{name:s,subject:l,text:d}=b;if(!s.trim()||!d.trim()){i("name and text are required");return}w(!0);try{const h={name:s.trim(),...r.showSubject?{subject:l.trim()}:{},text:d.trim(),body:d.trim(),...r.fixedChannel?{channel:r.fixedChannel}:{}};await c(h),y(k=>({...k,name:"",subject:"",text:""})),await N()}catch(h){i(((o=(a=h==null?void 0:h.response)==null?void 0:a.data)==null?void 0:o.error)||h.message||"Create failed")}finally{w(!1)}}async function C(s,l){var d,a;i("");try{const o={...l,...l.text?{body:l.text}:{}};await g(s,o),await N()}catch(o){i(((a=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:a.error)||o.message||"Save failed")}}async function T(s){var l,d;if(confirm("Delete this item?")){i("");try{await u(s),await N()}catch(a){i(((d=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:d.error)||a.message||"Delete failed")}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:t}),f&&e.jsx("div",{className:"text-sm text-rose-600",children:f}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Name"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:b.name,onChange:s=>y(l=>({...l,name:s.target.value})),placeholder:"Welcome template"})]}),r.showSubject&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Subject"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:b.subject,onChange:s=>y(l=>({...l,subject:s.target.value})),placeholder:"Welcome to MkopoSuite"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs mb-1",children:"Text"}),e.jsx("textarea",{className:"w-full min-h-[120px] border rounded px-2 py-1 text-sm",value:b.text,onChange:s=>y(l=>({...l,text:s.target.value})),placeholder:"Hello {{name}}, …"})]}),e.jsx("div",{children:e.jsx("button",{onClick:S,disabled:v,className:"px-3 py-2 border rounded bg-white disabled:opacity-60",children:v?"Saving…":"Add"})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),r.showSubject&&e.jsx("th",{className:"p-2 text-left",children:"Subject"}),e.jsx("th",{className:"p-2 text-left",children:"Preview"}),e.jsx("th",{className:"p-2 w-[1%]"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-slate-500",colSpan:r.showSubject?4:3,children:"No items"})}):m.map(s=>e.jsx(A,{row:s,showSubject:!!r.showSubject,onSave:C,onDelete:T},s.id||s._id||s.name))})]})})]})}function A({row:t,showSubject:n,onSave:c,onDelete:g}){const[u,r]=j.useState({name:t.name||"",subject:t.subject||"",text:t.text||t.body||""});return e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full border rounded px-2 py-1",value:u.name,onChange:m=>r(x=>({...x,name:m.target.value}))})}),n&&e.jsx("td",{className:"p-2",children:e.jsx("input",{className:"w-full border rounded px-2 py-1",value:u.subject,onChange:m=>r(x=>({...x,subject:m.target.value}))})}),e.jsx("td",{className:"p-2",children:e.jsx("textarea",{className:"w-full min-h-[90px] border rounded px-2 py-1",value:u.text,onChange:m=>r(x=>({...x,text:m.target.value}))})}),e.jsxs("td",{className:"p-2 text-right space-x-2",children:[e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>c(t.id||t._id,u),children:"Save"}),e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>g(t.id||t._id),children:"Delete"})]})]})}const P={listTypes:(t,n={})=>p.get("/api/admin/types",{params:{category:t,...n}}).then(c=>c.data),createType:t=>p.post("/api/admin/types",t).then(n=>n.data),updateType:(t,n)=>p.put(`/api/admin/types/${t}`,n).then(c=>c.data),deleteType:t=>p.delete(`/api/admin/types/${t}`).then(n=>n.data),listTemplates:(t,n={})=>p.get("/api/admin/templates",{params:{channel:t,...n}}).then(c=>c.data),createTemplate:t=>p.post("/api/admin/templates",t).then(n=>n.data),updateTemplate:(t,n)=>p.put(`/api/admin/templates/${t}`,n).then(c=>c.data),deleteTemplate:t=>p.delete(`/api/admin/templates/${t}`).then(n=>n.data)};export{P as A,D as T};
