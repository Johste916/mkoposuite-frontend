import{r as b,g as c,j as e,L as H}from"./index-DUtn1vUj.js";const oe=["Africa/Nairobi","Africa/Dar_es_Salaam","Africa/Kampala","Africa/Addis_Ababa","Africa/Kigali","UTC"],ie=["en","sw","fr"];function me(){var F,R,I,z,L,B,U,O,_,K,Z,G,J,W,$;const[o,v]=b.useState(null),[i,w]=b.useState([]),[l,r]=b.useState({displayName:"",name:"",phone:"",branchId:"",timezone:"Africa/Nairobi",locale:"en",title:"",department:"",employeeCode:""}),[d,u]=b.useState({landingPage:"/dashboard",defaultCurrency:"TZS",dateFormat:"DD/MM/YYYY",numberFormat:"1,234.56",theme:"system",fontScale:"normal",reduceMotion:!1,colorBlindMode:!1}),[m,h]=b.useState({channels:{inApp:!0,email:!0,sms:!1},events:{loanAssigned:!0,approvalNeeded:!0,largeRepayment:{enabled:!0,threshold:5e5},arrearsDigest:{enabled:!0,days:7,hour:18},kycAssigned:!0}}),[ce,A]=b.useState([]),[C,j]=b.useState(!1),T=b.useMemo(()=>{var a;return((a=o==null?void 0:o.user)==null?void 0:a.avatarUrl)||""},[o]);b.useEffect(()=>{const a=new AbortController;return(async()=>{var s,t,f;try{const[g,D,M,re,P]=await Promise.all([c.get("/account/me",{signal:a.signal}),c.get("/account/preferences",{signal:a.signal}),c.get("/account/notifications",{signal:a.signal}),c.get("/account/security/sessions",{signal:a.signal}),c.get("/branches",{signal:a.signal}).catch(()=>({data:[]}))]);v(g.data);const p=((s=g.data)==null?void 0:s.user)||{};r(S=>({...S,displayName:p.displayName||p.name||"",name:p.name||"",phone:p.phone||"",branchId:p.branchId||"",timezone:p.timezone||S.timezone,locale:p.locale||S.locale,title:p.title||"",department:p.department||"",employeeCode:p.employeeCode||""})),u(S=>{var k;return{...S,...((k=D.data)==null?void 0:k.preferences)||{}}}),h(S=>{var k;return{...S,...((k=M.data)==null?void 0:k.notifications)||{}}}),A(((t=re.data)==null?void 0:t.sessions)||[]),w(Array.isArray(P.data)?P.data:((f=P.data)==null?void 0:f.items)||[])}catch(g){console.error("Failed to load profile:",(g==null?void 0:g.message)||g)}})(),()=>a.abort()},[]);const q=async()=>{var a;j(!0);try{const s={displayName:l.displayName,name:l.name,phone:l.phone,timezone:l.timezone,locale:l.locale,branchId:l.branchId||null,title:l.title,department:l.department,employeeCode:l.employeeCode},t=await c.put("/account/me",s);v({user:((a=t.data)==null?void 0:a.user)||{}}),n("Saved profile")}catch{n("Failed to save profile","error")}finally{j(!1)}},Q=async()=>{j(!0);try{await c.put("/account/preferences",d),n("Saved preferences")}catch{n("Failed to save preferences","error")}finally{j(!1)}},V=async()=>{j(!0);try{await c.put("/account/notifications",m),n("Saved notifications")}catch{n("Failed to save notifications","error")}finally{j(!1)}},X=async()=>{j(!0);try{await c.post("/account/security/sessions/revoke-all"),A([]),n("Signed out from other devices")}catch{n("Failed to revoke sessions","error")}finally{j(!1)}},ee=async a=>{var f;const s=(f=a.target.files)==null?void 0:f[0];if(!s)return;if(s.size>2*1024*1024)return n("Image too large (max 2MB)","error");const t=new FormData;t.append("avatar",s);try{const g=await c.post("/account/avatar",t,{headers:{"Content-Type":"multipart/form-data"}});v(D=>{var M;return{...D||{},user:{...(D==null?void 0:D.user)||{},avatarUrl:((M=g.data)==null?void 0:M.avatarUrl)||""}}}),n("Avatar updated")}catch{n("Failed to upload avatar","error")}finally{a.target.value=""}},ae=async()=>{try{await c.post("/account/security/mute"),n("Profile muted (notifications suppressed)")}catch{n("Mute not available on this server","error")}},se=async()=>{if(window.confirm("Disable this profile? You will be signed out and an admin must re-enable it."))try{await c.post("/account/security/disable"),n("Profile disabled")}catch{n("Disable not available on this server","error")}},le=async()=>{if(window.prompt("Type DELETE to permanently remove your profile. This cannot be undone.")==="DELETE")try{await c.delete("/account"),n("Profile deleted")}catch{n("Delete not available on this server","error")}},[te,E]=b.useState([]);function n(a,s="ok"){const t=Math.random().toString(36).slice(2);E(f=>[...f,{id:t,msg:a,type:s}]),setTimeout(()=>E(f=>f.filter(g=>g.id!==t)),2500)}const Y=(o==null?void 0:o.user)||{},ne=(Y.displayName||Y.name||"S").split(" ").map(a=>a[0]).join("").slice(0,2).toUpperCase();return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"fixed right-4 top-4 z-50 space-y-2",children:te.map(a=>e.jsx("div",{className:`px-3 py-2 rounded shadow text-sm text-white ${a.type==="error"?"bg-rose-600":"bg-emerald-600"}`,children:a.msg},a.id))}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Identity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(x,{label:"Display name",value:l.displayName,onChange:a=>r(s=>({...s,displayName:a}))}),e.jsx(x,{label:"Full name",value:l.name,onChange:a=>r(s=>({...s,name:a}))}),e.jsx(x,{label:"Email",value:Y.email||"",readOnly:!0,helper:"Email is managed by your admin."}),e.jsx(x,{label:"Phone",value:l.phone,onChange:a=>r(s=>({...s,phone:a})),placeholder:"+2547…"}),e.jsx(N,{label:"Default branch",value:String(l.branchId||""),onChange:a=>r(s=>({...s,branchId:a||""})),options:[{value:"",label:"—"},...i.map(a=>({value:String(a.id),label:a.name}))]}),e.jsx(N,{label:"Time zone",value:l.timezone,onChange:a=>r(s=>({...s,timezone:a})),options:oe.map(a=>({value:a,label:a}))}),e.jsx(N,{label:"Locale",value:l.locale,onChange:a=>r(s=>({...s,locale:a})),options:ie.map(a=>({value:a,label:a}))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Professional"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(x,{label:"Job title",value:l.title,onChange:a=>r(s=>({...s,title:a}))}),e.jsx(x,{label:"Department",value:l.department,onChange:a=>r(s=>({...s,department:a}))}),e.jsx(x,{label:"Employee ID",value:l.employeeCode,onChange:a=>r(s=>({...s,employeeCode:a}))})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2",children:e.jsx("button",{onClick:q,disabled:C,className:"px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-60",children:C?"Saving…":"Save Changes"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(N,{label:"Default landing page",value:d.landingPage,onChange:a=>u(s=>({...s,landingPage:a})),options:[{value:"/dashboard",label:"Dashboard"},{value:"/loans",label:"Loans"},{value:"/borrowers",label:"Borrowers"},{value:"/collections",label:"Collections"}]}),e.jsx(N,{label:"Default currency",value:d.defaultCurrency,onChange:a=>u(s=>({...s,defaultCurrency:a})),options:[{value:"TZS",label:"TZS"},{value:"USD",label:"USD"},{value:"KES",label:"KES"}]}),e.jsx(N,{label:"Date format",value:d.dateFormat,onChange:a=>u(s=>({...s,dateFormat:a})),options:[{value:"DD/MM/YYYY",label:"DD/MM/YYYY"},{value:"YYYY-MM-DD",label:"YYYY-MM-DD"},{value:"MM/DD/YYYY",label:"MM/DD/YYYY"}]}),e.jsx(N,{label:"Theme",value:d.theme,onChange:a=>u(s=>({...s,theme:a})),options:[{value:"system",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]}),e.jsx(N,{label:"Font size",value:d.fontScale,onChange:a=>u(s=>({...s,fontScale:a})),options:[{value:"small",label:"Small"},{value:"normal",label:"Normal"},{value:"large",label:"Large"}]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(y,{label:"Color-blind friendly palette",checked:!!d.colorBlindMode,onChange:a=>u(s=>({...s,colorBlindMode:a}))}),e.jsx(y,{label:"Reduced motion",checked:!!d.reduceMotion,onChange:a=>u(s=>({...s,reduceMotion:a}))})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:Q,disabled:C,className:"px-3 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-900 disabled:opacity-60",children:C?"Saving…":"Save Preferences"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Notifications"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(y,{label:"In-app",checked:!!((F=m.channels)!=null&&F.inApp),onChange:a=>h(s=>({...s,channels:{...s.channels,inApp:a}}))}),e.jsx(y,{label:"Email",checked:!!((R=m.channels)!=null&&R.email),onChange:a=>h(s=>({...s,channels:{...s.channels,email:a}}))}),e.jsx(y,{label:"SMS/WhatsApp",checked:!!((I=m.channels)!=null&&I.sms),onChange:a=>h(s=>({...s,channels:{...s.channels,sms:a}}))})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(y,{label:"New loan assigned to me",checked:!!((z=m.events)!=null&&z.loanAssigned),onChange:a=>h(s=>({...s,events:{...s.events,loanAssigned:a}}))}),e.jsx(y,{label:"Approval needed (maker-checker)",checked:!!((L=m.events)!=null&&L.approvalNeeded),onChange:a=>h(s=>({...s,events:{...s.events,approvalNeeded:a}}))})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx(y,{label:"Large repayment",checked:!!((U=(B=m.events)==null?void 0:B.largeRepayment)!=null&&U.enabled),onChange:a=>h(s=>{var t;return{...s,events:{...s.events,largeRepayment:{...((t=s.events)==null?void 0:t.largeRepayment)||{},enabled:a}}}})}),e.jsx("div",{className:"mt-2",children:e.jsx(x,{label:"Threshold",type:"number",value:String(((_=(O=m.events)==null?void 0:O.largeRepayment)==null?void 0:_.threshold)??5e5),onChange:a=>h(s=>{var t;return{...s,events:{...s.events,largeRepayment:{...((t=s.events)==null?void 0:t.largeRepayment)||{},threshold:Number(a||0)}}}})})})]}),e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx(y,{label:"Arrears digest",checked:!!((Z=(K=m.events)==null?void 0:K.arrearsDigest)!=null&&Z.enabled),onChange:a=>h(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},enabled:a}}}})}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsx(x,{label:"Days",type:"number",value:String(((J=(G=m.events)==null?void 0:G.arrearsDigest)==null?void 0:J.days)??7),onChange:a=>h(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},days:Number(a||0)}}}})}),e.jsx(x,{label:"Hour (24h)",type:"number",value:String((($=(W=m.events)==null?void 0:W.arrearsDigest)==null?void 0:$.hour)??18),onChange:a=>h(s=>{var t;return{...s,events:{...s.events,arrearsDigest:{...((t=s.events)==null?void 0:t.arrearsDigest)||{},hour:Number(a||0)}}}})})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:V,disabled:C,className:"px-3 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-900 disabled:opacity-60",children:C?"Saving…":"Save Notifications"})})]}),e.jsxs("section",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Security"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(H,{to:"/2fa",className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Manage Two-Factor"}),e.jsx(H,{to:"/change-password",className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Change Password"}),e.jsx("button",{onClick:ae,className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Mute Profile"}),e.jsx("button",{onClick:se,className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Disable Profile"}),e.jsx("button",{onClick:le,className:"px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700",children:"Delete Profile"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 mb-2",children:"Active sessions"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Only this device is active."}),e.jsx("button",{onClick:X,className:"px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700",children:"Sign out of other devices"})]})]})]}),e.jsxs("aside",{className:"bg-white border rounded-2xl p-4 h-fit shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Refresh page"}),e.jsxs("div",{className:"flex items-center gap-3",children:[T?e.jsx("img",{src:T,alt:"Avatar",className:"w-14 h-14 rounded-full object-cover border"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-indigo-600 text-white flex items-center justify-center text-lg font-semibold",children:ne}),e.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:ee}),"Choose image"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"PNG/JPG/WEBP up to 2MB."})]})]})]})}function x({label:o,value:v,onChange:i,type:w="text",placeholder:l="",readOnly:r=!1,helper:d=""}){return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-slate-600",children:o}),e.jsx("input",{className:`mt-1 w-full border rounded-lg px-3 py-2 outline-none ${r?"bg-gray-50":"focus:ring-2 focus:ring-indigo-200"}`,type:w,value:v??"",placeholder:l,onChange:u=>i==null?void 0:i(u.target.value),readOnly:r}),d&&e.jsx("span",{className:"block mt-1 text-[11px] text-slate-500",children:d})]})}function N({label:o,value:v,onChange:i,options:w}){return e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-xs text-slate-600",children:o}),e.jsx("select",{className:"mt-1 w-full border rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-200",value:v??"",onChange:l=>i==null?void 0:i(l.target.value),children:w.map((l,r)=>e.jsx("option",{value:l.value,children:l.label},r))})]})}function y({label:o,checked:v,onChange:i}){return e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!v,onChange:w=>i==null?void 0:i(w.target.checked)}),e.jsx("span",{children:o})]})}export{me as default};
