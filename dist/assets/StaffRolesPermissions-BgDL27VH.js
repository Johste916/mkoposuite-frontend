import{r as i,j as e,c as y}from"./index-Dk5Cvq3D.js";const j=["borrowers:view","borrowers:edit","loans:view","loans:edit","loans:approve","repayments:view","repayments:record","reports:view","settings:view","settings:edit","users:view","users:edit"];function C(){const[l,w]=i.useState([]),[g,o]=i.useState(""),[h,u]=i.useState(!1),[d,n]=i.useState(null),[x,p]=i.useState(""),c=async()=>{var s,r;u(!0),o("");try{const a=await y.get("/roles");w(a.data||[])}catch(a){o(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.error)||a.message||"Failed to load roles")}finally{u(!1)}};i.useEffect(()=>{c()},[]);const N=async()=>{var s,r;if(x.trim()){n("new");try{await y.post("/roles",{name:x.trim(),permissions:[]}),p(""),await c()}catch(a){o(((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.error)||a.message||"Failed to create role")}finally{n(null)}}},f=async(s,r)=>{var a,m;n(s);try{await y.put(`/roles/${s}`,r),await c()}catch(b){o(((m=(a=b==null?void 0:b.response)==null?void 0:a.data)==null?void 0:m.error)||b.message||"Failed to update role")}finally{n(null)}},t=async s=>{var r,a;if(confirm("Delete this role?")){n(s);try{await y.delete(`/roles/${s}`),await c()}catch(m){o(((a=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:a.error)||m.message||"Failed to delete role")}finally{n(null)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Staff Roles & Permissions"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Control who can see and do what."})]}),g&&e.jsx("div",{className:"text-sm text-rose-600",children:g}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 flex gap-2",children:[e.jsx("input",{className:"rounded border px-3 py-2 text-sm",placeholder:"New role name",value:x,onChange:s=>p(s.target.value)}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",onClick:N,disabled:d==="new",children:d==="new"?"Creating…":"Create"})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:h?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):l.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No roles yet."}):e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsx(v,{role:s,allPerms:j,onSave:f,onDelete:t,busy:d===s.id},s.id))})})]})}function v({role:l,allPerms:w,onSave:g,onDelete:o,busy:h}){const[u,d]=i.useState(!1),[n,x]=i.useState(l.name||""),[p,c]=i.useState(Array.isArray(l.permissions)?l.permissions:[]),N=t=>c(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t]),f=async()=>{await g(l.id,{name:n.trim(),permissions:p}),d(!1)};return e.jsxs("div",{className:"p-3 border rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{disabled:!u,className:"rounded border px-3 py-2 text-sm",value:n,onChange:t=>x(t.target.value)}),u?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-blue-600 text-white",onClick:f,disabled:h,children:"Save"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:()=>{d(!1),x(l.name||""),c(Array.isArray(l.permissions)?l.permissions:[])},children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-3 py-1.5 rounded bg-slate-100",onClick:()=>d(!0),children:"Edit"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-rose-50 text-rose-700",onClick:()=>o(l.id),disabled:h,children:"Delete"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:w.map(t=>e.jsxs("label",{className:`px-2 py-1 rounded border text-sm ${p.includes(t)?"bg-blue-50 border-blue-300":"bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:p.includes(t),onChange:()=>N(t),disabled:!u}),t]},t))})]})}export{C as default};
