import{r as n,j as e}from"./index-ChU33jNq.js";import{S as i}from"./settings-DCIWR1Wf.js";function A(){const[p,N]=n.useState([]),[u,r]=n.useState(""),[y,j]=n.useState(!0),[o,m]=n.useState({title:"",channel:"email",body:""}),h=n.useRef(null),c=async()=>{var s,t;r(""),j(!0);try{const a=await i.listComms();N(Array.isArray(a)?a:[])}catch(a){r(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message)}finally{j(!1)}};n.useEffect(()=>{c()},[]);const g=async()=>{var s,t;try{await i.createComm(o),m({title:"",channel:"email",body:""}),await c()}catch(a){r(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message)}},v=async s=>{var t,a;if(confirm("Delete this communication?"))try{await i.deleteComm(s),await c()}catch(l){r(((a=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:a.error)||l.message)}},w=async s=>{var l,d,b,f;const t=(d=(l=h.current)==null?void 0:l.files)==null?void 0:d[0];if(!t)return;const a=new FormData;a.append("file",t);try{await i.addCommAttachment(s,a),h.current.value="",await c()}catch(x){r(((f=(b=x==null?void 0:x.response)==null?void 0:b.data)==null?void 0:f.error)||x.message)}};return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-6 shadow-sm space-y-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Communications"}),u&&e.jsx("div",{className:"text-sm text-rose-600",children:u}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs",children:"Title"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:o.title,onChange:s=>m(t=>({...t,title:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs",children:"Channel"}),e.jsxs("select",{className:"w-full border rounded px-2 py-1 text-sm",value:o.channel,onChange:s=>m(t=>({...t,channel:s.target.value})),children:[e.jsx("option",{value:"email",children:"email"}),e.jsx("option",{value:"sms",children:"sms"}),e.jsx("option",{value:"inapp",children:"inapp"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs",children:"Body"}),e.jsx("textarea",{rows:6,className:"w-full border rounded px-2 py-1 text-sm",value:o.body,onChange:s=>m(t=>({...t,body:s.target.value}))})]}),e.jsx("div",{children:e.jsx("button",{onClick:g,className:"px-3 py-2 border rounded bg-white",children:"Add"})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Title"}),e.jsx("th",{className:"p-2 text-left",children:"Channel"}),e.jsx("th",{className:"p-2",children:"Attachments"}),e.jsx("th",{className:"p-2"})]})}),e.jsx("tbody",{children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3",children:"Loadingâ€¦"})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3",children:"No communications"})}):p.map(s=>e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"p-2",children:s.title}),e.jsx("td",{className:"p-2",children:s.channel}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"space-y-1",children:[(s.attachments||[]).map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"underline",children:t.name||"file"}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>i.removeCommAttachment(s.id,t.id).then(c).catch(a=>{var l,d;return r(((d=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:d.error)||a.message)}),children:"Remove"})]},t.id)),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:h,type:"file",className:"text-xs"}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>w(s.id),children:"Upload"})]})]})}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{onClick:()=>v(s.id),className:"px-2 py-1 text-xs border rounded",children:"Delete"})})]},s.id))})]})})]})}export{A as default};
