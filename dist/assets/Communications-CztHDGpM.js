import{r,j as e}from"./index-BVbJtkKt.js";import{S as d}from"./settings-TYzRie5w.js";import"./index-DbICIDaE.js";const g=[{value:"inapp",label:"In-app"},{value:"email",label:"Email"},{value:"sms",label:"SMS"}],y=[{value:"notice",label:"Notice"},{value:"maintenance",label:"Maintenance"},{value:"policy",label:"Policy"}],f=[{value:"low",label:"Low"},{value:"normal",label:"Normal"},{value:"high",label:"High"},{value:"critical",label:"Critical"}];function S(){const[m,h]=r.useState([]),[x,c]=r.useState(""),[p,u]=r.useState(!1),[s,n]=r.useState({title:"",text:"",channel:"inapp",type:"notice",priority:"normal",isActive:!0,showInTicker:!0,showOnDashboard:!1,startAt:"",endAt:""});async function o(){var t,a,i;c("");try{const l=await d.listComms(),N=Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l)?l:[];h(N)}catch(l){console.warn("Failed to list communications, treating as empty.",(t=l==null?void 0:l.response)==null?void 0:t.status,(a=l==null?void 0:l.response)==null?void 0:a.data),h([]),((i=l==null?void 0:l.response)==null?void 0:i.status)===401&&c("You are not authorized. Please sign in again.")}}r.useEffect(()=>{o()},[]);const b=t=>t?new Date(t).toISOString():null;async function j(){var t,a;if(c(""),!s.title.trim()||!s.text.trim()){c("title and text are required");return}u(!0);try{await d.createComm({title:s.title.trim(),text:s.text.trim(),channel:s.channel,type:s.type,priority:s.priority,isActive:!!s.isActive,showInTicker:!!s.showInTicker,showOnDashboard:!!s.showOnDashboard,startAt:b(s.startAt),endAt:b(s.endAt)}),n(i=>({...i,title:"",text:""})),await o()}catch(i){c(((a=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:a.error)||i.message||"Failed to create communication")}finally{u(!1)}}async function v(t){var a,i;if(confirm("Delete this communication?")){c("");try{await d.deleteComm(t),await o()}catch(l){c(((i=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:i.error)||l.message||"Delete failed")}}}return e.jsxs("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Communications"}),x&&e.jsx("div",{className:"text-sm text-rose-600",children:x}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Title"}),e.jsx("input",{className:"input text-sm",value:s.title,onChange:t=>n(a=>({...a,title:t.target.value})),placeholder:"Important Notice"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Channel"}),e.jsx("select",{className:"input text-sm ms-select",value:s.channel,onChange:t=>n(a=>({...a,channel:t.target.value})),children:g.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Type"}),e.jsx("select",{className:"input text-sm ms-select",value:s.type,onChange:t=>n(a=>({...a,type:t.target.value})),children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Priority"}),e.jsx("select",{className:"input text-sm ms-select",value:s.priority,onChange:t=>n(a=>({...a,priority:t.target.value})),children:f.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs mb-1",children:"Body"}),e.jsx("textarea",{className:"input text-sm min-h-[120px]",value:s.text,onChange:t=>n(a=>({...a,text:t.target.value})),placeholder:"REMINDER: Submit weekly PAR review by Friday 4:00 PM."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 md:col-span-2",children:[e.jsxs("label",{className:"form-check text-xs inline-flex items-center gap-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:s.isActive,onChange:t=>n(a=>({...a,isActive:t.target.checked}))}),e.jsx("span",{className:"form-check-label",children:"Active"})]}),e.jsxs("label",{className:"form-check text-xs inline-flex items-center gap-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:s.showInTicker,onChange:t=>n(a=>({...a,showInTicker:t.target.checked}))}),e.jsx("span",{className:"form-check-label",children:"Show in ticker (bottom line)"})]}),e.jsxs("label",{className:"form-check text-xs inline-flex items-center gap-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:s.showOnDashboard,onChange:t=>n(a=>({...a,showOnDashboard:t.target.checked}))}),e.jsx("span",{className:"form-check-label",children:"Show on dashboard (curated card)"})]})]}),e.jsxs("div",{className:"ms-inline-add md:col-span-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs mb-1",children:"Start at"}),e.jsx("input",{type:"datetime-local",className:"input text-sm",value:s.startAt,onChange:t=>n(a=>({...a,startAt:t.target.value}))})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs mb-1",children:"End at"}),e.jsx("input",{type:"datetime-local",className:"input text-sm",value:s.endAt,onChange:t=>n(a=>({...a,endAt:t.target.value}))})]}),e.jsx("button",{onClick:j,disabled:p,className:"btn px-3 py-2 bg-white disabled:opacity-60",children:p?"Saving…":"Add"})]})]}),e.jsx("div",{className:"overflow-x-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"p-2 text-left",children:"Title"}),e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Channel"}),e.jsx("th",{className:"p-2 text-left",children:"Preview"}),e.jsx("th",{className:"p-2"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-slate-500",colSpan:6,children:"No communications"})}):m.map(t=>e.jsxs("tr",{className:"border-b align-top",children:[e.jsx("td",{className:"p-2",children:t.title}),e.jsx("td",{className:"p-2",children:t.type||"notice"}),e.jsx("td",{className:"p-2",children:t.priority||"normal"}),e.jsx("td",{className:"p-2",children:t.channel||"inapp"}),e.jsxs("td",{className:"p-2 max-w-[520px]",children:[e.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap",children:t.text||t.body||""}),e.jsxs("div",{className:"text-[11px] text-slate-500 mt-1",children:[t.isActive?"Active":"Inactive"," ·"," ",t.showInTicker?"Ticker":"—"," ",t.showOnDashboard?"· Dashboard":"",t.startAt?` · from ${new Date(t.startAt).toLocaleString()}`:"",t.endAt?` · until ${new Date(t.endAt).toLocaleString()}`:""]})]}),e.jsx("td",{className:"p-2 text-right",children:e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>v(t.id||t._id),children:"Delete"})})]},t.id||t._id||t.title))})]})})]})}export{S as default};
