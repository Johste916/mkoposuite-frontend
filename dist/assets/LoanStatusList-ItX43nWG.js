import{j as n,k as Nt,u as Dt,m as kt,l as St,r as N,h as H,L as It}from"./index-BdJ97RMf.js";import{F as Pt,S as jt}from"./search-fZ7_Abkv.js";import{C as vt}from"./chevron-down-DNEKsryA.js";import"./createLucideIcon-DNL7ncPI.js";const ze=e=>e==null||e===""?"—":Number(e).toLocaleString(),de=e=>{var a;if(!e)return"—";const r=typeof e=="string"||typeof e=="number"?new Date(e):e;return!isNaN((a=r==null?void 0:r.getTime)==null?void 0:a.call(r))?r.toLocaleDateString():"—"},A=(e,r="TZS",s)=>{if(e==null||e==="")return"—";try{return new Intl.NumberFormat(s,{style:"currency",currency:r,maximumFractionDigits:0}).format(Number(e||0))}catch{return`‎${r} ${Number(e||0).toLocaleString()}`}},ce=(e="")=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");function At(e,r){const{rows:s,headers:a,filename:u}=Array.isArray(e)?{rows:e,headers:ge(e),filename:r||"export.csv"}:{rows:(e==null?void 0:e.rows)||[],headers:(e==null?void 0:e.headers)||ge((e==null?void 0:e.rows)||[]),filename:(e==null?void 0:e.filename)||"export.csv"},p=D=>String(D??"").replace(/"/g,'""'),l=a.join(","),h=s.map(D=>a.map(k=>`"${p(D[k])}"`).join(",")).join(`
`),f=`${l}
${h}`;ft(new Blob([f],{type:"text/csv;charset=utf-8"}),u)}function Ft(e,r){const{rows:s,headers:a,filename:u,title:p}=Array.isArray(e)?{rows:e,headers:ge(e),filename:r||"export.xls"}:{rows:(e==null?void 0:e.rows)||[],headers:(e==null?void 0:e.headers)||ge((e==null?void 0:e.rows)||[]),filename:(e==null?void 0:e.filename)||"export.xls",title:(e==null?void 0:e.title)||"Export"},l=`<h1>${ce(p||"")}</h1><table border="1"><thead><tr>${a.map(f=>`<th>${ce(f)}</th>`).join("")}</tr></thead><tbody>`+s.map(f=>`<tr>${a.map(D=>`<td>${ce(String(f[D]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",h=new Blob([`\uFEFF${l}`],{type:"application/vnd.ms-excel"});ft(h,u)}function Mt(e){const{rows:r,headers:s,title:a}=Array.isArray(e)?{rows:e,headers:ge(e),title:"Export"}:{rows:(e==null?void 0:e.rows)||[],headers:(e==null?void 0:e.headers)||ge((e==null?void 0:e.rows)||[]),title:(e==null?void 0:e.title)||"Export"},u=`
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; padding: 16px; }
      h1 { font-size: 16px; margin: 0 0 12px 0; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap; }
      thead { background: #f3f4f6; }
    </style>
  `,p=`<h1>${ce(a)}</h1><table><thead><tr>${s.map(h=>`<th>${ce(h)}</th>`).join("")}</tr></thead><tbody>`+r.map(h=>`<tr>${s.map(f=>`<td>${ce(String(h[f]??""))}</td>`).join("")}</tr>`).join("")+"</tbody></table>",l=window.open("","_blank");l&&(l.document.write(`<html><head><title>${ce(a)}</title>${u}</head><body>${p}</body></html>`),l.document.close(),l.focus(),l.print())}function Bt(e,r){return At(e,r)}function $t(e,r){return Ft(e,r)}function Ot(e,r){return Mt(e)}function ge(e=[]){return e[0]?Object.keys(e[0]):[]}function ft(e,r){const s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=r||"export",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(s)}function Ct({page:e=1,pageSize:r=25,total:s=0,onPageChange:a,onPageSizeChange:u}){const p=Math.max(1,Math.ceil(s/r));return n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-2 py-3",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",n.jsx("span",{className:"font-medium",children:e})," of"," ",n.jsx("span",{className:"font-medium",children:p})," •"," ",n.jsx("span",{className:"font-medium",children:s})," rows"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:r,onChange:l=>u==null?void 0:u(Number(l.target.value)),"aria-label":"Rows per page",children:[10,25,50,100].map(l=>n.jsxs("option",{value:l,children:[l," / page"]},l))}),n.jsxs("div",{className:"inline-flex rounded border overflow-hidden",children:[n.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50",onClick:()=>a==null?void 0:a(Math.max(1,e-1)),disabled:e<=1,"aria-label":"Previous page",children:"‹ Prev"}),n.jsx("button",{className:"px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-50 border-l",onClick:()=>a==null?void 0:a(Math.min(p,e+1)),disabled:e>=p,"aria-label":"Next page",children:"Next ›"})]})]})]})}function Lt({open:e,title:r="Are you sure?",description:s="",confirmText:a="Confirm",cancelText:u="Cancel",destructive:p=!1,onConfirm:l,onClose:h}){return e?n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-4",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"mt-1 w-8 h-8 rounded-full flex items-center justify-center text-white "+(p?"bg-rose-600":"bg-indigo-600"),children:"!"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-semibold",children:r}),s&&n.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s})]}),n.jsx("button",{className:"text-gray-500 hover:text-gray-700","aria-label":"Close",onClick:h,children:"✕"})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded border",onClick:h,children:u}),n.jsx("button",{className:"px-4 py-2 rounded text-white "+(p?"bg-rose-600 hover:bg-rose-700":"bg-indigo-600 hover:bg-indigo-700"),onClick:()=>{l==null||l(),h==null||h()},children:a})]})]})}):null}const I={page:"w-full px-4 md:px-6 lg:px-10 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",sub:"text-sm text-slate-700",card:"rounded-2xl border border-slate-200 bg-white shadow-sm",th:"bg-slate-50 text-left text-[12px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-b border-slate-200 select-none",td:"px-3 py-2 border-b border-slate-100 text-sm align-top",btn:"inline-flex items-center rounded-lg border px-3 py-2 hover:bg-slate-50 font-semibold border-slate-300",btnGhost:"inline-flex items-center rounded-lg border px-3 py-2 hover:bg-slate-50 border-slate-300",btnPrimary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-3 py-2 font-semibold hover:bg-indigo-700",fieldBase:"h-11 w-full rounded-lg border border-slate-300 bg-white text-sm outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600 transition",fieldIcon:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"},Ie=({className:e="",leadingIcon:r=null,...s})=>n.jsxs("div",{className:`relative ${e}`,children:[r,n.jsx("input",{...s,className:`${I.fieldBase} ${r?"pl-10":""}`})]}),Ve=({className:e="",children:r,...s})=>n.jsxs("div",{className:`relative ${e}`,children:[n.jsx("select",{...s,className:`${I.fieldBase} pr-9 appearance-none bg-none ms-select`,style:{backgroundImage:"none"},children:r}),n.jsx(vt,{className:"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-600"})]}),Rt=(e,r)=>e&&r&&e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth()&&e.getDate()===r.getDate(),Tt=(e,r)=>e&&r?e.getTime()<r.getTime():!1,c=(e,r=0)=>Number.isFinite(Number(e))?Number(e):r,Ue=e=>String(e||"").toLowerCase(),V=e=>String(e||"").toLowerCase().replace(/\b([a-z])/g,(r,s)=>s.toUpperCase()),Et=({value:e})=>{const r=String(e||"").toLowerCase(),s=r==="disbursed"?"bg-emerald-50 text-emerald-700 border-emerald-200":r.includes("arrear")?"bg-orange-50 text-orange-700 border-orange-200":r.includes("overdue")?"bg-red-50 text-red-700 border-red-200":"bg-slate-50 text-slate-700 border-slate-200";return n.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-full text-xs border ${s}`,children:V(r||"—")})},j=e=>{if(!e)return!0;const r=String(e).trim().toLowerCase();return!!(["admin","administrator","manager","director","user","loan officer","officer"].includes(r)||/^officer\s*#\s*/i.test(e)||/^[0-9a-f-]{8,}$/i.test(r))},_=e=>{if(!e)return null;if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e)){const[s,a,u]=e.split("-").map(Number);return new Date(s,a-1,u,0,0,0,0)}const r=new Date(e);return Number.isFinite(r.getTime())?r:null},_t=(e,r)=>{if(!e||!Number.isFinite(Number(r)))return null;const s=new Date(e.getTime()),a=s.getDate();return s.setMonth(s.getMonth()+Number(r)),s.getDate()<a&&(s.setDate(1),s.setMonth(s.getMonth()+1),s.setDate(0)),s.setHours(0,0,0,0),s},Ke=e=>{const r=e.loanDurationMonths??e.termMonths??e.durationMonths??e.tenureMonths??e.periodMonths??null;if(!Number.isFinite(Number(r))||Number(r)<=0)return null;const s=_(e.disbursementDate||e.disbursement_date||e.releaseDate)||_(e.startDate)||_(e.createdAt);if(!s)return null;const a=_t(s,Number(r));return a?a.toISOString().slice(0,10):null},Pe=e=>{var l;const r=h=>{if(!Array.isArray(h)||!h.length)return null;const f=h.map(k=>({dt:_((k==null?void 0:k.dueDate)||(k==null?void 0:k.date)),status:String((k==null?void 0:k.status)||"").toUpperCase()})).filter(k=>k.dt);if(!f.length)return null;const D=f.sort((k,Y)=>k.dt-Y.dt).find(k=>k.status==="DUE")||f.find(k=>k.status==="PENDING"||k.status==="UPCOMING")||f[0];return(D==null?void 0:D.dt)||null},s=r(e.repaymentSchedule)||r(e.schedule);if(s)return s.toISOString().slice(0,10);const a=[e.nextInstallmentDueDate,e.nextDueDate,e.upcomingDueDate,e.firstDueDate,e.dueDate,e.firstRepaymentDate,e.firstInstallmentDate,e.repaymentStartDate,e.expectedFirstRepaymentDate,(l=e.nextDue)==null?void 0:l.date].filter(Boolean).map(_).filter(Boolean);if(!a.length)return null;a.sort((h,f)=>h-f);const u=new Date;return u.setHours(0,0,0,0),(a.find(h=>h>=u)||a[0]).toISOString().slice(0,10)},lt={due:"Due Loans",missed:"Missed Repayments",arrears:"Loans in Arrears","no-repayments":"No Repayments Made","past-maturity":"Past Maturity Loans","principal-outstanding":"Principal Outstanding","1-month-late":"1 Month Late","3-months-late":"3+ Months Late",disbursed:"Disbursed Loans"},X={active:e=>{const r=Ue(e.status||e.state);return["disbursed","active"].includes(r)||r==="closed"&&c(e.outstanding)>0},disbursed:e=>Ue(e.status||e.state)==="disbursed"||!!(e.disbursementDate||e.disbursement_date||e.releaseDate),due:(e,r)=>{if(!X.active(e))return!1;const s=_(Pe(e));return Ue(e.nextDueStatus||e.dueStatus)==="due"||s&&Rt(s,r.todayStart)},missed:e=>X.active(e)&&c(e.dpd||e.daysPastDue)>0,arrears:e=>X.active(e)&&(Ue(e.nextDueStatus||e.dueStatus)==="overdue"||c(e.arrears||e.totalArrears||e.outstandingArrears)>0||c(e.dpd||e.daysPastDue)>0),"no-repayments":e=>X.active(e)?!(c(e.totalPaid||e.amountPaid||e.repaymentsTotal||e.totalCollections)>0||c(e.paidPrincipal)+c(e.paidInterest)+c(e.paidFees)+c(e.paidPenalty)>0):!1,"past-maturity":(e,r)=>{if(!X.active(e))return!1;const s=_(e.maturityDate||e.endDate||e.expectedMaturityDate||Ke(e)),a=e.outstanding!=null?c(e.outstanding,0):c(e.outstandingPrincipal)+c(e.outstandingInterest)+c(e.outstandingFees)+c(e.outstandingPenalty);return s&&Tt(s,r.todayStart)&&a>0},"principal-outstanding":e=>X.active(e)&&c(e.outstandingPrincipal)>0,"1-month-late":e=>X.active(e)&&c(e.dpd||e.daysPastDue)>=30&&c(e.dpd||e.daysPastDue)<60,"3-months-late":e=>X.active(e)&&c(e.dpd||e.daysPastDue)>=90},qt={disbursed:{columns:[{key:"disbDate",header:"Date of Dsb"},{key:"borrower",header:"Borrower name"},{key:"phone",header:"Phone number"},{key:"product",header:"Loan product"},{key:"principal",header:"Principal amount",align:"right"},{key:"interest",header:"Interest amount",align:"right"},{key:"outPrin",header:"Outstanding principal",align:"right"},{key:"outInt",header:"Outstanding Interest",align:"right"},{key:"outFee",header:"Outstanding fee",align:"right"},{key:"outPen",header:"Outstanding penalty",align:"right"},{key:"outstanding",header:"Total outstanding",align:"right"},{key:"rateYear",header:"Interest rate/year %"},{key:"duration",header:"Loan Duration"},{key:"dueDate",header:"Due date"},{key:"officer",header:"Loan officer"},{key:"branch",header:"Branch"},{key:"status",header:"Status"}],totalKeys:["principal","interest","outPrin","outInt","outFee","outPen","outstanding"],rowMap:(e,r={})=>{var te,re,Me,Be,fe,F,pe,$e,Z,Oe,Ce,Le,Re,he,U;const s=e.currency||"TZS",a=v=>Number.isFinite(Number(v))?Number(v):0,u=v=>Math.max(0,a(v)),p=a(e.principalAmount??e.amount??e.principal??e.expectedPrincipal),l=e.loanDurationMonths??e.termMonths??e.durationMonths??e.tenureMonths??e.periodMonths??null,h=e.termDays??e.durationDays??null,f=e.installmentCount??e.numberOfInstallments??null,D=e.repaymentFrequency||e.frequency||e.installmentFrequency||null,k=typeof D=="string"?D.replace(/_/g," "):D;let Y="—";l?Y=`${l} mo`:h?Y=`${h} days`:f&&k?Y=`${f} × ${k}`:f&&(Y=`${f} installments`);const Ze=Pe(e),ue=Ke(e)||Ze,ne=a(e.paidPrincipal??e.totalPrincipalPaid),xe=a(e.paidInterest??e.totalInterestPaid),me=a(e.paidFees??e.totalFeesPaid),G=a(e.paidPenalty??e.totalPenaltyPaid);let K=a(e.interestAmount??e.totalInterest??e.expectedInterest??e.interest);const C=Number.isFinite(Number(e.outstandingPrincipal))?Number(e.outstandingPrincipal):u(p-ne),ae=Number.isFinite(Number(e.outstandingInterest))?Number(e.outstandingInterest):u(K-xe),B=Number.isFinite(Number(e.outstandingFees))?Number(e.outstandingFees):u(a(e.totalFees)-me),W=Number.isFinite(Number(e.outstandingPenalty))?Number(e.outstandingPenalty):u(a(e.totalPenalty)-G),O=e.totalOutstanding!=null?a(e.totalOutstanding):e.outstanding!=null?a(e.outstanding):u(C+ae+B+W),se=v=>{if(v==null)return null;if(typeof v=="string"){const De=v.replace(/\s*%$/,"").trim();return Number.isFinite(Number(De))?Number(De):null}return Number.isFinite(Number(v))?Number(v):null},L=[e.annualInterestRate,e.interestRateYear,e.interestRateAnnual,e.interestRate,e.ratePerYear,e.rateAnnual,e.rate].map(se).find(v=>v!=null),oe=[e.monthlyInterestRate,e.interestRateMonth,e.ratePerMonth,e.rate_month].map(se).find(v=>v!=null);let M=null;if(L!=null)M=L>1?L/100:L;else if(oe!=null)M=(oe>1?oe/100:oe)*12;else if(p&&l&&K){const v=K/p/(l/12);Number.isFinite(v)&&v>=0&&(M=v)}!K&&p&&l&&M!=null&&(K=Math.round(p*M*(l/12)));const we=M!=null?M*100:null,R=e.officerId||e.loanOfficerId||e.assignedOfficerId||e.disbursedBy||e.disbursed_by||e.createdById||((te=e.officer)==null?void 0:te.id)||null,Ne=R&&r.officersById?r.officersById[String(R)]:null,T=j(Ne)?null:Ne,ve=!j(e.officerName)&&e.officerName||!j(e.loanOfficerName)&&e.loanOfficerName||!j(e.disbursedByName)&&e.disbursedByName||!j(e.disbursed_by_name)&&e.disbursed_by_name||!j(e.createdByName)&&e.createdByName||!j((re=e.officer)==null?void 0:re.name)&&((Me=e.officer)==null?void 0:Me.name)||T||"—",Ae=e.branchId||e.branch_id||((Be=e.Branch)==null?void 0:Be.id)||((fe=e.branch)==null?void 0:fe.id)||null,Fe=Ae&&r.branchesById?r.branchesById[String(Ae)]:null,ee=e.branchName||((F=e.Branch)==null?void 0:F.name)||((pe=e.branch)==null?void 0:pe.name)||Fe||e.branchCode||"—",le=e.borrowerName??(($e=e.Borrower)==null?void 0:$e.name)??((Z=e.borrower)==null?void 0:Z.name)??"—",Q=e.borrowerId??((Oe=e.Borrower)==null?void 0:Oe.id)??((Ce=e.borrower)==null?void 0:Ce.id)??void 0,He=e.borrowerPhone??e.phone??((Le=e.Borrower)==null?void 0:Le.phone)??((Re=e.borrower)==null?void 0:Re.phone)??"—",Ye=e.productName??((he=e.Product)==null?void 0:he.name)??((U=e.product)==null?void 0:U.name)??"—";return{id:e.id,disbDate:de(e.disbursementDate||e.disbursement_date||e.releaseDate||e.startDate||e.createdAt),borrower:le,borrowerId:Q,phone:He,product:Ye,principal:p,principalFmt:p?A(p,s):"—",interest:K,interestFmt:K?A(K,s):"—",outPrin:C,outPrinFmt:C?A(C,s):"—",outInt:ae,outIntFmt:ae?A(ae,s):"—",outFee:B,outFeeFmt:B?A(B,s):"—",outPen:W,outPenFmt:W?A(W,s):"—",outstanding:O,outstandingFmt:O?A(O,s):"—",rateYear:we==null?"—":`${ze(we)}%`,duration:Y,dueDate:de(ue),officer:V(ve),branch:ee,status:n.jsx(Et,{value:(e.status||e.state||"—").toString()}),currency:s}}},due:{columns:[{key:"date",header:"Due Date"},{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"installment",header:"Inst. #"},{key:"dueAmount",header:"Amount Due",align:"right"},{key:"dpd",header:"DPD",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["dueAmount"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=Pe(e),p=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,date:de(u),borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",installment:c(e.nextInstallment||e.upcomingInstallment||null)||"—",dueAmount:c(e.nextDueAmount||e.upcomingDueAmount||0),dueAmountFmt:e.nextDueAmount||e.upcomingDueAmount?A(e.nextDueAmount||e.upcomingDueAmount,a):"—",dpd:c(e.dpd||e.daysPastDue||0),officer:V(p),currency:a}}},missed:{columns:[{key:"lastDueDate",header:"Last Due"},{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"dpd",header:"DPD",align:"right"},{key:"arrears",header:"Arrears",align:"right"},{key:"outstanding",header:"Outstanding",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["arrears","outstanding"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.outstandingPrincipal),p=c(e.outstandingInterest),l=c(e.outstandingFees),h=c(e.outstandingPenalty),f=e.outstanding!=null?c(e.outstanding):u+p+l+h,D=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,lastDueDate:de(e.lastDueDate||e.nextDueDate),borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",dpd:c(e.dpd||e.daysPastDue||0),arrears:c(e.arrears||e.totalArrears||e.outstandingArrears||0),outstanding:f,arrearsFmt:c(e.arrears||e.totalArrears||e.outstandingArrears||0)?A(c(e.arrears||e.totalArrears||e.outstandingArrears||0),a):"—",outstandingFmt:f?A(f,a):"—",officer:V(D),currency:a}}},arrears:{columns:[{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"dpd",header:"DPD",align:"right"},{key:"arrears",header:"Arrears",align:"right"},{key:"penalty",header:"Penalty",align:"right"},{key:"outstanding",header:"Outstanding",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["arrears","penalty","outstanding"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.outstandingPrincipal),p=c(e.outstandingInterest),l=c(e.outstandingFees),h=c(e.outstandingPenalty),f=e.outstanding!=null?c(e.outstanding):u+p+l+h,D=c(e.arrears||e.totalArrears||e.outstandingArrears||0),k=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",dpd:c(e.dpd||e.daysPastDue||0),arrears:D,penalty:h,outstanding:f,arrearsFmt:D?A(D,a):"—",penaltyFmt:h?A(h,a):"—",outstandingFmt:f?A(f,a):"—",officer:V(k),currency:a}}},"no-repayments":{columns:[{key:"disbDate",header:"Disbursed"},{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"principal",header:"Principal",align:"right"},{key:"firstDue",header:"1st Due"},{key:"officer",header:"Officer"}],totalKeys:["principal"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.amount??e.principal??0),p=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,disbDate:de(e.disbursementDate||e.releaseDate||e.startDate||e.createdAt),borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",principal:u,principalFmt:u?A(u,a):"—",firstDue:de(Pe(e)),officer:V(p),currency:a}}},"past-maturity":{columns:[{key:"maturity",header:"Maturity"},{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"outstanding",header:"Outstanding",align:"right"},{key:"dpd",header:"DPD",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["outstanding"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.outstandingPrincipal),p=c(e.outstandingInterest),l=c(e.outstandingFees),h=c(e.outstandingPenalty),f=e.outstanding!=null?c(e.outstanding):u+p+l+h,D=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,maturity:de(e.maturityDate||e.endDate||e.expectedMaturityDate||Ke(e)),borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",outstanding:f,outstandingFmt:f?A(f,a):"—",dpd:c(e.dpd||e.daysPastDue||0),officer:V(D),currency:a}}},"principal-outstanding":{columns:[{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"outPrin",header:"Outstanding Principal",align:"right"},{key:"outstanding",header:"Total Outstanding",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["outPrin","outstanding"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.outstandingPrincipal),p=c(e.outstandingInterest),l=c(e.outstandingFees),h=c(e.outstandingPenalty),f=e.outstanding!=null?c(e.outstanding):u+p+l+h,D=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",outPrin:u,outstanding:f,outPrinFmt:u?A(u,a):"—",outstandingFmt:f?A(f,a):"—",officer:V(D),currency:a}}},"1-month-late":{columns:[{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"dpd",header:"DPD",align:"right"},{key:"arrears",header:"Arrears",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["arrears"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.arrears||e.totalArrears||e.outstandingArrears||0),p=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",dpd:c(e.dpd||e.daysPastDue||0),arrears:u,arrearsFmt:u?A(u,a):"—",officer:V(p),currency:a}}},"3-months-late":{columns:[{key:"borrower",header:"Borrower"},{key:"loanNumber",header:"Loan #"},{key:"product",header:"Product"},{key:"dpd",header:"DPD",align:"right"},{key:"arrears",header:"Arrears",align:"right"},{key:"outstanding",header:"Outstanding",align:"right"},{key:"officer",header:"Officer"}],totalKeys:["arrears","outstanding"],rowMap:e=>{const r=e.Borrower||e.borrower||{},s=e.Product||e.product||{},a=e.currency||"TZS",u=c(e.outstandingPrincipal),p=c(e.outstandingInterest),l=c(e.outstandingFees),h=c(e.outstandingPenalty),f=e.outstanding!=null?c(e.outstanding):u+p+l+h,D=c(e.arrears||e.totalArrears||e.outstandingArrears||0),k=!j(e.officerName)&&e.officerName||e.officer&&e.officer.name||"—";return{id:e.id,borrower:r.name||e.borrowerName||"—",borrowerId:r.id,loanNumber:e.loanNumber||e.id,product:s.name||e.productName||"—",dpd:c(e.dpd||e.daysPastDue||0),arrears:D,outstanding:f,arrearsFmt:D?A(D,a):"—",outstandingFmt:f?A(f,a):"—",officer:V(k),currency:a}}}};function Yt(){var tt;const e=Nt(),r=e.scope||e.status,s=Dt(),{error:a}=kt(),[u,p]=St(),[l,h]=N.useState([]),[f,D]=N.useState(0),[k,Y]=N.useState(!1),[Ze,je]=N.useState([]),[ue,ne]=N.useState([]),[xe,me]=N.useState([]),[G,K]=N.useState(u.get("q")||""),[C,ae]=N.useState(u.get("productId")||""),[B,W]=N.useState(u.get("officerId")||""),[O,se]=N.useState(u.get("branchId")||""),[L,oe]=N.useState(u.get("startDate")||""),[M,we]=N.useState(u.get("endDate")||""),[R,Ne]=N.useState(u.get("minAmt")||""),[T,ve]=N.useState(u.get("maxAmt")||""),Ae=Number(u.get("page")||1),Fe=Number(u.get("pageSize")||25),[ee,le]=N.useState(Math.max(1,Ae)),[Q,He]=N.useState([10,25,50,100].includes(Fe)?Fe:25),[Ye,te]=N.useState(null),[re,Me]=N.useState({open:!1,title:"",description:"",destructive:!1,onConfirm:null}),Be=lt[r]||"Loan Report",fe=N.useRef(null),F=qt[r],pe=new Date,$e=new Date(pe.getFullYear(),pe.getMonth(),pe.getDate()),[Z,Oe]=N.useState(null),[Ce,Le]=N.useState(!1);N.useEffect(()=>{(async()=>{var t,m,g,o,P;try{try{const i=await H.get("/me").catch(()=>H.get("/auth/me"));Oe((i==null?void 0:i.data)||null),Ce||(Le(!0),!u.get("officerId")&&((t=i==null?void 0:i.data)!=null&&t.id)&&W(String(i.data.id)),!u.get("branchId")&&((m=i==null?void 0:i.data)!=null&&m.branchId)&&se(String(i.data.branchId)))}catch{}const b=(await H.get("/reports/filters")).data||{};je(Array.isArray(b.products)?b.products:[]);const E=(Array.isArray(b.officers)?b.officers:[]).filter(i=>(i==null?void 0:i.id)!=null&&!j((i==null?void 0:i.name)||(i==null?void 0:i.email)||(i==null?void 0:i.phone)));ne(E),me(Array.isArray(b.branches)?b.branches:[]);return}catch{}try{const x=await H.get("/loan-products"),b=Array.isArray(x.data)?x.data:((g=x.data)==null?void 0:g.items)||[];je(b)}catch{je([])}try{const x=await H.get("/users",{params:{role:"loan_officer",pageSize:500}}),E=(Array.isArray(x.data)?x.data:((o=x.data)==null?void 0:o.items)||[]).filter(i=>(i==null?void 0:i.id)!=null&&!j((i==null?void 0:i.name)||(i==null?void 0:i.email)||(i==null?void 0:i.phone)));ne(E)}catch{ne([])}try{const x=await H.get("/branches",{params:{pageSize:500}}),b=Array.isArray(x.data)?x.data:((P=x.data)==null?void 0:P.items)||[];me(b)}catch{me([])}})()},[]);const Re=async t=>{const m=Array.from(new Set(t.map(String)));if(m.length)try{const g=await Promise.allSettled(m.map(P=>H.get(`/users/${P}`))),o=[];g.forEach(P=>{var x;if(P.status==="fulfilled"){const b=((x=P.value)==null?void 0:x.data)||{};b!=null&&b.id&&(b.name||b.email||b.phone)&&o.push({id:b.id,name:b.name||b.email||b.phone})}}),o.length&&ne(P=>{const x=new Map((P||[]).map(b=>[String(b.id),b]));for(const b of o)j(b.name)||x.set(String(b.id),{id:b.id,name:b.name});return Array.from(x.values()).sort((b,E)=>String(b.name||"").localeCompare(String(E.name||"")))})}catch{}},he=async(t={})=>{var m,g,o,P,x,b,E;Y(!0);try{const i={page:ee,pageSize:Q,scope:r};r==="disbursed"&&(i.status="disbursed");const Se=G.trim();Se&&(i.q=Se),C&&(i.productId=C),B&&(i.officerId=B),O&&(i.branchId=O),L&&(i.startDate=L),M&&(i.endDate=M);const Te=Number.isFinite(Number(R))&&`${R}`!="",q=Number.isFinite(Number(T))&&`${T}`!="";Te&&(i.minAmount=Number(R)),q&&(i.maxAmount=Number(T));const ye=await H.get("/loans",{params:i}),rt=(Array.isArray(ye.data)?ye.data:Array.isArray((m=ye.data)==null?void 0:m.items)?ye.data.items:[]).map(d=>{var z,qe,y,S,$,w,J,nt,at,st,ot,it,dt,ct,ut,mt;return{...d,borrowerId:d.borrowerId??((z=d.Borrower)==null?void 0:z.id)??((qe=d.borrower)==null?void 0:qe.id)??d.clientId??null,borrowerName:d.borrowerName??((y=d.Borrower)==null?void 0:y.name)??((S=d.borrower)==null?void 0:S.name)??d.clientName??null,borrowerPhone:d.borrowerPhone??d.phone??(($=d.Borrower)==null?void 0:$.phone)??((w=d.borrower)==null?void 0:w.phone)??null,productId:d.productId??d.product_id??((J=d.Product)==null?void 0:J.id)??((nt=d.product)==null?void 0:nt.id)??null,productName:d.productName??((at=d.Product)==null?void 0:at.name)??((st=d.product)==null?void 0:st.name)??null,officerId:d.officerId??d.loanOfficerId??d.assignedOfficerId??d.disbursedBy??d.disbursed_by??d.createdById??((ot=d.officer)==null?void 0:ot.id)??null,officerName:d.officerName??((it=d.officer)==null?void 0:it.name)??d.createdByName??null,branchId:d.branchId??((dt=d.Branch)==null?void 0:dt.id)??((ct=d.branch)==null?void 0:ct.id)??null,branchName:d.branchName??((ut=d.Branch)==null?void 0:ut.name)??((mt=d.branch)==null?void 0:mt.name)??null,nextDueDate:d.nextDueDate??d.firstDueDate??d.upcomingDueDate??d.dueDate??null,principalAmount:d.principalAmount??d.amount??d.principal??d.expectedPrincipal??null,interestAmount:d.interestAmount??d.totalInterest??d.expectedInterest??d.interest??null,totalOutstanding:d.totalOutstanding!=null?d.totalOutstanding:d.outstanding!=null?d.outstanding:null}}),Ee=new Map;for(const d of rt){const z=d.id??d.loanId??d.loan_id;z&&(Ee.has(z)||Ee.set(z,d))}const _e=(Ee.size?Array.from(Ee.values()):rt).filter(d=>{const z=X[r];return z?z(d,{todayStart:$e}):!0});h(_e),D(_e.length);try{const d=new Map,z=new Map;for(const y of _e){const S=y.officerId??y.loanOfficerId??y.assignedOfficerId??y.disbursedBy??y.disbursed_by??y.createdById??((g=y.officer)==null?void 0:g.id)??null,$=y.officerName??y.loanOfficerName??y.disbursedByName??y.disbursed_by_name??y.createdByName??((o=y.officer)==null?void 0:o.name)??null;S!=null&&$&&!j($)&&d.set(String(S),{id:S,name:$});const w=y.branchId??y.branch_id??((P=y.Branch)==null?void 0:P.id)??((x=y.branch)==null?void 0:x.id)??null,J=y.branchName??((b=y.Branch)==null?void 0:b.name)??((E=y.branch)==null?void 0:E.name)??y.branchCode??null;w!=null&&J&&z.set(String(w),{id:w,name:J})}ne(y=>{const S=new Map((y||[]).map(w=>[String(w.id),w]));for(const[w,J]of d)S.set(w,J);return Array.from(S.values()).filter(w=>(w==null?void 0:w.id)!=null&&!j((w==null?void 0:w.name)||(w==null?void 0:w.email)||(w==null?void 0:w.phone))).sort((w,J)=>String(w.name||"").localeCompare(String(J.name||"")))}),me(y=>{const S=new Map((y||[]).map($=>[String($.id),$]));for(const[$,w]of z)S.set($,w);return Array.from(S.values()).sort(($,w)=>String($.name||"").localeCompare(String(w.name||"")))});const qe=_e.map(y=>{var S;return y.officerId??y.loanOfficerId??y.assignedOfficerId??y.disbursedBy??y.disbursed_by??y.createdById??((S=y.officer)==null?void 0:S.id)}).filter(Boolean).map(String).filter(y=>{const S=(ue||[]).find(w=>String(w.id)===y),$=(S==null?void 0:S.name)||(S==null?void 0:S.email)||(S==null?void 0:S.phone)||"";return!$||j($)});await Re(qe)}catch{}}catch(i){console.error(i),a("Failed to load report."),h([]),D(0)}finally{Y(!1)}if(!t.skipSyncUrl){const i=new URLSearchParams;G&&i.set("q",G),C&&i.set("productId",C),B&&i.set("officerId",B),O&&i.set("branchId",O),L&&i.set("startDate",L),M&&i.set("endDate",M),R&&i.set("minAmt",R),T&&i.set("maxAmt",T),i.set("page",String(ee)),i.set("pageSize",String(Q)),p(i)}};N.useEffect(()=>{he({skipSyncUrl:!0}),te(null)},[r,ee,Q]);const U=N.useMemo(()=>{const t=L?_(L):null,m=M?(()=>{const o=_(M);return o&&o.setHours(23,59,59,999),o})():null,g=G.trim().toLowerCase();return l.filter(o=>{var E,i,Se,Te;if(t||m){let q;if(r==="due"?q=_(Pe(o)):r==="disbursed"||r==="no-repayments"?q=_(o.disbursementDate||o.disbursement_date||o.releaseDate||o.startDate||o.createdAt):r==="past-maturity"?q=_(o.maturityDate||o.endDate||o.expectedMaturityDate||Ke(o)):q=_(o.createdAt||o.updatedAt||o.disbursementDate),t&&(!q||q<t)||m&&(!q||q>m))return!1}if(C&&String(o.productId??o.product_id??((E=o.Product)==null?void 0:E.id)??((i=o.product)==null?void 0:i.id))!==String(C)||B&&String(o.officerId||o.loanOfficerId||o.disbursedBy||o.disbursed_by||o.createdById)!==String(B)||O&&String(o.branchId||((Se=o.Branch)==null?void 0:Se.id)||((Te=o.branch)==null?void 0:Te.id))!==String(O))return!1;const P=Number(o.principalAmount??o.amount??o.principal??0),x=Number.isFinite(Number(R))&&`${R}`!="",b=Number.isFinite(Number(T))&&`${T}`!="";if(x&&!(P>=Number(R))||b&&!(P<=Number(T)))return!1;if(g){const q=o.Borrower||o.borrower||{},ye=o.Product||o.product||{};if(![q.name,q.phone,o.borrowerName,o.borrowerPhone,o.phone,ye.name,o.productName,o.loanNumber,o.id].filter(Boolean).join(" ").toLowerCase().includes(g))return!1}return!0})},[l,G,C,B,O,L,M,R,T,r]),v=N.useMemo(()=>{const t={};for(const m of ue||[]){const g=m.name||m.email||m.phone||"";j(g)||(t[String(m.id)]=g)}return t},[ue]),De=N.useMemo(()=>{const t={};for(const m of xe||[])t[String(m.id)]=m.name||m.code||`Branch ${m.id}`;return t},[xe]),ke=N.useMemo(()=>({officersById:v,branchesById:De}),[v,De]),We=N.useMemo(()=>{if(f>l.length)return U;const t=(ee-1)*Q;return U.slice(t,t+Q)},[U,ee,Q,l.length,f]),ie=N.useMemo(()=>F?We.map(t=>F.rowMap(t,ke)):[],[We,F,ke]),pt=N.useMemo(()=>{if(!F)return{};const t={};for(const m of F.totalKeys||[])t[m]=0;for(const m of U.map(g=>F.rowMap(g,ke)))for(const g of F.totalKeys||[])t[g]+=c(m[g]);return t},[U,F,ke]),be=N.useMemo(()=>{if(!F)return[];const t=[...F.columns||[]],m=o=>ie.length?ie.every(P=>{const x=P[o];return x==null||x===""?!0:typeof x=="number"?x===0:!1}):!1,g=new Set(["disbDate","date","borrower","phone","product","rateYear","duration","dueDate","officer","branch","status","loanNumber","maturity"]);return t.filter(o=>g.has(o.key)?!0:!m(o.key))},[F,ie]),Ge=()=>F?U.map(t=>F.rowMap(t,ke)).map(t=>{const m={};for(const g of be){const o=t[`${g.key}Fmt`]!=null?t[`${g.key}Fmt`]:t[g.key]!=null?t[g.key]:"";m[g.header]=o===0||o==="0"?"0":o||""}return m}):[],Qe=(lt[r]||"loan-report").toLowerCase().replace(/\s+/g,"-"),Je=()=>{const t=new URLSearchParams;return G.trim()&&t.set("q",G.trim()),C&&t.set("productId",String(C)),B&&t.set("officerId",String(B)),O&&t.set("branchId",String(O)),L&&t.set("startDate",String(L)),M&&t.set("endDate",String(M)),R&&t.set("minAmount",String(R)),T&&t.set("maxAmount",String(T)),t.set("scope",r),t.toString()},Xe=async t=>{try{return await(H.head?H.head(t):H.get(t,{method:"HEAD"})),window.open(t,"_blank","noopener,noreferrer"),!0}catch{return!1}},ht=async()=>{const m=`/reports/loans/export/csv?${Je()}`;await Xe(m)||Bt(Ge(),Qe)},bt=()=>{$t(Ge(),Qe)},yt=async()=>{const m=`/reports/loans/export/pdf?${Je()}`;await Xe(m)||Ot(Ge())},gt=t=>s(`/loans/${t}`),xt=t=>s(`/repayments/new?loanId=${t}`),et=()=>{K(""),ae(""),W(""),se(""),oe(""),we(""),Ne(""),ve(""),le(1),p(new URLSearchParams),setTimeout(()=>he({skipSyncUrl:!0}),0)};return N.useEffect(()=>{const t=m=>{fe.current&&(fe.current.contains(m.target)||te(null))};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),F?n.jsxs("div",{className:I.page,children:[n.jsx("style",{children:`
        select.ms-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: none !important; }
        select.ms-select::-ms-expand { display: none; }
      `}),n.jsxs("div",{className:"mb-5 flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:I.h1,children:Be}),n.jsxs("div",{className:I.sub,children:["Showing ",ze(U.length)," of ",ze(f)]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{onClick:ht,className:I.btnGhost,children:"Export CSV"}),n.jsx("button",{onClick:bt,className:I.btnGhost,children:"Export Excel"}),n.jsx("button",{onClick:yt,className:I.btnGhost,children:"Export PDF"})]})]}),n.jsxs("div",{className:`${I.card} p-4 mb-6`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 text-slate-800 font-semibold",children:[n.jsx(Pt,{className:"w-4 h-4"})," Report Filters"]}),n.jsx("button",{onClick:et,className:"text-sm underline decoration-slate-300 hover:decoration-slate-600",children:"Clear all"})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[n.jsxs("button",{type:"button",onClick:()=>W(t=>t?"":Z!=null&&Z.id?String(Z.id):""),className:`text-xs px-2 py-1 rounded-lg border ${B?"bg-indigo-600 text-white border-indigo-600":"bg-white border-slate-300"}`,title:"Toggle: show only loans assigned to me",children:["My loans ",B?"✓":""]}),n.jsxs("button",{type:"button",onClick:()=>se(t=>t?"":Z!=null&&Z.branchId?String(Z.branchId):""),className:`text-xs px-2 py-1 rounded-lg border ${O?"bg-indigo-600 text-white border-indigo-600":"bg-white border-slate-300"}`,title:"Toggle: show only my branch",children:["My branch ",O?"✓":""]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-3",children:[n.jsx(Ie,{className:"lg:col-span-2",leadingIcon:n.jsx(jt,{className:I.fieldIcon}),placeholder:"Search borrower / phone / product / loan #",value:G,onChange:t=>K(t.target.value)}),n.jsxs(Ve,{value:C,onChange:t=>ae(t.target.value),children:[n.jsx("option",{value:"",children:"Product: All"}),Ze.map(t=>n.jsxs("option",{value:t.id,children:[t.name,t.code?` (${t.code})`:""]},t.id))]}),n.jsxs(Ve,{value:B,onChange:t=>W(t.target.value),children:[n.jsx("option",{value:"",children:"Officer: All"}),ue.filter(t=>(t==null?void 0:t.id)!=null&&!j((t==null?void 0:t.name)||(t==null?void 0:t.email)||(t==null?void 0:t.phone))).map(t=>n.jsx("option",{value:t.id,children:t.name||t.email},t.id))]}),n.jsxs(Ve,{value:O,onChange:t=>se(t.target.value),children:[n.jsx("option",{value:"",children:"Branch: All"}),xe.map(t=>n.jsx("option",{value:t.id,children:t.name||t.code},t.id))]}),n.jsx(Ie,{type:"date",value:L,onChange:t=>oe(t.target.value)}),n.jsx(Ie,{type:"date",value:M,onChange:t=>we(t.target.value)}),n.jsx(Ie,{type:"number",placeholder:"Min Amount",value:R,onChange:t=>Ne(t.target.value)}),n.jsx(Ie,{type:"number",placeholder:"Max Amount",value:T,onChange:t=>ve(t.target.value)})]}),n.jsxs("div",{className:"mt-3 flex gap-2",children:[n.jsx("button",{onClick:()=>{le(1),he()},className:I.btnPrimary,children:"Apply Filters"}),n.jsx("button",{onClick:et,className:I.btn,children:"Reset"})]})]}),n.jsx("div",{className:`${I.card} overflow-x-auto`,ref:fe,children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"sticky top-0 bg-white",children:[be.map(t=>n.jsx("th",{className:`${I.th} ${t.align==="right"?"text-right":""}`,children:t.header},t.key)),n.jsx("th",{className:I.th,children:"Action"})]})}),n.jsx("tbody",{children:k?n.jsx("tr",{children:n.jsx("td",{colSpan:be.length+1,className:`${I.td} text-center py-10 text-slate-600`,children:"Loading…"})}):ie.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:be.length+1,className:`${I.td} text-center py-10 text-slate-600`,children:"No records match this report."})}):ie.map(t=>n.jsxs("tr",{className:"odd:bg-white even:bg-slate-50/40 hover:bg-slate-50",children:[be.map(m=>{const g=t[m.key],o=t[`${m.key}Fmt`],P=o??(g==null||g===""||typeof g=="number"&&g===0?"—":g);let x=P;if(m.key==="borrower"&&t.borrowerId&&(x=n.jsx(It,{to:`/borrowers/${t.borrowerId}`,className:"text-indigo-700 hover:underline font-semibold",children:P})),m.key==="dueDate"&&t.dueDate){const b=_(t.dueDate),E=new Date;E.setHours(0,0,0,0);const i=b&&b<E;x=n.jsx("span",{className:i?"text-red-600 font-semibold":"",children:P})}return n.jsx("td",{className:`${I.td} ${m.align==="right"?"text-right":""}`,children:x},m.key)}),n.jsx("td",{className:`${I.td} whitespace-nowrap`,children:n.jsxs("div",{className:"relative inline-block",children:[n.jsx("button",{className:"px-2 py-1 rounded border border-slate-300 hover:bg-slate-50 font-medium",onClick:()=>te(m=>m===t.id?null:t.id),children:"Actions ▾"}),Ye===t.id&&n.jsxs("div",{className:"absolute right-0 mt-1 w-56 bg-white border border-slate-200 rounded-lg shadow z-10 overflow-hidden",children:[n.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{te(null),gt(t.id)},children:"View Loan"}),n.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-50",onClick:()=>{te(null),xt(t.id)},children:"Record Repayment"})]})]})})]},t.id))}),!k&&U.length>0&&((tt=F.totalKeys)==null?void 0:tt.length)>0&&n.jsx("tfoot",{children:n.jsxs("tr",{className:"bg-slate-50",children:[be.map((t,m)=>{var x;if(m===0)return n.jsx("td",{className:`${I.td} font-semibold`,children:"Totals:"},t.key);const g=(F.totalKeys||[]).includes(t.key),o=g?pt[t.key]:"",P=o!=null&&o!==""?(x=ie[0])!=null&&x.currency?A(o,ie[0].currency):ze(o):"";return n.jsx("td",{className:`${I.td} ${t.align==="right"?"text-right":""} font-semibold`,children:g?P:""},t.key)}),n.jsx("td",{className:I.td})]})})]})}),n.jsx(Ct,{page:ee,pageSize:Q,total:f||U.length,onPageChange:t=>le(t),onPageSizeChange:t=>{He(t),le(1)}}),n.jsx(Lt,{open:re.open,title:re.title,description:re.description,destructive:re.destructive,onConfirm:re.onConfirm,onClose:()=>Me(t=>({...t,open:!1}))})]}):n.jsxs("div",{className:I.page,children:[n.jsx("h2",{className:I.h1,children:"Unknown Report"}),n.jsxs("p",{className:"text-slate-600 mt-2",children:["The report “",r,"” is not configured."]})]})}export{Yt as default};
