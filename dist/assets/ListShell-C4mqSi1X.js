import{r as l,b as L,j as e}from"./index-C-j5_Jvg.js";function W({url:s,params:i={},initialPage:p=1,initialLimit:x=20}){var R,q;const[c,h]=l.useState(p),[r,g]=l.useState(x),[y,N]=l.useState(i.q||""),[v,b]=l.useState(!0),[u,a]=l.useState(""),[m,S]=l.useState([]),[A,w]=l.useState(0),[P,k]=l.useState(null),C=l.useMemo(()=>({...i,page:c,limit:r,q:y||void 0}),[i,c,r,y]),E=l.useMemo(()=>{var f,t;if(!s||/^https?:\/\//i.test(s))return s;const o=((t=(f=L)==null?void 0:f.defaults)==null?void 0:t.baseURL)||"",j=/\/api\/?$/.test(o);let n=s;return j&&n.startsWith("/api/")&&(n=n.slice(4)),n.startsWith("/")||(n=`/${n}`),n=n.replace(/\/{2,}/g,"/"),n},[s,(q=(R=L)==null?void 0:R.defaults)==null?void 0:q.baseURL]),M=async o=>{var j,n,f;b(!0),a("");try{const t=await L.get(E,{params:C,signal:o}),d=t==null?void 0:t.data;Array.isArray(d)?(S(d),w(d.length),k(null)):d&&Array.isArray(d.data)?(S(d.data),w(((j=d.pagination)==null?void 0:j.total)??d.data.length??0),k(d.summary??null)):(S([]),w(0),k(null))}catch(t){(t==null?void 0:t.name)!=="CanceledError"&&(t==null?void 0:t.message)!=="canceled"&&a(((f=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:f.error)||t.message||"Request failed")}finally{(!o||!o.aborted)&&b(!1)}};return l.useEffect(()=>{const o=new AbortController;return M(o.signal),()=>o.abort()},[E,JSON.stringify(C)]),{rows:m,total:A,page:c,setPage:h,limit:r,setLimit:g,q:y,setQ:N,loading:v,error:u,summary:P,refresh:()=>M()}}function U({page:s,setPage:i,limit:p,setLimit:x,total:c}){const h=Math.max(1,Math.ceil((c||0)/(p||20)));return e.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows:"}),e.jsx("select",{className:"border rounded px-2 py-1",value:p,onChange:r=>{i(1),x(parseInt(r.target.value,10))},children:[10,20,50,100].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>i(Math.max(1,s-1)),disabled:s<=1,children:"Prev"}),e.jsxs("span",{children:["Page ",s," / ",h]}),e.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",onClick:()=>i(Math.min(h,s+1)),disabled:s>=h,children:"Next"})]})]})}function $({title:s,q:i,setQ:p,columns:x=[],rows:c=[],loading:h,error:r,page:g,setPage:y,limit:N,setLimit:v,total:b,renderActions:u}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s}),e.jsx("input",{value:i,onChange:a=>p(a.target.value),placeholder:"Search…",className:"px-3 py-2 border rounded w-60 dark:bg-gray-700"})]}),r&&e.jsxs("div",{className:"text-red-500 text-sm mb-3",children:["Error: ",r]}),h?e.jsx("div",{className:"py-10 text-center text-sm opacity-70",children:"Loading…"}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b dark:border-gray-700",children:[x.map(a=>e.jsx("th",{className:"px-3 py-2",children:a.title},a.key)),u&&e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:x.length+(u?1:0),className:"px-3 py-10 text-center opacity-70",children:"No data"})}):c.map(a=>e.jsxs("tr",{className:"border-b last:border-0 dark:border-gray-700",children:[x.map(m=>e.jsx("td",{className:"px-3 py-2",children:typeof m.render=="function"?m.render(a[m.key],a):String(a[m.key]??"—")},m.key)),u&&e.jsx("td",{className:"px-3 py-2",children:u(a)})]},a.id??JSON.stringify(a)))})]})}),e.jsx(U,{page:g,setPage:y,limit:N,setLimit:v,total:b})]})}export{$ as L,W as u};
