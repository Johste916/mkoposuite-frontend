import{r,f as b,j as e}from"./index-GPeVFkMM.js";const N=(t,i)=>t?t.role==="admin"||t.role==="director"?!0:Array.isArray(t.permissions)&&t.permissions.includes(i):!1;function A(){const[t,i]=r.useState(null),[a,o]=r.useState("overview");return r.useEffect(()=>{(async()=>{try{const{data:x}=await b.get("/auth/me");i(x)}catch{}})()},[]),t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Branches"}),e.jsxs("div",{className:"flex gap-1 rounded-lg border bg-white overflow-hidden",children:[e.jsx(y,{label:"Overview",id:"overview",tab:a,setTab:o}),N(t,"branches:manage")&&e.jsx(y,{label:"Add",id:"add",tab:a,setTab:o}),N(t,"branches:assign")&&e.jsx(y,{label:"Assign",id:"assign",tab:a,setTab:o}),e.jsx(y,{label:"Reports",id:"reports",tab:a,setTab:o})]})]}),a==="overview"&&e.jsx(w,{}),a==="add"&&N(t,"branches:manage")&&e.jsx(S,{}),a==="assign"&&N(t,"branches:assign")&&e.jsx(C,{}),a==="reports"&&e.jsx(k,{})]}):e.jsx("div",{className:"p-4",children:"Loading…"})}function y({label:t,id:i,tab:a,setTab:o}){const x=a===i;return e.jsx("button",{onClick:()=>o(i),className:`px-3 py-1.5 text-sm ${x?"bg-slate-100":"bg-white hover:bg-slate-50"}`,children:t})}function w(){const[t,i]=r.useState([]),[a,o]=r.useState(""),[x,g]=r.useState(""),h=async()=>{var c,m;g("");try{const{data:n}=await b.get("/branches",{params:{q:a}});i((n==null?void 0:n.items)||[])}catch(n){g(((m=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:m.error)||n.message)}};return r.useEffect(()=>{h()},[]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Search"}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm",value:a,onChange:c=>o(c.target.value)})]}),e.jsx("button",{onClick:h,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Apply"})]}),x&&e.jsx("div",{className:"text-sm text-red-600",children:x}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Name"}),e.jsx("th",{className:"py-2 px-3",children:"Code"}),e.jsx("th",{className:"py-2 px-3",children:"Manager"}),e.jsx("th",{className:"py-2 px-3",children:"Phone"}),e.jsx("th",{className:"py-2 px-3",children:"Address"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-3 text-gray-500",children:"No branches yet."})}):t.map(c=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:c.name}),e.jsx("td",{className:"py-2 px-3",children:c.code||"—"}),e.jsx("td",{className:"py-2 px-3",children:c.managerName||c.manager_id||"—"}),e.jsx("td",{className:"py-2 px-3",children:c.phone||"—"}),e.jsx("td",{className:"py-2 px-3",children:c.address||"—"})]},c.id))})]})})]})}function S(){const[t,i]=r.useState({name:"",code:"",phone:"",address:""}),[a,o]=r.useState(!1),[x,g]=r.useState(""),[h,c]=r.useState(""),m=async()=>{var n,u;o(!0),c(""),g("");try{await b.post("/branches",t),g("Branch created."),i({name:"",code:"",phone:"",address:""})}catch(p){c(((u=(n=p==null?void 0:p.response)==null?void 0:n.data)==null?void 0:u.error)||p.message)}finally{o(!1)}};return e.jsxs("div",{className:"bg-white border rounded-xl p-3 grid gap-2 md:grid-cols-4 items-end",children:[["name","code","phone","address"].map(n=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:n}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:t[n],onChange:u=>i(p=>({...p,[n]:u.target.value}))})]},n)),e.jsx("button",{onClick:m,disabled:a,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:a?"Saving…":"Create"}),x&&e.jsx("div",{className:"text-sm text-emerald-700",children:x}),h&&e.jsx("div",{className:"text-sm text-red-600",children:h})]})}function C(){const[t,i]=r.useState([]),[a,o]=r.useState([]),[x,g]=r.useState(""),[h,c]=r.useState([]),[m,n]=r.useState(""),[u,p]=r.useState("");r.useEffect(()=>{(async()=>{try{const[{data:s},{data:l}]=await Promise.all([b.get("/branches"),b.get("/users",{params:{limit:1e3}})]);i((s==null?void 0:s.items)||[]),o((l==null?void 0:l.items)||l||[])}catch{}})()},[]);const f=s=>{c(l=>l.includes(s)?l.filter(j=>j!==s):[...l,s])},d=async()=>{var s,l;n(""),p("");try{await b.post(`/branches/${x}/assign-staff`,{userIds:h}),n("Assigned successfully.")}catch(j){p(((l=(s=j==null?void 0:j.response)==null?void 0:s.data)==null?void 0:l.error)||j.message)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm min-w-[220px]",value:x,onChange:s=>g(s.target.value),children:[e.jsx("option",{value:"",children:"Select branch"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("button",{onClick:d,disabled:!x||h.length===0,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:["Assign ",h.length?`(${h.length})`:""]}),m&&e.jsx("div",{className:"text-sm text-emerald-700",children:m}),u&&e.jsx("div",{className:"text-sm text-red-600",children:u})]}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Assign"}),e.jsx("th",{className:"py-2 px-3",children:"Name"}),e.jsx("th",{className:"py-2 px-3",children:"Email"}),e.jsx("th",{className:"py-2 px-3",children:"Role"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3 text-gray-500",children:"No users."})}):a.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:()=>f(s.id)})}),e.jsx("td",{className:"py-2 px-3",children:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()}),e.jsx("td",{className:"py-2 px-3",children:s.email}),e.jsx("td",{className:"py-2 px-3",children:s.role})]},s.id))})]})})]})}function k(){const[t,i]=r.useState([]),[a,o]=r.useState(""),[x,g]=r.useState(""),[h,c]=r.useState(""),[m,n]=r.useState(null),[u,p]=r.useState("");r.useEffect(()=>{(async()=>{try{const{data:d}=await b.get("/branches");i((d==null?void 0:d.items)||[])}catch{}})()},[]);const f=async()=>{var d,s;p(""),n(null);try{const{data:l}=await b.get(`/branches/${a}/report`,{params:{from:x,to:h}});n((l==null?void 0:l.kpis)||null)}catch(l){p(((s=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:s.error)||l.message)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm min-w-[220px]",value:a,onChange:d=>o(d.target.value),children:[e.jsx("option",{value:"",children:"Select"}),t.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"From"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:x,onChange:d=>g(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"To"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:h,onChange:d=>c(d.target.value)})]}),e.jsx("button",{onClick:f,disabled:!a,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Run"})]}),u&&e.jsx("div",{className:"text-sm text-red-600",children:u}),m&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(v,{title:"Staff",value:m.staffCount,tone:"indigo"}),e.jsx(v,{title:"Expenses",value:`TZS ${Number(m.expenses||0).toLocaleString()}`,tone:"amber"}),e.jsx(v,{title:"Loans Out",value:`TZS ${Number(m.loansOut||0).toLocaleString()}`,tone:"emerald"}),e.jsx(v,{title:"Collections",value:`TZS ${Number(m.collections||0).toLocaleString()}`,tone:"blue"})]})]})}function v({title:t,value:i,tone:a="indigo"}){const o={indigo:"text-indigo-600 bg-indigo-50",amber:"text-amber-600 bg-amber-50",emerald:"text-emerald-600 bg-emerald-50",blue:"text-blue-600 bg-blue-50"}[a]||"text-slate-600 bg-slate-50";return e.jsxs("div",{className:"bg-white border rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:`px-2 py-1 rounded ${o}`,children:t}),e.jsx("div",{className:"font-semibold",children:i??"—"})]})}export{A as default};
