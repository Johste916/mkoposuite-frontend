import{f as w}from"./index-BWN1fagU.js";const m={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://mkoposuite-backend-42w2.onrender.com/api"};var u={};const y=typeof import.meta<"u"&&m&&"https://mkoposuite-backend-42w2.onrender.com/api"||"",T=typeof globalThis<"u"&&globalThis.process&&u&&(u.REACT_APP_API_BASE_URL||u.REACT_APP_API_URL)||"",A=typeof window<"u"&&window.location&&window.location.origin||"http://localhost:10000",p=String(y||T||A).replace(/\/+$/,""),I=/\/api$/i.test(p)?p:`${p}/api`,E=String(typeof import.meta<"u"&&m&&void 0)==="1",b=Number(typeof import.meta<"u"&&m&&void 0)||3e4,g=Number(typeof import.meta<"u"&&m&&void 0)||0,a=w.create({baseURL:I,withCredentials:E,timeout:b,headers:{Accept:"application/json"}}),R=/\/api$/i.test(I);function i(t){if(!t)return"/";if(/^https?:\/\//i.test(t))return t;let e=String(t).trim();return e.startsWith("/")||(e=`/${e}`),R&&e.startsWith("/api/")&&(e=e.slice(4)),e.replace(/\/{2,}/g,"/")}function k(t){return typeof FormData<"u"&&t instanceof FormData}function C(){var t;try{if((t=globalThis==null?void 0:globalThis.crypto)!=null&&t.randomUUID)return crypto.randomUUID()}catch{}return`req_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}let h=null;a.interceptors.request.use(t=>{var r,c;t.url&&!/^https?:\/\//i.test(t.url)&&(t.url=i(t.url));const e=localStorage.getItem("token")||localStorage.getItem("jwt")||localStorage.getItem("access_token")||localStorage.getItem("authToken")||localStorage.getItem("accessToken");e&&(t.headers.Authorization=`Bearer ${String(e).replace(/^Bearer\s+/i,"")}`);const n=h||localStorage.getItem("activeTenantId")||(()=>{var s;try{const o=JSON.parse(localStorage.getItem("user")||"{}");return(o==null?void 0:o.tenantId)||((s=o==null?void 0:o.tenant)==null?void 0:s.id)||(o==null?void 0:o.orgId)||(o==null?void 0:o.companyId)||null}catch{return null}})()||localStorage.getItem("tenantId")||localStorage.getItem("x-tenant-id");n&&(t.headers["x-tenant-id"]=n);const d=localStorage.getItem("activeBranchId");d&&(t.headers["x-branch-id"]=d);try{const s=Intl.DateTimeFormat().resolvedOptions().timeZone;s&&(t.headers["x-timezone"]=s)}catch{}try{t.headers["x-tz-offset"]=String(new Date().getTimezoneOffset())}catch{}return k(t.data)?t.headers&&"Content-Type"in t.headers&&delete t.headers["Content-Type"]:((r=t.headers)["x-request-id"]||(r["x-request-id"]=C()),(c=t.headers)["Content-Type"]||(c["Content-Type"]="application/json")),t});a.interceptors.response.use(t=>t,async t=>{var c,s,o,f,_;const e=(c=t==null?void 0:t.response)==null?void 0:c.status,n=(t==null?void 0:t.config)||{};if(t.normalizedMessage=e?((o=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:o.error)||((_=(f=t==null?void 0:t.response)==null?void 0:f.data)==null?void 0:_.message)||(t==null?void 0:t.message)||`Request failed (${e})`:(t==null?void 0:t.message)==="Network Error"?"Network error: server unreachable.":(t==null?void 0:t.code)==="ECONNABORTED"?"Request timeout. Please try again.":(t==null?void 0:t.message)||"Request failed.",e===401){try{["token","jwt","authToken","accessToken","access_token","user","tenant","tenantId","tenantName","activeBranchId"].forEach(l=>{try{localStorage.removeItem(l),sessionStorage.removeItem(l)}catch{}}),delete a.defaults.headers.common.Authorization,delete a.defaults.headers.common["x-tenant-id"],delete a.defaults.headers.common["x-branch-id"]}catch{}return typeof window<"u"&&!window.location.pathname.includes("/login")&&window.location.replace("/login"),Promise.reject(t)}const d=e&&[429,502,503,504].includes(e),r=(n.method||"get").toLowerCase()==="get";if(n.__retryCount=n.__retryCount||0,g>0&&r&&d&&n.__retryCount<g){n.__retryCount+=1;const l=Math.min(1e3*2**(n.__retryCount-1),4e3);return await new Promise(S=>setTimeout(S,l)),a.request(n)}return Promise.reject(t)});a.getJSON=async(t,e)=>(await a.get(i(t),e)).data;a.postJSON=async(t,e,n)=>(await a.post(i(t),e,n)).data;a.putJSON=async(t,e,n)=>(await a.put(i(t),e,n)).data;a.patchJSON=async(t,e,n)=>(await a.patch(i(t),e,n)).data;a.deleteJSON=async(t,e)=>(await a.delete(i(t),e)).data;a.setTenantId=t=>{h=t||null};a.clearTenantId=()=>{h=null};a.path=i;a.withAbort=()=>{const t=new AbortController;return{signal:t.signal,cancel:()=>t.abort()}};export{a};
