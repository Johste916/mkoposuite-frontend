import{r as l,j as s,g as d}from"./index-CGp3nliO.js";function b(){const[j,n]=l.useState([]),[i,u]=l.useState(""),[o,m]=l.useState(""),[y,h]=l.useState(!1),c=async()=>{var e,t;h(!0),m("");try{const a=await d.get("/admin/audit");n(a.data||[])}catch(a){m(((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.error)||a.message||"Failed to load audits"),n([])}finally{h(!1)}};l.useEffect(()=>{c()},[]);const p=j.filter(e=>{var a,r;const t=i.toLowerCase().trim();return t?[(a=e==null?void 0:e.User)==null?void 0:a.name,(r=e==null?void 0:e.Branch)==null?void 0:r.name,e==null?void 0:e.category,e==null?void 0:e.message,e==null?void 0:e.ip,e==null?void 0:e.action].some(x=>String(x||"").toLowerCase().includes(t)):!0}),N=async e=>{var t,a;try{await d.post(`/admin/audit/${e}/reverse`),await c()}catch(r){alert(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message||"Failed to reverse entry")}},g=async e=>{var t,a;if(confirm("Delete this audit entry?"))try{await d.delete(`/admin/audit/${e}`),await c()}catch(r){alert(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message||"Failed to delete entry")}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Audit Management"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Track logins, actions, and changes. Linked to dashboard activity widgets."})]}),s.jsx("input",{className:"rounded border px-3 py-2 text-sm",value:i,onChange:e=>u(e.target.value),placeholder:"Search audit…"})]}),o&&s.jsx("div",{className:"text-sm text-rose-600",children:o}),s.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:y?s.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):p.length===0?s.jsx("div",{className:"text-sm text-slate-500",children:"No entries."}):s.jsx("div",{className:"overflow-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"text-left",children:s.jsxs("tr",{className:"border-b",children:[s.jsx("th",{className:"py-2 pr-3",children:"Time"}),s.jsx("th",{className:"py-2 pr-3",children:"Branch"}),s.jsx("th",{className:"py-2 pr-3",children:"Staff"}),s.jsx("th",{className:"py-2 pr-3",children:"Category"}),s.jsx("th",{className:"py-2 pr-3",children:"Message"}),s.jsx("th",{className:"py-2 pr-3",children:"Action"}),s.jsx("th",{className:"py-2 pr-3",children:"IP"}),s.jsx("th",{className:"py-2 pr-3",children:"Ops"})]})}),s.jsx("tbody",{children:p.map(e=>{var t,a;return s.jsxs("tr",{className:"border-b last:border-0",children:[s.jsx("td",{className:"py-2 pr-3",children:new Date(e.createdAt||e.ts||Date.now()).toLocaleString()}),s.jsx("td",{className:"py-2 pr-3",children:((t=e==null?void 0:e.Branch)==null?void 0:t.name)||"-"}),s.jsx("td",{className:"py-2 pr-3",children:((a=e==null?void 0:e.User)==null?void 0:a.name)||"-"}),s.jsx("td",{className:"py-2 pr-3",children:e.category||"-"}),s.jsx("td",{className:"py-2 pr-3",children:e.message||"-"}),s.jsx("td",{className:"py-2 pr-3",children:e.action||"-"}),s.jsx("td",{className:"py-2 pr-3",children:e.ip||"-"}),s.jsx("td",{className:"py-2 pr-3",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{className:"px-2 py-1 rounded bg-slate-100",onClick:()=>N(e.id),children:"Reverse"}),s.jsx("button",{className:"px-2 py-1 rounded bg-rose-50 text-rose-700",onClick:()=>g(e.id),children:"Delete"})]})})]},e.id)})})]})})})]})}export{b as default};
