import{u as O,r as a,b as C,j as t}from"./index-DjV_TQlB.js";import{u as U}from"./usePaginatedFetch-bsoKGCJF.js";import{L as V}from"./ListShell-Bs-J9hUG.js";const P=["","OPERATING","ADMIN","MARKETING","OTHER"];function H(){const m=O(),[n,u]=a.useState(""),[l,p]=a.useState(""),[d,b]=a.useState(""),[c,h]=a.useState(""),[i,v]=a.useState(""),[x,g]=a.useState(""),[o,y]=a.useState(localStorage.getItem("activeBranchId")||""),[j,k]=a.useState([]);a.useEffect(()=>{(async()=>{try{const e=await C._get("/branches"),s=Array.isArray(e.data)?e.data:[];k(s),!o&&s.length&&y(String(s[0].id))}catch{k([])}})()},[]);const{rows:N,total:w,page:_,setPage:E,limit:T,setLimit:R,q:f,setQ:I,loading:L,error:M,refresh:A}=U({url:"/api/expenses",params:{date_from:n||void 0,date_to:l||void 0,type:d||void 0,vendor:c||void 0,min_amount:i||void 0,max_amount:x||void 0,branch_id:o||void 0}}),D=a.useMemo(()=>[{key:"date",title:"Date"},{key:"type",title:"Type"},{key:"vendor",title:"Vendor"},{key:"reference",title:"Reference"},{key:"amount",title:"Amount",render:({value:e})=>{const s=Number(e);return Number.isFinite(s)?s.toLocaleString():e??"—"}},{key:"note",title:"Note"}],[]),B=t.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 lg:items-end",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Date From"}),t.jsx("input",{type:"date",value:n,onChange:e=>u(e.target.value),className:"px-2 py-1 border rounded dark:bg-slate-700 dark:border-slate-600"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Date To"}),t.jsx("input",{type:"date",value:l,onChange:e=>p(e.target.value),className:"px-2 py-1 border rounded dark:bg-slate-700 dark:border-slate-600"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Type"}),t.jsx("select",{value:d,onChange:e=>b(e.target.value),className:"px-2 py-1 border rounded dark:bg-slate-700 dark:border-slate-600",children:P.map(e=>t.jsx("option",{value:e,children:e||"Any"},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Vendor"}),t.jsx("input",{value:c,onChange:e=>h(e.target.value),placeholder:"contains…",className:"px-2 py-1 border rounded dark:bg-slate-700 dark:border-slate-600"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Min Amount"}),t.jsx("input",{type:"number",step:"0.01",value:i,onChange:e=>v(e.target.value),className:"px-2 py-1 border rounded w-28 dark:bg-slate-700 dark:border-slate-600"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Max Amount"}),t.jsx("input",{type:"number",step:"0.01",value:x,onChange:e=>g(e.target.value),className:"px-2 py-1 border rounded w-28 dark:bg-slate-700 dark:border-slate-600"})]}),j.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs mb-1",children:"Branch"}),t.jsx("select",{value:o,onChange:e=>y(e.target.value),className:"px-2 py-1 border rounded dark:bg-slate-700 dark:border-slate-600",children:j.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))})]}),t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>A(),className:"px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Apply"}),t.jsx("button",{onClick:()=>{u(""),p(""),b(""),h(""),v(""),g(""),A()},className:"px-3 py-2 rounded border dark:border-slate-600",children:"Reset"}),t.jsx("button",{onClick:()=>m("/expenses/add"),className:"px-3 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700",children:"Add"}),t.jsx("button",{onClick:()=>m("/expenses/csv"),className:"px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"Upload CSV"}),t.jsx("button",{onClick:async()=>{try{const e={q:f||void 0,date_from:n||void 0,date_to:l||void 0,type:d||void 0,vendor:c||void 0,min_amount:i||void 0,max_amount:x||void 0,branch_id:o||void 0},s=await C._get("/expenses/export",{params:e,responseType:"blob"}),F=new Blob([s.data],{type:"text/csv;charset=utf-8"}),S=URL.createObjectURL(F),r=document.createElement("a");r.href=S,r.download=`expenses_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(S)}catch(e){alert((e==null?void 0:e.normalizedMessage)||(e==null?void 0:e.message)||"Export failed")}},className:"px-3 py-2 rounded bg-slate-700 text-white hover:bg-slate-800",children:"Export CSV"})]})]});return t.jsx(V,{title:"Expenses",q:f,setQ:I,columns:D,rows:Array.isArray(N)?N:[],loading:L,error:M,page:_,setPage:E,limit:T,setLimit:R,total:w,toolbar:B})}export{H as default};
