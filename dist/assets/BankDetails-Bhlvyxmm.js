import{i as re,r as i,g as d,j as e,L as E}from"./index-BR01ehMu.js";import{D as ce}from"./download-B1lk69X5.js";import{c as b}from"./createLucideIcon-S-tXfS_2.js";/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],z=b("arrow-right-left",le);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],oe=b("badge-check",ie);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],me=b("circle-check",de);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],he=b("circle-x",ue);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],pe=b("plus",xe);/**
 * @license lucide-react v0.535.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],je=b("refresh-cw",ye),g="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-5 md:p-7",n="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 focus:border-indigo-500 transition-all",N="inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",P="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700";function be(){const{id:a}=re(),[t,T]=i.useState(null),[r,U]=i.useState(null),[R,Z]=i.useState({transactionTypes:["deposit","withdrawal","loan_repayment","disbursement","fee","transfer_in","transfer_out","other"],statuses:["posted","pending","void"],channels:["bank","cash","mobile","card","other"]}),[I,F]=i.useState([]),[o,A]=i.useState({type:"",status:"",reconciled:"",from:"",to:""}),[c,y]=i.useState({type:"deposit",direction:"in",amount:"",occurredAt:"",reference:"",description:""}),[m,w]=i.useState({loanId:"",amount:"",occurredAt:"",reference:""}),[u,k]=i.useState({toBankId:"",amount:"",occurredAt:"",reference:""}),[h,C]=i.useState({cashAccountId:"",amount:"",occurredAt:"",reference:""}),[H,J]=i.useState([]),[X,Y]=i.useState([]),[f,q]=i.useState(!0),j=async()=>{var s,l,p,M,O;q(!0);try{const[B,te,x,ae,ne]=await Promise.all([d.get(`/banks/${a}`),d.get(`/banks/${a}/balance`),d.get("/banks/codes"),d.get(`/banks/${a}/transactions`,{params:_(o)}),d.get("/banks")]);T(B.data),U(te.data),Z({transactionTypes:Array.isArray((s=x.data)==null?void 0:s.transactionTypes)?x.data.transactionTypes:[],statuses:Array.isArray((l=x.data)==null?void 0:l.statuses)?x.data.statuses:[],channels:Array.isArray((p=x.data)==null?void 0:p.channels)?x.data.channels:[]}),F(ae.data||[]),Y((ne.data||[]).filter(L=>String(L.id)!==String(a))),(O=(M=x.data)==null?void 0:M.transactionTypes)!=null&&O.length&&!x.data.transactionTypes.includes(c.type)&&y(L=>({...L,type:x.data.transactionTypes[0],direction:D(x.data.transactionTypes[0])}))}catch(B){console.error(B)}finally{q(!1)}},G=async()=>{try{const s=await d.get("/banks/cash/accounts");J(s.data||[])}catch(s){console.error(s)}};i.useEffect(()=>{j(),G()},[a]),i.useEffect(()=>{(async()=>{try{const s=await d.get(`/banks/${a}/transactions`,{params:_(o)});F(s.data||[])}catch(s){console.error(s)}})()},[o]);const K=async s=>{var l;if(s.preventDefault(),!c.amount)return alert("Amount is required");try{await d.post(`/banks/${a}/transactions`,{...c,amount:Number(c.amount),occurredAt:c.occurredAt||void 0,direction:D(c.type),currency:t==null?void 0:t.currency}),y({type:((l=R.transactionTypes)==null?void 0:l[0])||"deposit",direction:"in",amount:"",occurredAt:"",reference:"",description:""}),await j()}catch(p){console.error(p),alert("Failed to create transaction")}},Q=async s=>{if(s.preventDefault(),!m.loanId||!m.amount)return alert("Loan ID and amount are required");try{await d.post(`/banks/${a}/repayments`,{...m,amount:Number(m.amount),occurredAt:m.occurredAt||void 0,currency:t==null?void 0:t.currency}),w({loanId:"",amount:"",occurredAt:"",reference:""}),await j()}catch(l){console.error(l),alert("Failed to record repayment")}},V=async s=>{if(s.preventDefault(),!u.toBankId||!u.amount)return alert("Target bank and amount are required");try{await d.post(`/banks/${a}/transfer`,{...u,amount:Number(u.amount),occurredAt:u.occurredAt||void 0,currency:t==null?void 0:t.currency}),k({toBankId:"",amount:"",occurredAt:"",reference:""}),await j()}catch(l){console.error(l),alert("Failed to transfer")}},W=async s=>{if(s.preventDefault(),!h.cashAccountId||!h.amount)return alert("Cash account and amount are required");try{await d.post(`/banks/${a}/transfer-to-cash`,{...h,amount:Number(h.amount),occurredAt:h.occurredAt||void 0,currency:t==null?void 0:t.currency}),C({cashAccountId:"",amount:"",occurredAt:"",reference:""}),await j()}catch(l){console.error(l),alert("Failed to transfer to cash")}},ee=async s=>{try{s.reconciled?await d.post(`/banks/transactions/${s.id}/unreconcile`):await d.post(`/banks/transactions/${s.id}/reconcile`,{bankRef:s.bankRef||"",note:s.note||""}),await j()}catch(l){console.error(l),alert("Failed to toggle reconciliation")}},se=async()=>{try{const s=await d.get(`/banks/${a}/statement`,{params:_({...o,includeOpening:1})}),l=new Blob([JSON.stringify(s.data,null,2)],{type:"application/json"}),p=document.createElement("a");p.href=URL.createObjectURL(l),p.download=`bank-statement-${(t==null?void 0:t.name)||a}.json`,p.click()}catch(s){console.error(s),alert("Failed to download statement")}},$=i.useMemo(()=>Array.isArray(I)?I:[],[I]),v=(t==null?void 0:t.currency)||"TZS";return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:[(t==null?void 0:t.name)||"Bank",t!=null&&t.branch?` — ${t.branch}`:""," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v,")"]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage transactions, repayments, transfers and reconciliation."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{to:"/banks",className:N,children:"Back"}),e.jsx(E,{to:`/banks/${a}/edit`,className:N,children:"Edit"}),e.jsxs("button",{onClick:se,className:N,children:[e.jsx(ce,{className:"h-4 w-4"})," Statement"]}),e.jsxs("button",{onClick:j,className:N,disabled:f,children:[e.jsx(je,{className:"h-4 w-4"})," ",f?"Loading…":"Refresh"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Balances"}),e.jsxs("div",{className:"text-sm grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-gray-500",children:"Opening"}),e.jsx("div",{className:"text-right font-medium",children:S(r==null?void 0:r.opening,v)}),e.jsx("div",{className:"text-gray-500",children:"Inflow"}),e.jsx("div",{className:"text-right font-medium",children:S(r==null?void 0:r.inflow,v)}),e.jsx("div",{className:"text-gray-500",children:"Outflow"}),e.jsx("div",{className:"text-right font-medium",children:S(r==null?void 0:r.outflow,v)}),e.jsx("div",{className:"text-gray-500",children:"Closing"}),e.jsx("div",{className:"text-right font-semibold",children:S(r==null?void 0:r.closing,v)})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["As of ",r!=null&&r.asOf?new Date(r.asOf).toLocaleString():"—"]})]}),e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"New Transaction"}),e.jsxs("form",{onSubmit:K,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsx("select",{className:n,value:c.type,onChange:s=>y({...c,type:s.target.value,direction:D(s.target.value)}),children:R.transactionTypes.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:c.amount,onChange:s=>y({...c,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At (optional)"}),e.jsx("input",{type:"datetime-local",className:n,value:c.occurredAt,onChange:s=>y({...c,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:c.reference,onChange:s=>y({...c,reference:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Description (optional)"}),e.jsx("input",{className:n,value:c.description,onChange:s=>y({...c,description:s.target.value})})]}),e.jsxs("button",{className:P,disabled:f,children:[e.jsx(pe,{className:"h-4 w-4"})," Create"]})]})]}),e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Loan Repayment (Bank)"}),e.jsxs("form",{onSubmit:Q,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Loan ID"}),e.jsx("input",{className:n,value:m.loanId,onChange:s=>w({...m,loanId:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:m.amount,onChange:s=>w({...m,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At (optional)"}),e.jsx("input",{type:"datetime-local",className:n,value:m.occurredAt,onChange:s=>w({...m,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:m.reference,onChange:s=>w({...m,reference:s.target.value})})]}),e.jsxs("button",{className:P,disabled:f,children:[e.jsx(oe,{className:"h-4 w-4"})," Record Repayment"]})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Transfer to Another Bank"}),e.jsxs("form",{onSubmit:V,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Target Bank"}),e.jsxs("select",{className:n,value:u.toBankId,onChange:s=>k({...u,toBankId:s.target.value}),children:[e.jsx("option",{value:"",children:"— Select —"}),X.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:u.amount,onChange:s=>k({...u,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At"}),e.jsx("input",{type:"datetime-local",className:n,value:u.occurredAt,onChange:s=>k({...u,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:u.reference,onChange:s=>k({...u,reference:s.target.value})})]}),e.jsxs("button",{className:N,disabled:f,children:[e.jsx(z,{className:"h-4 w-4"})," Transfer"]})]})]}),e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Transfer to Cash"}),e.jsxs("form",{onSubmit:W,className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Cash Account"}),e.jsxs("select",{className:n,value:h.cashAccountId,onChange:s=>C({...h,cashAccountId:s.target.value}),children:[e.jsx("option",{value:"",children:"— Select —"}),H.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",className:n,value:h.amount,onChange:s=>C({...h,amount:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Occurred At"}),e.jsx("input",{type:"datetime-local",className:n,value:h.occurredAt,onChange:s=>C({...h,occurredAt:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reference (optional)"}),e.jsx("input",{className:n,value:h.reference,onChange:s=>C({...h,reference:s.target.value})})]}),e.jsxs("button",{className:N,disabled:f,children:[e.jsx(z,{className:"h-4 w-4"})," Transfer"]})]})]}),e.jsxs("section",{className:g,children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Filter Transactions"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Type"}),e.jsxs("select",{className:n,value:o.type,onChange:s=>A({...o,type:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),R.transactionTypes.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Status"}),e.jsxs("select",{className:n,value:o.status,onChange:s=>A({...o,status:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),R.statuses.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Reconciled"}),e.jsxs("select",{className:n,value:o.reconciled,onChange:s=>A({...o,reconciled:s.target.value}),children:[e.jsx("option",{value:"",children:"Any"}),e.jsx("option",{value:"1",children:"Reconciled"}),e.jsx("option",{value:"0",children:"Not Reconciled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"From"}),e.jsx("input",{type:"date",className:n,value:o.from,onChange:s=>A({...o,from:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"To"}),e.jsx("input",{type:"date",className:n,value:o.to,onChange:s=>A({...o,to:s.target.value})})]})]})]})]}),e.jsxs("section",{className:`${g} mt-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Transactions"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Showing ",$.length," row(s)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"py-2 pr-4",children:"Date"}),e.jsx("th",{className:"py-2 pr-4",children:"Type"}),e.jsx("th",{className:"py-2 pr-4",children:"Direction"}),e.jsx("th",{className:"py-2 pr-4 text-right",children:"Amount"}),e.jsx("th",{className:"py-2 pr-4",children:"Reference"}),e.jsx("th",{className:"py-2 pr-4",children:"Loan"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"}),e.jsx("th",{className:"py-2 pr-4",children:"Reconciled"}),e.jsx("th",{className:"py-2 pr-4"})]})}),e.jsxs("tbody",{children:[$.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-2 pr-4",children:ge(s.occurredAt)}),e.jsx("td",{className:"py-2 pr-4",children:s.type}),e.jsx("td",{className:"py-2 pr-4",children:s.direction}),e.jsx("td",{className:"py-2 pr-4 text-right font-medium",children:S(s.amount,s.currency||v)}),e.jsx("td",{className:"py-2 pr-4",children:s.reference||"—"}),e.jsx("td",{className:"py-2 pr-4",children:s.loanId?String(s.loanId).slice(0,8):"—"}),e.jsx("td",{className:"py-2 pr-4",children:s.status}),e.jsx("td",{className:"py-2 pr-4",children:s.reconciled?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(me,{className:"h-4 w-4"})," Yes"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-500",children:[e.jsx(he,{className:"h-4 w-4"})," No"]})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx("button",{onClick:()=>ee(s),className:N,children:s.reconciled?e.jsx(e.Fragment,{children:"Unreconcile"}):e.jsx(e.Fragment,{children:"Reconcile"})})})]},s.id)),$.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"py-6 text-center text-gray-500",children:"No transactions"})})]})]})})]})]})}function S(a,t="TZS"){if(a==null)return"—";const T=Number(a);return Number.isNaN(T)?String(a):`${T.toLocaleString()} ${t}`}function ge(a){return a?new Date(a).toLocaleString():"—"}function D(a){return["withdrawal","disbursement","fee","transfer_out"].includes(a)?"out":"in"}function _(a){const t={};return a.type&&(t.type=a.type),a.status&&(t.status=a.status),a.reconciled!==""&&(t.reconciled=a.reconciled),a.from&&(t.from=a.from),a.to&&(t.to=a.to),t}export{be as default};
