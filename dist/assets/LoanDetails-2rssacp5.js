import{k as Ze,u as Ge,r as o,j as e,L as V,h as c}from"./index-p3hQqlDS.js";import{c as Ke,f as p,d as F,e as Qe,g as Xe,h as Ye,S as et,n as tt,i as we}from"./ScheduleTable-C2x4q8hK.js";const a={page:"w-full px-4 md:px-6 py-6 space-y-6 bg-[var(--bg)] text-[var(--fg)]",h1:"text-4xl font-extrabold tracking-tight",sub:"text-sm text-[var(--muted)]",card:"card rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",cardHead:"px-6 py-4 border-b-2 border-[var(--border)] bg-[var(--table-head-bg)] flex items-center justify-between rounded-t-2xl",cardBody:"px-6 py-6",cardBodyDense:"px-6 py-4",label:"text-[12px] uppercase tracking-wide text-[var(--muted)] font-semibold",actionLink:"inline-flex items-center gap-1 font-extrabold text-[var(--primary)] underline underline-offset-4 decoration-2 rounded focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",chip:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-[11px] font-extrabold uppercase ring-2 ring-[var(--border)] bg-[var(--badge-bg)] text-[var(--badge-fg)]",btn:"inline-flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg font-semibold border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)] hover:bg-[var(--chip-soft)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]",primary:"inline-flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg font-semibold bg-[var(--primary)] text-[var(--primary-contrast)] hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)] disabled:opacity-60",input:"w-full rounded-lg border-2 px-3 py-2 outline-none bg-[var(--input-bg)] text-[var(--input-fg)] border-[var(--input-border)] placeholder:text-[var(--input-placeholder)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg)]",tableWrap:"overflow-x-auto rounded-xl border-2 border-[var(--border-strong)] bg-[var(--card)]",th:"bg-[var(--table-head-bg)] text-left text-[12px] uppercase tracking-wide font-semibold px-3 py-2 border border-[var(--border)] text-[var(--fg)]/90",td:"px-3 py-2 border border-[var(--border)] text-sm text-[var(--fg)]"},H=({title:r,subtitle:b,right:s,children:J,dense:u=!1})=>e.jsxs("div",{className:a.card,children:[(r||b||s)&&e.jsxs("div",{className:a.cardHead,children:[e.jsxs("div",{className:"min-w-0",children:[r&&e.jsx("h3",{className:"text-xl md:text-2xl font-extrabold tracking-tight",children:r}),b&&e.jsx("p",{className:a.sub,children:b})]}),s]}),e.jsx("div",{className:u?a.cardBodyDense:a.cardBody,children:J})]}),N=({children:r})=>e.jsx("div",{className:a.label,children:r}),st=()=>{try{return(JSON.parse(localStorage.getItem("user")||"{}").role||"").toLowerCase()}catch{return""}},L=r=>r==="admin"||r==="director"||r==="superadmin",at=r=>["branch_manager","manager","bm"].includes(r)||L(r),nt=r=>["compliance","compliance_officer","legal"].includes(r)||L(r),rt=r=>["accountant","finance"].includes(r)||L(r),lt=r=>["loan_officer","officer"].includes(r)&&!L(r);function it(r){if(!r)return"";const b=String(r).toLowerCase();return b==="pending"?"submitted":b==="approved"?"accounting":""}function dt(){var je,Ne;const{id:r}=Ze(),b=Ge(),[s,J]=o.useState(null),[u,Y]=o.useState(null),[y,ee]=o.useState([]),[te,P]=o.useState([]),[x,E]=o.useState(null),[Se,se]=o.useState(!0),[ke,ae]=o.useState(!0),[Ce,ne]=o.useState(!0),[Re,re]=o.useState(!1),[le,ie]=o.useState(null),[d,D]=o.useState(""),[S,oe]=o.useState(""),[f,O]=o.useState(!1),[Z,G]=o.useState(""),[Le,T]=o.useState(!1),[ce,de]=o.useState(!1),[k,A]=o.useState({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),[De,K]=o.useState(!1),[Ae,_]=o.useState(!1),[h,M]=o.useState({amount:"",interestRate:"",termMonths:"",startDate:""}),[me,ue]=o.useState(!1),[Me,I]=o.useState(!1),[v,B]=o.useState({termMonths:"",startDate:"",previewOnly:!1}),[xe,he]=o.useState(!1),m=(s==null?void 0:s.currency)||"TZS",$e=a.chip,C=st(),Q=at(C),pe=nt(C),Fe=rt(C),Pe=lt(C),Ee=L(C)||Q||pe,Oe=L(C)||Q,R=(s==null?void 0:s.workflowStage)||it(s==null?void 0:s.status),be=Pe&&["changes_requested","bm_changes_requested","compliance_changes_requested","returned_to_officer","request_changes"].includes(R),q=Q&&["submitted","bm_review","changes_resubmitted"].includes(R),fe=pe&&["compliance","compliance_review"].includes(R),ge=Fe&&((s==null?void 0:s.status)==="approved"||R==="accounting"),ve=o.useRef(null),g=async()=>{se(!0),ie(null);try{const{data:t}=await c.get(`/loans/${r}`);J(t),oe(String((t==null?void 0:t.amount)??""));const n=[c.get(`/repayments/loan/${r}`).then(i=>ee(i.data||[])).catch(()=>ee([])).finally(()=>ae(!1)),c.get(`/comments/loan/${r}`).then(i=>P(Array.isArray(i.data)?i.data:[])).catch(()=>P([])).finally(()=>ne(!1))];t!=null&&t.productId&&n.push(c.get(`/loan-products/${t.productId}`).then(i=>Y(i.data)).catch(()=>Y(null))),re(!0),n.push(c.get(`/loans/${r}/schedule`).then(i=>E(tt(i.data))).catch(()=>E(null)).finally(()=>re(!1))),await Promise.all(n)}catch(t){console.error(t),ie("Failed to fetch loan.")}finally{se(!1)}};o.useEffect(()=>{ve.current!==r&&(ve.current=r,E(null),D(""),G(""),ae(!0),ne(!0),g())},[r]),o.useEffect(()=>{const t=()=>g();return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[]),o.useEffect(()=>{const t=n=>{var i;String((i=n==null?void 0:n.detail)==null?void 0:i.id)===String(r)&&g()};return window.addEventListener("loan:updated",t),()=>window.removeEventListener("loan:updated",t)},[r]);async function $(t){try{await c.post("/comments",{loanId:r,content:t});const n=await c.get(`/comments/loan/${r}`);P(Array.isArray(n.data)?n.data:[])}catch{}}async function W(t,n={}){O(!0);try{await c.post(`/loans/${r}/workflow`,{action:t,comment:(d==null?void 0:d.trim())||void 0,suggestedAmount:n.suggestedAmount!=null&&n.suggestedAmount!==""?Number(n.suggestedAmount):void 0}),await g(),D(""),alert("Action applied.")}catch{try{t==="bm_approve"||t==="compliance_approve"?(await c.patch(`/loans/${r}/status`,{status:"approved"}),d.trim()&&await $(d.trim())):t==="reject"?(await c.patch(`/loans/${r}/status`,{status:"rejected"}),d.trim()&&await $(d.trim())):t==="request_changes"?d.trim()&&await $(`Changes requested: ${d.trim()}`):t==="resubmit"&&(await c.patch(`/loans/${r}/status`,{status:"pending"}),d.trim()&&await $(`Resubmitted: ${d.trim()}`)),await g(),D(""),alert("Action applied (fallback).")}catch(l){console.error(l),alert("Failed to apply action.")}}finally{O(!1)}}async function Te(){if(!S||Number(S)<=0){alert("Enter a valid amount.");return}O(!0);try{await c.patch(`/loans/${r}`,{amount:Number(S)}),d.trim()&&await $(`Suggested amount: ${p(S,m)} — ${d.trim()}`),await g(),alert("Suggestion saved.")}catch(t){console.error(t),alert("Failed to save suggestion.")}finally{O(!1)}}const _e=async()=>{const t=Number(z||0);if(!(t>0&&!window.confirm("Outstanding > 0. Close anyway?")))try{await c.patch(`/loans/${r}/status`,{status:"closed",override:t>0}),await g(),alert("Loan closed.")}catch(n){console.error(n),alert("Failed to close loan.")}},Ie=async()=>{if(Z.trim())try{const t=await c.post("/comments",{loanId:r,content:Z});P(n=>[t.data,...n]),G("")}catch(t){console.error(t),alert("Failed to add comment.")}},Be=async()=>{const t=Number(k.amount);if(!t||t<=0)return alert("Enter a valid amount.");de(!0);try{if(await c.post("/repayments",{loanId:r,...k,amount:t}),s!=null&&s.status&&!["active","closed"].includes(String(s.status).toLowerCase()))try{await c.patch(`/loans/${r}/status`,{status:"active"})}catch{}await g(),T(!1),A({amount:"",date:new Date().toISOString().slice(0,10),method:"cash",notes:""}),window.dispatchEvent(new CustomEvent("loan:updated",{detail:{id:r}})),alert("Repayment posted.")}catch(n){console.error(n),alert("Failed to post repayment.")}finally{de(!1)}},qe=()=>{M({amount:(s==null?void 0:s.amount)??"",interestRate:(s==null?void 0:s.interestRate)??"",termMonths:(s==null?void 0:s.termMonths)??(s==null?void 0:s.durationMonths)??"",startDate:we((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate))}),_(!0)},We=async()=>{var n,i;const t={amount:h.amount===""?void 0:Number(h.amount),interestRate:h.interestRate===""?void 0:Number(h.interestRate),termMonths:h.termMonths===""?void 0:Number(h.termMonths),startDate:h.startDate||void 0};if(Number.isFinite(t.amount)&&t.amount<=0)return alert("Amount must be > 0");if(Number.isFinite(t.termMonths)&&t.termMonths<=0)return alert("Term must be > 0");ue(!0);try{await c.patch(`/loans/${r}`,t),_(!1),await g(),alert("Loan updated.")}catch(l){console.error(l),alert(((i=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:i.error)||"Failed to update loan.")}finally{ue(!1)}},ze=async()=>{var t,n;if(window.confirm("This will permanently delete this loan. Continue?"))try{await c.delete(`/loans/${r}`),alert("Loan deleted."),b("/loans")}catch(i){console.error(i),alert(((n=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:n.error)||"Failed to delete loan.")}},Ue=()=>{B({termMonths:(s==null?void 0:s.termMonths)??"",startDate:we((s==null?void 0:s.startDate)||(s==null?void 0:s.releaseDate)),previewOnly:!1}),I(!0)},Ve=async()=>{var n,i;const t={termMonths:v.termMonths===""?void 0:Number(v.termMonths),startDate:v.startDate||void 0,previewOnly:!!v.previewOnly};if(Number.isFinite(t.termMonths)&&t.termMonths<=0)return alert("Term must be > 0");he(!0);try{const{data:l}=await c.post(`/loans/${r}/reschedule`,t);Array.isArray(l==null?void 0:l.schedule)&&E(l.schedule),I(!1),await g(),alert((l==null?void 0:l.message)||"Schedule updated.")}catch(l){console.error(l),alert(((i=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:i.error)||"Failed to reschedule.")}finally{he(!1)}},He=async()=>{var t,n,i;if(window.confirm("Reissue creates a new pending loan cloned from this one. Continue?"))try{const{data:l}=await c.post(`/loans/${r}/reissue`),ye=((t=l==null?void 0:l.loan)==null?void 0:t.id)||(l==null?void 0:l.id);alert("New loan created."),ye&&b(`/loans/${ye}`)}catch(l){console.error(l),alert(((i=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:i.error)||"Failed to reissue loan.")}},j=o.useMemo(()=>Ke(x||[],y||[]),[x,y]),X=Array.isArray(x)&&x.length>0,z=(s==null?void 0:s.status)==="closed"?0:X?j.outstanding:(s==null?void 0:s.outstanding)??null,w=X?j.nextDue:null,U=o.useMemo(()=>{const t=y.length||0,n=y.reduce((i,l)=>i+Number(l.amount||0),0);return{count:t,sum:n}},[y]),Je=(s==null?void 0:s.status)!=="closed"&&Number(z||0)>0;return Se?e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:"Loading loan…"}):le?e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:le}):s?e.jsxs("div",{className:a.page,children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:a.h1,children:"Loan Details"}),e.jsx("span",{className:$e,children:s.status}),R&&e.jsxs("span",{className:a.chip,children:["Stage: ",R.replaceAll("_"," ")]})]}),e.jsx("button",{onClick:()=>b(-1),className:a.actionLink,children:"← Back"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-6",children:[e.jsxs("div",{className:"col-span-2 min-w-0",children:[e.jsx(N,{children:"Borrower"}),e.jsxs(V,{className:`${a.actionLink} text-lg md:text-xl truncate`,to:`/borrowers/${s.borrowerId}`,title:((je=s.Borrower)==null?void 0:je.name)||s.borrowerName||"N/A",children:[((Ne=s.Borrower)==null?void 0:Ne.name)||s.borrowerName||"N/A"," ",e.jsx("span",{children:"›"})]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Amount"}),e.jsx("div",{className:"text-2xl font-extrabold",children:p(s.amount,m)})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Interest"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-bold",children:[s.interestRate,"%"]})," ",e.jsxs("span",{children:["· ",s.interestMethod||"—"]})]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Term"}),e.jsxs("div",{className:"text-base font-semibold",children:[s.termMonths||s.durationMonths," months"]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Start / Release"}),e.jsx("div",{className:"text-base font-semibold",children:F(s.startDate||s.releaseDate)})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Outstanding"}),e.jsx("div",{className:"text-2xl font-extrabold",children:z==null?"—":p(z,m)})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Next Due"}),e.jsx("div",{className:"text-base font-semibold",children:w?e.jsxs(e.Fragment,{children:[F(w.date)," ·"," ",e.jsx("span",{className:"font-extrabold",children:p(w.amount,m)})]}):"—"})]}),u&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3 xl:col-span-4",children:[e.jsx(N,{children:"Product"}),e.jsxs("div",{className:"text-base",children:[e.jsxs("span",{className:"font-extrabold",children:[u.name,u.code?` (${u.code})`:""]}),e.jsxs("div",{className:"text-sm mt-0.5",children:["Defaults: ",u.interestMethod," @"," ",u.interestRate??u.defaultInterestRate,"% · Limits:"," ",p(u.minPrincipal,m)," –"," ",p(u.maxPrincipal,m),", ",u.minTermMonths,"-",u.maxTermMonths," months"]})]})]})]}),e.jsx("div",{className:"mt-6 grid sm:grid-cols-3 lg:grid-cols-6 gap-4 text-sm",children:[["Paid Principal",j.paidPrincipal],["Paid Interest",j.paidInterest],["Paid Penalties",j.paidPenalty],["Paid Fees",j.paidFees],["Total Paid",j.totalPaid],["Total Scheduled",j.scheduledTotal]].map(([t,n])=>e.jsxs("div",{className:"rounded-xl border-2 border-[var(--border-strong)] p-3 bg-[var(--card)] shadow-sm",children:[e.jsx("div",{className:a.label,children:t}),e.jsx("div",{className:"font-bold text-lg",children:X?p(n,m):"—"})]},t))})]}),(be||q||fe||ge)&&e.jsxs(H,{dense:!0,children:[be&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-extrabold",children:"Changes Requested"}),e.jsxs("p",{className:"text-sm",children:["Update the application and attach missing documents, then"," ",e.jsx("strong",{children:"Resubmit"}),". Add a short note if helpful."]}),e.jsx("label",{className:"block text-xs font-semibold",children:"Comment (optional)"}),e.jsx("textarea",{value:d,onChange:t=>D(t.target.value),className:`${a.input} min-h-[44px]`,placeholder:"What did you fix / add?"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>W("resubmit"),disabled:f,className:a.primary,title:"Send for review again",children:f?"Submitting…":"Resubmit for Review"}),e.jsx(V,{to:"/loans/applications",className:a.btn,title:"Open applications to edit details/attachments",children:"Edit Application"})]})]}),(q||fe)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-extrabold",children:q?"Branch Manager Review":"Compliance Review"})}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold",children:"Suggested Principal"}),e.jsx("input",{type:"number",className:a.input,value:S,onChange:t=>oe(t.target.value),min:"0",step:"0.01"}),e.jsx("p",{className:"text-[11px] text-[var(--muted)] mt-1",children:"Save a suggestion or approve with a different amount."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold",children:"Comment"}),e.jsx("textarea",{className:`${a.input} min-h-[44px]`,placeholder:"Why approving / changes / rejection?",value:d,onChange:t=>D(t.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:()=>W(q?"bm_approve":"compliance_approve",{suggestedAmount:S}),disabled:f,className:a.primary,children:f?"Working…":"Approve"}),e.jsx("button",{onClick:()=>W("request_changes"),disabled:f,className:a.btn,title:"Send back to Loan Officer with requested changes",children:f?"Working…":"Request Changes"}),e.jsx("button",{onClick:()=>W("reject"),disabled:f,className:a.btn,children:f?"Working…":"Reject"}),e.jsx("button",{onClick:Te,disabled:f,className:a.btn,children:f?"Saving…":"Save Suggestion"})]})]}),ge&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm",children:"This loan is approved. Proceed to disbursement to finalize payout."}),e.jsx(V,{to:`/loans/${r}/disburse`,className:a.primary,children:"Disburse"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(V,{to:"/loans",className:a.btn,children:"Back to Loans"}),e.jsx("button",{onClick:()=>K(!0),className:a.btn,children:"View Schedule"}),e.jsx("button",{onClick:()=>Qe({loan:s,schedule:x||[],currency:m}),className:a.btn,disabled:!Array.isArray(x)||!x.length,children:"Export CSV"}),e.jsx("button",{onClick:()=>Xe({loan:s,schedule:x||[],currency:m}),className:a.btn,disabled:!Array.isArray(x)||!x.length,children:"Export PDF"}),Je&&e.jsx("button",{onClick:()=>T(!0),className:a.btn,children:"Post Repayment"}),Ee&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:qe,className:a.btn,children:"Edit Loan"}),e.jsx("button",{onClick:Ue,className:a.btn,children:"Reschedule"})]}),e.jsx("button",{onClick:He,className:a.btn,children:"Reissue"}),Oe&&e.jsx("button",{onClick:ze,className:"px-3 md:px-4 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700 shadow-sm",children:"Delete"}),s.status!=="closed"&&e.jsx("button",{onClick:_e,className:a.btn,children:"Close Loan"})]}),e.jsx(H,{title:"Repayments",right:e.jsxs("div",{className:"text-sm font-semibold",children:[U.count," record",U.count===1?"":"s"," · Total"," ",e.jsx("span",{className:"font-extrabold",children:p(U.sum,m)})]}),children:ke?e.jsx("p",{children:"Loading repayments…"}):y.length===0?e.jsx("div",{className:"text-sm",children:"No repayments found."}):e.jsx("div",{className:a.tableWrap,children:e.jsxs("table",{className:"min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsx("tr",{className:"text-left sticky top-0 z-10",children:["#","Date","Amount","Method","Notes"].map(t=>e.jsx("th",{className:a.th,children:t},t))})}),e.jsx("tbody",{children:y.map((t,n)=>e.jsxs("tr",{className:`${n%2===0?"bg-[var(--table-row-even)]":"bg-[var(--table-row-odd)]"} hover:bg-[var(--chip-soft)] transition-colors`,children:[e.jsx("td",{className:a.td,children:n+1}),e.jsx("td",{className:a.td,children:F(t.date)}),e.jsx("td",{className:`${a.td} text-right tabular-nums`,children:p(t.amount,m)}),e.jsx("td",{className:a.td,children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-bold bg-[var(--badge-bg)] text-[var(--badge-fg)] ring-1 ring-[var(--border)]",children:t.method||"—"})}),e.jsx("td",{className:`${a.td} break-words`,children:t.notes||"—"})]},t.id||n))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:`${a.td} font-bold`,colSpan:2,children:"Total"}),e.jsx("td",{className:`${a.td} text-right text-base font-extrabold`,children:p(U.sum,m)}),e.jsx("td",{className:a.td,colSpan:2})]})})]})})}),e.jsxs(H,{title:"Comments",children:[Ce?e.jsx("p",{children:"Loading comments…"}):te.length===0?e.jsx("div",{className:"text-sm",children:"No comments yet."}):e.jsx("div",{className:"space-y-3 max-h-72 overflow-auto pr-1",children:te.map((t,n)=>{var i,l;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[var(--badge-bg)] text-[var(--badge-fg)] flex items-center justify-center text-xs font-extrabold select-none",children:(((i=t.author)==null?void 0:i.name)||"U").slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-1 border-b-2 border-[var(--border)] pb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-[var(--muted)]",children:[e.jsx("span",{className:"font-bold text-[var(--fg)]",children:((l=t.author)==null?void 0:l.name)||"User"}),e.jsx("span",{children:Ye(t.createdAt)})]}),e.jsx("p",{className:"text-sm mt-0.5 break-words",children:t.content})]})]},t.id||n)})}),e.jsxs("div",{className:"mt-4 flex items-start gap-2",children:[e.jsx("textarea",{value:Z,onChange:t=>G(t.target.value),className:`${a.input} min-h-[44px]`,placeholder:"Add a comment"}),e.jsx("button",{onClick:Ie,className:a.primary,children:"Post"})]})]}),Le&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-3xl p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Post Repayment"}),e.jsx("button",{onClick:()=>T(!1),className:a.actionLink,children:"✕"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:k.amount,onChange:t=>A(n=>({...n,amount:t.target.value})),className:a.input,min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Date"}),e.jsx("input",{type:"date",value:k.date,onChange:t=>A(n=>({...n,date:t.target.value})),className:a.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Method"}),e.jsxs("select",{value:k.method,onChange:t=>A(n=>({...n,method:t.target.value})),className:a.input,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile",children:"Mobile Money"}),e.jsx("option",{value:"bank",children:"Bank"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:k.notes,onChange:t=>A(n=>({...n,notes:t.target.value})),className:a.input,placeholder:"Receipt no., reference, etc."})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>T(!1),className:a.btn,children:"Cancel"}),e.jsx("button",{onClick:Be,disabled:ce,className:a.primary,children:ce?"Posting…":"Post"})]})]})}),De&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-6xl p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Repayment Schedule"}),e.jsx("button",{onClick:()=>K(!1),className:a.actionLink,children:"✕"})]}),Re?e.jsx("p",{children:"Loading schedule…"}):!Array.isArray(x)||x.length===0?e.jsx("p",{children:"No schedule available."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Disbursed:"})," ",F((s==null?void 0:s.releaseDate)||(s==null?void 0:s.startDate))||"—"]}),e.jsxs("div",{children:["Next installment: ",w?e.jsxs(e.Fragment,{children:[e.jsxs("b",{children:["#",w.idx]})," on ",F(w.date)," —"," ",e.jsx("b",{children:p(w.amount,m)})]}):"—"]})]}),e.jsx("div",{className:"max-h-[75vh] overflow-auto rounded-xl border-2 border-[var(--border-strong)]",children:e.jsx(et,{schedule:x||[],currency:m})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>K(!1),className:a.btn,children:"Close"})})]})}),Ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Edit Loan"}),e.jsx("button",{onClick:()=>_(!1),className:a.actionLink,children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Amount"}),e.jsx("input",{type:"number",value:h.amount,onChange:t=>M(n=>({...n,amount:t.target.value})),className:a.input,min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",value:h.interestRate,onChange:t=>M(n=>({...n,interestRate:t.target.value})),className:a.input,step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Term (months)"}),e.jsx("input",{type:"number",value:h.termMonths,onChange:t=>M(n=>({...n,termMonths:t.target.value})),className:a.input})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"Start Date"}),e.jsx("input",{type:"date",value:h.startDate,onChange:t=>M(n=>({...n,startDate:t.target.value})),className:a.input})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>_(!1),className:a.btn,children:"Cancel"}),e.jsx("button",{onClick:We,disabled:me,className:a.primary,children:me?"Saving…":"Save"})]})]})}),Me&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl w-full max-w-lg p-6 border-2 border-[var(--border-strong)] bg-[var(--card)] text-[var(--fg)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-2xl font-extrabold",children:"Reschedule Loan"}),e.jsx("button",{onClick:()=>I(!1),className:a.actionLink,children:"✕"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"New Term (months)"}),e.jsx("input",{type:"number",value:v.termMonths,onChange:t=>B(n=>({...n,termMonths:t.target.value})),className:a.input,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold",children:"New Start Date"}),e.jsx("input",{type:"date",value:v.startDate,onChange:t=>B(n=>({...n,startDate:t.target.value})),className:a.input})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-semibold",children:[e.jsx("input",{type:"checkbox",checked:v.previewOnly,onChange:t=>B(n=>({...n,previewOnly:t.target.checked}))}),"Preview only (don’t save)"]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>I(!1),className:a.btn,children:"Cancel"}),e.jsx("button",{onClick:Ve,disabled:xe,className:a.primary,children:xe?"Working…":v.previewOnly?"Preview":"Reschedule"})]})]})})]}):e.jsx("div",{className:"w-full px-6 py-6 text-[var(--fg)]",children:"Loan not found."})}export{dt as default};
