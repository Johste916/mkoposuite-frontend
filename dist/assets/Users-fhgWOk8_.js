import{r as i,j as e,h as p}from"./index-p3hQqlDS.js";const j=(d="")=>/.+@.+\..+/.test(d),a={page:"w-full px-4 md:px-6 lg:px-10 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",sub:"text-sm text-slate-700",card:"rounded-2xl border-2 border-slate-300 bg-white shadow",th:"bg-slate-100 text-left text-[12px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-2 border-slate-200",td:"px-3 py-2 border-2 border-slate-200 text-sm",field:"h-11 w-full rounded-lg border-2 border-slate-300 bg-white text-sm px-3 outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-600",btn:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50 font-semibold",btnPrimary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-3 py-2 font-semibold hover:bg-indigo-700",btnDanger:"inline-flex items-center rounded-lg border-2 border-rose-300 text-rose-600 px-3 py-2 hover:bg-rose-50 font-semibold"},U=()=>{const[d,m]=i.useState([]),[n,o]=i.useState(""),[b,w]=i.useState(!1),[k,N]=i.useState(!1),[u,v]=i.useState(!1),[t,x]=i.useState({name:"",email:"",password:"",id:null}),f=i.useRef(),h=async(s="")=>{var l;w(!0);try{const r=await p.get("/users",{params:{q:s,limit:100}}),c=Array.isArray(r.data)?r.data:((l=r.data)==null?void 0:l.items)||[];m(c)}catch(r){console.error("Error fetching users:",r)}finally{w(!1)}};i.useEffect(()=>{h()},[]),i.useEffect(()=>(clearTimeout(f.current),f.current=setTimeout(()=>h(n),300),()=>clearTimeout(f.current)),[n]);const y=(s={name:"",email:"",password:"",id:null})=>{x(s),N(!0)},g=()=>{u||(x({name:"",email:"",password:"",id:null}),N(!1))},E=async()=>{var s,l;if(!t.name.trim()||!j(t.email))return alert("Please provide a valid name and email.");if(!t.id&&!t.password.trim())return alert("Please set an initial password for this user.");v(!0);try{t.id?(await p.put(`/users/${t.id}`,{name:t.name.trim(),email:t.email.trim()}),alert("User updated successfully")):(await p.post("/users",{name:t.name.trim(),email:t.email.trim(),password:t.password.trim()}),alert("User created successfully")),g(),h(n)}catch(r){console.error("Submit error:",r),alert(((l=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:l.error)||"Error saving user")}finally{v(!1)}},S=async s=>{var l,r;if(window.confirm("Delete this user?"))try{await p.delete(`/users/${s}`),alert("User deleted"),h(n)}catch(c){console.error("Delete error:",c),alert(((r=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:r.error)||"Error deleting user")}};return e.jsxs("div",{className:a.page,children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:a.h1,children:"Users"}),e.jsx("p",{className:a.sub,children:"Create, edit, and manage users."})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Search"}),e.jsx("input",{className:`${a.field} w-64 h-10`,placeholder:"name or email…",value:n,onChange:s=>o(s.target.value)})]}),e.jsx("button",{className:a.btnPrimary,onClick:()=>y(),children:"+ New User"})]})]}),e.jsx("div",{className:`${a.card} overflow-x-auto`,children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsx("tr",{children:["#","Name","Email","Actions"].map((s,l)=>e.jsx("th",{className:`${a.th} ${l===3?"text-right":""}`,children:s},s))})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:`${a.td} text-center py-8 text-slate-600`,children:"Loading…"})}):d.length?d.map((s,l)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:a.td,children:l+1}),e.jsx("td",{className:a.td,children:s.name}),e.jsx("td",{className:a.td,children:s.email}),e.jsx("td",{className:`${a.td} text-right`,children:e.jsxs("div",{className:"inline-flex gap-2",children:[e.jsx("button",{className:a.btn,onClick:()=>y(s),children:"Edit"}),e.jsx("button",{className:a.btnDanger,onClick:()=>S(s.id),children:"Delete"})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:`${a.td} text-center py-8 text-slate-600`,children:"No users found"})})})]})}),k&&e.jsx(C,{title:t.id?"Edit User":"Add New User",onClose:g,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Full name"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>x({...t,name:s.target.value}),className:a.field})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>x({...t,email:s.target.value}),className:`${a.field} ${t.email&&!j(t.email)?"!border-rose-400":""}`}),t.email&&!j(t.email)&&e.jsx("div",{className:"text-[12px] text-rose-600 mt-1",children:"Please enter a valid email."})]}),!t.id&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[12px] font-semibold text-slate-600",children:"Initial Password"}),e.jsx("input",{type:"password",placeholder:"Enter initial password",value:t.password,onChange:s=>x({...t,password:s.target.value}),className:a.field}),e.jsx("div",{className:"text-[12px] text-slate-500 mt-1",children:"Set an initial password (user can reset later)"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[e.jsx("button",{className:a.btn,onClick:g,disabled:u,children:"Cancel"}),e.jsx("button",{className:`${a.btnPrimary} disabled:opacity-50`,onClick:E,disabled:u,children:u?"Saving…":t.id?"Update":"Create"})]})]})})]})};function C({title:d,onClose:m,children:n}){return i.useEffect(()=>{const o=b=>{b.key==="Escape"&&m()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[m]),e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",onClick:m,children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border-2 border-slate-300 bg-white p-5 shadow",onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold tracking-tight mb-3",children:d}),n]})})}export{U as default};
