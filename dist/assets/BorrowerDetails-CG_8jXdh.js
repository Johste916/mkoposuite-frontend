import{c as S,d as C,r as n,j as s,a as x}from"./index-BAFAFUIz.js";import{E as P}from"./jspdf.es.min-DOzhIBJD.js";import"./jspdf.plugin.autotable-TLQB5wf7.js";import{C as H}from"./index-BFi-Sfyd.js";import{g as I}from"./auth-CO9T0zV9.js";var _={exports:{}};(function(u,f){(function(c,m){m()})(S,function(){function c(e,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function m(e,t,d){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){h(o.response,t,d)},o.onerror=function(){console.error("could not download file")},o.send()}function b(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function w(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof S=="object"&&S.global===S?S:void 0,g=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(e,t,d){var o=l.URL||l.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener",typeof e=="string"?(i.href=e,i.origin===location.origin?w(i):b(i.href)?m(e,t,d):w(i,i.target="_blank")):(i.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(i.href)},4e4),setTimeout(function(){w(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,d){if(t=t||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(c(e,d),t);else if(b(e))m(e,t,d);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){w(o)})}}:function(e,t,d,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),typeof e=="string")return m(e,t,d);var i=e.type==="application/octet-stream",N=/constructor/i.test(l.HTMLElement)||l.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||i&&N||g)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var v=E.result;v=j?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=v:location=v,o=null},E.readAsDataURL(e)}else{var T=l.URL||l.webkitURL,R=T.createObjectURL(e);o?o.location=R:location.href=R,o=null,setTimeout(function(){T.revokeObjectURL(R)},4e4)}});l.saveAs=h.saveAs=h,u.exports=h})})(_);const se=()=>{var D;const{id:u}=C(),f="https://mkoposuite-backend-42w2.onrender.com/api";I();const[c,m]=n.useState(null),[b,w]=n.useState([]),[l,g]=n.useState([]),[h,e]=n.useState([]),[t,d]=n.useState("overview"),[o,i]=n.useState(""),[N,j]=n.useState({}),[E,T]=n.useState(!1),[R,v]=n.useState({loanId:"",amount:"",method:"manual",date:new Date().toISOString().split("T")[0]}),[V,Z]=n.useState(!1),[q,G]=n.useState([]),[X,z]=n.useState(null),[y,O]=n.useState([]),[K,$]=n.useState([]),[W,k]=n.useState(0),[Y,J]=n.useState({type:"deposit",amount:"",date:new Date().toISOString().split("T")[0],notes:""}),[A,Q]=n.useState("all");n.useEffect(()=>{(async()=>{try{const a=await x.get(`${f}/borrowers/${u}`);m(a.data),j(a.data);const p=await x.get(`${f}/loans/borrower/${u}`);w(p.data);const M=await x.get(`${f}/repayments/borrower/${u}`);g(M.data);const U=await x.get(`${f}/comments/borrower/${u}`);e(U.data);const F=await x.get(`${f}/savings/borrower/${u}`);O(F.data.transactions),k(F.data.balance),$(F.data.transactions)}catch(a){console.error(a)}})()},[u]),n.useEffect(()=>{$(A==="all"?y:y.filter(r=>r.type===A))},[A,y]);const L=r=>y.filter(a=>a.type===r).reduce((a,p)=>a+p.amount,0),B=()=>{const r=[];return b.forEach(a=>r.push({type:"loan",date:a.createdAt,text:`Loan ${a.id} - ${a.status.toUpperCase()}`})),l.forEach(a=>r.push({type:"repayment",date:a.date,text:`Repayment of TZS ${a.amount.toLocaleString()}`})),y.forEach(a=>r.push({type:"savings",date:a.date,text:`${a.type} of TZS ${a.amount.toLocaleString()}`})),h.forEach(a=>r.push({type:"comment",date:a.createdAt,text:`Note: ${a.content}`})),r.sort((a,p)=>new Date(p.date)-new Date(a.date))};return L("deposit"),L("withdrawal"),L("charge"),L("interest"),c?s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Borrower Details"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(H,{data:[c],filename:`borrower-${c.id}.csv`,className:"bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700 text-sm",children:"Export CSV"}),s.jsx("button",{onClick:()=>{const r=new P;r.text(`Borrower Profile: ${c.name}`,14,16),r.autoTable({startY:20,head:[["Field","Value"]],body:Object.entries(c).map(([a,p])=>[a,String(p)])}),r.save(`borrower-${c.id}.pdf`)},className:"bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm",children:"Export PDF"})]})]}),s.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded",children:[s.jsx("h4",{className:"font-semibold text-yellow-700 mb-1",children:"⚠️ Risk Summary"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Overdue Amount:"})," TZS ",((D=c.overdueAmount)==null?void 0:D.toLocaleString())||"0"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"PAR:"})," ",c.parPercent?c.parPercent+"%":"0%"]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"📜 Activity Timeline"}),s.jsx("ul",{className:"space-y-2 text-sm",children:B().map((r,a)=>s.jsxs("li",{className:"border-l-4 pl-2 border-gray-300",children:[s.jsx("span",{className:"text-gray-500",children:new Date(r.date).toLocaleDateString()})," – ",r.text]},a))})]})]}):s.jsx("div",{className:"p-4",children:"Loading..."})};export{se as default};
