import{i as v,r as a,j as e,g as p}from"./index-BVWWaTks.js";function S(r,t=250){const[h,m]=a.useState(r);return a.useEffect(()=>{const d=setTimeout(()=>m(r),t);return()=>clearTimeout(d)},[r,t]),h}function A({value:r,onChange:t,placeholder:h="Search name, phone or ID…"}){const[m,d]=a.useState(""),[x,c]=a.useState(!1),[n,u]=a.useState([]),[g,b]=a.useState(!1),o=a.useRef(null),i=S(m,250);a.useEffect(()=>{const s=l=>{o.current&&(o.current.contains(l.target)||c(!1))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),a.useEffect(()=>{let s=!1;return(async()=>{var l,N;if(!i||i.length<1){u([]);return}b(!0);try{const j=await((N=(l=p)._get)==null?void 0:N.call(l,`/borrowers/search?q=${encodeURIComponent(i)}`).catch(()=>p.get(`/borrowers/search?q=${encodeURIComponent(i)}`))),w=Array.isArray(j==null?void 0:j.data)?j.data:[];s||u(w)}catch{s||u([])}finally{s||b(!1)}})(),()=>{s=!0}},[i]);const y=s=>{d(`${s.name??""} (${s.id})`),c(!1),t==null||t(s.id,s)},f=g?"Searching…":x&&n.length===0&&i?"No matches":"";return e.jsxs("div",{ref:o,className:"relative w-[320px]",children:[e.jsx("input",{value:m,onChange:s=>{d(s.target.value),c(!0)},onFocus:()=>c(!0),placeholder:h,className:"border px-3 py-2 rounded w-full dark:bg-slate-700 dark:border-slate-600"}),f&&e.jsx("div",{className:"absolute right-2 top-2 text-xs text-slate-400",children:f}),x&&n.length>0&&e.jsx("div",{className:"absolute mt-1 z-50 w-full bg-white dark:bg-slate-800 border dark:border-slate-700 rounded shadow max-h-64 overflow-auto",children:n.map(s=>e.jsxs("button",{className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-700",onClick:()=>y(s),type:"button",children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["ID: ",s.id," • ",s.phone||"—"]})]},s.id))}),r!=null&&r.id?e.jsx("input",{type:"hidden",value:r.id}):null]})}const $=()=>{const{groupId:r}=v(),[t,h]=a.useState(null),[m,d]=a.useState(!0),[x,c]=a.useState(""),[n,u]=a.useState(null),[g,b]=a.useState(!1),o=async s=>{try{d(!0);const l=await p.get(`/borrowers/groups/${r}`,{signal:s});h(l.data||null),c("")}catch{c("Failed to load group")}finally{d(!1)}};a.useEffect(()=>{const s=new AbortController;return o(s.signal),()=>s.abort()},[r]);const i=async()=>{if(n!=null&&n.id){b(!0);try{await p.post(`/borrowers/groups/${r}/members`,{borrowerId:n.id}),u(null),await o()}catch{}finally{b(!1)}}},y=async s=>{try{await p.delete(`/borrowers/groups/${r}/members/${s}`),await o()}catch{}},f=a.useMemo(()=>Array.isArray(t==null?void 0:t.members)?t.members:[],[t]);return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Group #",r]}),m&&e.jsx("div",{children:"Loading…"}),x&&e.jsx("div",{className:"text-red-600",children:x}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Overview"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("li",{children:[e.jsx("b",{children:"Name:"})," ",(t==null?void 0:t.name)??"—"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Branch:"})," ",(t==null?void 0:t.branchName)??"—"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Officer:"})," ",(t==null?void 0:t.officerName)??"—"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Meeting Day:"})," ",(t==null?void 0:t.meetingDay)??"—"]})]})]}),e.jsxs("div",{className:"bg-white rounded shadow p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Members"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(A,{value:n,onChange:(s,l)=>u(l),placeholder:"Add borrower…"})}),e.jsx("button",{onClick:i,disabled:!n||g,className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-60",children:g?"Adding…":"Add"})]}),e.jsx("ul",{className:"text-sm divide-y",children:f.length===0?e.jsx("li",{className:"py-2 text-gray-500",children:"No members yet."}):f.map(s=>{const l=s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||s.id;return e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{children:[l," ",e.jsxs("span",{className:"text-gray-500",children:["• ",s.phone||"—"]}),s.role&&e.jsx("span",{className:"ml-2 text-xs uppercase text-gray-400",children:s.role})]}),e.jsx("button",{className:"px-2 py-1 border rounded hover:bg-gray-50",onClick:()=>y(s.id),children:"Remove"})]},s.id)})})]})]}),e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Loans & Repayments"}),e.jsx("div",{className:"text-sm text-gray-600",children:"TODO: group loans, outstanding, next repayments, PAR"})]}),e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Meetings & Attendance"}),e.jsx("div",{className:"text-sm text-gray-600",children:"TODO: schedule, attendance register, minutes"})]})]})};export{$ as default};
