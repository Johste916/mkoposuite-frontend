import{r as l,j as e,c as d}from"./index-Dk5Cvq3D.js";function f(){const[x,n]=l.useState([]),[i,N]=l.useState(""),[o,m]=l.useState(""),[j,h]=l.useState(!1),c=async()=>{var s,t;h(!0),m("");try{const a=await d.get("/audit-logs");n(a.data||[])}catch(a){m(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message||"Failed to load audits"),n([])}finally{h(!1)}};l.useEffect(()=>{c()},[]);const p=x.filter(s=>{const t=i.toLowerCase().trim();return t?[s.staffName,s.branchName,s.category,s.message,s.ip,s.action].some(a=>(a||"").toLowerCase().includes(t)):!0}),u=async s=>{var t,a;try{await d.post(`/audit-logs/${s}/reverse`),await c()}catch(r){alert(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message||"Failed to reverse entry")}},y=async s=>{var t,a;if(confirm("Delete this audit entry?"))try{await d.delete(`/audit-logs/${s}`),await c()}catch(r){alert(((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.error)||r.message||"Failed to delete entry")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Audit Management"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Track logins, actions, and changes. Linked to dashboard activity widgets."})]}),e.jsx("input",{className:"rounded border px-3 py-2 text-sm",value:i,onChange:s=>N(s.target.value),placeholder:"Search audit…"})]}),o&&e.jsx("div",{className:"text-sm text-rose-600",children:o}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border rounded-2xl p-4",children:j?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):p.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No entries."}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-left",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 pr-3",children:"Time"}),e.jsx("th",{className:"py-2 pr-3",children:"Branch"}),e.jsx("th",{className:"py-2 pr-3",children:"Staff"}),e.jsx("th",{className:"py-2 pr-3",children:"Category"}),e.jsx("th",{className:"py-2 pr-3",children:"Message"}),e.jsx("th",{className:"py-2 pr-3",children:"Action"}),e.jsx("th",{className:"py-2 pr-3",children:"IP"}),e.jsx("th",{className:"py-2 pr-3",children:"Ops"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 pr-3",children:new Date(s.createdAt||s.ts||Date.now()).toLocaleString()}),e.jsx("td",{className:"py-2 pr-3",children:s.branchName||s.branch||"-"}),e.jsx("td",{className:"py-2 pr-3",children:s.staffName||s.userName||"-"}),e.jsx("td",{className:"py-2 pr-3",children:s.category||"-"}),e.jsx("td",{className:"py-2 pr-3",children:s.message||"-"}),e.jsx("td",{className:"py-2 pr-3",children:s.action||"-"}),e.jsx("td",{className:"py-2 pr-3",children:s.ip||"-"}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-slate-100",onClick:()=>u(s.id),children:"Reverse"}),e.jsx("button",{className:"px-2 py-1 rounded bg-rose-50 text-rose-700",onClick:()=>y(s.id),children:"Delete"})]})})]},s.id))})]})})})]})}export{f as default};
