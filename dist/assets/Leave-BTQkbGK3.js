import{r as n,j as e,b as o}from"./index-CMgmpHUd.js";function v(){const[y,j]=n.useState([]),[x,g]=n.useState([]),[r,d]=n.useState({typeId:"",from:"",to:"",reason:"",paid:1}),[m,i]=n.useState(""),p=async()=>{var s,a,l,h,u;i("");try{const[{data:t},{data:c}]=await Promise.all([o.get("/hr/leave/types"),o.get("/hr/leave/my-requests")]);j((t==null?void 0:t.items)||[]),g((c==null?void 0:c.items)||[])}catch(t){i((l=(a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)!=null&&l.includes("Required table is missing")?"Required table is missing. Run DB migrations (sequelize).":((u=(h=t==null?void 0:t.response)==null?void 0:h.data)==null?void 0:u.message)||t.message)}};n.useEffect(()=>{p()},[]);const b=async()=>{var s,a;try{await o.post("/hr/leave/requests",r),d({typeId:"",from:"",to:"",reason:"",paid:1}),await p()}catch(l){i(((a=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:a.message)||l.message)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Leave Management"}),m&&e.jsx("div",{className:"text-sm text-red-600",children:m}),e.jsxs("div",{className:"bg-white border rounded-xl p-3 grid gap-2 md:grid-cols-5 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Type"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:r.typeId,onChange:s=>d(a=>({...a,typeId:s.target.value})),children:[e.jsx("option",{value:"",children:"Select Type"}),y.map(s=>e.jsxs("option",{value:s.id,children:[s.name," — ",s.days," days/yr"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"From"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:r.from,onChange:s=>d(a=>({...a,from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"To"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:r.to,onChange:s=>d(a=>({...a,to:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Paid?"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:r.paid,onChange:s=>d(a=>({...a,paid:Number(s.target.value)})),children:[e.jsx("option",{value:1,children:"Paid"}),e.jsx("option",{value:0,children:"Unpaid"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Reason"}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:r.reason,onChange:s=>d(a=>({...a,reason:s.target.value}))})]}),e.jsx("button",{onClick:b,className:"px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 text-sm",children:"Request"})]}),e.jsx("div",{className:"bg-white border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600 border-b",children:[e.jsx("th",{className:"py-2 px-3",children:"Type"}),e.jsx("th",{className:"py-2 px-3",children:"From → To"}),e.jsx("th",{className:"py-2 px-3",children:"Paid"}),e.jsx("th",{className:"py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3 text-gray-500",children:"No requests yet."})}):x.map(s=>{var a;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:(a=s.type)==null?void 0:a.name}),e.jsxs("td",{className:"py-2 px-3",children:[s.from," → ",s.to]}),e.jsx("td",{className:"py-2 px-3",children:s.paid?"Paid":"Unpaid"}),e.jsx("td",{className:"py-2 px-3",children:s.status})]},s.id)})})]})})]})}export{v as default};
