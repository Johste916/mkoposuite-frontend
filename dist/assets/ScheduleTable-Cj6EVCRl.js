const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-CntO34m2.js","assets/index-sMnl2-1N.js","assets/index-Crkt3ipF.css"])))=>i.map(i=>d[i]);
import{_ as F,r as T,j as p}from"./index-sMnl2-1N.js";const n=(e,s="TZS")=>`‎${s} ${Number(e||0).toLocaleString()}`,B=e=>e?new Date(e).toLocaleDateString():"—",k=e=>e?new Date(e).toLocaleString():"",D=e=>{if(!e)return"";const s=new Date(e);return Number.isNaN(s.getTime())?String(e).slice(0,10):s.toISOString().slice(0,10)};function M(e){return e?Array.isArray(e)?e:Array.isArray(e.schedule)?e.schedule:Array.isArray(e.rows)?e.rows:Array.isArray(e.data)?e.data:null:null}function L(e=[],s=0){let t=Number(s||0),a=0,i=0,u=0,b=0;for(const d of e){const l=Number(d.fee??d.fees??0),h=Number(d.penalty??0),c=Number(d.interest??0),f=Number(d.principal??0);if(t<=0)break;const g=Math.min(t,l);if(b+=g,t-=g,t<=0)break;const P=Math.min(t,h);if(u+=P,t-=P,t<=0)break;const S=Math.min(t,c);if(i+=S,t-=S,t<=0)break;const m=Math.min(t,f);a+=m,t-=m}return{paidPrincipal:a,paidInterest:i,paidPenalty:u,paidFees:b}}const j=e=>{const s=Number((e==null?void 0:e.principal)||0),t=Number((e==null?void 0:e.interest)||0),a=Number((e==null?void 0:e.penalty)||0),i=Number((e==null?void 0:e.fee)??(e==null?void 0:e.fees)??0),u=(e==null?void 0:e.total)!=null?Number(e.total):s+t+a+i;if((e==null?void 0:e.balance)!=null&&!Number.isNaN(Number(e.balance)))return Number(e.balance);if((e==null?void 0:e.paidPrincipal)!=null||(e==null?void 0:e.paidInterest)!=null||(e==null?void 0:e.paidPenalty)!=null||(e==null?void 0:e.paidFees)!=null||(e==null?void 0:e.paidFee)!=null){const d=Number(e.paidPrincipal||0),l=Number(e.paidInterest||0),h=Number(e.paidPenalty||0),c=Number(e.paidFees||0)+Number(e.paidFee||0);return Math.max(u-(d+l+h+c),0)}return u},E=["#","Due Date","Principal","Interest","Total P&I","Penalty","Fees","Paid Principal","Paid Interest","Outstanding","Status"];function y(e=[]){const s=[];for(let a=0;a<e.length;a++){const i=e[a],u=Number(i.principal||0),b=Number(i.interest||0),d=Number(i.penalty||0),l=Number(i.fee??i.fees??0),h=i.paidPrincipal!=null?Number(i.paidPrincipal):null,c=i.paidInterest!=null?Number(i.paidInterest):null,f=j(i),g=f<=1e-6?"Settled":"Pending";s.push({idx:i.installment??i.period??a+1,dueDateISO:D(i.dueDate??i.date??""),principal:u,interest:b,penalty:d,fees:l,pi:u+b,paidP:h,paidI:c,outstanding:f,status:g})}return s}function _(e=[],s=[]){const t=Array.isArray(e)?e:[],a=I=>t.reduce((r,x)=>r+Number((x==null?void 0:x[I])||0),0),i=a("principal"),u=a("interest"),b=a("penalty"),d=a("fee")+a("fees"),l=a("total")||i+u+b+d,h=(Array.isArray(s)?s:[]).reduce((I,r)=>I+Number(r.amount||0),0),c=a("paidPrincipal")||0,f=a("paidInterest")||0,g=a("paidPenalty")||0,P=a("paidFees")+a("paidFee")||0,m=c+f+g+P>0?{paidPrincipal:c,paidInterest:f,paidPenalty:g,paidFees:P}:L(t,h),o=Math.max(l-h,0),N=t.find(I=>j(I)>0)||null,v=N?{idx:N.installment??N.period??t.indexOf(N)+1,date:N.dueDate||N.date||null,amount:Number(N.total??0)}:null;return{scheduledPrincipal:i,scheduledInterest:u,scheduledPenalty:b,scheduledFees:d,scheduledTotal:l,totalPaid:h,outstanding:o,outstandingTotal:o,nextDue:v,...m}}function R({loan:e,schedule:s=[],currency:t="TZS",method:a="",company:i={}}){var m;if(!s.length)return;const u=[["Company",i.name||""],["Address",i.address||""],["Phone",i.phone||""],["Email",i.email||""],["Website",i.website||""],[],["Loan ID",(e==null?void 0:e.id)??""],["Borrower",((m=e==null?void 0:e.Borrower)==null?void 0:m.name)||(e==null?void 0:e.borrowerName)||""],["Status",(e==null?void 0:e.status)||""],["Currency",t],["Interest Method",a||(e==null?void 0:e.interestMethod)||""],["Disbursed",D((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")],["Generated At",new Date().toLocaleString()],[]],b=E.slice(0,-1).concat("Settled"),d=y(s).map(o=>[o.idx,o.dueDateISO,o.principal,o.interest,o.pi,o.penalty,o.fees,o.paidP??"",o.paidI??"",o.outstanding,o.outstanding<=1e-6?"YES":"NO"]),l=_(s,[]),h=[[],["Totals","",l.scheduledPrincipal,l.scheduledInterest,l.scheduledPrincipal+l.scheduledInterest,l.scheduledPenalty,l.scheduledFees,l.paidPrincipal,l.paidInterest,l.outstanding,""],["Total Paid","","","","","","","","",l.totalPaid,""]],f=[...u,b,...d,...h].map(o=>o.map(N=>`"${String(N??"").replace(/"/g,'""')}"`).join(",")).join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(g),S=document.createElement("a");S.href=P,S.download=`loan_${(e==null?void 0:e.id)??"schedule"}.csv`,S.click(),URL.revokeObjectURL(P)}async function U({loan:e,schedule:s=[],currency:t="TZS",method:a="",company:i={}}){var v,I;if(!s.length)return;let u,b;try{u=(await F(async()=>{const{default:r}=await import("./jspdf.es.min-CntO34m2.js").then(x=>x.j);return{default:r}},__vite__mapDeps([0,1,2]))).default,b=(await F(async()=>{const{default:r}=await import("./jspdf.plugin.autotable-CfO62xhj.js");return{default:r}},[])).default}catch{return w({loan:e,schedule:s,currency:t,method:a,company:i})}const d=new u({unit:"pt",format:"a4"}),l=d.internal.pageSize.getWidth(),h=40;let c=40;if(i.logoUrl)try{const r=await fetch(i.logoUrl).then($=>$.blob()),x=new FileReader,A=new Promise($=>{x.onload=()=>$(x.result)});x.readAsDataURL(r);const O=await A;d.addImage(O,"PNG",h,c,120,40)}catch{}d.setFontSize(14),d.text(i.name||"Company",h,c+65),d.setFontSize(10),[i.address,[i.phone,i.email].filter(Boolean).join("  •  "),i.website].filter(Boolean).forEach((r,x)=>d.text(String(r),h,c+80+x*14)),d.setFontSize(16),d.text("Loan Repayment Schedule",l-40,50,{align:"right"}),d.setFontSize(10),[`Loan ID: ${(e==null?void 0:e.id)??""}`,`Borrower: ${((v=e==null?void 0:e.Borrower)==null?void 0:v.name)||(e==null?void 0:e.borrowerName)||""}`,`Status: ${(e==null?void 0:e.status)||""}`,`Currency: ${t}`,`Interest Method: ${a||(e==null?void 0:e.interestMethod)||""}`,`Disbursed: ${D((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")}`,`Generated: ${new Date().toLocaleString()}`].forEach((r,x)=>d.text(r,l-40,68+x*14,{align:"right"}));const g=[{header:"#",dataKey:"idx"},{header:"Due Date",dataKey:"dueDate"},{header:"Principal",dataKey:"principal"},{header:"Interest",dataKey:"interest"},{header:"Total P&I",dataKey:"pi"},{header:"Penalty",dataKey:"penalty"},{header:"Fees",dataKey:"fees"},{header:"Paid Principal",dataKey:"paidP"},{header:"Paid Interest",dataKey:"paidI"},{header:"Outstanding",dataKey:"outstanding"},{header:"Settled",dataKey:"settled"}],P=1e-6,S=y(s).map(r=>({idx:r.idx,dueDate:r.dueDateISO,principal:n(r.principal,t),interest:n(r.interest,t),pi:n(r.pi,t),penalty:n(r.penalty,t),fees:n(r.fees,t),paidP:r.paidP==null?"—":n(r.paidP,t),paidI:r.paidI==null?"—":n(r.paidI,t),outstanding:n(r.outstanding,t),settled:r.outstanding<=P?"YES":"NO"}));b(d,{head:[g.map(r=>r.header)],body:S.map(r=>g.map(x=>r[x.dataKey])),startY:140,styles:{fontSize:9},headStyles:{fillColor:[243,244,246],textColor:20},alternateRowStyles:{fillColor:[250,250,250]},margin:{left:40,right:40},didDrawPage:()=>{const r=`Page ${d.internal.getNumberOfPages()}`;d.setFontSize(9),d.text(r,l-40,d.internal.pageSize.getHeight()-20,{align:"right"})}});const m=_(s,[]);let o=((I=d.lastAutoTable)==null?void 0:I.finalY)||140;o+=16,d.setFontSize(11),d.text("Summary",40,o),o+=8,d.setFontSize(10),[["Principal (Sched.)",n(m.scheduledPrincipal,t)],["Interest (Sched.)",n(m.scheduledInterest,t)],["Total P&I (Sched.)",n(m.scheduledPrincipal+m.scheduledInterest,t)],["Penalty (Sched.)",n(m.scheduledPenalty,t)],["Fees (Sched.)",n(m.scheduledFees,t)],["Total Payable",n(m.scheduledTotal,t)],["Paid Principal",n(m.paidPrincipal,t)],["Paid Interest",n(m.paidInterest,t)],["Total Paid",n(m.totalPaid,t)],["Outstanding",n(m.outstanding,t)]].forEach((r,x)=>{d.text(r[0],40,o+16+x*14),d.text(r[1],l-40,o+16+x*14,{align:"right"})}),d.save(`loan_${(e==null?void 0:e.id)??"schedule"}.pdf`)}function w({loan:e,schedule:s=[],currency:t,method:a,company:i}){var h;const u=y(s).map(c=>`
      <tr>
        <td>${c.idx}</td>
        <td>${c.dueDateISO}</td>
        <td>${n(c.principal,t)}</td>
        <td>${n(c.interest,t)}</td>
        <td>${n(c.pi,t)}</td>
        <td>${n(c.penalty,t)}</td>
        <td>${n(c.fees,t)}</td>
        <td>${c.paidP==null?"—":n(c.paidP,t)}</td>
        <td>${c.paidI==null?"—":n(c.paidI,t)}</td>
        <td>${n(c.outstanding,t)}</td>
        <td>${c.outstanding<=1e-6?"YES":"NO"}</td>
      </tr>`).join(""),b=i!=null&&i.logoUrl?`<img src="${i.logoUrl}" style="height:48px;object-fit:contain;margin-right:12px;" />`:"",d=`
    <html>
      <head>
        <meta charset="utf-8" />
        <title>Loan ${(e==null?void 0:e.id)??""} Schedule</title>
        <style>
          body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial; color:#111827; }
          .container { max-width: 1024px; margin: 24px auto; }
          .header { display:flex; align-items:center; justify-content:space-between; }
          .company { display:flex; align-items:center; }
          .company h1 { margin:0; font-size:18px; }
          .muted { color:#6B7280; font-size:12px; }
          table { width:100%; border-collapse: collapse; margin-top: 16px; }
          th, td { border: 1px solid #E5E7EB; padding: 6px 8px; font-size: 12px; }
          thead { background:#F3F4F6; }
          .summary { margin-top:16px; display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:8px; }
          .card { border:1px solid #E5E7EB; padding:8px 10px; border-radius:8px; }
          @media print { .no-print { display:none; } }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <div class="company">
              ${b}
              <div>
                <h1>${(i==null?void 0:i.name)||""}</h1>
                <div class="muted">
                  ${[i==null?void 0:i.address,i==null?void 0:i.phone,i==null?void 0:i.email,i==null?void 0:i.website].filter(Boolean).join(" • ")}
                </div>
              </div>
            </div>
            <div>
              <div style="font-weight:600;">Loan Repayment Schedule</div>
              <div class="muted">Generated: ${new Date().toLocaleString()}</div>
            </div>
          </div>

          <div style="margin-top:12px;font-size:12px;">
            <div><b>Loan ID:</b> ${(e==null?void 0:e.id)??""}</div>
            <div><b>Borrower:</b> ${((h=e==null?void 0:e.Borrower)==null?void 0:h.name)||(e==null?void 0:e.borrowerName)||""}</div>
            <div><b>Status:</b> ${(e==null?void 0:e.status)||""}</div>
            <div><b>Currency:</b> ${(e==null?void 0:e.currency)||t} &nbsp; • &nbsp; <b>Interest Method:</b> ${a||(e==null?void 0:e.interestMethod)||""}</div>
            <div><b>Disbursed:</b> ${D((e==null?void 0:e.releaseDate)||(e==null?void 0:e.startDate)||"")}</div>
          </div>

          <table>
            <thead>
              <tr>${E.map(c=>`<th>${c}</th>`).join("")}<th>Settled</th></tr>
            </thead>
            <tbody>${u}</tbody>
          </table>

          <div class="no-print" style="margin-top:16px;">
            <button onclick="window.print()" style="padding:8px 12px;border:1px solid #E5E7EB;border-radius:8px;background:white;cursor:pointer;">Print / Save as PDF</button>
          </div>
        </div>
      </body>
    </html>
  `,l=window.open("","_blank","noopener,noreferrer,width=1024,height=768");l&&(l.document.open(),l.document.write(d),l.document.close())}const C=(e=[],s="TZS")=>(Array.isArray(e)?e:[]).map((t,a)=>{const i=Number(t.principal||0),u=Number(t.interest||0),b=Number(t.penalty||0),d=Number(t.fee??t.fees??0),l=i+u,h=j(t);return{idx:t.installment??t.period??a+1,dueDate:D(t.dueDate??t.date??""),principal:n(i,s),interest:n(u,s),pi:n(l,s),penalty:n(b,s),fees:n(d,s),paidP:t.paidPrincipal!=null?n(Number(t.paidPrincipal),s):"—",paidI:t.paidInterest!=null?n(Number(t.paidInterest),s):"—",outstanding:n(h,s),settled:h<=1e-6?"YES":"NO"}}),K=(e=[])=>(Array.isArray(e)?e:[]).map((s,t)=>{const a=Number(s.principal||0),i=Number(s.interest||0),u=Number(s.penalty||0),b=Number(s.fee??s.fees??0),d=a+i,l=j(s);return{idx:s.installment??s.period??t+1,dueDate:D(s.dueDate??s.date??""),principal:a,interest:i,pi:d,penalty:u,fees:b,paidP:s.paidPrincipal!=null?Number(s.paidPrincipal):"",paidI:s.paidInterest!=null?Number(s.paidInterest):"",outstanding:l,settled:l<=1e-6?"YES":"NO"}});function Y({schedule:e=[],currency:s="TZS"}){const t=T.useMemo(()=>y(e||[]),[e,s]);return t.length?p.jsx("div",{className:"overflow-x-auto",children:p.jsxs("table",{className:"min-w-full text-base",children:[p.jsx("thead",{className:"bg-slate-100 sticky top-0 z-10",children:p.jsxs("tr",{className:"text-left",children:[p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200",children:"#"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200",children:"Due Date"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Principal"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Interest"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Total P&I"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Penalty"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Fees"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Paid Principal"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Paid Interest"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200 text-right",children:"Outstanding"}),p.jsx("th",{className:"px-3 py-3 border-b-2 border-slate-200",children:"Status"})]})}),p.jsx("tbody",{className:"divide-y divide-slate-100",children:t.map((a,i)=>p.jsxs("tr",{className:"hover:bg-gray-50",children:[p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.idx}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.dueDateISO}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.principal,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.interest,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.pi,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.penalty,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.fees,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:a.paidP==null?"—":n(a.paidP,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:a.paidI==null?"—":n(a.paidI,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right",children:n(a.outstanding,s)}),p.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:a.status==="Settled"?p.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200",children:"Settled"}):p.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-200",children:"Pending"})})]},i))})]})}):p.jsx("div",{className:"text-sm text-gray-600",children:"No schedule available."})}export{Y as S,K as a,E as b,_ as c,B as d,R as e,n as f,U as g,k as h,D as i,M as n,C as r};
