import{r as i,j as t,L as c,b as N}from"./index-C-j5_Jvg.js";import{u as C,L}from"./ListShell-C4mqSi1X.js";const k=new Set(["admin","director","branch_manager"]);function w(){var r;try{const l=localStorage.getItem("auth")||localStorage.getItem("user")||"",a=l?JSON.parse(l):{};return(a==null?void 0:a.role)||((r=a==null?void 0:a.user)==null?void 0:r.role)||"user"}catch{return"user"}}function D(){const r=w(),l=k.has(r),[a,u]=i.useState(""),[s,d]=i.useState(""),m=i.useMemo(()=>{const e=new URLSearchParams;a&&e.set("status",a),s&&e.set("category",s);const n=e.toString();return n?`/api/collateral?${n}`:"/api/collateral"},[a,s]),{rows:x,total:p,page:g,setPage:h,limit:S,setLimit:y,q:o,setQ:b,loading:f,error:E}=C({url:m}),j=[{key:"itemName",title:"Item"},{key:"category",title:"Category"},{key:"model",title:"Model"},{key:"serialNumber",title:"Serial"},{key:"estValue",title:"Est. Value"},{key:"status",title:"Status"},{key:"location",title:"Location"}],v=i.useMemo(()=>{const e=new URLSearchParams;return o&&e.set("q",o),a&&e.set("status",a),s&&e.set("category",s),e.set("export","csv"),`/api/collateral?${e.toString()}`},[o,a,s]);return t.jsx(L,{title:"Collateral",q:o,setQ:b,columns:[...j,l&&{key:"__actions__",title:"Actions",render:e=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"text-emerald-600 text-sm",onClick:async()=>{await N.post(`/api/collateral/${e.id}/release`),window.location.reload()},disabled:e.status==="RELEASED",title:"Mark as released",children:"Release"}),t.jsx(c,{to:`/collateral/${e.id}/edit`,className:"text-blue-600 text-sm",children:"Edit"})]})}].filter(Boolean),rows:x,loading:f,error:E,page:g,setPage:h,limit:S,setLimit:y,total:p,toolbar:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full",children:[l&&t.jsx(c,{to:"/collateral/add",className:"mr-3 border rounded px-3 py-1 text-sm bg-blue-600 text-white hover:bg-blue-700",children:"+ Add Collateral"}),t.jsx("label",{className:"text-sm",children:"Status"}),t.jsxs("select",{className:"border rounded px-2 py-1",value:a,onChange:e=>u(e.target.value),children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"ACTIVE",children:"ACTIVE"}),t.jsx("option",{value:"RELEASED",children:"RELEASED"}),t.jsx("option",{value:"DISPOSED",children:"DISPOSED"})]}),t.jsx("label",{className:"text-sm ml-3",children:"Category"}),t.jsx("input",{className:"border rounded px-2 py-1",placeholder:"e.g. Vehicle",value:s,onChange:e=>d(e.target.value)}),t.jsx("a",{href:v,className:"ml-auto inline-flex items-center border rounded px-3 py-1 text-sm hover:bg-gray-50",children:"Export CSV"})]})})}export{D as default};
