import{u as B,r as i,j as e,g as C}from"./index-sYV8Q1B4.js";const N=l=>{const c=Number(l);return Number.isFinite(c)?new Intl.NumberFormat().format(c):"—"},y=(...l)=>l.filter(Boolean).join(" ");function q({open:l,title:c,children:f,onClose:p,width:j=520}){return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/40",onClick:p,"aria-hidden":"true"}),e.jsxs("aside",{className:"fixed right-0 top-0 bottom-0 z-50 bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800 shadow-2xl overflow-auto",style:{width:j},role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"sticky top-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur border-b border-slate-200 dark:border-slate-800 px-4 py-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:c}),e.jsx("button",{type:"button",onClick:p,className:"px-2 py-1 text-sm rounded border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800",children:"Close"})]}),e.jsx("div",{className:"p-4",children:f})]})]}):null}function Q(){const l=B(),[c,f]=i.useState([]),[p,j]=i.useState(!1),[w,T]=i.useState(""),[b,A]=i.useState({by:"name",dir:"asc"}),[d,g]=i.useState(1),[o,D]=i.useState(10),[F,P]=i.useState(!1),[a,I]=i.useState(null),k=async t=>{var r,n;j(!0);try{const s=await C.get("/loan-products",{params:{q:w},signal:t}),x=Array.isArray(s.data)?s.data:Array.isArray((r=s.data)==null?void 0:r.items)?s.data.items:((n=s.data)==null?void 0:n.data)||[];f(x)}catch(s){(s==null?void 0:s.name)!=="CanceledError"&&alert("Failed to load loan products.")}finally{j(!1)}};i.useEffect(()=>{const t=new AbortController,r=setTimeout(()=>k(t.signal),240);return()=>{clearTimeout(r),t.abort()}},[w]);const h=i.useMemo(()=>{const t=[...c],{by:r,dir:n}=b;return t.sort((s,x)=>{const u=((s==null?void 0:s[r])??"").toString().toLowerCase(),R=((x==null?void 0:x[r])??"").toString().toLowerCase();return u<R?n==="asc"?-1:1:u>R?n==="asc"?1:-1:0}),t},[c,b]),v=Math.max(1,Math.ceil(h.length/o)),L=i.useMemo(()=>{const t=(d-1)*o;return h.slice(t,t+o)},[h,d,o]),S=()=>l("/loans/products/new"),E=t=>l(`/loans/products/${t.id}/edit`),$=t=>{I(t),P(!0)},z=async t=>{if(confirm(`Set "${t.name}" to ${t.status==="active"?"inactive":"active"}?`))try{await C.patch(`/loan-products/${t.id}/toggle`),await k()}catch{alert("Failed to update status.")}},V=async t=>{if(confirm(`Delete product "${t.name}" permanently?`))try{await C.delete(`/loan-products/${t.id}`),await k()}catch{alert("Failed to delete product.")}},M=({value:t})=>{const r=(t||"").toLowerCase(),n=r==="active"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-slate-200 text-slate-700 dark:bg-slate-800 dark:text-slate-300";return e.jsx("span",{className:y("px-2 py-0.5 rounded text-xs font-medium",n),children:r||"—"})},m=({id:t,children:r,className:n})=>{const s=b.by===t,x=s?b.dir:"asc";return e.jsx("th",{className:y("p-2 border-b border-[var(--border)] text-left text-xs uppercase tracking-wide",n),children:e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 hover:underline",onClick:()=>A(u=>u.by===t?{by:t,dir:u.dir==="asc"?"desc":"asc"}:{by:t,dir:"asc"}),children:[e.jsx("span",{children:r}),s&&e.jsx("span",{className:"opacity-60",children:x==="asc"?"▲":"▼"})]})})};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Loan Products"}),e.jsx("p",{className:"muted text-sm",children:"Define the lending terms your team can use in applications."})]}),e.jsx("button",{onClick:S,className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700",children:"New Product"})]}),e.jsxs("div",{className:"card p-3 flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[e.jsx("input",{className:"input md:w-96",placeholder:"Search by name or code…",value:w,onChange:t=>{T(t.target.value),g(1)}}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"text-xs",children:["Page size",e.jsx("select",{className:"ml-2 input",value:o,onChange:t=>{D(Number(t.target.value)),g(1)},children:[10,20,50].map(t=>e.jsx("option",{value:t,children:t},t))})]})})]}),e.jsx("div",{className:"card overflow-x-auto",children:p?e.jsx("p",{className:"p-4 muted",children:"Loading…"}):c.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-sm muted mb-3",children:"No products found."}),e.jsx("button",{onClick:S,className:"px-3 py-2 rounded bg-indigo-600 text-white",children:"Create your first product"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-[var(--fg)]",children:e.jsxs("tr",{children:[e.jsx(m,{id:"name",children:"Name"}),e.jsx(m,{id:"code",children:"Code"}),e.jsx(m,{id:"interestMethod",children:"Method"}),e.jsx(m,{id:"interestRate",className:"text-right",children:"Rate (%)"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)] text-right",children:"Principal Range"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)] text-right",children:"Term Range"}),e.jsx(m,{id:"penaltyRate",className:"text-right",children:"Penalty (%)"}),e.jsx(m,{id:"status",children:"Status"}),e.jsx("th",{className:"p-2 border-b border-[var(--border)]",children:"Actions"})]})}),e.jsx("tbody",{children:L.map(t=>e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx("td",{className:"px-2 py-2 font-medium",children:t.name}),e.jsx("td",{className:"px-2 py-2",children:t.code}),e.jsx("td",{className:"px-2 py-2",children:t.interestMethod}),e.jsx("td",{className:"px-2 py-2 text-right",children:t.interestRate??"—"}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[t.minPrincipal!=null?N(t.minPrincipal):"—"," – ",t.maxPrincipal!=null?N(t.maxPrincipal):"—"]}),e.jsxs("td",{className:"px-2 py-2 text-right",children:[t.minTermMonths??"—"," – ",t.maxTermMonths??"—"," m"]}),e.jsx("td",{className:"px-2 py-2 text-right",children:t.penaltyRate??"—"}),e.jsx("td",{className:"px-2 py-2",children:e.jsx(M,{value:t.status})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("button",{className:"text-indigo-600 hover:underline",onClick:()=>$(t),children:"View"}),e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>E(t),children:"Edit"}),e.jsx("button",{className:"text-amber-700 hover:underline",onClick:()=>z(t),children:t.status==="active"?"Deactivate":"Activate"}),e.jsx("button",{className:"text-rose-600 hover:underline",onClick:()=>V(t),children:"Delete"})]})})]},t.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("div",{className:"text-xs muted",children:["Showing ",(d-1)*o+1,"–",Math.min(d*o,h.length)," of ",h.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:d===1,onClick:()=>g(t=>Math.max(1,t-1)),className:y("px-3 py-1 rounded border text-sm",d===1?"opacity-50 cursor-not-allowed border-slate-200 dark:border-slate-800":"border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"),children:"Prev"}),e.jsxs("div",{className:"text-sm",children:[d," / ",v]}),e.jsx("button",{disabled:d>=v,onClick:()=>g(t=>Math.min(v,t+1)),className:y("px-3 py-1 rounded border text-sm",d>=v?"opacity-50 cursor-not-allowed border-slate-200 dark:border-slate-800":"border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"),children:"Next"})]})]})]})}),e.jsx(q,{open:F,title:"Product Details",onClose:()=>P(!1),width:460,children:a?e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Name"}),e.jsx("div",{className:"font-medium",children:a.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Code"}),e.jsx("div",{children:a.code})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Status"}),e.jsx("span",{className:"inline-block mt-1",children:e.jsx("span",{className:"align-middle",children:e.jsx(M,{value:a.status})})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Interest Method"}),e.jsx("div",{children:a.interestMethod})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Interest Rate (%)"}),e.jsx("div",{children:a.interestRate??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Penalty Rate (%)"}),e.jsx("div",{children:a.penaltyRate??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Term (months)"}),e.jsxs("div",{children:[a.minTermMonths??"—"," – ",a.maxTermMonths??"—"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Principal Range"}),e.jsxs("div",{children:[a.minPrincipal!=null?N(a.minPrincipal):"—"," –"," ",a.maxPrincipal!=null?N(a.maxPrincipal):"—"]})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide muted",children:"Description"}),e.jsx("div",{className:"whitespace-pre-wrap",children:a.description})]})]}):e.jsx("div",{className:"muted",children:"No product selected."})})]})}export{Q as default};
