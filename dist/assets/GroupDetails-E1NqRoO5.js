import{i as v,r as u,j as r,L as S,g as x}from"./index-w0S6QMJE.js";import{B as A}from"./BorrowerAutoComplete-CB9rQ5ck.js";async function g(e=[],o={}){let s;for(const d of e)try{const n=await x.get(d,o);return n==null?void 0:n.data}catch(n){s=n}throw s||new Error("No endpoint succeeded")}async function E(e=[],o={},s={}){let d;for(const n of e)try{const l=await x.post(n,o,s);return l==null?void 0:l.data}catch(l){d=l}throw d||new Error("No endpoint succeeded")}async function C(e=[],o={}){let s;for(const d of e)try{const n=await x.delete(d,o);return n==null?void 0:n.data}catch(n){s=n}throw s||new Error("No endpoint succeeded")}function I(e){return{id:e.id??e._id??e.borrowerId??e.memberId,name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||e.fullName||e.id,phone:e.phone??e.msisdn??e.mobile,role:e.role||e.memberRole}}function h(e){var s,d,n;if(!e||typeof e!="object")return null;const o=Array.isArray(e.members)?e.members:e.groupMembers||e.items||[];return{id:e.id??e._id??e.groupId??e.code,name:e.name??e.groupName??e.title??"—",branchName:e.branchName??((s=e.branch)==null?void 0:s.name)??"—",officerName:e.officerName??((d=e.officer)==null?void 0:d.name)??"—",meetingDay:e.meetingDay??((n=e.meeting)==null?void 0:n.day)??"—",members:o.map(I)}}async function k(e,o){const s=encodeURIComponent(e),d=await g([`/borrowers/groups/${s}`,`/groups/${s}`,`/borrower-groups/${s}`,`/api/borrowers/groups/${s}`,`/api/groups/${s}`,`/api/borrower-groups/${s}`],{signal:o}).catch(()=>null);if(d)return h(d);const n=await g([`/borrowers/groups?id=${s}&include=members`,`/borrowers/groups?groupId=${s}&include=members`,`/borrowers/groups?code=${s}&include=members`,`/groups?id=${s}&include=members`,`/groups?groupId=${s}&include=members`,`/groups?code=${s}&include=members`,`/borrower-groups?id=${s}&include=members`,`/borrower-groups?groupId=${s}&include=members`,`/borrower-groups?code=${s}&include=members`,`/api/borrowers/groups?id=${s}&include=members`,`/api/borrowers/groups?groupId=${s}&include=members`,`/api/borrowers/groups?code=${s}&include=members`,`/api/groups?id=${s}&include=members`,`/api/groups?groupId=${s}&include=members`,`/api/groups?code=${s}&include=members`,`/api/borrower-groups?id=${s}&include=members`,`/api/borrower-groups?groupId=${s}&include=members`,`/api/borrower-groups?code=${s}&include=members`],{signal:o}).catch(()=>null)||null;if(n){const m=Array.isArray(n)?n:n.items||n.rows||n.data||[];if(m.length){const c=m.find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e))||m[0];if(c)return h(c)}}const l=await g(["/borrowers/groups?include=members","/groups?include=members","/borrower-groups?include=members","/api/borrowers/groups?include=members","/api/groups?include=members","/api/borrower-groups?include=members"],{signal:o}).catch(()=>null);if(l){const c=(Array.isArray(l)?l:l.items||l.rows||l.data||[]).find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e));if(c)return h(c)}return null}const a={container:"w-full px-4 md:px-6 lg:px-8 py-6 bg-[var(--bg)] text-[var(--fg)]",h1:"text-3xl font-extrabold tracking-tight",h1Muted:"font-medium text-[var(--muted)]",card:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow",btn:"inline-flex items-center rounded-lg border-2 border-[var(--border-strong)] px-3 py-2 hover:bg-[var(--kpi-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",primary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-4 py-2 font-semibold hover:bg-indigo-700 disabled:opacity-60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ring)]",tableWrap:"rounded-2xl border-2 border-[var(--border-strong)] bg-[var(--card)] shadow overflow-x-auto",th:"bg-[var(--kpi-bg)] text-left text-[13px] uppercase tracking-wide text-[var(--muted)] font-semibold px-3 py-2 border-2 border-[var(--border)]",td:"px-3 py-2 border-2 border-[var(--border)] text-sm",chip:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-bold bg-[var(--chip-soft)] text-[var(--fg)] ring-1 ring-[var(--border)]"},R=()=>{const{groupId:e}=v(),[o,s]=u.useState(null),[d,n]=u.useState(!0),[l,m]=u.useState(""),[c,i]=u.useState(null),[f,w]=u.useState(!1),b=async t=>{try{n(!0),m("");const p=await k(e,t);p?s(p):(m("Group not found."),s(null))}catch{m("Failed to load group (endpoint not implemented)."),s(null)}finally{n(!1)}};u.useEffect(()=>{const t=new AbortController;return b(t.signal),()=>t.abort()},[e]);const j=()=>b(),$=async()=>{if(c!=null&&c.id){w(!0);try{await E([`/borrowers/groups/${e}/members`,`/groups/${e}/members`,`/borrower-groups/${e}/members`,`/api/borrowers/groups/${e}/members`,`/api/groups/${e}/members`,`/api/borrower-groups/${e}/members`],{borrowerId:c.id}),i(null),await b()}catch{alert("Failed to add member.")}finally{w(!1)}}},N=async t=>{try{await C([`/borrowers/groups/${e}/members/${t}`,`/groups/${e}/members/${t}`,`/borrower-groups/${e}/members/${t}`,`/api/borrowers/groups/${e}/members/${t}`,`/api/groups/${e}/members/${t}`,`/api/borrower-groups/${e}/members/${t}`]),await b()}catch{alert("Failed to remove member.")}},y=Array.isArray(o==null?void 0:o.members)?o.members:[];return r.jsxs("div",{className:a.container,children:[r.jsxs("div",{className:"mb-4 flex flex-wrap items-end justify-between gap-3",children:[r.jsxs("h1",{className:a.h1,children:["Group #",e,o!=null&&o.name?r.jsxs("span",{className:`ml-2 ${a.h1Muted}`,children:["• ",o.name]}):null]}),r.jsx("button",{onClick:j,className:a.btn,children:"Refresh"})]}),d&&r.jsx("div",{className:`${a.card} px-4 py-3`,children:"Loading…"}),l&&r.jsx("div",{className:"rounded-2xl border-2 px-4 py-3",style:{borderColor:"var(--danger-border)",background:"var(--danger-bg)",color:"var(--danger-fg)"},children:l}),r.jsxs("div",{className:"grid grid-cols-1 gap-5 lg:grid-cols-3",children:[r.jsxs("section",{className:`${a.card} p-4`,children:[r.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Overview"}),r.jsxs("ul",{className:"space-y-1 text-[15px]",children:[r.jsxs("li",{children:[r.jsx("b",{children:"Name:"})," ",(o==null?void 0:o.name)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Branch:"})," ",(o==null?void 0:o.branchName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Officer:"})," ",(o==null?void 0:o.officerName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Meeting Day:"})," ",(o==null?void 0:o.meetingDay)??"—"]})]})]}),r.jsxs("section",{className:`${a.card} p-4 lg:col-span-2`,children:[r.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Members"}),r.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx(A,{value:c,onChange:(t,p)=>i(p),placeholder:"Add borrower…"})}),r.jsx("button",{onClick:$,disabled:!c||f,className:a.primary,children:f?"Adding…":"Add"})]}),r.jsx("div",{className:a.tableWrap,children:r.jsxs("table",{className:"min-w-full table-auto",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:a.th,children:"Borrower"}),r.jsx("th",{className:a.th,children:"Phone"}),r.jsx("th",{className:a.th,children:"Role"}),r.jsx("th",{className:a.th,children:"Actions"})]})}),r.jsx("tbody",{children:y.length===0?r.jsx("tr",{children:r.jsx("td",{className:a.td,colSpan:4,children:r.jsx("span",{className:"text-[var(--muted)]",children:"No members yet."})})}):y.map(t=>r.jsxs("tr",{children:[r.jsx("td",{className:a.td,children:r.jsx(S,{to:`/borrowers/${encodeURIComponent(t.id)}`,className:"font-semibold underline decoration-2 underline-offset-2 hover:opacity-90 text-[var(--fg)]",children:t.name})}),r.jsx("td",{className:a.td,children:t.phone||"—"}),r.jsx("td",{className:a.td,children:t.role?r.jsx("span",{className:a.chip,children:String(t.role).toUpperCase()}):"—"}),r.jsx("td",{className:a.td,children:r.jsx("button",{className:a.btn,onClick:()=>N(t.id),children:"Remove"})})]},t.id))})]})})]})]})]})};export{R as default};
