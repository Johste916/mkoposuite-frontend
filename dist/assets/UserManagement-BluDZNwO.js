import{r as o,j as e,h as J,x as Ge}from"./index-D7WBPAut.js";async function w(i,h={}){try{const d=await J.get(i,h);return{ok:!0,data:d==null?void 0:d.data}}catch(d){return{ok:!1,error:d}}}async function I(i,h={},d={}){try{const p=await J.post(i,h,d);return{ok:!0,data:p==null?void 0:p.data}}catch(p){return{ok:!1,error:p}}}async function M(i,h={},d={}){try{const p=await J.put(i,h,d);return{ok:!0,data:p==null?void 0:p.data}}catch(p){return{ok:!1,error:p}}}async function be(i,h={}){try{const d=await J.delete(i,h);return{ok:!0,data:d==null?void 0:d.data}}catch(d){return{ok:!1,error:d}}}const je=i=>String(i||"").replace(/\D+/g,""),A=i=>{const h=String(i??"").trim();return h.length?h:null},L=i=>Array.isArray(i)?i:(i==null?void 0:i.items)||(i==null?void 0:i.rows)||(i==null?void 0:i.data)||[];function se({children:i}){return typeof document>"u"?null:Ge.createPortal(i,document.body)}function Qe(i,h){o.useEffect(()=>{const d=p=>{i.some(k=>k.current&&k.current.contains(p.target))||h()};return document.addEventListener("mousedown",d,!0),document.addEventListener("touchstart",d,{passive:!0,capture:!0}),()=>{document.removeEventListener("mousedown",d,!0),document.removeEventListener("touchstart",d,!0)}},[i,h])}function We({actions:i=[]}){const[h,d]=o.useState(!1),p=o.useRef(null),b=o.useRef(null),[k,O]=o.useState({top:0,left:0}),P=()=>{var B;const m=(B=p.current)==null?void 0:B.getBoundingClientRect();if(!m)return;const g=220,v=6;let Y=Math.min(Math.max(8,m.right-g),window.innerWidth-g-8),E=m.bottom+v;const V=8+i.length*36;E+V>window.innerHeight-8&&(E=Math.max(8,m.top-v-V)),O({top:E,left:Y})};return o.useLayoutEffect(()=>{if(!h)return;P();const m=()=>P(),g=()=>P();return window.addEventListener("scroll",m,!0),window.addEventListener("resize",g),()=>{window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",g)}},[h,i.length]),Qe([p,b],()=>d(!1)),o.useEffect(()=>{if(!h)return;const m=g=>g.key==="Escape"&&d(!1);return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[h]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:p,className:"px-2 py-1 border rounded hover:bg-gray-50",onClick:()=>d(m=>!m),"aria-haspopup":"menu","aria-expanded":h,children:"⋮"}),h&&e.jsxs(se,{children:[e.jsx("div",{className:"fixed inset-0 z-50",style:{background:"transparent"},onClick:()=>d(!1)}),e.jsx("div",{ref:b,className:"fixed z-[60] min-w-[220px] bg-white border shadow-lg rounded-md",style:{top:k.top,left:k.left},onClick:m=>m.stopPropagation(),role:"menu",children:i.map((m,g)=>e.jsx("button",{onClick:()=>{var v;m.disabled||(d(!1),(v=m.onClick)==null||v.call(m))},disabled:m.disabled,className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${m.danger?"text-red-700":""} disabled:opacity-50`,children:m.label},g))})]})]})}function ye(){o.useEffect(()=>{const{body:i}=document,h=i.style.overflow;return i.style.overflow="hidden",()=>{i.style.overflow=h||""}},[])}function X({title:i,children:h,onClose:d}){return ye(),o.useEffect(()=>{const p=b=>b.key==="Escape"&&(d==null?void 0:d());return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[d]),e.jsx(se,{children:e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl border shadow p-4 w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:i}),e.jsx("button",{onClick:d,className:"text-sm px-2 py-1 border rounded","aria-label":"Close",children:"✕"})]}),h]})})})}function Xe({title:i,children:h,onClose:d,wide:p=!1}){return ye(),o.useEffect(()=>{const b=k=>k.key==="Escape"&&(d==null?void 0:d());return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[d]),e.jsx(se,{children:e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:d}),e.jsxs("div",{className:`absolute right-0 top-0 h-full w-full ${p?"max-w-5xl":"max-w-3xl"} bg-white border-l shadow-xl p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:i}),e.jsx("button",{onClick:d,className:"text-sm px-2 py-1 border rounded",children:"✕"})]}),h]})]})})}function H({className:i="",children:h,...d}){return e.jsx("button",{...d,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-blue-600 text-white border border-blue-600 hover:bg-blue-700","disabled:opacity-60 disabled:hover:bg-blue-600","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-1",i].join(" "),children:h})}function C({className:i="",children:h,...d}){return e.jsx("button",{...d,className:["px-3 py-2 rounded-lg text-sm font-medium","bg-white text-slate-800 border border-slate-300 hover:bg-slate-50","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 focus-visible:ring-offset-1","disabled:opacity-60",i].join(" "),children:h})}const Ye=()=>{var pe,ue;const[i,h]=o.useState([]),[d,p]=o.useState([]),[b,k]=o.useState([]),[O,P]=o.useState(!0),[m,g]=o.useState(""),[v,Y]=o.useState(""),[E,V]=o.useState(""),[B,te]=o.useState({}),[F,K]=o.useState({}),[ae,re]=o.useState(""),[D,Z]=o.useState(new Set),le=i.length>0&&i.every(s=>D.has(s.id)),[_,ne]=o.useState(!1),[f,ge]=o.useState(null),[N,ie]=o.useState("profile"),[j,z]=o.useState({hr:null,attendance:null,leave:null,payroll:null}),[R,T]=o.useState({hr:"",attendance:"",leave:"",payroll:""}),[U,de]=o.useState(!1),[Ne,q]=o.useState(!1),[ve,G]=o.useState(!1),[we,Q]=o.useState(!1),[ke,W]=o.useState(!1),[c,y]=o.useState(null),[ee,ce]=o.useState(new Set),Se=(s,t,a)=>{const r=L(s.data),l=L(t.data),n=L(a.data);h(r),p(l),k(n);const x={};r.forEach(u=>{var $;x[u.id]={roleId:u.roleId??(($=u.role)==null?void 0:$.id)??"",branchId:u.branchId??""}}),K(x)},S=async()=>{var s,t;P(!0),re("");try{const a={limit:1e3,q:m};v&&(a.roleId=v),E&&(a.branchId=E);const[r,l,n]=await Promise.all([w("/users",{params:a}),w("/roles",{params:{limit:1e3}}),w("/branches",{params:{limit:1e3}})]);if(!r.ok)throw r.error;if(!l.ok)throw l.error;if(!n.ok)throw n.error;Se(r,l,n)}catch(a){re(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.error)||(a==null?void 0:a.message)||"Failed to load data")}finally{P(!1)}};o.useEffect(()=>{S()},[]),o.useEffect(()=>{const s=setTimeout(()=>{O||S()},400);return()=>clearTimeout(s)},[m,v,E]);const oe=(s,t)=>{K(a=>({...a,[s]:{...a[s]||{},...t}}))},Ie=s=>{var l;const t=F[s.id]||{},a=s.roleId??((l=s.role)==null?void 0:l.id)??"",r=s.branchId??"";return String(t.roleId||"")!==String(a)||String(t.branchId||"")!==String(r)},Ce=async s=>{var l,n;const t=s.id,a=F[t]||{},r={roleId:a.roleId?Number(a.roleId):null,branchId:a.branchId?Number(a.branchId):null};te(x=>({...x,[t]:!0}));try{let x=await I(`/users/${t}/assign`,r);if(x.ok||(x=await M(`/users/${t}`,r)),!x.ok)throw x.error;h(u=>u.map($=>$.id===t?{...$,roleId:r.roleId,branchId:r.branchId}:$)),alert("Assigned successfully")}catch(x){alert(((n=(l=x==null?void 0:x.response)==null?void 0:l.data)==null?void 0:n.error)||(x==null?void 0:x.message)||"Failed to assign")}finally{te(x=>({...x,[t]:!1}))}},Ee=s=>{Z(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},Re=()=>{Z(le?new Set:new Set(i.map(s=>s.id)))},$e=async s=>{if(!s||D.size===0)return;const t=[...D];if(!(await I("/users/assign-role",{userIds:t,roleId:Number(s)})).ok)for(const r of t)await I(`/users/${r}/assign`,{roleId:Number(s)});K(r=>{const l={...r};return t.forEach(n=>{l[n]={...l[n]||{},roleId:Number(s)}}),l}),alert(`Assigned role to ${t.length} user(s).`)},Le=async s=>{if(!s||D.size===0)return;const t=[...D];if(!(await I("/users/assign-branch",{userIds:t,branchId:Number(s)})).ok)for(const r of t)await I(`/users/${r}/assign`,{branchId:Number(s)});K(r=>{const l={...r};return t.forEach(n=>{l[n]={...l[n]||{},branchId:Number(s)}}),l}),alert(`Assigned branch to ${t.length} user(s).`)},De=()=>{const s=["id","name","email","phone","roleId","branchId"],t=i.map(n=>{var fe;const x=F[n.id]||{},u=x.roleId??n.roleId??((fe=n.role)==null?void 0:fe.id)??"",$=x.branchId??n.branchId??"",Ve=(n.name||`${n.firstName||""} ${n.lastName||""}`.trim()||"").replace(/"/g,'""'),Ke=(n.email||"").replace(/"/g,'""'),qe=(n.phone||"").replace(/"/g,'""');return[n.id,`"${Ve}"`,`"${Ke}"`,`"${qe}"`,u,$].join(",")}),a=new Blob([[s.join(","),...t].join(`
`)],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download="staff.csv",l.click(),URL.revokeObjectURL(r)},Oe=()=>{y({name:"",email:"",phone:"",password:"",roleId:"",branchId:""}),q(!0)},he=s=>{y({id:s.id,name:s.name||`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email||"",phone:s.phone||""}),G(!0)},xe=s=>{y({id:s.id,password:""}),W(!0)},me=async s=>{y(s);const t=new Set((s.roles||s.Roles||[]).map(a=>(a==null?void 0:a.id)??(a==null?void 0:a.roleId)??(a==null?void 0:a.RoleId)).filter(a=>a!=null));if(ce(t),d.length===0){const a=await w("/roles",{params:{limit:1e3}});a.ok&&p(L(a.data))}Q(!0)},Pe=async s=>{var a,r,l,n;const t=await be(`/users/${s.id}`);t.ok||alert(((l=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.error)||((n=t==null?void 0:t.error)==null?void 0:n.message)||"Failed to disable user."),S()},Ae=async s=>{var a,r,l,n;const t=await be(`/users/${s.id}`,{params:{force:1,hard:1},headers:{"X-Force-Delete":"1"},data:{force:!0}});t.ok||alert(((l=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.error)||((n=t==null?void 0:t.error)==null?void 0:n.message)||"Failed to delete user."),S()},Be=async()=>{var a,r,l,n;const s={name:A(c.name),email:A(c.email),phone:A(je(c.phone)),...c.password?{password:c.password}:{},...c.roleId?{roleId:Number(c.roleId)}:{},...c.branchId?{branchId:Number(c.branchId)}:{}},t=await I("/users",s);t.ok||alert(((l=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.error)||((n=t==null?void 0:t.error)==null?void 0:n.message)||"Failed to create user."),q(!1),y(null),S()},Fe=async()=>{var a,r,l,n;const s={name:A(c.name),email:A(c.email),phone:A(je(c.phone))};let t=await M(`/users/${c.id}`,s);t.ok||(t=await I(`/users/${c.id}`,s)),t.ok||alert(((l=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.error)||((n=t==null?void 0:t.error)==null?void 0:n.message)||"Failed to update user."),G(!1),y(null),S()},ze=async()=>{var t,a,r,l;let s=await I(`/users/${c.id}/password`,{password:c.password});s.ok||(s=await M(`/users/${c.id}`,{password:c.password})),s.ok||alert(((r=(a=(t=s==null?void 0:s.error)==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.error)||((l=s==null?void 0:s.error)==null?void 0:l.message)||"Failed to set password."),W(!1),y(null),S()},Te=async()=>{var a,r,l,n;const s=[...ee];let t=await I(`/users/${c.id}/roles`,{roleIds:s});t.ok||(t=await M(`/users/${c.id}/roles`,{roleIds:s})),t.ok||(t=await M(`/users/${c.id}`,{roleIds:s})),t.ok||alert(((l=(r=(a=t==null?void 0:t.error)==null?void 0:a.response)==null?void 0:r.data)==null?void 0:l.error)||((n=t==null?void 0:t.error)==null?void 0:n.message)||"Failed to update roles."),Q(!1),y(null),S()},Ue=s=>{const t=new Set(ee);t.has(s)?t.delete(s):t.add(s),ce(t)},Me=s=>{ge(s),ie("profile"),z({hr:null,attendance:null,leave:null,payroll:null}),T({hr:"",attendance:"",leave:"",payroll:""}),ne(!0)},He=async(s,t)=>{de(!0);try{if(s==="hr"){let a=await w("/hr/contracts",{params:{userId:t.id,limit:50}});a.ok||(a=await w(`/hr/employees/${t.id}`)),a.ok?z(r=>({...r,hr:L(a.data)})):T(r=>{var l,n,x,u;return{...r,hr:((x=(n=(l=a==null?void 0:a.error)==null?void 0:l.response)==null?void 0:n.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"HR endpoint not enabled."}})}if(s==="attendance"){const a=await w("/hr/attendance",{params:{userId:t.id,limit:100}});a.ok?z(r=>({...r,attendance:L(a.data)})):T(r=>{var l,n,x,u;return{...r,attendance:((x=(n=(l=a==null?void 0:a.error)==null?void 0:l.response)==null?void 0:n.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Attendance endpoint not enabled."}})}if(s==="leave"){const a=await w("/hr/leave",{params:{userId:t.id,limit:100}});a.ok?z(r=>({...r,leave:L(a.data)})):T(r=>{var l,n,x,u;return{...r,leave:((x=(n=(l=a==null?void 0:a.error)==null?void 0:l.response)==null?void 0:n.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Leave endpoint not enabled."}})}if(s==="payroll"){let a=await w("/payroll",{params:{userId:t.id,limit:50}});a.ok||(a=await w("/payroll/entries",{params:{userId:t.id,limit:50}})),a.ok?z(r=>({...r,payroll:L(a.data)})):T(r=>{var l,n,x,u;return{...r,payroll:((x=(n=(l=a==null?void 0:a.error)==null?void 0:l.response)==null?void 0:n.data)==null?void 0:x.error)||((u=a==null?void 0:a.error)==null?void 0:u.message)||"Payroll endpoint not enabled."}})}}finally{de(!1)}};return o.useEffect(()=>{!_||!f||N!=="profile"&&!j[N]&&He(N,f)},[N,_,f]),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"User & Staff Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{placeholder:"Search name, email, role…",value:m,onChange:s=>g(s.target.value),className:"border rounded px-3 py-1.5 text-sm","aria-label":"Search users"})}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:v,onChange:s=>Y(s.target.value),"aria-label":"Filter by role",children:[e.jsx("option",{value:"",children:"All roles"}),d.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:E,onChange:s=>V(s.target.value),"aria-label":"Filter by branch",children:[e.jsx("option",{value:"",children:"All branches"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(C,{onClick:S,disabled:O,children:O?"Loading…":"Refresh"}),e.jsx(H,{onClick:Oe,children:"Add Staff"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsxs("span",{className:"opacity-70",children:["Selected: ",D.size]}),e.jsxs("select",{className:"border rounded px-2 py-1",onChange:s=>{const t=s.target.value;t&&($e(t),s.target.value="")},"aria-label":"Bulk assign role",defaultValue:"",children:[e.jsx("option",{value:"",children:"Bulk: set role…"}),d.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]}),e.jsxs("select",{className:"border rounded px-2 py-1",onChange:s=>{const t=s.target.value;t&&(Le(t),s.target.value="")},"aria-label":"Bulk assign branch",defaultValue:"",children:[e.jsx("option",{value:"",children:"Bulk: set branch…"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(C,{onClick:De,children:"Export CSV"})]}),ae&&e.jsx("div",{className:"text-sm text-red-600",children:ae}),O?e.jsx("p",{children:"Loading users..."}):e.jsx("div",{className:"overflow-x-auto bg-white border rounded",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-100 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:e.jsx("input",{type:"checkbox",checked:le,onChange:Re,"aria-label":"Select all"})}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Phone"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Role"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Branch"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"text-sm",children:[i.map(s=>{var t,a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:D.has(s.id),onChange:()=>Ee(s.id),"aria-label":`Select ${s.name||s.email||s.id}`})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>Me(s),title:"Open staff profile",children:s.name||`${s.firstName||""} ${s.lastName||""}`.trim()||"—"})}),e.jsx("td",{className:"px-4 py-2",children:s.email||"—"}),e.jsx("td",{className:"px-4 py-2",children:s.phone||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 min-w-[180px]",value:((t=F[s.id])==null?void 0:t.roleId)??"",onChange:r=>oe(s.id,{roleId:r.target.value}),children:[e.jsx("option",{value:"",children:"— Select Role —"}),d.map(r=>e.jsx("option",{value:r.id,children:r.name||r.title},r.id))]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 min-w-[180px]",value:((a=F[s.id])==null?void 0:a.branchId)??"",onChange:r=>oe(s.id,{branchId:r.target.value}),children:[e.jsx("option",{value:"",children:"— Select Branch —"}),b.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded disabled:opacity-50",disabled:!Ie(s)||B[s.id],onClick:()=>Ce(s),children:B[s.id]?"Saving…":"Save"}),e.jsx(We,{actions:[{label:"Edit",onClick:()=>he(s)},{label:"Manage Roles (multi)",onClick:()=>me(s)},{label:"Set/Reset Password",onClick:()=>xe(s)},{label:"Disable",onClick:()=>Pe(s),danger:!0},{label:"Delete (hard)",onClick:()=>Ae(s),danger:!0}]})]})})]},s.id)}),i.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-500",colSpan:7,children:"No users found."})})]})]})}),Ne&&e.jsxs(X,{title:"Add Staff",onClose:()=>q(!1),children:[e.jsxs("div",{className:"grid gap-2",children:[["name","email","phone","password"].map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:s}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",type:s==="password"?"password":"text",value:(c==null?void 0:c[s])??"",onChange:t=>y(a=>({...a,[s]:t.target.value})),placeholder:s==="phone"?"digits only":""})]},s)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Role (optional)"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:(c==null?void 0:c.roleId)??"",onChange:s=>y(t=>({...t,roleId:s.target.value})),children:[e.jsx("option",{value:"",children:"— Select Role —"}),d.map(s=>e.jsx("option",{value:s.id,children:s.name||s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Branch (optional)"}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm w-full",value:(c==null?void 0:c.branchId)??"",onChange:s=>y(t=>({...t,branchId:s.target.value})),children:[e.jsx("option",{value:"",children:"— Select Branch —"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(C,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(H,{onClick:Be,children:"Create"})]})]}),ve&&e.jsxs(X,{title:"Edit Staff",onClose:()=>G(!1),children:[e.jsx("div",{className:"grid gap-2",children:["name","email","phone"].map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 capitalize",children:s}),e.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",value:(c==null?void 0:c[s])??"",onChange:t=>y(a=>({...a,[s]:t.target.value})),placeholder:s==="phone"?"digits only":""})]},s))}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(C,{onClick:()=>G(!1),children:"Cancel"}),e.jsx(H,{onClick:Fe,children:"Save"})]})]}),ke&&e.jsxs(X,{title:"Set/Reset Password",onClose:()=>W(!1),children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"New Password"}),e.jsx("input",{type:"password",className:"border rounded px-2 py-1 text-sm w-full",value:(c==null?void 0:c.password)??"",onChange:s=>y(t=>({...t,password:s.target.value}))})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(C,{onClick:()=>W(!1),children:"Cancel"}),e.jsx(H,{onClick:ze,children:"Set Password"})]})]}),we&&e.jsxs(X,{title:`Manage Roles • ${(c==null?void 0:c.name)||(c==null?void 0:c.email)||""}`,onClose:()=>Q(!1),children:[e.jsx("div",{className:"max-h-[50vh] overflow-auto border rounded p-2",children:d.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No roles found."}):d.map(s=>{const t=s.id??s.roleId??s.RoleId,a=s.name||s.title||`#${t}`,r=ee.has(t);return e.jsxs("label",{className:"flex items-center gap-2 py-1 px-1 rounded hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>Ue(t)}),e.jsx("span",{className:"text-sm",children:a})]},t)})}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx(C,{onClick:()=>Q(!1),children:"Cancel"}),e.jsx(H,{onClick:Te,children:"Save Roles"})]})]}),_&&f&&e.jsxs(Xe,{title:`Staff • ${f.name||f.email||""}`,onClose:()=>ne(!1),wide:!0,children:[e.jsx("div",{className:"border-b mb-3",children:e.jsx("div",{className:"flex gap-2",children:["profile","hr","attendance","leave","payroll"].map(s=>e.jsx("button",{className:`px-3 py-1.5 text-sm rounded-t ${N===s?"bg-blue-600 text-white":"bg-slate-100 hover:bg-slate-200"}`,onClick:()=>ie(s),children:s[0].toUpperCase()+s.slice(1)},s))})}),N==="profile"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Basics"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Name:"})," ",f.name||`${f.firstName||""} ${f.lastName||""}`.trim()||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Email:"})," ",f.email||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Phone:"})," ",f.phone||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Role:"})," ",((pe=f.role)==null?void 0:pe.name)||f.role||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"Branch:"})," ",((ue=b.find(s=>String(s.id)===String(f.branchId)))==null?void 0:ue.name)||"—"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("b",{children:"User ID:"})," ",f.id]})]}),e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{onClick:()=>he(f),children:"Edit"}),e.jsx(C,{onClick:()=>me(f),children:"Roles"}),e.jsx(C,{onClick:()=>xe(f),children:"Password"})]})]})]}),N!=="profile"&&U&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading…"}),N==="hr"&&!U&&e.jsx("div",{children:R.hr?e.jsx("div",{className:"text-sm text-amber-700",children:R.hr}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"HR • Contracts/Employee Info"}),!j.hr||j.hr.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No HR records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Title"}),e.jsx("th",{className:"py-1 px-2",children:"Start"}),e.jsx("th",{className:"py-1 px-2",children:"End"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.hr.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.title||s.position||"—"}),e.jsx("td",{className:"py-1 px-2",children:((a=s.startDate||s.start)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:((r=s.endDate||s.end)==null?void 0:r.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),N==="attendance"&&!U&&e.jsx("div",{children:R.attendance?e.jsx("div",{className:"text-sm text-amber-700",children:R.attendance}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Attendance (latest 100)"}),!j.attendance||j.attendance.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No attendance records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Date"}),e.jsx("th",{className:"py-1 px-2",children:"In"}),e.jsx("th",{className:"py-1 px-2",children:"Out"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.attendance.map((s,t)=>{var a;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:((a=s.date||s.day||s.createdAt)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.clockIn||s.in||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.clockOut||s.out||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),N==="leave"&&!U&&e.jsx("div",{children:R.leave?e.jsx("div",{className:"text-sm text-amber-700",children:R.leave}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Leave Requests"}),!j.leave||j.leave.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No leave records."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Type"}),e.jsx("th",{className:"py-1 px-2",children:"From"}),e.jsx("th",{className:"py-1 px-2",children:"To"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.leave.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.type||"—"}),e.jsx("td",{className:"py-1 px-2",children:((a=s.from||s.startDate)==null?void 0:a.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:((r=s.to||s.endDate)==null?void 0:r.slice(0,10))||"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})}),N==="payroll"&&!U&&e.jsx("div",{children:R.payroll?e.jsx("div",{className:"text-sm text-amber-700",children:R.payroll}):e.jsxs("div",{className:"bg-white border rounded p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Payroll Entries"}),!j.payroll||j.payroll.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No payroll entries."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"Period"}),e.jsx("th",{className:"py-1 px-2",children:"Gross"}),e.jsx("th",{className:"py-1 px-2",children:"Net"}),e.jsx("th",{className:"py-1 px-2",children:"Status"})]})}),e.jsx("tbody",{children:j.payroll.map((s,t)=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 px-2",children:s.period||`${(r=(a=(s.month||"").toString()).padStart)==null?void 0:r.call(a,2,"0")}/${s.year||""}`}),e.jsx("td",{className:"py-1 px-2",children:s.gross!=null?Number(s.gross).toLocaleString():"—"}),e.jsx("td",{className:"py-1 px-2",children:s.net!=null?Number(s.net).toLocaleString():"—"}),e.jsx("td",{className:"py-1 px-2",children:s.status||"—"})]},t)})})]})]})})]})]})};export{Ye as default};
