import{r,b,j as e}from"./index-C_4DK2M-.js";function C(m){try{return[JSON.parse(m),null]}catch(a){return[null,a.message]}}function J({title:m,keyName:a,defaults:u={}}){const[p,j]=r.useState(!0),[g,f]=r.useState(!1),[N,n]=r.useState(""),[S,d]=r.useState(""),[w,l]=r.useState(u),i=r.useMemo(()=>JSON.stringify(w??{},null,2),[w]),[y,h]=r.useState(i);r.useEffect(()=>h(i),[i]),r.useEffect(()=>{let t=!0;return(async()=>{var o,c,x;j(!0),n(""),d("");try{const{data:v}=await b.get(`/api/settings/${encodeURIComponent(a)}`);t&&l(v??u)}catch{try{const{data:s}=await b.get("/api/settings",{params:{key:a}});t&&l(s??u)}catch(s){((o=s==null?void 0:s.response)==null?void 0:o.status)===404?t&&l(u):n(((x=(c=s==null?void 0:s.response)==null?void 0:c.data)==null?void 0:x.error)||s.message||"Failed to load settings")}}finally{t&&j(!1)}})(),()=>{t=!1}},[a]);async function k(){var c,x;f(!0),n(""),d("");const[t,o]=C(y);if(o){f(!1),n(`Invalid JSON: ${o}`);return}try{await b.put(`/api/settings/${encodeURIComponent(a)}`,t),l(t),d("Saved.")}catch{try{await b.put("/api/settings",{key:a,value:t}),l(t),d("Saved.")}catch(s){n(((x=(c=s==null?void 0:s.response)==null?void 0:c.data)==null?void 0:x.error)||s.message||"Failed to save settings")}}finally{f(!1),setTimeout(()=>d(""),2e3)}}return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:m}),e.jsx("div",{className:"text-[11px] text-slate-500",children:e.jsxs("code",{children:["/api/settings/",a]})})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-600 dark:text-slate-400",children:["Configure ",e.jsx("span",{className:"font-medium",children:m}),". This page edits a JSON config stored under the key ",e.jsx("code",{children:a}),". You can keep it simple now and replace with a tailored form later."]})]}),N&&e.jsx("div",{className:"bg-rose-50 text-rose-700 border border-rose-200 rounded-lg p-3 text-sm",children:N}),S&&e.jsx("div",{className:"bg-emerald-50 text-emerald-700 border border-emerald-200 rounded-lg p-3 text-sm",children:S}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"JSON"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded border hover:bg-slate-50 dark:hover:bg-slate-800",onClick:()=>h(i),disabled:p||g,children:"Reformat"})]}),p?e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}):e.jsx("textarea",{rows:18,className:"w-full font-mono text-[12px] rounded border px-3 py-2 bg-white dark:bg-slate-900 dark:border-slate-700",value:y,onChange:t=>h(t.target.value),spellCheck:!1}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:k,disabled:g||p,className:"px-3 py-1.5 rounded bg-blue-600 text-white text-sm disabled:opacity-60",children:g?"Saving…":"Save Changes"}),e.jsx("button",{onClick:()=>h(i),disabled:g||p,className:"px-3 py-1.5 rounded border text-sm",children:"Reset edits"})]})]}),e.jsxs("div",{className:"text-[12px] text-slate-500",children:["Tip: JSON must be valid. Example for renaming/hiding columns:",e.jsx("pre",{className:"mt-1 p-2 rounded bg-slate-50 dark:bg-slate-800 overflow-x-auto",children:`{
  "renameColumns": { "full_name": "Borrower Name", "phone": "Phone" },
  "hideColumns": ["internal_id", "created_at"]
}`})]})]})}export{J as default};
