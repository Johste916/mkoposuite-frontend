import{i as S,r as u,j as r,L as v,g}from"./index-CeHYLxUd.js";import{B as A}from"./BorrowerAutoComplete-_b5Ca4DP.js";async function h(e=[],t={}){let s;for(const d of e)try{const o=await g.get(d,t);return o==null?void 0:o.data}catch(o){s=o}throw s||new Error("No endpoint succeeded")}async function E(e=[],t={},s={}){let d;for(const o of e)try{const l=await g.post(o,t,s);return l==null?void 0:l.data}catch(l){d=l}throw d||new Error("No endpoint succeeded")}async function I(e=[],t={}){let s;for(const d of e)try{const o=await g.delete(d,t);return o==null?void 0:o.data}catch(o){s=o}throw s||new Error("No endpoint succeeded")}function C(e){return{id:e.id??e._id??e.borrowerId??e.memberId,name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||e.fullName||e.id,phone:e.phone??e.msisdn??e.mobile,role:e.role||e.memberRole}}function x(e){var s,d,o;if(!e||typeof e!="object")return null;const t=Array.isArray(e.members)?e.members:e.groupMembers||e.items||[];return{id:e.id??e._id??e.groupId??e.code,name:e.name??e.groupName??e.title??"—",branchName:e.branchName??((s=e.branch)==null?void 0:s.name)??"—",officerName:e.officerName??((d=e.officer)==null?void 0:d.name)??"—",meetingDay:e.meetingDay??((o=e.meeting)==null?void 0:o.day)??"—",members:t.map(C)}}async function G(e,t){const s=encodeURIComponent(e),d=await h([`/borrowers/groups/${s}`,`/groups/${s}`,`/borrower-groups/${s}`,`/api/borrowers/groups/${s}`,`/api/groups/${s}`,`/api/borrower-groups/${s}`],{signal:t}).catch(()=>null);if(d)return x(d);const o=await h([`/borrowers/groups?id=${s}&include=members`,`/borrowers/groups?groupId=${s}&include=members`,`/borrowers/groups?code=${s}&include=members`,`/groups?id=${s}&include=members`,`/groups?groupId=${s}&include=members`,`/groups?code=${s}&include=members`,`/borrower-groups?id=${s}&include=members`,`/borrower-groups?groupId=${s}&include=members`,`/borrower-groups?code=${s}&include=members`,`/api/borrowers/groups?id=${s}&include=members`,`/api/borrowers/groups?groupId=${s}&include=members`,`/api/borrowers/groups?code=${s}&include=members`,`/api/groups?id=${s}&include=members`,`/api/groups?groupId=${s}&include=members`,`/api/groups?code=${s}&include=members`,`/api/borrower-groups?id=${s}&include=members`,`/api/borrower-groups?groupId=${s}&include=members`,`/api/borrower-groups?code=${s}&include=members`],{signal:t}).catch(()=>null)||null;if(o){const m=Array.isArray(o)?o:o.items||o.rows||o.data||[];if(m.length){const c=m.find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e))||m[0];if(c)return x(c)}}const l=await h(["/borrowers/groups?include=members","/groups?include=members","/borrower-groups?include=members","/api/borrowers/groups?include=members","/api/groups?include=members","/api/borrower-groups?include=members"],{signal:t}).catch(()=>null);if(l){const c=(Array.isArray(l)?l:l.items||l.rows||l.data||[]).find(i=>String(i.id)===String(e)||String(i._id)===String(e)||String(i.groupId)===String(e)||String(i.code)===String(e)||String(i.name)===String(e)||String(i.groupName)===String(e));if(c)return x(c)}return null}const a={container:"w-full px-4 md:px-6 lg:px-8 py-6 text-slate-900",h1:"text-3xl font-extrabold tracking-tight",card:"rounded-2xl border-2 border-slate-300 bg-white shadow",btn:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-2 hover:bg-slate-50",primary:"inline-flex items-center rounded-lg bg-indigo-600 text-white px-4 py-2 font-semibold hover:bg-indigo-700 disabled:opacity-60",tableWrap:"rounded-2xl border-2 border-slate-300 bg-white shadow overflow-x-auto",th:"bg-slate-100 text-left text-[13px] uppercase tracking-wide text-slate-700 font-semibold px-3 py-2 border-2 border-slate-200",td:"px-3 py-2 border-2 border-slate-200 text-sm",chip:"ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-bold bg-slate-100 text-slate-700 ring-1 ring-slate-200"},D=()=>{const{groupId:e}=S(),[t,s]=u.useState(null),[d,o]=u.useState(!0),[l,m]=u.useState(""),[c,i]=u.useState(null),[f,w]=u.useState(!1),b=async n=>{try{o(!0),m("");const p=await G(e,n);p?s(p):(m("Group not found."),s(null))}catch{m("Failed to load group (endpoint not implemented)."),s(null)}finally{o(!1)}};u.useEffect(()=>{const n=new AbortController;return b(n.signal),()=>n.abort()},[e]);const j=()=>b(),N=async()=>{if(c!=null&&c.id){w(!0);try{await E([`/borrowers/groups/${e}/members`,`/groups/${e}/members`,`/borrower-groups/${e}/members`,`/api/borrowers/groups/${e}/members`,`/api/groups/${e}/members`,`/api/borrower-groups/${e}/members`],{borrowerId:c.id}),i(null),await b()}catch{alert("Failed to add member.")}finally{w(!1)}}},$=async n=>{try{await I([`/borrowers/groups/${e}/members/${n}`,`/groups/${e}/members/${n}`,`/borrower-groups/${e}/members/${n}`,`/api/borrowers/groups/${e}/members/${n}`,`/api/groups/${e}/members/${n}`,`/api/borrower-groups/${e}/members/${n}`]),await b()}catch{alert("Failed to remove member.")}},y=Array.isArray(t==null?void 0:t.members)?t.members:[];return r.jsxs("div",{className:a.container,children:[r.jsxs("div",{className:"mb-4 flex flex-wrap items-end justify-between gap-3",children:[r.jsxs("h1",{className:a.h1,children:["Group #",e,t!=null&&t.name?r.jsxs("span",{className:"font-medium text-slate-700",children:[" • ",t.name]}):null]}),r.jsx("button",{onClick:j,className:a.btn,children:"Refresh"})]}),d&&r.jsx("div",{className:"rounded-2xl border-2 border-slate-300 bg-white px-4 py-3",children:"Loading…"}),l&&r.jsx("div",{className:"rounded-2xl border-2 border-rose-300 bg-rose-50 px-4 py-3 text-rose-800",children:l}),r.jsxs("div",{className:"grid grid-cols-1 gap-5 lg:grid-cols-3",children:[r.jsxs("section",{className:`${a.card} p-4`,children:[r.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Overview"}),r.jsxs("ul",{className:"space-y-1 text-[15px]",children:[r.jsxs("li",{children:[r.jsx("b",{children:"Name:"})," ",(t==null?void 0:t.name)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Branch:"})," ",(t==null?void 0:t.branchName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Officer:"})," ",(t==null?void 0:t.officerName)??"—"]}),r.jsxs("li",{children:[r.jsx("b",{children:"Meeting Day:"})," ",(t==null?void 0:t.meetingDay)??"—"]})]})]}),r.jsxs("section",{className:`${a.card} p-4 lg:col-span-2`,children:[r.jsx("h3",{className:"mb-3 text-lg font-semibold",children:"Members"}),r.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx(A,{value:c,onChange:(n,p)=>i(p),placeholder:"Add borrower…"})}),r.jsx("button",{onClick:N,disabled:!c||f,className:a.primary,children:f?"Adding…":"Add"})]}),r.jsx("div",{className:a.tableWrap,children:r.jsxs("table",{className:"min-w-full table-auto",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:a.th,children:"Borrower"}),r.jsx("th",{className:a.th,children:"Phone"}),r.jsx("th",{className:a.th,children:"Role"}),r.jsx("th",{className:a.th,children:"Actions"})]})}),r.jsx("tbody",{children:y.length===0?r.jsx("tr",{children:r.jsx("td",{className:a.td,colSpan:4,children:r.jsx("span",{className:"text-slate-600",children:"No members yet."})})}):y.map(n=>r.jsxs("tr",{children:[r.jsx("td",{className:a.td,children:r.jsx(v,{to:`/borrowers/${encodeURIComponent(n.id)}`,className:"font-semibold underline decoration-2 underline-offset-2 hover:text-slate-950",children:n.name})}),r.jsx("td",{className:a.td,children:n.phone||"—"}),r.jsx("td",{className:a.td,children:n.role?r.jsx("span",{className:a.chip,children:String(n.role).toUpperCase()}):"—"}),r.jsx("td",{className:a.td,children:r.jsx("button",{className:"inline-flex items-center rounded-lg border-2 border-slate-300 px-3 py-1.5 hover:bg-slate-50",onClick:()=>$(n.id),children:"Remove"})})]},n.id))})]})})]})]})]})};export{D as default};
